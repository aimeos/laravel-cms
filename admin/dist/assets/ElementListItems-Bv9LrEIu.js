import{_ as A,am as N,c as v,a0 as V,F as x,o as u,ar as O,a as l,b as _,w as r,j as m,d as k,t as y,E as S,aF as T,aG as f,a2 as h,D,a6 as F,a7 as U,aM as j,aR as B,b4 as M,aS as q,b5 as R,ao as H,f as g,H as E,Z as J,h as W,aE as $,C as z,b6 as Q,an as Y,T as Z,r as G,av as w,ax as I,i as K}from"../index.js";const X={props:{data:{type:Object,default:()=>{}},files:{type:Array,default:()=>[]},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},fields:{type:Object,required:!0}},emits:["change","error","update:files"],inject:["compose","translate","txlanguages"],data(){return{translating:{},composing:{},errors:{}}},setup(){return{messages:N()}},methods:{addFile(t){const e=Array.isArray(t)?t:[t],s=[...this.files];s.push(...e),this.$emit("update:files",s)},composeText(t){const e=["generate for: "+(this.fields[t].label||t),"required output format: "+this.fields[t].type,this.fields[t].min?"minimum characters: "+this.fields[t].min:null,this.fields[t].max?"maximum characters: "+this.fields[t].max:null,this.fields[t].placeholder?"hint text: "+this.fields[t].placeholder:null,"context information as JSON: "+JSON.stringify(this.data)];this.composing[t]=!0,this.compose(this.data[t]??"",e).then(s=>{this.update(t,s)}).finally(()=>{this.composing[t]=!1})},error(t,e){this.errors[t]=e,this.$emit("error",Object.values(this.errors).includes(!0))},removeFile(t){const e=Array.isArray(t)?t:[t],s=[...this.files];for(const o of e){const i=s.findIndex(n=>n===o);i!==-1&&s.splice(i,1)}this.$emit("update:files",s)},translateText(t,e){this.translating[t]=!0,this.translate([this.data[t]],e).then(s=>{this.update(t,s[0]||"")}).finally(()=>{this.translating[t]=!1})},update(t,e){this.data[t]=e,this.$emit("change",this.data[t])},validate(){var e;const t=[];return(e=this.$refs.field)==null||e.forEach(s=>{t.push(s.validate())}),Promise.all(t).then(s=>s.every(o=>o))}}},ee={key:0,class:"actions"};function te(t,e,s,o,i,n){return u(!0),v(x,null,V(s.fields,(d,a)=>{var b,c,C;return u(),v("div",{key:a,class:O(["item",{error:i.errors[a]}])},[l(F,null,{default:r(()=>[m(y(d.label||a)+" ",1),!s.readonly&&["markdown","plaintext","string","text"].includes(d.type)?(u(),v("div",ee,[l(S,null,{activator:r(({props:p})=>[l(h,D({loading:i.translating[a]||!1,icon:"mdi-translate",elevation:"0"},{ref_for:!0},p),null,16,["loading"])]),default:r(()=>[l(T,null,{default:r(()=>[(u(!0),v(x,null,V(n.txlanguages(),p=>(u(),_(f,{key:p.code},{default:r(()=>[l(h,{variant:"text",onClick:P=>n.translateText(a,p.code)},{default:r(()=>[m("ðŸ – "+y(p.name)+" ("+y(p.code)+")",1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),l(h,{loading:i.composing[a]||!1,icon:"mdi-creation",variant:"flat",onClick:p=>n.composeText(a)},null,8,["loading","onClick"])])):k("",!0)]),_:2},1024),(u(),_(U(((c=(b=d.type)==null?void 0:b.charAt(0))==null?void 0:c.toUpperCase())+((C=d.type)==null?void 0:C.slice(1))),{ref_for:!0,ref:"field",assets:s.assets,config:d,readonly:s.readonly,modelValue:s.data[a],onAddFile:e[0]||(e[0]=p=>n.addFile(p)),onRemoveFile:e[1]||(e[1]=p=>n.removeFile(p)),"onUpdate:modelValue":p=>n.update(a,p),onError:p=>n.error(a,p)},null,40,["assets","config","readonly","modelValue","onUpdate:modelValue","onError"]))],2)}),128)}const Ee=A(X,[["render",te],["__scopeId","data-v-ecb04003"]]),Ve=function(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",e=new Date("2025-01-01T00:00:00Z").getTime();let s=0;return function(){s=(s+1)%16;const o=Math.floor((Date.now()-e)/8)<<4|s;return Array.from({length:7},(i,n)=>{const d=o>>7*(7-n)&63;return t[n===0?d%52:d]}).join("")}}(),se={props:{type:{type:String,required:!0}},emits:["add"],data:()=>({tab:["basic"]}),setup(){return{schemas:j()}},computed:{groups(){const t={};for(const e in this.schemas[this.type]||{}){const s=this.schemas[this.type][e],o=s.group||"uncategorized";s.type=e,t[o]=t[o]||[],t[o].push(s)}return t}},methods:{add(t){this.$emit("add",{type:t.type})}}},ae=["innerHTML"];function re(t,e,s,o,i,n){return u(),v(x,null,[l(B,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=d=>t.tab=d)},{default:r(()=>[(u(!0),v(x,null,V(n.groups,(d,a)=>(u(),_(q,{key:a,value:a},{default:r(()=>[m(y(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(M,{modelValue:t.tab,"onUpdate:modelValue":e[1]||(e[1]=d=>t.tab=d)},{default:r(()=>[(u(!0),v(x,null,V(Object.keys(n.groups),d=>(u(),_(R,{key:d,value:d},{default:r(()=>[l(H,null,{default:r(()=>[(u(!0),v(x,null,V(n.groups[d],a=>(u(),_(h,{key:a.type,onClick:b=>n.add(a),variant:"text",stacked:""},{prepend:r(()=>[g("span",{class:"icon",innerHTML:a.icon},null,8,ae)]),default:r(()=>[m(" "+y(a.type),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],64)}const le=A(se,[["render",re],["__scopeId","data-v-06e74854"]]),ie={components:{SchemaItems:le},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,vschemas:!1,checked:!1,loading:!0,trash:!1}},setup(){const t=N();return{auth:J(),messages:t}},created(){this.search(),this.searchd=this.debounce(this.search,500)},computed:{canTrash(){return this.items.some(t=>t._checked&&!t.deleted_at)},isChecked(){return this.items.some(t=>t._checked)},isTrashed(){return this.items.some(t=>t._checked&&t.deleted_at)}},methods:{add(t){if(this.embed||!this.auth.can("element:add")){this.messages.add("Permission denied","error");return}return this.$apollo.mutate({mutation:E`mutation($input: ElementInput!) {
            addElement(input: $input) {
              id
              lang
              name
              type
              data
              editor
              created_at
              updated_at
              deleted_at
            }
          }`,variables:{input:{type:t.type,name:"New shared element",data:"{}"}}}).then(e=>{var o;if(e.errors)throw e.errors;const s=((o=e.data)==null?void 0:o.addElement)||{};return s.data=JSON.parse(s.data)||{},s.published=!0,this.vschemas=!1,this.items.unshift(s),this.$emit("select",s),this.invalidate(),s}).catch(e=>{this.$log("ElementListItems::add(): Error adding shared element",e)})},debounce(t,e){let s;return function(...o){return new Promise((i,n)=>{const d=this;clearTimeout(s),s=setTimeout(()=>{try{i(t.apply(d,o))}catch(a){n(a)}},e)})}},drop(t){if(!this.auth.can("element:drop")){this.messages.add("Permission denied","error");return}const e=t?[t]:this.items.filter(s=>s._checked);e.length&&this.$apollo.mutate({mutation:E`
            mutation($id: [ID!]!) {
              dropElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add("Error trashing shared element","error"),this.$log("ElementListItems::drop(): Error trashing shared element",e,s)})},invalidate(){const t=this.$apollo.provider.defaultClient.cache;t.evict({id:"ROOT_QUERY",fieldName:"elements"}),t.gc()},keep(t){if(!this.auth.can("element:keep")){this.messages.add("Permission denied","error");return}const e=t?[t]:this.items.filter(s=>s._checked);e.length&&this.$apollo.mutate({mutation:E`
            mutation($id: [ID!]!) {
              keepElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;e.forEach(o=>{o.deleted_at=null}),this.invalidate(),this.search()}).catch(s=>{this.messages.add("Error restoring shared element","error"),this.$log("ElementListItems::keep(): Error restoring shared element",e,s)})},publish(t){if(!this.auth.can("element:publish")){this.messages.add("Permission denied","error");return}const e=t?[t]:this.items.filter(s=>s._checked&&s.id&&!s.published);e.length&&this.$apollo.mutate({mutation:E`mutation ($id: [ID!]!) {
            pubElement(id: $id) {
              id
            }
          }`,variables:{id:e.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;e.forEach(o=>{o.published=!0,o._checked=!1}),this.invalidate(),this.search()}).catch(s=>{this.messages.add("Error publishing shared element","error"),this.$log("ElementListItems::publish(): Error publishing shared element",e,s)})},purge(t){if(!this.auth.can("element:purge")){this.messages.add("Permission denied","error");return}const e=t?[t]:this.items.filter(s=>s._checked);e.length&&this.$apollo.mutate({mutation:E`
            mutation($id: [ID!]!) {
              purgeElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add("Error purging shared element","error"),this.$log("ElementListItems::purge(): Error purging shared element",e,s)})},search(){if(!this.auth.can("element:view"))return this.messages.add("Permission denied","error"),Promise.resolve([]);const t=this.filter.publish||null,e=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.publish,delete s.trashed,this.term&&(s.any=this.term),this.loading=!0,this.$apollo.query({query:E`
            query($filter: ElementFilter, $sort: [QueryElementsSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              elements(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  type
                  data
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:s,page:this.page,limit:this.limit,sort:[this.sort],trashed:e,publish:t}}).then(o=>{var n;if(o.errors)throw o.errors;const i=o.data.elements||{};return this.last=((n=i.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...i.data||[]].map(d=>{var b,c,C,p,P,L;const a=(b=d.latest)!=null&&b.data?JSON.parse((c=d.latest)==null?void 0:c.data):{...d,data:JSON.parse(d.data||"{}")};return Object.assign(a,{id:d.id,deleted_at:d.deleted_at,created_at:d.created_at,updated_at:((C=d.latest)==null?void 0:C.created_at)||d.updated_at,editor:((p=d.latest)==null?void 0:p.editor)||d.editor,published:((P=d.latest)==null?void 0:P.published)??!0,publish_at:((L=d.latest)==null?void 0:L.publish_at)||null,latest:d.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(o=>{this.messages.add("Error fetching shared elements","error"),this.$log("ElementListItems::search(): Error fetching shared element",o)})},title(t){const e=[];return t.publish_at&&e.push("Publish at: "+new Date(t.publish_at).toLocaleDateString()),e.join(`
`)},toggle(){this.items.forEach(t=>{t._checked=!t._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},ne={class:"header"},de={class:"bulk"},oe={class:"search"},ue={class:"layout"},he=["onClick","title"],me={class:"item-text"},pe={key:1,class:"item-lang"},ce={class:"item-title"},fe={class:"item-type item-subtitle"},ge={class:"item-aux"},ve={class:"item-editor"},_e={class:"item-modified item-subtitle"},be={key:0,class:"loading"},ke={key:1,class:"notfound"},ye={key:3,class:"btn-group"};function Ce(t,e,s,o,i,n){const d=G("SchemaItems");return u(),v(x,null,[g("div",ne,[g("div",de,[l($,{modelValue:i.checked,"onUpdate:modelValue":e[0]||(e[0]=a=>i.checked=a),onClick:e[1]||(e[1]=W(a=>n.toggle(),["stop"]))},null,8,["modelValue"]),l(S,{location:"bottom left"},{activator:r(({props:a})=>[l(h,D({"append-icon":"mdi-menu-down",variant:"text"},a),{default:r(()=>e[17]||(e[17]=[m("Actions")])),_:2,__:[17]},1040)]),default:r(()=>[l(T,null,{default:r(()=>[w(l(f,null,{default:r(()=>[l(h,{"prepend-icon":"mdi-publish",variant:"text",onClick:e[2]||(e[2]=a=>n.publish())},{default:r(()=>e[18]||(e[18]=[m("Publish")])),_:1,__:[18]})]),_:1},512),[[I,n.isChecked&&o.auth.can("element:publish")]]),!this.embed&&o.auth.can("element:add")?(u(),_(f,{key:0},{default:r(()=>[l(h,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:e[3]||(e[3]=a=>i.vschemas=!0)},{default:r(()=>e[19]||(e[19]=[m("Add element")])),_:1,__:[19]})]),_:1})):k("",!0),w(l(f,null,{default:r(()=>[l(h,{"prepend-icon":"mdi-delete",variant:"text",onClick:e[4]||(e[4]=a=>n.drop())},{default:r(()=>e[20]||(e[20]=[m("Trash")])),_:1,__:[20]})]),_:1},512),[[I,n.canTrash&&o.auth.can("element:drop")]]),w(l(f,null,{default:r(()=>[l(h,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:e[5]||(e[5]=a=>n.keep())},{default:r(()=>e[21]||(e[21]=[m("Restore")])),_:1,__:[21]})]),_:1},512),[[I,n.isTrashed&&o.auth.can("element:keep")]]),w(l(f,null,{default:r(()=>[l(h,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:e[6]||(e[6]=a=>n.purge())},{default:r(()=>e[22]||(e[22]=[m("Purge")])),_:1,__:[22]})]),_:1},512),[[I,n.isChecked&&o.auth.can("element:purge")]])]),_:1})]),_:1})]),g("div",oe,[l(z,{modelValue:i.term,"onUpdate:modelValue":e[7]||(e[7]=a=>i.term=a),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:"Search for","hide-details":"",clearable:""},null,8,["modelValue"])]),g("div",ue,[l(S,null,{activator:r(({props:a})=>[l(h,D({"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text",location:"bottom right"},a),{default:r(()=>{var b,c,C;return[m(y(((b=i.sort)==null?void 0:b.column)==="ID"?((c=i.sort)==null?void 0:c.order)==="DESC"?"Latest":"Oldest":((C=i.sort)==null?void 0:C.column)||""),1)]}),_:2},1040)]),default:r(()=>[l(T,null,{default:r(()=>[l(f,null,{default:r(()=>[l(h,{variant:"text",onClick:e[8]||(e[8]=a=>i.sort={column:"ID",order:"DESC"})},{default:r(()=>e[23]||(e[23]=[m("Latest")])),_:1,__:[23]})]),_:1}),l(f,null,{default:r(()=>[l(h,{variant:"text",onClick:e[9]||(e[9]=a=>i.sort={column:"ID",order:"ASC"})},{default:r(()=>e[24]||(e[24]=[m("Oldest")])),_:1,__:[24]})]),_:1}),l(f,null,{default:r(()=>[l(h,{variant:"text",onClick:e[10]||(e[10]=a=>i.sort={column:"NAME",order:"ASC"})},{default:r(()=>e[25]||(e[25]=[m("Name")])),_:1,__:[25]})]),_:1}),l(f,null,{default:r(()=>[l(h,{variant:"text",onClick:e[11]||(e[11]=a=>i.sort={column:"TYPE",order:"ASC"})},{default:r(()=>e[26]||(e[26]=[m("Type")])),_:1,__:[26]})]),_:1}),l(f,null,{default:r(()=>[l(h,{variant:"text",onClick:e[12]||(e[12]=a=>i.sort={column:"EDITOR",order:"ASC"})},{default:r(()=>e[27]||(e[27]=[m("Editor")])),_:1,__:[27]})]),_:1})]),_:1})]),_:1})])]),l(T,{class:"items"},{default:r(()=>[(u(!0),v(x,null,V(i.items,(a,b)=>(u(),_(f,{key:b},{default:r(()=>[l($,{modelValue:a._checked,"onUpdate:modelValue":c=>a._checked=c,class:O([{draft:!a.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),l(S,null,{activator:r(({props:c})=>[l(h,D({class:"item-menu",icon:"mdi-dots-vertical",variant:"text"},{ref_for:!0},c),null,16)]),default:r(()=>[l(T,null,{default:r(()=>[w(l(f,null,{default:r(()=>[l(h,{"prepend-icon":"mdi-publish",variant:"text",onClick:c=>n.publish(a)},{default:r(()=>e[28]||(e[28]=[m("Publish")])),_:2,__:[28]},1032,["onClick"])]),_:2},1536),[[I,!a.deleted_at&&!a.published&&this.auth.can("element:publish")]]),!a.deleted_at&&this.auth.can("element:drop")?(u(),_(f,{key:0},{default:r(()=>[l(h,{"prepend-icon":"mdi-delete",variant:"text",onClick:c=>n.drop(a)},{default:r(()=>e[29]||(e[29]=[m("Trash")])),_:2,__:[29]},1032,["onClick"])]),_:2},1024)):k("",!0),a.deleted_at&&this.auth.can("element:keep")?(u(),_(f,{key:1},{default:r(()=>[l(h,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:c=>n.keep(a)},{default:r(()=>e[30]||(e[30]=[m("Restore")])),_:2,__:[30]},1032,["onClick"])]),_:2},1024)):k("",!0),this.auth.can("element:purge")?(u(),_(f,{key:2},{default:r(()=>[l(h,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:c=>n.purge(a)},{default:r(()=>e[31]||(e[31]=[m("Purge")])),_:2,__:[31]},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024),g("div",{class:O(["item-content",{trashed:a.deleted_at}]),onClick:c=>t.$emit("select",a),title:n.title(a)},[g("div",me,[a.publish_at?(u(),_(K,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):k("",!0),a.lang?(u(),v("span",pe,y(a.lang),1)):k("",!0),g("span",ce,y(a.name),1),g("div",fe,y(a.type),1)]),g("div",ge,[g("div",ve,y(a.editor),1),g("div",_e,y(new Date(a.updated_at).toLocaleString()),1)])],10,he)]),_:2},1024))),128))]),_:1}),i.loading?(u(),v("p",be,e[32]||(e[32]=[m(" Loading "),g("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1)]))):k("",!0),!i.loading&&!i.items.length?(u(),v("p",ke," No items found ")):k("",!0),i.last>1?(u(),_(Q,{key:2,modelValue:i.page,"onUpdate:modelValue":e[13]||(e[13]=a=>i.page=a),length:i.last},null,8,["modelValue","length"])):k("",!0),!this.embed&&this.auth.can("element:add")?(u(),v("div",ye,[l(h,{onClick:e[14]||(e[14]=a=>i.vschemas=!0),icon:"mdi-view-grid-plus",color:"primary",elevation:"0"})])):k("",!0),(u(),_(Z,{to:"body"},[l(Y,{modelValue:i.vschemas,"onUpdate:modelValue":e[16]||(e[16]=a=>i.vschemas=a),scrollable:"",width:"auto"},{default:r(()=>[l(d,{type:"content",onAdd:e[15]||(e[15]=a=>n.add(a))})]),_:1},8,["modelValue"])]))],64)}const we=A(ie,[["render",Ce],["__scopeId","data-v-3886cd71"]]);export{we as E,Ee as F,le as S,Ve as u};
