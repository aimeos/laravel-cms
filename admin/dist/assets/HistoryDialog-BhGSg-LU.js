import{_ as de,aE as ce,b as _,w as s,aP as ve,o as p,a as v,a8 as me,aQ as he,c as D,F as B,a2 as J,a9 as ee,f as L,aR as pe,l as y,t as g,aS as ge,aT as ye,a3 as Ce,a4 as U,aw as we,a5 as G,aU as Ve,d as Q,aV as A,aW as te,aI as O,aX as ne,j as re,h as ae,aY as Te,i as $e}from"../index.js";const Le={props:{item:{type:Object,required:!0}},setup(){return{drawer:ce()}},computed:{values(){const t={[this.$gettext("id")]:this.item.id,[this.$gettext("editor")]:this.item.editor};return this.item.created_at&&(t[this.$gettext("created")]=new Date(this.item.created_at).toLocaleString(this.$vuetify.locale.current)),this.item.updated_at&&(t[this.$gettext("updated")]=new Date(this.item.updated_at).toLocaleString(this.$vuetify.locale.current)),this.item.deleted_at&&(t[this.$gettext("deleted")]=new Date(this.item.deleted_at).toLocaleString(this.$vuetify.locale.current)),t}}};function _e(t,e,n,a,l,r){return p(),_(ve,{modelValue:a.drawer.aside,"onUpdate:modelValue":e[0]||(e[0]=i=>a.drawer.aside=i),"mobile-breakpoint":"md",location:"end"},{default:s(()=>[v(me,{opened:[0]},{default:s(()=>[v(he,{value:0},{activator:s(({props:i})=>[v(ee,ge(ye(i)),{default:s(()=>[y(g(t.$gettext("Meta data")),1)]),_:2},1040)]),default:s(()=>[(p(!0),D(B,null,J(r.values,(i,o)=>(p(),_(ee,{key:o,rounded:"lg"},{default:s(()=>[v(pe,{class:"name"},{default:s(()=>[y(g(o),1)]),_:2},1024),L("div",null,g(i),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Ae=de(Le,[["render",_e],["__scopeId","data-v-ecd13b29"]]);function C(){}C.prototype={diff:function(e,n){var a,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=l.callback;typeof l=="function"&&(r=l,l={});var i=this;function o(c){return c=i.postProcess(c,l),r?(setTimeout(function(){r(c)},0),!0):c}e=this.castInput(e,l),n=this.castInput(n,l),e=this.removeEmpty(this.tokenize(e,l)),n=this.removeEmpty(this.tokenize(n,l));var u=n.length,d=e.length,f=1,m=u+d;l.maxEditLength!=null&&(m=Math.min(m,l.maxEditLength));var T=(a=l.timeout)!==null&&a!==void 0?a:1/0,V=Date.now()+T,h=[{oldPos:-1,lastComponent:void 0}],w=this.extractCommon(h[0],n,e,0,l);if(h[0].oldPos+1>=d&&w+1>=u)return o(ie(i,h[0].lastComponent,n,e,i.useLongestToken));var E=-1/0,I=1/0;function q(){for(var c=Math.max(E,-f);c<=Math.min(I,f);c+=2){var $=void 0,k=h[c-1],x=h[c+1];k&&(h[c-1]=void 0);var P=!1;if(x){var S=x.oldPos-c;P=x&&0<=S&&S<u}var K=k&&k.oldPos+1<d;if(!P&&!K){h[c]=void 0;continue}if(!K||P&&k.oldPos<x.oldPos?$=i.addToPath(x,!0,!1,0,l):$=i.addToPath(k,!1,!0,1,l),w=i.extractCommon($,n,e,c,l),$.oldPos+1>=d&&w+1>=u)return o(ie(i,$.lastComponent,n,e,i.useLongestToken));h[c]=$,$.oldPos+1>=d&&(I=Math.min(I,c-1)),w+1>=u&&(E=Math.max(E,c+1))}f++}if(r)(function c(){setTimeout(function(){if(f>m||Date.now()>V)return r();q()||c()},0)})();else for(;f<=m&&Date.now()<=V;){var M=q();if(M)return M}},addToPath:function(e,n,a,l,r){var i=e.lastComponent;return i&&!r.oneChangePerToken&&i.added===n&&i.removed===a?{oldPos:e.oldPos+l,lastComponent:{count:i.count+1,added:n,removed:a,previousComponent:i.previousComponent}}:{oldPos:e.oldPos+l,lastComponent:{count:1,added:n,removed:a,previousComponent:i}}},extractCommon:function(e,n,a,l,r){for(var i=n.length,o=a.length,u=e.oldPos,d=u-l,f=0;d+1<i&&u+1<o&&this.equals(a[u+1],n[d+1],r);)d++,u++,f++,r.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return f&&!r.oneChangePerToken&&(e.lastComponent={count:f,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=u,d},equals:function(e,n,a){return a.comparator?a.comparator(e,n):e===n||a.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],a=0;a<e.length;a++)e[a]&&n.push(e[a]);return n},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function ie(t,e,n,a,l){for(var r=[],i;e;)r.push(e),i=e.previousComponent,delete e.previousComponent,e=i;r.reverse();for(var o=0,u=r.length,d=0,f=0;o<u;o++){var m=r[o];if(m.removed)m.value=t.join(a.slice(f,f+m.count)),f+=m.count;else{if(!m.added&&l){var T=n.slice(d,d+m.count);T=T.map(function(V,h){var w=a[f+h];return w.length>V.length?w:V}),m.value=t.join(T)}else m.value=t.join(n.slice(d,d+m.count));d+=m.count,m.added||(f+=m.count)}}return r}function le(t,e){var n;for(n=0;n<t.length&&n<e.length;n++)if(t[n]!=e[n])return t.slice(0,n);return t.slice(0,n)}function ue(t,e){var n;if(!t||!e||t[t.length-1]!=e[e.length-1])return"";for(n=0;n<t.length&&n<e.length;n++)if(t[t.length-(n+1)]!=e[e.length-(n+1)])return t.slice(-n);return t.slice(-n)}function X(t,e,n){if(t.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return n+t.slice(e.length)}function Y(t,e,n){if(!e)return t+n;if(t.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return t.slice(0,-e.length)+n}function N(t,e){return X(t,e,"")}function R(t,e){return Y(t,e,"")}function oe(t,e){return e.slice(0,De(t,e))}function De(t,e){var n=0;t.length>e.length&&(n=t.length-e.length);var a=e.length;t.length<e.length&&(a=t.length);var l=Array(a),r=0;l[0]=0;for(var i=1;i<a;i++){for(e[i]==e[r]?l[i]=l[r]:l[i]=r;r>0&&e[i]!=e[r];)r=l[r];e[i]==e[r]&&r++}r=0;for(var o=n;o<t.length;o++){for(;r>0&&t[o]!=e[r];)r=l[r];t[o]==e[r]&&r++}return r}var F="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ze=new RegExp("[".concat(F,"]+|\\s+|[^").concat(F,"]"),"ug"),H=new C;H.equals=function(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()};H.tokenize=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(e.intlSegmenter.segment(t),function(r){return r.segment})}else n=t.match(ze)||[];var a=[],l=null;return n.forEach(function(r){/\s/.test(r)?l==null?a.push(r):a.push(a.pop()+r):/\s/.test(l)?a[a.length-1]==l?a.push(a.pop()+r):a.push(l+r):a.push(r),l=r}),a};H.join=function(t){return t.map(function(e,n){return n==0?e:e.replace(/^\s+/,"")}).join("")};H.postProcess=function(t,e){if(!t||e.oneChangePerToken)return t;var n=null,a=null,l=null;return t.forEach(function(r){r.added?a=r:r.removed?l=r:((a||l)&&se(n,l,a,r),n=r,a=null,l=null)}),(a||l)&&se(n,l,a,null),t};function se(t,e,n,a){if(e&&n){var l=e.value.match(/^\s*/)[0],r=e.value.match(/\s*$/)[0],i=n.value.match(/^\s*/)[0],o=n.value.match(/\s*$/)[0];if(t){var u=le(l,i);t.value=Y(t.value,i,u),e.value=N(e.value,u),n.value=N(n.value,u)}if(a){var d=ue(r,o);a.value=X(a.value,o,d),e.value=R(e.value,d),n.value=R(n.value,d)}}else if(n)t&&(n.value=n.value.replace(/^\s*/,"")),a&&(a.value=a.value.replace(/^\s*/,""));else if(t&&a){var f=a.value.match(/^\s*/)[0],m=e.value.match(/^\s*/)[0],T=e.value.match(/\s*$/)[0],V=le(f,m);e.value=N(e.value,V);var h=ue(N(f,V),T);e.value=R(e.value,h),a.value=X(a.value,f,h),t.value=Y(t.value,f,f.slice(0,f.length-h.length))}else if(a){var w=a.value.match(/^\s*/)[0],E=e.value.match(/\s*$/)[0],I=oe(E,w);e.value=R(e.value,I)}else if(t){var q=t.value.match(/\s*$/)[0],M=e.value.match(/^\s*/)[0],c=oe(q,M);e.value=N(e.value,c)}}var Ee=new C;Ee.tokenize=function(t){var e=new RegExp("(\\r?\\n)|[".concat(F,"]+|[^\\S\\n\\r]+|[^").concat(F,"]"),"ug");return t.match(e)||[]};var W=new C;W.tokenize=function(t,e){e.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var n=[],a=t.split(/(\n|\r\n)/);a[a.length-1]||a.pop();for(var l=0;l<a.length;l++){var r=a[l];l%2&&!e.newlineIsToken?n[n.length-1]+=r:n.push(r)}return n};W.equals=function(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),C.prototype.equals.call(this,t,e,n)};var Ie=new C;Ie.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var ke=new C;ke.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function Z(t){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(t)}var z=new C;z.useLongestToken=!0;z.tokenize=W.tokenize;z.castInput=function(t,e){var n=e.undefinedReplacement,a=e.stringifyReplacer,l=a===void 0?function(r,i){return typeof i>"u"?n:i}:a;return typeof t=="string"?t:JSON.stringify(b(t,null,null,l),l,"  ")};z.equals=function(t,e,n){return C.prototype.equals.call(z,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)};function fe(t,e,n){return z.diff(t,e,n)}function b(t,e,n,a,l){e=e||[],n=n||[],a&&(t=a(l,t));var r;for(r=0;r<e.length;r+=1)if(e[r]===t)return n[r];var i;if(Object.prototype.toString.call(t)==="[object Array]"){for(e.push(t),i=new Array(t.length),n.push(i),r=0;r<t.length;r+=1)i[r]=b(t[r],e,n,a,l);return e.pop(),n.pop(),i}if(t&&t.toJSON&&(t=t.toJSON()),Z(t)==="object"&&t!==null){e.push(t),i={},n.push(i);var o=[],u;for(u in t)Object.prototype.hasOwnProperty.call(t,u)&&o.push(u);for(o.sort(),r=0;r<o.length;r+=1)u=o[r],i[u]=b(t[u],e,n,a,u);e.pop(),n.pop()}else i=t;return i}var j=new C;j.tokenize=function(t){return t.slice()};j.join=j.removeEmpty=function(t){return t};const xe={props:{modelValue:{type:Boolean,required:!0},current:{type:Object,required:!0},load:{type:Function,required:!0}},emit:["update:modelValue","use","revert"],data:()=>({list:[],latest:null,loading:!1,show:!1}),computed:{versions(){return this.list.filter(t=>this.isModified(t,this.current)||t.published||t.publish_at)}},methods:{diff(t,e){return t&&e?fe(t,e):e?[e]:[]},isModified(t,e){return!t||!e?!1:fe(t.data||{},e.data||{}).length!==1},reset(){this.list=[],this.latest=null}},watch:{modelValue:{immediate:!0,handler(t){t&&!this.latest&&(this.loading=!0,this.load().then(e=>{this.latest=e.shift(),this.list=e}).finally(()=>{this.loading=!1}))}}}},Oe={class:"loading"},Ne=["onClick"];function qe(t,e,n,a,l,r){return p(),_(Ce,{modelValue:n.modelValue,"max-width":"1200",scrollable:""},{default:s(()=>[v(U,{"prepend-icon":"mdi-history"},{append:s(()=>[v($e,{onClick:e[0]||(e[0]=i=>t.$emit("update:modelValue",!1))},{default:s(()=>e[3]||(e[3]=[y("mdi-close")])),_:1,__:[3]})]),title:s(()=>[y(g(t.$gettext("History")),1)]),default:s(()=>[v(we),v(G,null,{default:s(()=>[v(Ve,{side:"end",align:"start"},{default:s(()=>[t.loading?(p(),_(A,{key:0,size:"small","dot-color":"grey-lighten-1"},{default:s(()=>[L("div",Oe,[y(g(t.$gettext("Loading"))+" ",1),e[4]||(e[4]=L("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[L("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),L("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),L("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])]),_:1})):Q("",!0),!t.loading&&!(t.latest&&r.isModified(t.latest,n.current)||r.versions.length)?(p(),_(A,{key:1,size:"small","dot-color":"grey-lighten-1"},{default:s(()=>[y(g(t.$gettext("No changes")),1)]),_:1})):Q("",!0),!t.loading&&t.latest&&r.isModified(t.latest,n.current)?(p(),_(A,{key:2,size:"small","dot-color":"blue"},{default:s(()=>[v(U,{class:"elevation-2",onClick:e[2]||(e[2]=i=>t.show=!t.show)},{default:s(()=>[v(te,null,{default:s(()=>[y(g(t.$gettext("Current")),1)]),_:1}),v(G,{class:O(["diff",{show:t.show}])},{default:s(()=>{var i;return[(p(!0),D(B,null,J(r.diff(n.current.data,(i=t.latest)==null?void 0:i.data),o=>(p(),D("span",{class:O({added:o.added,removed:o.removed})},g(o.value||o),3))),256))]}),_:1},8,["class"]),v(ne,null,{default:s(()=>[v(re,{variant:"outlined",onClick:e[1]||(e[1]=ae(i=>t.$emit("revert",t.latest),["stop"]))},{default:s(()=>[y(g(t.$gettext("Revert")),1)]),_:1})]),_:1})]),_:1})]),_:1})):Q("",!0),(p(!0),D(B,null,J(r.versions,(i,o)=>(p(),_(A,{key:o,size:"small","dot-color":i.published?"success":"grey-lighten-1",class:O({publish:i.publish_at})},{default:s(()=>[v(U,{class:"elevation-2"},{default:s(()=>[L("div",{onClick:u=>i._show=!i._show},[v(te,null,{default:s(()=>[y(g(new Date(i.publish_at||i.created_at).toLocaleString(t.$vuetify.locale.current)),1)]),_:2},1024),v(Te,null,{default:s(()=>[y(g(i.editor),1)]),_:2},1024),v(G,{class:O(["diff",{show:i._show}])},{default:s(()=>[(p(!0),D(B,null,J(r.diff(i.data,n.current.data),u=>(p(),D("span",{class:O({added:u.removed,removed:u.added})},g(u.value||u),3))),256))]),_:2},1032,["class"])],8,Ne),v(ne,null,{default:s(()=>[v(re,{variant:"outlined",onClick:ae(u=>t.$emit("use",i),["stop"])},{default:s(()=>[y(g(t.$gettext("Use version")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color","class"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Re=de(xe,[["render",qe],["__scopeId","data-v-fd61719e"]]);export{Ae as A,Re as H};
