import{g as i}from"./index-CzuiuYVM.js";import{_ as m,c as u,B as r,U as p,W as t,X as f,Y as g,u as w,o as h,h as o,Z as V,$ as v,a0 as $,M as d,j as y,a1 as l,a2 as b,a3 as C,a4 as S,a5 as L,a6 as c}from"../index.js";const q={setup(){return{app:w()}},apollo:{me:{query:i`query{
          me {
            cmseditor
            name
          }
        }`,error(e){console.dir(e),this.message=e.message,this.failure=!0},update(e){this.handle(e.me)}}},data:()=>({creds:{email:"",password:""},form:null,error:null,loading:!1,login:!1,show:!1}),methods:{cmslogin(){if(!this.creds.email||!this.creds.password)return!1;this.error=null,this.loading=!0,this.$apollo.mutate({mutation:i`mutation ($email: String!, $password: String!) {
            cmsLogin(email: $email, password: $password) {
              cmseditor
              name
            }
          }`,variables:{email:this.creds.email,password:this.creds.password}}).then(e=>{this.handle(e.data.cmsLogin||null)}).catch(e=>{console.error(`cmsLogin(email: ${this.creds.email})`,e),this.error=e.message}).finally(()=>{this.loading=!1})},handle(e){e?e.name?e.cmseditor?(this.app.me=e.name,this.error=null,g.push("/pages")):this.error="Not a CMS editor":this.error=error.message:this.login=!0}}};function k(e,s,B,F,M,n){return h(),u(f,{class:t(["login",{show:e.login}]),modelValue:e.form,"onUpdate:modelValue":s[4]||(s[4]=a=>e.form=a),onSubmit:s[5]||(s[5]=p(a=>n.cmslogin(),["prevent"]))},{default:r(()=>[o(V,{loading:e.loading,class:t(["elevation-2",{error:e.error}])},{title:r(()=>s[6]||(s[6]=[l(" Login ")])),default:r(()=>[o(v,null,{default:r(()=>[o(d,{modelValue:e.creds.email,"onUpdate:modelValue":s[0]||(s[0]=a=>e.creds.email=a),label:"E-Mail",variant:"underlined","validate-on":"blur",rules:[a=>!!a||"Field is required",a=>!!a.match(/.+@.+/)||"Invalid e-mail address"],autocomplete:"username",autofocus:""},null,8,["modelValue","rules"]),o(d,{modelValue:e.creds.password,"onUpdate:modelValue":s[3]||(s[3]=a=>e.creds.password=a),type:e.show?"text":"password",label:"Password",variant:"underlined",rules:[a=>!!a||"Field is required"],autocomplete:"current-password"},{"append-inner":r(()=>[o(y,{onClick:s[1]||(s[1]=a=>e.show=!e.show),onKeydown:s[2]||(s[2]=a=>[13,32].includes(a.keyCode)?e.show=!e.show:!1)},{default:r(()=>[l(b(e.show?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1},8,["modelValue","type","rules"]),$(o(C,{color:"error",icon:"mdi-alert-octagon",text:"Error: "+e.error},null,8,["text"]),[[S,e.error]])]),_:1}),o(L,null,{default:r(()=>[o(c,{type:"submit",variant:"outlined",disabled:e.form!=!0},{default:r(()=>s[7]||(s[7]=[l("Login")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["loading","class"])]),_:1},8,["class","modelValue"])}const N=m(q,[["render",k]]);export{N as default};
