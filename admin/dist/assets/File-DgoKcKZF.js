import{_ as V,I as y,an as w,$ as F,a0 as k,c as d,a as h,b as m,w as c,V as L,r as U,T as x,F as C,o as a,d as p,e as v,f as i,j as f,g as R,t as u,h as j,i as M}from"../index.js";import{a as b,F as O}from"./FileDetail-BjE0_aB0.js";import{F as D}from"./FileDialog-BCETGS6-.js";import"./HistoryDialog-CI7a4V_R.js";const S={components:{FileListItems:O,FileDetail:b,FileDialog:D},inject:["openView"],props:{modelValue:{type:[Object,null],default:()=>null},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","error","addFile","removeFile"],data(){return{file:{},index:Math.floor(Math.random()*1e5),selected:null,vfiles:!1}},setup(){const t=w(),e=F();return{app:k(),auth:e,messages:t}},unmounted(){var t,e;(e=(t=this.file)==null?void 0:t.path)!=null&&e.startsWith("blob:")&&URL.revokeObjectURL(this.file.path)},methods:{add(t){if(!this.auth.can("file:add")){this.messages.add("Permission denied","error");return}const e=t.target.files||t.dataTransfer.files||[];if(!e.length)return;const o=URL.createObjectURL(e[0]);return this.file={path:o,uploading:!0},this.$apollo.mutate({mutation:y`mutation($file: Upload!) {
            addFile(file: $file) {
              id
              mime
              name
              path
              previews
              updated_at
              editor
            }
          }`,variables:{file:e[0]},context:{hasUpload:!0}}).then(r=>{var n;if(r.errors)throw r.errors;const l=((n=r.data)==null?void 0:n.addFile)||{};return l.previews=JSON.parse(l.previews)||{},delete l.__typename,this.handle(l,o)}).catch(r=>{this.messages.add("Error uploading file","error"),this.$log("File::addFile(): Error uploading file",t,r)}).finally(()=>{this.selected=null})},handle(t,e){if(!(t!=null&&t.id)){this.$log("File::handle(): Invalid item without ID",t);return}return this.file={...t},this.$emit("addFile",t.id),this.$emit("update:modelValue",{id:t.id,type:"file"}),this.validate(),e!=null&&e.startsWith("blob:")&&URL.revokeObjectURL(e),this.vfiles=!1,t},open(t){this.openView(b,{item:t})},remove(){this.file.path.startsWith("blob:")&&URL.revokeObjectURL(this.file.path),this.file.id&&this.$emit("removeFile",this.file.id),this.$emit("update:modelValue",null),this.file={},this.validate()},url(t){return t.startsWith("http")||t.startsWith("blob:")?t:this.app.urlfile.replace(/\/+$/g,"")+"/"+t},async validate(){const t=!!(!this.config.required||this.file.path);return this.$emit("error",!t),await t}},watch:{assets:{handler(t){!this.file.path&&this.modelValue&&t[this.modelValue.id]&&(this.file=t[this.modelValue.id]),this.validate()}},modelValue:{immediate:!0,handler(t){!this.file.path&&t&&this.assets[t.id]&&(this.file=this.assets[t.id]),this.validate()}}}},B={class:"files"},I={key:1,class:"file file-input"},N={class:"upload-file"},_=["disabled","accept","id","value"],A=["for"];function W(t,e,o,r,l,n){const g=U("FileDialog");return a(),d(C,null,[h(L,null,{default:c(()=>[h(v,{cols:"12",md:"6"},{default:c(()=>[i("div",B,[l.file.path?(a(),d("div",{key:0,class:"file",onClick:e[1]||(e[1]=s=>n.open(l.file))},[l.file.uploading?(a(),m(R,{key:0,color:"primary",height:"5",indeterminate:"",rounded:""})):p("",!0),e[6]||(e[6]=i("svg",{draggable:"false",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-file-earmark-binary",viewBox:"0 0 16 16"},[i("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"}),i("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"})],-1)),f(" "+u(l.file.name)+" ",1),!o.readonly&&l.file.path?(a(),d("button",{key:1,onClick:e[0]||(e[0]=j(s=>n.remove(),["stop"])),class:"btn-overlay",title:"Remove file",type:"button"},[h(M,{icon:"mdi-trash-can",role:"img"})])):p("",!0)])):(a(),d("div",I,[r.auth.can("file:view")?(a(),d("div",{key:0,class:"select-file",onClick:e[2]||(e[2]=s=>l.vfiles=!0)},e[7]||(e[7]=[i("label",null,[i("span",{class:"btn"},"Select file")],-1)]))):p("",!0),i("div",N,[i("input",{type:"file",onInput:e[3]||(e[3]=s=>n.add(s)),disabled:o.readonly,accept:o.config.accept||"*",id:"file-"+l.index,value:l.selected,hidden:""},null,40,_),i("label",{for:"file-"+l.index},e[8]||(e[8]=[i("span",{class:"btn"},"Add file",-1)]),8,A)])]))])]),_:1}),l.file.path?(a(),m(v,{key:0,cols:"12",md:"6"},{default:c(()=>[f(" Name: "+u(l.file.name),1),e[9]||(e[9]=i("br",null,null,-1)),f(" Mime: "+u(l.file.mime),1),e[10]||(e[10]=i("br",null,null,-1)),f(" Editor: "+u(l.file.editor),1),e[11]||(e[11]=i("br",null,null,-1)),f(" Updated: "+u(new Date(l.file.updated_at).toLocaleString()),1)]),_:1,__:[9,10,11]})):p("",!0)]),_:1}),(a(),m(x,{to:"body"},[h(g,{modelValue:l.vfiles,"onUpdate:modelValue":e[4]||(e[4]=s=>l.vfiles=s),onAdd:e[5]||(e[5]=s=>n.handle(s))},null,8,["modelValue"])]))],64)}const H=V(S,[["render",W]]);export{H as default};
