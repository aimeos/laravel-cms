import{_ as At,I as j,an as Oe,$ as It,a0 as Ne,c as L,f as g,a as p,d as O,b as _,h as Ut,aF as de,w as f,G as Ot,D as Se,a3 as D,as as ot,aG as Ct,j as C,b7 as Ze,F as lt,o as v,aH as P,E as Nt,t as B,a1 as wt,aw as Ke,ay as ti,Z as ei,i as Ae,aP as Ie,aQ as Re,a2 as ii,a4 as Pt,a5 as Bt,a6 as Yt,b4 as zt,aE as ai,aK as ri,V as Wt,e as kt,ad as si,Y as ni,aJ as oi,aW as li,aX as hi,r as Mt,T as di,aY as ui,W as ci,aZ as fi,at as pi,aS as mi,aT as ue,aU as gi,aV as ce}from"../index.js";import{H as vi,A as bi}from"./HistoryDialog-CI7a4V_R.js";const wi={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,checked:!1,loading:!0,vgrid:!1}},setup(){const a=Oe(),t=It();return{app:Ne(),auth:t,messages:a}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(a=>a._checked&&!a.deleted_at)},isChecked(){return this.items.some(a=>a._checked)},isTrashed(){return this.items.some(a=>a._checked&&a.deleted_at)}},methods:{add(a){if(this.embed||!this.auth.can("file:add")){this.messages.add("Permission denied","error");return}const t=[],e=a.target.files||a.dataTransfer.files||[];if(e.length)return Array.from(e).forEach(i=>{t.push(this.$apollo.mutate({mutation:j`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:i},context:{hasUpload:!0}}).then(n=>{var s;if(n.errors)throw n.errors;const r=((s=n.data)==null?void 0:s.addFile)||{};return r.previews=JSON.parse(r.previews)||{},r.description=JSON.parse(r.description)||{},r.published=!0,this.items.unshift(r),this.$emit("select",r),r}).catch(n=>{this.$log("FileListItems::add(): Error adding file",a,n)}))}),Promise.all(t).then(()=>{this.invalidate()})},debounce(a,t){let e;return function(...i){return new Promise((n,r)=>{const s=this;clearTimeout(e),e=setTimeout(()=>{try{n(a.apply(s,i))}catch(l){r(l)}},t)})}},drop(a){if(!this.auth.can("file:drop")){this.messages.add("Permission denied","error");return}const t=a?[a]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:j`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add("Error trashing file","error"),this.$log("FileListItems::drop(): Error trashing file",a,e)})},invalidate(){const a=this.$apollo.provider.defaultClient.cache;a.evict({id:"ROOT_QUERY",fieldName:"files"}),a.gc()},keep(a){if(!this.auth.can("file:keep")){this.messages.add("Permission denied","error");return}const t=a?[a]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:j`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(i=>{i.deleted_at=null}),this.invalidate(),this.search()}).catch(e=>{this.messages.add("Error restoring file","error"),this.$log("FileListItems::keep(): Error restoring file",a,e)})},publish(a){if(!this.auth.can("file:publish")){this.messages.add("Permission denied","error");return}const t=a?[a]:this.items.filter(e=>e._checked&&e.id&&!e.published);t.length&&this.$apollo.mutate({mutation:j`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(i=>{i.published=!0,i._checked=!1}),this.invalidate(),this.search()}).catch(e=>{this.messages.add("Error publishing file","error"),this.$log("FileListItems::publish(): Error publishing file",a,e)})},purge(a){if(!this.auth.can("file:purge")){this.messages.add("Permission denied","error");return}const t=a?[a]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:j`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add("Error purging file","error"),this.$log("FileListItems::purge(): Error purging file",a,e)})},search(){if(!this.auth.can("file:view"))return this.messages.add("Permission denied","error"),Promise.resolve([]);const a=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",e={...this.filter};return delete e.trashed,delete e.publish,this.term&&this.term,this.loading=!0,this.$apollo.query({query:j`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:e,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:a}}).then(i=>{var r;if(i.errors)throw i.errors;const n=i.data.files||{};return this.last=((r=n.paginatorInfo)==null?void 0:r.lastPage)||1,this.items=[...n.data||[]].map(s=>{var u,h,o,d,c,b;const l=(u=s.latest)!=null&&u.data?JSON.parse((h=s.latest)==null?void 0:h.data):{...s,previews:JSON.parse(s.previews||"{}"),description:JSON.parse(s.description||"{}")};return Object.assign(l,{id:s.id,deleted_at:s.deleted_at,created_at:s.created_at,updated_at:((o=s.latest)==null?void 0:o.created_at)||s.updated_at,editor:((d=s.latest)==null?void 0:d.editor)||s.editor,published:((c=s.latest)==null?void 0:c.published)??!0,publish_at:((b=s.latest)==null?void 0:b.publish_at)||null,latest:s.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(i=>{this.messages.add("Error fetching files","error"),this.$log("FileListItems::search(): Error fetching files",i)})},srcset(a){let t=[];for(const e in a)t.push(`${this.url(a[e])} ${e}w`);return t.join(", ")},title(a){const t=[];return a.publish_at&&t.push("Publish at: "+new Date(a.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(a=>{a._checked=!a._checked})},url(a){return a.startsWith("http")||a.startsWith("blob:")?a:this.app.urlfile.replace(/\/+$/g,"")+"/"+a}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},yi={class:"header"},Di={class:"bulk"},xi={class:"search"},Ei={class:"layout"},Ci=["onClick","title"],ki=["onClick","title"],Mi={class:"item-text"},Ti={class:"item-title"},_i={class:"item-mime item-subtitle"},Oi={class:"item-aux"},Ni={class:"item-editor"},Si={class:"item-modified item-subtitle"},Ai={key:0,class:"loading"},Ii={key:1,class:"notfound"},Ri={key:3,class:"btn-group"};function Vi(a,t,e,i,n,r){return v(),L(lt,null,[g("div",yi,[g("div",Di,[p(de,{modelValue:n.checked,"onUpdate:modelValue":t[0]||(t[0]=s=>n.checked=s),onClick:t[1]||(t[1]=Ut(s=>r.toggle(),["stop"]))},null,8,["modelValue"]),p(Ot,{location:"bottom left"},{activator:f(({props:s})=>[p(D,Nt({"append-icon":"mdi-menu-down",variant:"text"},s),{default:f(()=>t[19]||(t[19]=[C("Actions")])),_:2,__:[19]},1040)]),default:f(()=>[p(Ct,null,{default:f(()=>[r.isChecked&&i.auth.can("file:publish")?(v(),_(P,{key:0},{default:f(()=>[p(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=s=>r.publish())},{default:f(()=>t[20]||(t[20]=[C("Publish")])),_:1,__:[20]})]),_:1})):O("",!0),!this.embed&&i.auth.can("file:add")?(v(),_(P,{key:1},{default:f(()=>[p(D,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[3]||(t[3]=s=>a.$refs.upload.click())},{default:f(()=>t[21]||(t[21]=[C("Add files")])),_:1,__:[21]})]),_:1})):O("",!0),r.canTrash&&i.auth.can("file:drop")?(v(),_(P,{key:2},{default:f(()=>[p(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=s=>r.drop())},{default:f(()=>t[22]||(t[22]=[C("Trash")])),_:1,__:[22]})]),_:1})):O("",!0),r.isTrashed&&i.auth.can("file:keep")?(v(),_(P,{key:3},{default:f(()=>[p(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=s=>r.keep())},{default:f(()=>t[23]||(t[23]=[C("Restore")])),_:1,__:[23]})]),_:1})):O("",!0),r.isChecked&&i.auth.can("file:purge")?(v(),_(P,{key:4},{default:f(()=>[p(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=s=>r.purge())},{default:f(()=>t[24]||(t[24]=[C("Purge")])),_:1,__:[24]})]),_:1})):O("",!0)]),_:1})]),_:1})]),g("div",xi,[p(Se,{modelValue:n.term,"onUpdate:modelValue":t[7]||(t[7]=s=>n.term=s),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:"Search for","hide-details":"",clearable:""},null,8,["modelValue"])]),g("div",Ei,[n.vgrid?O("",!0):(v(),_(D,{key:0,onClick:t[8]||(t[8]=s=>n.vgrid=!0),icon:"mdi-view-grid-outline",variant:"flat",title:"Grid view"})),n.vgrid?(v(),_(D,{key:1,onClick:t[9]||(t[9]=s=>n.vgrid=!1),icon:"mdi-format-list-bulleted-square",variant:"flat",title:"List view"})):O("",!0),p(Ot,null,{activator:f(({props:s})=>[p(D,Nt({"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text",location:"bottom right"},s),{default:f(()=>{var l,u,h;return[C(B(((l=n.sort)==null?void 0:l.column)==="ID"?((u=n.sort)==null?void 0:u.order)==="DESC"?"Latest":"Oldest":((h=n.sort)==null?void 0:h.column)||""),1)]}),_:2},1040)]),default:f(()=>[p(Ct,null,{default:f(()=>[p(P,null,{default:f(()=>[p(D,{variant:"text",onClick:t[10]||(t[10]=s=>n.sort={column:"ID",order:"DESC"})},{default:f(()=>t[25]||(t[25]=[C("Latest")])),_:1,__:[25]})]),_:1}),p(P,null,{default:f(()=>[p(D,{variant:"text",onClick:t[11]||(t[11]=s=>n.sort={column:"ID",order:"ASC"})},{default:f(()=>t[26]||(t[26]=[C("Oldest")])),_:1,__:[26]})]),_:1}),p(P,null,{default:f(()=>[p(D,{variant:"text",onClick:t[12]||(t[12]=s=>n.sort={column:"NAME",order:"ASC"})},{default:f(()=>t[27]||(t[27]=[C("Name")])),_:1,__:[27]})]),_:1}),p(P,null,{default:f(()=>[p(D,{variant:"text",onClick:t[13]||(t[13]=s=>n.sort={column:"MIME",order:"ASC"})},{default:f(()=>t[28]||(t[28]=[C("Mime")])),_:1,__:[28]})]),_:1}),p(P,null,{default:f(()=>[p(D,{variant:"text",onClick:t[14]||(t[14]=s=>n.sort={column:"TAG",order:"ASC"})},{default:f(()=>t[29]||(t[29]=[C("Tag")])),_:1,__:[29]})]),_:1}),p(P,null,{default:f(()=>[p(D,{variant:"text",onClick:t[15]||(t[15]=s=>n.sort={column:"EDITOR",order:"ASC"})},{default:f(()=>t[30]||(t[30]=[C("Editor")])),_:1,__:[30]})]),_:1})]),_:1})]),_:1})])]),p(Ct,{class:ot(["items",{grid:n.vgrid,list:!n.vgrid}])},{default:f(()=>[(v(!0),L(lt,null,wt(n.items,(s,l)=>(v(),_(P,{key:l},{default:f(()=>[p(de,{modelValue:s._checked,"onUpdate:modelValue":u=>s._checked=u,class:ot([{draft:!s.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),p(Ot,null,{activator:f(({props:u})=>[p(D,Nt({class:"item-menu",icon:"mdi-dots-vertical",variant:"text",ref_for:!0},u),null,16)]),default:f(()=>[p(Ct,null,{default:f(()=>[Ke(p(P,null,{default:f(()=>[p(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:u=>r.publish(s)},{default:f(()=>t[31]||(t[31]=[C("Publish")])),_:2,__:[31]},1032,["onClick"])]),_:2},1536),[[ti,!s.deleted_at&&!s.published&&i.auth.can("file:publish")]]),!s.deleted_at&&i.auth.can("file:drop")?(v(),_(P,{key:0},{default:f(()=>[p(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:u=>r.drop(s)},{default:f(()=>t[32]||(t[32]=[C("Trash")])),_:2,__:[32]},1032,["onClick"])]),_:2},1024)):O("",!0),s.deleted_at&&i.auth.can("file:keep")?(v(),_(P,{key:1},{default:f(()=>[p(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:u=>r.keep(s)},{default:f(()=>t[33]||(t[33]=[C("Restore")])),_:2,__:[33]},1032,["onClick"])]),_:2},1024)):O("",!0),i.auth.can("file:purge")?(v(),_(P,{key:2},{default:f(()=>[p(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:u=>r.purge(s)},{default:f(()=>t[34]||(t[34]=[C("Purge")])),_:2,__:[34]},1032,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1024)]),_:2},1024),g("div",{class:"item-preview",onClick:u=>a.$emit("select",s),title:r.title(s)},[s.previews?(v(),_(ei,{key:0,src:r.url(s.path),srcset:r.srcset(s.previews),alt:s.name},null,8,["src","srcset","alt"])):O("",!0)],8,Ci),g("div",{class:ot(["item-content",{trashed:s.deleted_at}]),onClick:u=>a.$emit("select",s),title:r.title(s)},[g("div",Mi,[s.publish_at?(v(),_(Ae,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):O("",!0),g("span",Ti,B(s.name),1),g("div",_i,B(s.mime),1)]),g("div",Oi,[g("div",Ni,B(s.editor),1),g("div",Si,B(new Date(s.updated_at).toLocaleString()),1)])],10,ki)]),_:2},1024))),128))]),_:1},8,["class"]),n.loading?(v(),L("p",Ai,t[35]||(t[35]=[C(" Loading "),g("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1)]))):O("",!0),!n.loading&&!n.items.length?(v(),L("p",Ii," No items found ")):O("",!0),n.last>1?(v(),_(Ze,{key:2,modelValue:n.page,"onUpdate:modelValue":t[16]||(t[16]=s=>n.page=s),length:n.last},null,8,["modelValue","length"])):O("",!0),!this.embed&&i.auth.can("file:add")?(v(),L("div",Ri,[g("input",{onChange:t[17]||(t[17]=s=>r.add(s)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),p(D,{color:"primary",icon:"mdi-folder-plus",onClick:t[18]||(t[18]=s=>a.$refs.upload.click())})])):O("",!0)],64)}const Fa=At(wi,[["render",Vi],["__scopeId","data-v-f7cbc05a"]]),Li={props:{item:{type:Object,required:!0}},emits:[],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:It()}},watch:{item:{immediate:!0,handler(a){!a.id||!this.auth.can("file:view")||this.$apollo.query({query:j`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:a.id}}).then(t=>{var e,i,n;if(t.errors)throw t.errors;this.file=((e=t.data)==null?void 0:e.file)||{},this.versions=(((n=(i=t.data)==null?void 0:i.file)==null?void 0:n.byversions)||[]).map(r=>({id:r.versionable_id,type:r.versionable_type.split("\\").at(-1),published:r.published?"yes":r.publish_at?new Date(r.publish_at).toLocaleDateString():"no"})).filter(r=>this.auth.can(r.type.toLowerCase()+":view"))}).catch(t=>{this.$log("FileDetailRef::watch(item): Error fetching file",a,t)})}}}};function Pi(a,t,e,i,n,r){return v(),_(Ie,null,{default:f(()=>[p(Re,null,{default:f(()=>[p(ii,{modelValue:a.panel,"onUpdate:modelValue":t[0]||(t[0]=s=>a.panel=s),elevation:"0",multiple:""},{default:f(()=>{var s,l,u;return[(s=a.file.bypages)!=null&&s.length&&i.auth.can("page:view")?(v(),_(Pt,{key:0},{default:f(()=>[p(Bt,null,{default:f(()=>t[1]||(t[1]=[C("Pages")])),_:1,__:[1]}),p(Yt,null,{default:f(()=>[p(zt,{density:"comfortable",hover:""},{default:f(()=>[t[2]||(t[2]=g("thead",null,[g("tr",null,[g("th",null,"ID"),g("th",null,"URL"),g("th",null,"Name")])],-1)),g("tbody",null,[(v(!0),L(lt,null,wt(a.file.bypages,h=>(v(),L("tr",{key:h.id},[g("td",null,B(h.id),1),g("td",null,B(h.path),1),g("td",null,B(h.name),1)]))),128))])]),_:1,__:[2]})]),_:1})]),_:1})):O("",!0),(l=a.file.byelements)!=null&&l.length&&i.auth.can("element:view")?(v(),_(Pt,{key:1},{default:f(()=>[p(Bt,null,{default:f(()=>t[3]||(t[3]=[C("Elements")])),_:1,__:[3]}),p(Yt,null,{default:f(()=>[p(zt,{density:"comfortable",hover:""},{default:f(()=>[t[4]||(t[4]=g("thead",null,[g("tr",null,[g("th",null,"ID"),g("th",null,"Type"),g("th",null,"Name")])],-1)),g("tbody",null,[(v(!0),L(lt,null,wt(a.file.byelements,h=>(v(),L("tr",{key:h.id},[g("td",null,B(h.id),1),g("td",null,B(h.type),1),g("td",null,B(h.name),1)]))),128))])]),_:1,__:[4]})]),_:1})]),_:1})):O("",!0),(u=a.versions)!=null&&u.length?(v(),_(Pt,{key:2},{default:f(()=>[p(Bt,null,{default:f(()=>t[5]||(t[5]=[C("Versions")])),_:1,__:[5]}),p(Yt,null,{default:f(()=>[p(zt,{density:"comfortable",hover:""},{default:f(()=>[t[6]||(t[6]=g("thead",null,[g("tr",null,[g("th",null,"ID"),g("th",null,"Type"),g("th",null,"Published")])],-1)),g("tbody",null,[(v(!0),L(lt,null,wt(a.versions,h=>(v(),L("tr",{key:h.id},[g("td",null,B(h.id),1),g("td",null,B(h.type),1),g("td",null,B(h.published),1)]))),128))])]),_:1,__:[6]})]),_:1})]),_:1})):O("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Bi=At(Li,[["render",Pi],["__scopeId","data-v-650e56e0"]]);/*!
 * Cropper.js v1.5.13
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2022-11-20T05:30:46.114Z
 */function fe(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),e.push.apply(e,i)}return e}function Ve(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fe(Object(e),!0).forEach(function(i){Wi(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):fe(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}function Ft(a){"@babel/helpers - typeof";return Ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(a)}function Yi(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(a,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,i.key,i)}}function zi(a,t,e){return t&&pe(a.prototype,t),e&&pe(a,e),Object.defineProperty(a,"prototype",{writable:!1}),a}function Wi(a,t,e){return t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function Le(a){return Xi(a)||Hi(a)||Ui(a)||Fi()}function Xi(a){if(Array.isArray(a))return $t(a)}function Hi(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function Ui(a,t){if(a){if(typeof a=="string")return $t(a,t);var e=Object.prototype.toString.call(a).slice(8,-1);if(e==="Object"&&a.constructor&&(e=a.constructor.name),e==="Map"||e==="Set")return Array.from(a);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $t(a,t)}}function $t(a,t){(t==null||t>a.length)&&(t=a.length);for(var e=0,i=new Array(t);e<t;e++)i[e]=a[e];return i}function Fi(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Rt=typeof window<"u"&&typeof window.document<"u",G=Rt?window:{},ee=Rt&&G.document.documentElement?"ontouchstart"in G.document.documentElement:!1,ie=Rt?"PointerEvent"in G:!1,M="cropper",ae="all",Pe="crop",Be="move",Ye="zoom",st="e",nt="w",dt="s",K="n",mt="ne",gt="nw",vt="se",bt="sw",jt="".concat(M,"-crop"),me="".concat(M,"-disabled"),W="".concat(M,"-hidden"),ge="".concat(M,"-hide"),$i="".concat(M,"-invisible"),St="".concat(M,"-modal"),qt="".concat(M,"-move"),Dt="".concat(M,"Action"),Tt="".concat(M,"Preview"),re="crop",ze="move",We="none",Gt="crop",Jt="cropend",Qt="cropmove",Zt="cropstart",ve="dblclick",ji=ee?"touchstart":"mousedown",qi=ee?"touchmove":"mousemove",Gi=ee?"touchend touchcancel":"mouseup",be=ie?"pointerdown":ji,we=ie?"pointermove":qi,ye=ie?"pointerup pointercancel":Gi,De="ready",xe="resize",Ee="wheel",Kt="zoom",Ce="image/jpeg",Ji=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Qi=/^data:/,Zi=/^data:image\/jpeg;base64,/,Ki=/^img|canvas$/i,Xe=200,He=100,ke={viewMode:0,dragMode:re,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:Xe,minContainerHeight:He,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},ta='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',ea=Number.isNaN||G.isNaN;function w(a){return typeof a=="number"&&!ea(a)}var Me=function(t){return t>0&&t<1/0};function Xt(a){return typeof a>"u"}function ht(a){return Ft(a)==="object"&&a!==null}var ia=Object.prototype.hasOwnProperty;function ut(a){if(!ht(a))return!1;try{var t=a.constructor,e=t.prototype;return t&&e&&ia.call(e,"isPrototypeOf")}catch{return!1}}function z(a){return typeof a=="function"}var aa=Array.prototype.slice;function Ue(a){return Array.from?Array.from(a):aa.call(a)}function S(a,t){return a&&z(t)&&(Array.isArray(a)||w(a.length)?Ue(a).forEach(function(e,i){t.call(a,e,i,a)}):ht(a)&&Object.keys(a).forEach(function(e){t.call(a,a[e],e,a)})),a}var T=Object.assign||function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return ht(t)&&i.length>0&&i.forEach(function(r){ht(r)&&Object.keys(r).forEach(function(s){t[s]=r[s]})}),t},ra=/\.\d*(?:0|9){12}\d*$/;function ft(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return ra.test(a)?Math.round(a*t)/t:a}var sa=/^width|height|left|top|marginLeft|marginTop$/;function tt(a,t){var e=a.style;S(t,function(i,n){sa.test(n)&&w(i)&&(i="".concat(i,"px")),e[n]=i})}function na(a,t){return a.classList?a.classList.contains(t):a.className.indexOf(t)>-1}function V(a,t){if(t){if(w(a.length)){S(a,function(i){V(i,t)});return}if(a.classList){a.classList.add(t);return}var e=a.className.trim();e?e.indexOf(t)<0&&(a.className="".concat(e," ").concat(t)):a.className=t}}function q(a,t){if(t){if(w(a.length)){S(a,function(e){q(e,t)});return}if(a.classList){a.classList.remove(t);return}a.className.indexOf(t)>=0&&(a.className=a.className.replace(t,""))}}function ct(a,t,e){if(t){if(w(a.length)){S(a,function(i){ct(i,t,e)});return}e?V(a,t):q(a,t)}}var oa=/([a-z\d])([A-Z])/g;function se(a){return a.replace(oa,"$1-$2").toLowerCase()}function te(a,t){return ht(a[t])?a[t]:a.dataset?a.dataset[t]:a.getAttribute("data-".concat(se(t)))}function xt(a,t,e){ht(e)?a[t]=e:a.dataset?a.dataset[t]=e:a.setAttribute("data-".concat(se(t)),e)}function la(a,t){if(ht(a[t]))try{delete a[t]}catch{a[t]=void 0}else if(a.dataset)try{delete a.dataset[t]}catch{a.dataset[t]=void 0}else a.removeAttribute("data-".concat(se(t)))}var Fe=/\s\s*/,$e=function(){var a=!1;if(Rt){var t=!1,e=function(){},i=Object.defineProperty({},"once",{get:function(){return a=!0,t},set:function(r){t=r}});G.addEventListener("test",e,i),G.removeEventListener("test",e,i)}return a}();function F(a,t,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=e;t.trim().split(Fe).forEach(function(r){if(!$e){var s=a.listeners;s&&s[r]&&s[r][e]&&(n=s[r][e],delete s[r][e],Object.keys(s[r]).length===0&&delete s[r],Object.keys(s).length===0&&delete a.listeners)}a.removeEventListener(r,n,i)})}function U(a,t,e){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=e;t.trim().split(Fe).forEach(function(r){if(i.once&&!$e){var s=a.listeners,l=s===void 0?{}:s;n=function(){delete l[r][e],a.removeEventListener(r,n,i);for(var h=arguments.length,o=new Array(h),d=0;d<h;d++)o[d]=arguments[d];e.apply(a,o)},l[r]||(l[r]={}),l[r][e]&&a.removeEventListener(r,l[r][e],i),l[r][e]=n,a.listeners=l}a.addEventListener(r,n,i)})}function pt(a,t,e){var i;return z(Event)&&z(CustomEvent)?i=new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!0}):(i=document.createEvent("CustomEvent"),i.initCustomEvent(t,!0,!0,e)),a.dispatchEvent(i)}function je(a){var t=a.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Ht=G.location,ha=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Te(a){var t=a.match(ha);return t!==null&&(t[1]!==Ht.protocol||t[2]!==Ht.hostname||t[3]!==Ht.port)}function _e(a){var t="timestamp=".concat(new Date().getTime());return a+(a.indexOf("?")===-1?"?":"&")+t}function yt(a){var t=a.rotate,e=a.scaleX,i=a.scaleY,n=a.translateX,r=a.translateY,s=[];w(n)&&n!==0&&s.push("translateX(".concat(n,"px)")),w(r)&&r!==0&&s.push("translateY(".concat(r,"px)")),w(t)&&t!==0&&s.push("rotate(".concat(t,"deg)")),w(e)&&e!==1&&s.push("scaleX(".concat(e,")")),w(i)&&i!==1&&s.push("scaleY(".concat(i,")"));var l=s.length?s.join(" "):"none";return{WebkitTransform:l,msTransform:l,transform:l}}function da(a){var t=Ve({},a),e=0;return S(a,function(i,n){delete t[n],S(t,function(r){var s=Math.abs(i.startX-r.startX),l=Math.abs(i.startY-r.startY),u=Math.abs(i.endX-r.endX),h=Math.abs(i.endY-r.endY),o=Math.sqrt(s*s+l*l),d=Math.sqrt(u*u+h*h),c=(d-o)/o;Math.abs(c)>Math.abs(e)&&(e=c)})}),e}function _t(a,t){var e=a.pageX,i=a.pageY,n={endX:e,endY:i};return t?n:Ve({startX:e,startY:i},n)}function ua(a){var t=0,e=0,i=0;return S(a,function(n){var r=n.startX,s=n.startY;t+=r,e+=s,i+=1}),t/=i,e/=i,{pageX:t,pageY:e}}function et(a){var t=a.aspectRatio,e=a.height,i=a.width,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=Me(i),s=Me(e);if(r&&s){var l=e*t;n==="contain"&&l>i||n==="cover"&&l<i?e=i/t:i=e*t}else r?e=i/t:s&&(i=e*t);return{width:i,height:e}}function ca(a){var t=a.width,e=a.height,i=a.degree;if(i=Math.abs(i)%180,i===90)return{width:e,height:t};var n=i%90*Math.PI/180,r=Math.sin(n),s=Math.cos(n),l=t*s+e*r,u=t*r+e*s;return i>90?{width:u,height:l}:{width:l,height:u}}function fa(a,t,e,i){var n=t.aspectRatio,r=t.naturalWidth,s=t.naturalHeight,l=t.rotate,u=l===void 0?0:l,h=t.scaleX,o=h===void 0?1:h,d=t.scaleY,c=d===void 0?1:d,b=e.aspectRatio,y=e.naturalWidth,k=e.naturalHeight,x=i.fillColor,A=x===void 0?"transparent":x,R=i.imageSmoothingEnabled,N=R===void 0?!0:R,J=i.imageSmoothingQuality,X=J===void 0?"low":J,m=i.maxWidth,E=m===void 0?1/0:m,I=i.maxHeight,H=I===void 0?1/0:I,Q=i.minWidth,it=Q===void 0?0:Q,at=i.minHeight,Z=at===void 0?0:at,$=document.createElement("canvas"),Y=$.getContext("2d"),rt=et({aspectRatio:b,width:E,height:H}),Et=et({aspectRatio:b,width:it,height:Z},"cover"),Vt=Math.min(rt.width,Math.max(Et.width,y)),Lt=Math.min(rt.height,Math.max(Et.height,k)),ne=et({aspectRatio:n,width:E,height:H}),oe=et({aspectRatio:n,width:it,height:Z},"cover"),le=Math.min(ne.width,Math.max(oe.width,r)),he=Math.min(ne.height,Math.max(oe.height,s)),Je=[-le/2,-he/2,le,he];return $.width=ft(Vt),$.height=ft(Lt),Y.fillStyle=A,Y.fillRect(0,0,Vt,Lt),Y.save(),Y.translate(Vt/2,Lt/2),Y.rotate(u*Math.PI/180),Y.scale(o,c),Y.imageSmoothingEnabled=N,Y.imageSmoothingQuality=X,Y.drawImage.apply(Y,[a].concat(Le(Je.map(function(Qe){return Math.floor(ft(Qe))})))),Y.restore(),$}var qe=String.fromCharCode;function pa(a,t,e){var i="";e+=t;for(var n=t;n<e;n+=1)i+=qe(a.getUint8(n));return i}var ma=/^data:.*,/;function ga(a){var t=a.replace(ma,""),e=atob(t),i=new ArrayBuffer(e.length),n=new Uint8Array(i);return S(n,function(r,s){n[s]=e.charCodeAt(s)}),i}function va(a,t){for(var e=[],i=8192,n=new Uint8Array(a);n.length>0;)e.push(qe.apply(null,Ue(n.subarray(0,i)))),n=n.subarray(i);return"data:".concat(t,";base64,").concat(btoa(e.join("")))}function ba(a){var t=new DataView(a),e;try{var i,n,r;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var s=t.byteLength,l=2;l+1<s;){if(t.getUint8(l)===255&&t.getUint8(l+1)===225){n=l;break}l+=1}if(n){var u=n+4,h=n+10;if(pa(t,u,4)==="Exif"){var o=t.getUint16(h);if(i=o===18761,(i||o===19789)&&t.getUint16(h+2,i)===42){var d=t.getUint32(h+4,i);d>=8&&(r=h+d)}}}if(r){var c=t.getUint16(r,i),b,y;for(y=0;y<c;y+=1)if(b=r+y*12+2,t.getUint16(b,i)===274){b+=8,e=t.getUint16(b,i),t.setUint16(b,1,i);break}}}catch{e=1}return e}function wa(a){var t=0,e=1,i=1;switch(a){case 2:e=-1;break;case 3:t=-180;break;case 4:i=-1;break;case 5:t=90,i=-1;break;case 6:t=90;break;case 7:t=90,e=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:e,scaleY:i}}var ya={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,e=this.options,i=this.container,n=this.cropper,r=Number(e.minContainerWidth),s=Number(e.minContainerHeight);V(n,W),q(t,W);var l={width:Math.max(i.offsetWidth,r>=0?r:Xe),height:Math.max(i.offsetHeight,s>=0?s:He)};this.containerData=l,tt(n,{width:l.width,height:l.height}),V(t,W),q(n,W)},initCanvas:function(){var t=this.containerData,e=this.imageData,i=this.options.viewMode,n=Math.abs(e.rotate)%180===90,r=n?e.naturalHeight:e.naturalWidth,s=n?e.naturalWidth:e.naturalHeight,l=r/s,u=t.width,h=t.height;t.height*l>t.width?i===3?u=t.height*l:h=t.width/l:i===3?h=t.width/l:u=t.height*l;var o={aspectRatio:l,naturalWidth:r,naturalHeight:s,width:u,height:h};this.canvasData=o,this.limited=i===1||i===2,this.limitCanvas(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.left=(t.width-o.width)/2,o.top=(t.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCanvasData=T({},o)},limitCanvas:function(t,e){var i=this.options,n=this.containerData,r=this.canvasData,s=this.cropBoxData,l=i.viewMode,u=r.aspectRatio,h=this.cropped&&s;if(t){var o=Number(i.minCanvasWidth)||0,d=Number(i.minCanvasHeight)||0;l>1?(o=Math.max(o,n.width),d=Math.max(d,n.height),l===3&&(d*u>o?o=d*u:d=o/u)):l>0&&(o?o=Math.max(o,h?s.width:0):d?d=Math.max(d,h?s.height:0):h&&(o=s.width,d=s.height,d*u>o?o=d*u:d=o/u));var c=et({aspectRatio:u,width:o,height:d});o=c.width,d=c.height,r.minWidth=o,r.minHeight=d,r.maxWidth=1/0,r.maxHeight=1/0}if(e)if(l>(h?0:1)){var b=n.width-r.width,y=n.height-r.height;r.minLeft=Math.min(0,b),r.minTop=Math.min(0,y),r.maxLeft=Math.max(0,b),r.maxTop=Math.max(0,y),h&&this.limited&&(r.minLeft=Math.min(s.left,s.left+(s.width-r.width)),r.minTop=Math.min(s.top,s.top+(s.height-r.height)),r.maxLeft=s.left,r.maxTop=s.top,l===2&&(r.width>=n.width&&(r.minLeft=Math.min(0,b),r.maxLeft=Math.max(0,b)),r.height>=n.height&&(r.minTop=Math.min(0,y),r.maxTop=Math.max(0,y))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=n.width,r.maxTop=n.height},renderCanvas:function(t,e){var i=this.canvasData,n=this.imageData;if(e){var r=ca({width:n.naturalWidth*Math.abs(n.scaleX||1),height:n.naturalHeight*Math.abs(n.scaleY||1),degree:n.rotate||0}),s=r.width,l=r.height,u=i.width*(s/i.naturalWidth),h=i.height*(l/i.naturalHeight);i.left-=(u-i.width)/2,i.top-=(h-i.height)/2,i.width=u,i.height=h,i.aspectRatio=s/l,i.naturalWidth=s,i.naturalHeight=l,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,tt(this.canvas,T({width:i.width,height:i.height},yt({translateX:i.left,translateY:i.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var e=this.canvasData,i=this.imageData,n=i.naturalWidth*(e.width/e.naturalWidth),r=i.naturalHeight*(e.height/e.naturalHeight);T(i,{width:n,height:r,left:(e.width-n)/2,top:(e.height-r)/2}),tt(this.image,T({width:i.width,height:i.height},yt(T({translateX:i.left,translateY:i.top},i)))),t&&this.output()},initCropBox:function(){var t=this.options,e=this.canvasData,i=t.aspectRatio||t.initialAspectRatio,n=Number(t.autoCropArea)||.8,r={width:e.width,height:e.height};i&&(e.height*i>e.width?r.height=r.width/i:r.width=r.height*i),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*n),r.height=Math.max(r.minHeight,r.height*n),r.left=e.left+(e.width-r.width)/2,r.top=e.top+(e.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=T({},r)},limitCropBox:function(t,e){var i=this.options,n=this.containerData,r=this.canvasData,s=this.cropBoxData,l=this.limited,u=i.aspectRatio;if(t){var h=Number(i.minCropBoxWidth)||0,o=Number(i.minCropBoxHeight)||0,d=l?Math.min(n.width,r.width,r.width+r.left,n.width-r.left):n.width,c=l?Math.min(n.height,r.height,r.height+r.top,n.height-r.top):n.height;h=Math.min(h,n.width),o=Math.min(o,n.height),u&&(h&&o?o*u>h?o=h/u:h=o*u:h?o=h/u:o&&(h=o*u),c*u>d?c=d/u:d=c*u),s.minWidth=Math.min(h,d),s.minHeight=Math.min(o,c),s.maxWidth=d,s.maxHeight=c}e&&(l?(s.minLeft=Math.max(0,r.left),s.minTop=Math.max(0,r.top),s.maxLeft=Math.min(n.width,r.left+r.width)-s.width,s.maxTop=Math.min(n.height,r.top+r.height)-s.height):(s.minLeft=0,s.minTop=0,s.maxLeft=n.width-s.width,s.maxTop=n.height-s.height))},renderCropBox:function(){var t=this.options,e=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,t.movable&&t.cropBoxMovable&&xt(this.face,Dt,i.width>=e.width&&i.height>=e.height?Be:ae),tt(this.cropBox,T({width:i.width,height:i.height},yt({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),pt(this.element,Gt,this.getData())}},Da={initPreview:function(){var t=this.element,e=this.crossOrigin,i=this.options.preview,n=e?this.crossOriginUrl:this.url,r=t.alt||"The image to preview",s=document.createElement("img");if(e&&(s.crossOrigin=e),s.src=n,s.alt=r,this.viewBox.appendChild(s),this.viewBoxImage=s,!!i){var l=i;typeof i=="string"?l=t.ownerDocument.querySelectorAll(i):i.querySelector&&(l=[i]),this.previews=l,S(l,function(u){var h=document.createElement("img");xt(u,Tt,{width:u.offsetWidth,height:u.offsetHeight,html:u.innerHTML}),e&&(h.crossOrigin=e),h.src=n,h.alt=r,h.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',u.innerHTML="",u.appendChild(h)})}},resetPreview:function(){S(this.previews,function(t){var e=te(t,Tt);tt(t,{width:e.width,height:e.height}),t.innerHTML=e.html,la(t,Tt)})},preview:function(){var t=this.imageData,e=this.canvasData,i=this.cropBoxData,n=i.width,r=i.height,s=t.width,l=t.height,u=i.left-e.left-t.left,h=i.top-e.top-t.top;!this.cropped||this.disabled||(tt(this.viewBoxImage,T({width:s,height:l},yt(T({translateX:-u,translateY:-h},t)))),S(this.previews,function(o){var d=te(o,Tt),c=d.width,b=d.height,y=c,k=b,x=1;n&&(x=c/n,k=r*x),r&&k>b&&(x=b/r,y=n*x,k=b),tt(o,{width:y,height:k}),tt(o.getElementsByTagName("img")[0],T({width:s*x,height:l*x},yt(T({translateX:-u*x,translateY:-h*x},t))))}))}},xa={bind:function(){var t=this.element,e=this.options,i=this.cropper;z(e.cropstart)&&U(t,Zt,e.cropstart),z(e.cropmove)&&U(t,Qt,e.cropmove),z(e.cropend)&&U(t,Jt,e.cropend),z(e.crop)&&U(t,Gt,e.crop),z(e.zoom)&&U(t,Kt,e.zoom),U(i,be,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&U(i,Ee,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&U(i,ve,this.onDblclick=this.dblclick.bind(this)),U(t.ownerDocument,we,this.onCropMove=this.cropMove.bind(this)),U(t.ownerDocument,ye,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&U(window,xe,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.options,i=this.cropper;z(e.cropstart)&&F(t,Zt,e.cropstart),z(e.cropmove)&&F(t,Qt,e.cropmove),z(e.cropend)&&F(t,Jt,e.cropend),z(e.crop)&&F(t,Gt,e.crop),z(e.zoom)&&F(t,Kt,e.zoom),F(i,be,this.onCropStart),e.zoomable&&e.zoomOnWheel&&F(i,Ee,this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&F(i,ve,this.onDblclick),F(t.ownerDocument,we,this.onCropMove),F(t.ownerDocument,ye,this.onCropEnd),e.responsive&&F(window,xe,this.onResize)}},Ea={resize:function(){if(!this.disabled){var t=this.options,e=this.container,i=this.containerData,n=e.offsetWidth/i.width,r=e.offsetHeight/i.height,s=Math.abs(n-1)>Math.abs(r-1)?n:r;if(s!==1){var l,u;t.restore&&(l=this.getCanvasData(),u=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(S(l,function(h,o){l[o]=h*s})),this.setCropBoxData(S(u,function(h,o){u[o]=h*s})))}}},dblclick:function(){this.disabled||this.options.dragMode===We||this.setDragMode(na(this.dragBox,jt)?ze:re)},wheel:function(t){var e=this,i=Number(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),t.deltaY?n=t.deltaY>0?1:-1:t.wheelDelta?n=-t.wheelDelta/120:t.detail&&(n=t.detail>0?1:-1),this.zoom(-n*i,t)))},cropStart:function(t){var e=t.buttons,i=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(w(e)&&e!==1||w(i)&&i!==0||t.ctrlKey))){var n=this.options,r=this.pointers,s;t.changedTouches?S(t.changedTouches,function(l){r[l.identifier]=_t(l)}):r[t.pointerId||0]=_t(t),Object.keys(r).length>1&&n.zoomable&&n.zoomOnTouch?s=Ye:s=te(t.target,Dt),Ji.test(s)&&pt(this.element,Zt,{originalEvent:t,action:s})!==!1&&(t.preventDefault(),this.action=s,this.cropping=!1,s===Pe&&(this.cropping=!0,V(this.dragBox,St)))}},cropMove:function(t){var e=this.action;if(!(this.disabled||!e)){var i=this.pointers;t.preventDefault(),pt(this.element,Qt,{originalEvent:t,action:e})!==!1&&(t.changedTouches?S(t.changedTouches,function(n){T(i[n.identifier]||{},_t(n,!0))}):T(i[t.pointerId||0]||{},_t(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var e=this.action,i=this.pointers;t.changedTouches?S(t.changedTouches,function(n){delete i[n.identifier]}):delete i[t.pointerId||0],e&&(t.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,ct(this.dragBox,St,this.cropped&&this.options.modal)),pt(this.element,Jt,{originalEvent:t,action:e}))}}},Ca={change:function(t){var e=this.options,i=this.canvasData,n=this.containerData,r=this.cropBoxData,s=this.pointers,l=this.action,u=e.aspectRatio,h=r.left,o=r.top,d=r.width,c=r.height,b=h+d,y=o+c,k=0,x=0,A=n.width,R=n.height,N=!0,J;!u&&t.shiftKey&&(u=d&&c?d/c:1),this.limited&&(k=r.minLeft,x=r.minTop,A=k+Math.min(n.width,i.width,i.left+i.width),R=x+Math.min(n.height,i.height,i.top+i.height));var X=s[Object.keys(s)[0]],m={x:X.endX-X.startX,y:X.endY-X.startY},E=function(H){switch(H){case st:b+m.x>A&&(m.x=A-b);break;case nt:h+m.x<k&&(m.x=k-h);break;case K:o+m.y<x&&(m.y=x-o);break;case dt:y+m.y>R&&(m.y=R-y);break}};switch(l){case ae:h+=m.x,o+=m.y;break;case st:if(m.x>=0&&(b>=A||u&&(o<=x||y>=R))){N=!1;break}E(st),d+=m.x,d<0&&(l=nt,d=-d,h-=d),u&&(c=d/u,o+=(r.height-c)/2);break;case K:if(m.y<=0&&(o<=x||u&&(h<=k||b>=A))){N=!1;break}E(K),c-=m.y,o+=m.y,c<0&&(l=dt,c=-c,o-=c),u&&(d=c*u,h+=(r.width-d)/2);break;case nt:if(m.x<=0&&(h<=k||u&&(o<=x||y>=R))){N=!1;break}E(nt),d-=m.x,h+=m.x,d<0&&(l=st,d=-d,h-=d),u&&(c=d/u,o+=(r.height-c)/2);break;case dt:if(m.y>=0&&(y>=R||u&&(h<=k||b>=A))){N=!1;break}E(dt),c+=m.y,c<0&&(l=K,c=-c,o-=c),u&&(d=c*u,h+=(r.width-d)/2);break;case mt:if(u){if(m.y<=0&&(o<=x||b>=A)){N=!1;break}E(K),c-=m.y,o+=m.y,d=c*u}else E(K),E(st),m.x>=0?b<A?d+=m.x:m.y<=0&&o<=x&&(N=!1):d+=m.x,m.y<=0?o>x&&(c-=m.y,o+=m.y):(c-=m.y,o+=m.y);d<0&&c<0?(l=bt,c=-c,d=-d,o-=c,h-=d):d<0?(l=gt,d=-d,h-=d):c<0&&(l=vt,c=-c,o-=c);break;case gt:if(u){if(m.y<=0&&(o<=x||h<=k)){N=!1;break}E(K),c-=m.y,o+=m.y,d=c*u,h+=r.width-d}else E(K),E(nt),m.x<=0?h>k?(d-=m.x,h+=m.x):m.y<=0&&o<=x&&(N=!1):(d-=m.x,h+=m.x),m.y<=0?o>x&&(c-=m.y,o+=m.y):(c-=m.y,o+=m.y);d<0&&c<0?(l=vt,c=-c,d=-d,o-=c,h-=d):d<0?(l=mt,d=-d,h-=d):c<0&&(l=bt,c=-c,o-=c);break;case bt:if(u){if(m.x<=0&&(h<=k||y>=R)){N=!1;break}E(nt),d-=m.x,h+=m.x,c=d/u}else E(dt),E(nt),m.x<=0?h>k?(d-=m.x,h+=m.x):m.y>=0&&y>=R&&(N=!1):(d-=m.x,h+=m.x),m.y>=0?y<R&&(c+=m.y):c+=m.y;d<0&&c<0?(l=mt,c=-c,d=-d,o-=c,h-=d):d<0?(l=vt,d=-d,h-=d):c<0&&(l=gt,c=-c,o-=c);break;case vt:if(u){if(m.x>=0&&(b>=A||y>=R)){N=!1;break}E(st),d+=m.x,c=d/u}else E(dt),E(st),m.x>=0?b<A?d+=m.x:m.y>=0&&y>=R&&(N=!1):d+=m.x,m.y>=0?y<R&&(c+=m.y):c+=m.y;d<0&&c<0?(l=gt,c=-c,d=-d,o-=c,h-=d):d<0?(l=bt,d=-d,h-=d):c<0&&(l=mt,c=-c,o-=c);break;case Be:this.move(m.x,m.y),N=!1;break;case Ye:this.zoom(da(s),t),N=!1;break;case Pe:if(!m.x||!m.y){N=!1;break}J=je(this.cropper),h=X.startX-J.left,o=X.startY-J.top,d=r.minWidth,c=r.minHeight,m.x>0?l=m.y>0?vt:mt:m.x<0&&(h-=d,l=m.y>0?bt:gt),m.y<0&&(o-=c),this.cropped||(q(this.cropBox,W),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}N&&(r.width=d,r.height=c,r.left=h,r.top=o,this.action=l,this.renderCropBox()),S(s,function(I){I.startX=I.endX,I.startY=I.endY})}},ka={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&V(this.dragBox,St),q(this.cropBox,W),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=T({},this.initialImageData),this.canvasData=T({},this.initialCanvasData),this.cropBoxData=T({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(T(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),q(this.dragBox,St),V(this.cropBox,W)),this},replace:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),e?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,S(this.previews,function(i){i.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,q(this.cropper,me)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,V(this.cropper,me)),this},destroy:function(){var t=this.element;return t[M]?(t[M]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,i=this.canvasData,n=i.left,r=i.top;return this.moveTo(Xt(t)?t:n+Number(t),Xt(e)?e:r+Number(e))},moveTo:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,i=this.canvasData,n=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.movable&&(w(t)&&(i.left=t,n=!0),w(e)&&(i.top=e,n=!0),n&&this.renderCanvas(!0)),this},zoom:function(t,e){var i=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(i.width*t/i.naturalWidth,null,e)},zoomTo:function(t,e,i){var n=this.options,r=this.canvasData,s=r.width,l=r.height,u=r.naturalWidth,h=r.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&n.zoomable){var o=u*t,d=h*t;if(pt(this.element,Kt,{ratio:t,oldRatio:s/u,originalEvent:i})===!1)return this;if(i){var c=this.pointers,b=je(this.cropper),y=c&&Object.keys(c).length?ua(c):{pageX:i.pageX,pageY:i.pageY};r.left-=(o-s)*((y.pageX-b.left-r.left)/s),r.top-=(d-l)*((y.pageY-b.top-r.top)/l)}else ut(e)&&w(e.x)&&w(e.y)?(r.left-=(o-s)*((e.x-r.left)/s),r.top-=(d-l)*((e.y-r.top)/l)):(r.left-=(o-s)/2,r.top-=(d-l)/2);r.width=o,r.height=d,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),w(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var e=this.imageData.scaleY;return this.scale(t,w(e)?e:1)},scaleY:function(t){var e=this.imageData.scaleX;return this.scale(w(e)?e:1,t)},scale:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,i=this.imageData,n=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(w(t)&&(i.scaleX=t,n=!0),w(e)&&(i.scaleY=e,n=!0),n&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.options,i=this.imageData,n=this.canvasData,r=this.cropBoxData,s;if(this.ready&&this.cropped){s={x:r.left-n.left,y:r.top-n.top,width:r.width,height:r.height};var l=i.width/i.naturalWidth;if(S(s,function(o,d){s[d]=o/l}),t){var u=Math.round(s.y+s.height),h=Math.round(s.x+s.width);s.x=Math.round(s.x),s.y=Math.round(s.y),s.width=h-s.x,s.height=u-s.y}}else s={x:0,y:0,width:0,height:0};return e.rotatable&&(s.rotate=i.rotate||0),e.scalable&&(s.scaleX=i.scaleX||1,s.scaleY=i.scaleY||1),s},setData:function(t){var e=this.options,i=this.imageData,n=this.canvasData,r={};if(this.ready&&!this.disabled&&ut(t)){var s=!1;e.rotatable&&w(t.rotate)&&t.rotate!==i.rotate&&(i.rotate=t.rotate,s=!0),e.scalable&&(w(t.scaleX)&&t.scaleX!==i.scaleX&&(i.scaleX=t.scaleX,s=!0),w(t.scaleY)&&t.scaleY!==i.scaleY&&(i.scaleY=t.scaleY,s=!0)),s&&this.renderCanvas(!0,!0);var l=i.width/i.naturalWidth;w(t.x)&&(r.left=t.x*l+n.left),w(t.y)&&(r.top=t.y*l+n.top),w(t.width)&&(r.width=t.width*l),w(t.height)&&(r.height=t.height*l),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?T({},this.containerData):{}},getImageData:function(){return this.sized?T({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,e={};return this.ready&&S(["left","top","width","height","naturalWidth","naturalHeight"],function(i){e[i]=t[i]}),e},setCanvasData:function(t){var e=this.canvasData,i=e.aspectRatio;return this.ready&&!this.disabled&&ut(t)&&(w(t.left)&&(e.left=t.left),w(t.top)&&(e.top=t.top),w(t.width)?(e.width=t.width,e.height=t.width/i):w(t.height)&&(e.height=t.height,e.width=t.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,e;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(t){var e=this.cropBoxData,i=this.options.aspectRatio,n,r;return this.ready&&this.cropped&&!this.disabled&&ut(t)&&(w(t.left)&&(e.left=t.left),w(t.top)&&(e.top=t.top),w(t.width)&&t.width!==e.width&&(n=!0,e.width=t.width),w(t.height)&&t.height!==e.height&&(r=!0,e.height=t.height),i&&(n?e.height=e.width/i:r&&(e.width=e.height*i)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e=this.canvasData,i=fa(this.image,this.imageData,e,t);if(!this.cropped)return i;var n=this.getData(),r=n.x,s=n.y,l=n.width,u=n.height,h=i.width/Math.floor(e.naturalWidth);h!==1&&(r*=h,s*=h,l*=h,u*=h);var o=l/u,d=et({aspectRatio:o,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),c=et({aspectRatio:o,width:t.minWidth||0,height:t.minHeight||0},"cover"),b=et({aspectRatio:o,width:t.width||(h!==1?i.width:l),height:t.height||(h!==1?i.height:u)}),y=b.width,k=b.height;y=Math.min(d.width,Math.max(c.width,y)),k=Math.min(d.height,Math.max(c.height,k));var x=document.createElement("canvas"),A=x.getContext("2d");x.width=ft(y),x.height=ft(k),A.fillStyle=t.fillColor||"transparent",A.fillRect(0,0,y,k);var R=t.imageSmoothingEnabled,N=R===void 0?!0:R,J=t.imageSmoothingQuality;A.imageSmoothingEnabled=N,J&&(A.imageSmoothingQuality=J);var X=i.width,m=i.height,E=r,I=s,H,Q,it,at,Z,$;E<=-l||E>X?(E=0,H=0,it=0,Z=0):E<=0?(it=-E,E=0,H=Math.min(X,l+E),Z=H):E<=X&&(it=0,H=Math.min(l,X-E),Z=H),H<=0||I<=-u||I>m?(I=0,Q=0,at=0,$=0):I<=0?(at=-I,I=0,Q=Math.min(m,u+I),$=Q):I<=m&&(at=0,Q=Math.min(u,m-I),$=Q);var Y=[E,I,H,Q];if(Z>0&&$>0){var rt=y/l;Y.push(it*rt,at*rt,Z*rt,$*rt)}return A.drawImage.apply(A,[i].concat(Le(Y.map(function(Et){return Math.floor(ft(Et))})))),x},setAspectRatio:function(t){var e=this.options;return!this.disabled&&!Xt(t)&&(e.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var e=this.options,i=this.dragBox,n=this.face;if(this.ready&&!this.disabled){var r=t===re,s=e.movable&&t===ze;t=r||s?t:We,e.dragMode=t,xt(i,Dt,t),ct(i,jt,r),ct(i,qt,s),e.cropBoxMovable||(xt(n,Dt,t),ct(n,jt,r),ct(n,qt,s))}return this}},Ma=G.Cropper,Ge=function(){function a(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Yi(this,a),!t||!Ki.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=T({},ke,ut(e)&&e),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return zi(a,[{key:"init",value:function(){var e=this.element,i=e.tagName.toLowerCase(),n;if(!e[M]){if(e[M]=this,i==="img"){if(this.isImg=!0,n=e.getAttribute("src")||"",this.originalUrl=n,!n)return;n=e.src}else i==="canvas"&&window.HTMLCanvasElement&&(n=e.toDataURL());this.load(n)}}},{key:"load",value:function(e){var i=this;if(e){this.url=e,this.imageData={};var n=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Qi.test(e)){Zi.test(e)?this.read(ga(e)):this.clone();return}var s=new XMLHttpRequest,l=this.clone.bind(this);this.reloading=!0,this.xhr=s,s.onabort=l,s.onerror=l,s.ontimeout=l,s.onprogress=function(){s.getResponseHeader("content-type")!==Ce&&s.abort()},s.onload=function(){i.read(s.response)},s.onloadend=function(){i.reloading=!1,i.xhr=null},r.checkCrossOrigin&&Te(e)&&n.crossOrigin&&(e=_e(e)),s.open("GET",e,!0),s.responseType="arraybuffer",s.withCredentials=n.crossOrigin==="use-credentials",s.send()}}},{key:"read",value:function(e){var i=this.options,n=this.imageData,r=ba(e),s=0,l=1,u=1;if(r>1){this.url=va(e,Ce);var h=wa(r);s=h.rotate,l=h.scaleX,u=h.scaleY}i.rotatable&&(n.rotate=s),i.scalable&&(n.scaleX=l,n.scaleY=u),this.clone()}},{key:"clone",value:function(){var e=this.element,i=this.url,n=e.crossOrigin,r=i;this.options.checkCrossOrigin&&Te(i)&&(n||(n="anonymous"),r=_e(i)),this.crossOrigin=n,this.crossOriginUrl=r;var s=document.createElement("img");n&&(s.crossOrigin=n),s.src=r||i,s.alt=e.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),V(s,ge),e.parentNode.insertBefore(s,e.nextSibling)}},{key:"start",value:function(){var e=this,i=this.image;i.onload=null,i.onerror=null,this.sizing=!0;var n=G.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(G.navigator.userAgent),r=function(h,o){T(e.imageData,{naturalWidth:h,naturalHeight:o,aspectRatio:h/o}),e.initialImageData=T({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(i.naturalWidth&&!n){r(i.naturalWidth,i.naturalHeight);return}var s=document.createElement("img"),l=document.body||document.documentElement;this.sizingImage=s,s.onload=function(){r(s.width,s.height),n||l.removeChild(s)},s.src=i.src,n||(s.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",l.appendChild(s))}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var e=this.element,i=this.options,n=this.image,r=e.parentNode,s=document.createElement("div");s.innerHTML=ta;var l=s.querySelector(".".concat(M,"-container")),u=l.querySelector(".".concat(M,"-canvas")),h=l.querySelector(".".concat(M,"-drag-box")),o=l.querySelector(".".concat(M,"-crop-box")),d=o.querySelector(".".concat(M,"-face"));this.container=r,this.cropper=l,this.canvas=u,this.dragBox=h,this.cropBox=o,this.viewBox=l.querySelector(".".concat(M,"-view-box")),this.face=d,u.appendChild(n),V(e,W),r.insertBefore(l,e.nextSibling),q(n,ge),this.initPreview(),this.bind(),i.initialAspectRatio=Math.max(0,i.initialAspectRatio)||NaN,i.aspectRatio=Math.max(0,i.aspectRatio)||NaN,i.viewMode=Math.max(0,Math.min(3,Math.round(i.viewMode)))||0,V(o,W),i.guides||V(o.getElementsByClassName("".concat(M,"-dashed")),W),i.center||V(o.getElementsByClassName("".concat(M,"-center")),W),i.background&&V(l,"".concat(M,"-bg")),i.highlight||V(d,$i),i.cropBoxMovable&&(V(d,qt),xt(d,Dt,ae)),i.cropBoxResizable||(V(o.getElementsByClassName("".concat(M,"-line")),W),V(o.getElementsByClassName("".concat(M,"-point")),W)),this.render(),this.ready=!0,this.setDragMode(i.dragMode),i.autoCrop&&this.crop(),this.setData(i.data),z(i.ready)&&U(e,De,i.ready,{once:!0}),pt(e,De)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var e=this.cropper.parentNode;e&&e.removeChild(this.cropper),q(this.element,W)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Ma,a}},{key:"setDefaults",value:function(e){T(ke,ut(e)&&e)}}]),a}();T(Ge.prototype,ya,Da,xa,Ea,Ca,ka);const Ta={props:{item:{type:Object,required:!0}},emits:["update:item","update:file","error"],data(){return{cropper:null,scaleX:1,scaleY:1}},setup(){const a=ai(),t=ri(),e=It();return{app:Ne(),auth:e,languages:a,side:t}},mounted(){var a;!this.readonly&&((a=this.item.mime)!=null&&a.startsWith("image/"))&&(this.cropper=new Ge(this.$refs.image,{aspectRatio:NaN,background:!0,responsive:!0,dragMode:"move",movable:!1,autoCrop:!1,zoomable:!0,zoomOnWheel:!1,zoomOnTouch:!1,viewMode:1}))},beforeUnmount(){this.cropper&&this.cropper.destroy()},computed:{desclangs(){return Object.keys(this.languages.available||{}).concat(Object.keys(this.item.description||{})).filter((a,t,e)=>e.indexOf(a)===t)},langs(){const a=[{code:null,name:"None"}];return Object.entries(this.languages.available).forEach(t=>{a.push({code:t[0],name:t[1]})}),a},readonly(){return!this.auth.can("file:save")}},methods:{download(){this.cropper.getCroppedCanvas().toBlob(a=>{const t=URL.createObjectURL(a),e=document.createElement("a");e.href=t,e.download=this.item.name||"download",e.click(),URL.revokeObjectURL(t)})},flipX(){this.scaleX=-this.scaleX,this.cropper.scaleX(this.scaleX),this.save()},flipY(){this.scaleY=-this.scaleY,this.cropper.scaleY(this.scaleY),this.save()},reset(){this.$emit("update:file",null),this.cropper.reset(),this.cropper.clear(),this.scaleX=1,this.scaleY=1},rotate(a){this.cropper.rotate(a),this.save(),this.$nextTick(()=>{const t=this.cropper.getContainerData(),e=this.cropper.getImageData();let i,n;Math.abs(Math.abs(e.rotate)-180)===90?(i=t.width/e.naturalHeight,n=t.height/e.naturalWidth):(i=t.width/e.naturalWidth,n=t.height/e.naturalHeight),this.cropper.zoomTo(Math.min(i,n))})},save(){this.cropper.getCroppedCanvas().toBlob(a=>{this.$emit("update:file",a)})},update(a,t){this.item[a]=t,this.$emit("update:item",this.item)},url(a){return a.startsWith("http")||a.startsWith("blob:")?a:this.app.urlfile.replace(/\/+$/g,"")+"/"+a}}},_a={key:0,ref:"editorContainer",class:"editor-container"},Oa=["src"],Na={key:0,class:"floating-toolbar"},Sa={class:"toolbar-group"},Aa={class:"toolbar-group"},Ia={class:"toolbar-group"},Ra=["src"],Va=["src"],La={key:3,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-file-earmark-binary",viewBox:"0 0 16 16"};function Pa(a,t,e,i,n,r){return v(),_(Ie,null,{default:f(()=>[p(Re,null,{default:f(()=>[p(Wt,null,{default:f(()=>[p(kt,{cols:"12",md:"6"},{default:f(()=>[p(Se,{ref:"name",readonly:r.readonly,modelValue:e.item.name,"onUpdate:modelValue":t[0]||(t[0]=s=>r.update("name",s)),variant:"underlined",label:"Name",counter:"255",maxlength:"255"},null,8,["readonly","modelValue"])]),_:1}),p(kt,{cols:"12",md:"6"},{default:f(()=>[p(si,{ref:"lang",items:r.langs,readonly:r.readonly,modelValue:e.item.lang,"onUpdate:modelValue":t[1]||(t[1]=s=>r.update("lang",s)),variant:"underlined","item-title":"name","item-value":"code",label:"Language"},null,8,["items","readonly","modelValue"])]),_:1})]),_:1}),p(Wt,null,{default:f(()=>[(v(!0),L(lt,null,wt(r.desclangs,s=>(v(),_(kt,{cols:"12",class:"desc"},{default:f(()=>{var l;return[p(ni,{ref_for:!0,ref:"description",readonly:r.readonly,modelValue:((l=e.item.description)==null?void 0:l[s])||"","onUpdate:modelValue":u=>{e.item.description[s]=u,a.$emit("update:item",e.item)},placeholder:`Description in ${s}`,label:`Description (${s})`,variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["readonly","modelValue","onUpdate:modelValue","placeholder","label"])]}),_:2},1024))),256))]),_:1}),p(Wt,null,{default:f(()=>[e.item?(v(),_(kt,{key:0,cols:"12",class:"preview"},{default:f(()=>{var s,l,u;return[(s=e.item.mime)!=null&&s.startsWith("image/")?(v(),L("div",_a,[g("img",{ref:"image",src:r.url(e.item.path),class:"element"},null,8,Oa),r.readonly?O("",!0):(v(),L("div",Na,[g("div",Sa,[p(D,{icon:"mdi-rotate-left",onClick:t[2]||(t[2]=h=>r.rotate(-90)),title:"Rotate counter-clockwise"}),p(D,{icon:"mdi-rotate-right",onClick:t[3]||(t[3]=h=>r.rotate(90)),title:"Rotate clockwise"})]),g("div",Aa,[p(D,{icon:"mdi-flip-horizontal",onClick:r.flipX,title:"Flip horizontally"},null,8,["onClick"]),p(D,{icon:"mdi-flip-vertical",onClick:r.flipY,title:"Flip vertically"},null,8,["onClick"])]),g("div",Ia,[p(D,{icon:"mdi-history",onClick:t[4]||(t[4]=h=>r.reset()),title:"Reset"}),p(D,{icon:"mdi-download",onClick:t[5]||(t[5]=h=>r.download()),title:"Download"})])]))],512)):(l=e.item.mime)!=null&&l.startsWith("video/")?(v(),L("video",{key:1,preload:"metadata",crossorigin:"anonymous",src:r.url(e.item.path),class:"element",controls:""},null,8,Ra)):(u=e.item.mime)!=null&&u.startsWith("audio/")?(v(),L("audio",{key:2,preload:"metadata",src:r.url(e.item.path),class:"element",controls:""},null,8,Va)):(v(),L("svg",La,t[6]||(t[6]=[g("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),g("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])))]}),_:1})):O("",!0)]),_:1})]),_:1})]),_:1})}const Ba=At(Ta,[["render",Pa],["__scopeId","data-v-d9bb0192"]]),Ya={components:{AsideMeta:bi,HistoryDialog:vi,FileDetailItem:Ba,FileDetailRefs:Bi},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,pubmenu:!1,vhistory:!1,tab:"file"}),setup(){const a=Oe(),t=oi();return{auth:It(),drawer:t,messages:a}},methods:{publish(a=null){if(!this.auth.can("file:publish")){this.messages.add("Permission denied","error");return}this.save(!0).then(t=>{var e,i;t&&this.$apollo.mutate({mutation:j`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(i=(e=a==null?void 0:a.toISOString())==null?void 0:e.substring(0,19))==null?void 0:i.replace("T"," ")}}).then(n=>{if(n.errors)throw n.errors;a?(this.item.publish_at=a,this.messages.add(`File scheduled for publishing at ${a.toLocaleDateString()}`,"info")):(this.item.published=!0,this.messages.add("File published successfully","success")),this.closeView()}).catch(n=>{this.messages.add("Error publishing file","error"),this.$log("FileDetail::publish(): Error publishing file",a,n)})})},reset(){this.changed=!1,this.error=!1},save(a=!1){return this.auth.can("file:save")?this.changed?this.$apollo.mutate({mutation:j`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
            }
          }`,variables:{id:this.item.id,input:{description:JSON.stringify(this.item.description||{}),name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(t=>{if(t.errors)throw t.errors;return this.item.published=!1,this.reset(),a||this.messages.add("File saved successfully","success"),!0}).catch(t=>{this.messages.add("Error saving file","error"),this.$log("FileDetail::save(): Error saving file",t)}):Promise.resolve(!0):(this.messages.add("Permission denied","error"),Promise.resolve(!1))},use(a){Object.assign(this.item,a.data),this.vhistory=!1,this.changed=!0},versions(a){return this.auth.can("file:view")?a?this.$apollo.query({query:j`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:a}}).then(t=>{if(t.errors||!t.data.file)throw t;return(t.data.file.versions||[]).map(e=>({...e,data:JSON.parse(e.data||"{}")})).reverse()}).catch(t=>{this.messages.add("Error fetching file versions","error"),this.$log("FileDetail::versions(): Error fetching file versions",a,t)}):Promise.resolve([]):(this.messages.add("Permission denied","error"),Promise.resolve([]))}}},za={class:"app-title"},Wa={class:"menu-content"};function Xa(a,t,e,i,n,r){const s=Mt("FileDetailItem"),l=Mt("FileDetailRefs"),u=Mt("AsideMeta"),h=Mt("HistoryDialog");return v(),L(lt,null,[p(li,{elevation:0,density:"compact"},{prepend:f(()=>[p(D,{icon:"mdi-keyboard-backspace",onClick:t[0]||(t[0]=o=>r.closeView()),elevation:"0"})]),append:f(()=>[p(D,{icon:"mdi-history",class:ot({hidden:e.item.published&&!a.changed&&!e.item.latest}),onClick:t[1]||(t[1]=o=>a.vhistory=!0),elevation:"0"},null,8,["class"]),p(D,{class:ot([{error:a.error},"menu-save"]),disabled:!a.changed||a.error||!i.auth.can("file:save"),onClick:t[2]||(t[2]=o=>r.save()),variant:"text"},{default:f(()=>t[17]||(t[17]=[C("Save")])),_:1,__:[17]},8,["class","disabled"]),p(Ot,{modelValue:a.pubmenu,"onUpdate:modelValue":t[6]||(t[6]=o=>a.pubmenu=o),"close-on-content-click":!1},{activator:f(({props:o})=>[p(fi,{class:"menu-publish",variant:"text"},{default:f(()=>[p(D,{class:ot([{error:a.error},"button"]),disabled:e.item.published&&!a.changed||a.error||!i.auth.can("file:publish"),onClick:t[3]||(t[3]=d=>r.publish())},{default:f(()=>t[18]||(t[18]=[C("Publish")])),_:1,__:[18]},8,["class","disabled"]),p(D,Nt({class:[{error:a.error},"icon"],icon:"mdi-menu-down",disabled:e.item.published&&!a.changed||a.error||!i.auth.can("file:publish")},o),null,16,["class","disabled"])]),_:2},1024)]),default:f(()=>[g("div",Wa,[p(ci,{modelValue:a.publishAt,"onUpdate:modelValue":t[4]||(t[4]=o=>a.publishAt=o),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),p(D,{disabled:!a.publishAt||a.error,color:a.publishAt?"primary":"",onClick:t[5]||(t[5]=o=>{r.publish(a.publishAt),a.pubmenu=!1}),variant:"flat"},{default:f(()=>t[19]||(t[19]=[C("Publish")])),_:1,__:[19]},8,["disabled","color"])])]),_:1},8,["modelValue"]),p(D,{onClick:t[7]||(t[7]=Ut(o=>i.drawer.toggle("aside"),["stop"]))},{default:f(()=>[p(Ae,{size:"x-large"},{default:f(()=>[C(B(i.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"),1)]),_:1})]),_:1})]),default:f(()=>[p(ui,null,{default:f(()=>[g("div",za," File: "+B(e.item.name),1)]),_:1})]),_:1}),p(hi,{class:"file-details"},{default:f(()=>[p(pi,{onSubmit:t[13]||(t[13]=Ut(()=>{},["prevent"]))},{default:f(()=>[p(mi,{"fixed-tabs":"",modelValue:a.tab,"onUpdate:modelValue":t[8]||(t[8]=o=>a.tab=o)},{default:f(()=>[p(ue,{value:"file",class:ot({changed:a.changed,error:a.error})},{default:f(()=>t[20]||(t[20]=[C("File")])),_:1,__:[20]},8,["class"]),p(ue,{value:"refs"},{default:f(()=>t[21]||(t[21]=[C("Used by")])),_:1,__:[21]})]),_:1},8,["modelValue"]),p(gi,{modelValue:a.tab,"onUpdate:modelValue":t[12]||(t[12]=o=>a.tab=o)},{default:f(()=>[p(ce,{value:"file"},{default:f(()=>[p(s,{item:e.item,"onUpdate:item":t[9]||(t[9]=o=>{this.$emit("update:item",e.item),a.changed=!0}),"onUpdate:file":t[10]||(t[10]=o=>{this.file=o,a.changed=!0}),onError:t[11]||(t[11]=o=>a.error=o)},null,8,["item"])]),_:1}),p(ce,{value:"refs"},{default:f(()=>[p(l,{item:e.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),p(u,{item:e.item},null,8,["item"]),(v(),_(di,{to:"body"},[p(h,{modelValue:a.vhistory,"onUpdate:modelValue":t[14]||(t[14]=o=>a.vhistory=o),current:{data:{lang:e.item.lang,name:e.item.name,mime:e.item.mime,path:e.item.path,previews:e.item.previews,description:e.item.description}},load:()=>r.versions(e.item.id),onUse:t[15]||(t[15]=o=>r.use(o)),onRevert:t[16]||(t[16]=o=>{r.use(o),r.reset()})},null,8,["modelValue","current","load"])]))],64)}const $a=At(Ya,[["render",Xa],["__scopeId","data-v-a824fc87"]]);export{Fa as F,$a as a};
