var Qt=Object.defineProperty;var en=(e,t,n)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var _e=(e,t,n)=>en(e,typeof t!="symbol"?t+"":t,n);import{U as tn,A as nn,N as an}from"./Navigation-CGIIaB9V.js";import{_ as G,aE as kt,aB as He,b as v,w as o,aP as sn,o as g,a as u,a8 as xe,c as S,F as j,a2 as ee,aN as Ce,aQ as rn,a9 as E,f as I,t as y,G as we,l as w,aO as it,au as Ve,b7 as qe,a0 as he,b8 as Ct,ax as Ie,a3 as rt,T as Pe,r as T,ay as Te,d as k,aa as wt,ab as $t,aI as q,ac as Dt,j as C,ad as _t,J as B,aA as xt,b9 as Bt,a1 as Pt,V as Xe,e as ge,ak as Le,E as de,a6 as lt,a7 as ce,aC as St,aD as ye,a4 as Ht,aw as be,a5 as qt,i as Se,ba as ln,h as ue,aL as Qe,H as Ee,aF as Kt,aG as Mt,aH as Rt,X as on,aJ as dn,aK as un,an as Ke,bb as K,bc as ke,P as Ne,q as Y,a$ as Be,R as vt,aq as cn,b2 as ut,bd as re}from"../index.js";import{H as hn,A as fn}from"./HistoryDialog-BhGSg-LU.js";import{S as Et,F as ot,u as Oe,E as mn}from"./ElementListItems-nAx2RULT.js";import{l as gn}from"./vue-draggable-plus-wEOAkpgF.js";const pn={data:()=>({active:{},open:[0,1,2]}),setup(){const e=kt(),t=He();return{drawer:e,side:t}},computed:{stores(){const e=Object.keys(this.side.store).sort(),t={};for(const n of e)t[n]=this.side.store[n];return t}},methods:{isActive(e,t){return typeof this.active[e]>"u"&&(this.active[e]={}),typeof this.active[e][t]>"u"&&(this.active[e][t]=!1),this.active[e][t]},sort(e){const t=Object.keys(e).sort(),n={};for(const s of t)n[s]=e[s];return n},toggle(e,t){this.side.toggle(e,t),this.active[e][t]=!this.active[e][t]}}},vn={class:"name"},yn={class:"value"};function bn(e,t,n,s,l,a){return g(),v(sn,{modelValue:s.drawer.aside,"onUpdate:modelValue":t[1]||(t[1]=i=>s.drawer.aside=i),"mobile-breakpoint":"md",location:"end"},{default:o(()=>[u(xe,{opened:e.open,"onUpdate:opened":t[0]||(t[0]=i=>e.open=i)},{default:o(()=>[(g(!0),S(j,null,ee(a.stores,(i,r)=>Ce((g(),v(rn,{key:r,value:Object.keys(a.stores).indexOf(r)},{activator:o(({props:h})=>[u(E,we({ref_for:!0},h),{default:o(()=>[w(y(e.$gettext(r)),1)]),_:2},1040)]),default:o(()=>[(g(!0),S(j,null,ee(i,(h,d)=>(g(),v(E,{key:d,active:a.isActive(r,d),onClick:c=>a.toggle(r,d),rounded:"lg"},{default:o(()=>[I("span",vn,y(e.$gettext(d)),1),I("span",yn,y(h),1)]),_:2},1032,["active","onClick"]))),128))]),_:2},1032,["value"])),[[it,Object.keys(i).length]])),128))]),_:1},8,["opened"])]),_:1},8,["modelValue"])}const kn=G(pn,[["render",bn],["__scopeId","data-v-0c5a65db"]]),Cn={components:{Fields:ot,SchemaItems:Et},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=Ve(),t=qe(),n=He();return{auth:he(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.meta||(this.item.meta={}),this.item.meta[e.type]){this.messages.add(this.$gettext("The element has already been added"),"error");return}this.item.meta[e.type]={id:Oe(),type:e.type,data:{}},this.panel.push(Object.keys(this.item.meta).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.meta||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.meta[e])!=null&&t.fields?(n=this.schemas.meta[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.meta[e],this.$emit("change",!0),this.$nextTick(()=>{this.validate().then(t=>{this.$emit("error",!t)})})},reset(){Object.values(this.item.meta||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),s=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||s&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const s of Object.values(this.item.meta||{}))s.type&&(t[s.type]=(t[s.type]||0)+1),!s._changed&&!s._error&&(n.valid=(n.valid||0)+1),s._changed&&(n.changed=(n.changed||0)+1),s._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(s=>s&&typeof s!="object"&&typeof s!="boolean"?s:null).filter(s=>!!s).join(" - ")).substring(0,50)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(s=>s))}}},wn={class:"element-title"},$n={class:"element-type"},Dn={key:0,class:"btn-group"};function _n(e,t,n,s,l,a){const i=T("Fields"),r=T("SchemaItems"),h=Ct("observe-visibility");return g(),S(j,null,[Ce((g(),v(Ie,null,{default:o(()=>[u(Te,null,{default:o(()=>[u(wt,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=d=>e.panel=d),elevation:"0",multiple:""},{default:o(()=>[(g(!0),S(j,null,ee(n.item.meta||{},(d,c)=>Ce((g(),v($t,{key:c,class:q({changed:d._changed,error:d._error})},{default:o(()=>[u(Dt,{"expand-icon":"mdi-pencil"},{default:o(()=>[s.auth.can("page:save")?(g(),v(C,{key:0,icon:"mdi-delete",variant:"text",onClick:m=>a.remove(c)},null,8,["onClick"])):k("",!0),I("div",wn,y(a.title(d)),1),I("div",$n,y(d.type),1)]),_:2},1024),u(_t,null,{default:o(()=>[u(i,{ref_for:!0,ref:"field",data:d.data,"onUpdate:data":m=>d.data=m,files:d.files,"onUpdate:files":m=>d.files=m,readonly:!s.auth.can("page:save"),fields:a.fields(d.type),assets:n.assets,onError:m=>a.error(d,m),onChange:m=>a.update(d)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","onError","onChange"])]),_:2},1024)]),_:2},1032,["class"])),[[it,a.shown(d)]])),128))]),_:1},8,["modelValue"]),a.available&&s.auth.can("page:save")?(g(),S("div",Dn,[u(C,{icon:"mdi-view-grid-plus",color:"primary",onClick:t[1]||(t[1]=d=>e.vschemas=!0),variant:"flat"})])):k("",!0)]),_:1})]),_:1})),[[h,a.store]]),(g(),v(Pe,{to:"body"},[u(rt,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=d=>e.vschemas=d),scrollable:"",width:"auto"},{default:o(()=>[u(r,{type:"meta",onAdd:t[2]||(t[2]=d=>a.add(d))})]),_:1},8,["modelValue"])]))],64)}const xn=G(Cn,[["render",_n],["__scopeId","data-v-f6205f80"]]),Pn={props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],inject:["debounce","locales"],data:()=>({errors:{},messages:{}}),setup(){const e=xt(),t=Bt(),n=He(),s=he();return{app:Pt(),auth:s,side:n,config:t,languages:e}},created(){this.checkPathd=this.debounce(this.checkPath,500)},computed:{readonly(){return!this.auth.can("page:save")}},methods:{checkPath(){return this.$apollo.query({query:B`query($filter: PageFilter) {
            pages(filter: $filter) {
              data {
                id
              }
            }
          }`,variables:{filter:{path:this.item.path||"",domain:this.item.domain||""}}}).then(e=>{var t,n,s,l,a,i;return((s=(n=(t=e==null?void 0:e.data)==null?void 0:t.pages)==null?void 0:n.data)==null?void 0:s.length)>0&&((i=(a=(l=e==null?void 0:e.data)==null?void 0:l.pages)==null?void 0:a.data)!=null&&i.some(r=>r.id!==this.item.id))?this.messages.path=[this.$gettext("The path is already in use by another page")]:this.messages.path=[],this.$emit("error",!!this.messages.path.length),this.messages.path}).catch(e=>{console.error("PageDetailItemProps::checkPath: Error checking path",e)})},reset(){this.errors={}},setPath(e){var t;!e&&((t=this.item.path)==null?void 0:t.at(0))==="_"&&this.updatePath(this.item.name)},update(e,t){this.item[e]=typeof t=="string"?t.trim():t,this.$emit("change",!0)},updatePath(e){var t;this.update("path",(t=e==null?void 0:e.replace(/[?#%;&=+!"'()\[\]{}*<>|^]+/g," ").trim().replace(/[ ]+/g,"-"))==null?void 0:t.toLowerCase())},async validate(e=!1){await this.$nextTick();const t=[e?this.checkPathd():this.checkPath()];return Object.values(this.$refs).forEach(n=>{t.push(n.validate())}),Promise.all(t).then(n=>{const s=n.reduce((l,a)=>l+a.length,0);return this.$emit("error",!!s),s||!0})}},watch:{item:{deep:!0,immediate:!0,handler(e){this.validate(!0)}}}};function Sn(e,t,n,s,l,a){return g(),v(Ie,null,{default:o(()=>[u(Te,null,{default:o(()=>[u(Xe,null,{default:o(()=>[u(ge,{cols:"12",md:"6"},{default:o(()=>[u(Le,{ref:"status",items:[{key:0,val:e.$gettext("Disabled")},{key:1,val:e.$gettext("Enabled")},{key:2,val:e.$gettext("Hidden in navigation")}],readonly:a.readonly,modelValue:n.item.status,"onUpdate:modelValue":t[0]||(t[0]=i=>a.update("status",i)),variant:"underlined","item-title":"val","item-value":"key",label:e.$gettext("Status")},null,8,["items","readonly","modelValue","label"])]),_:1}),u(ge,{cols:"12",md:"6"},{default:o(()=>[u(Le,{ref:"lang",items:a.locales(),readonly:a.readonly,modelValue:n.item.lang,"onUpdate:modelValue":t[1]||(t[1]=i=>a.update("lang",i)),variant:"underlined",label:e.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),u(Xe,null,{default:o(()=>[u(ge,{cols:"12",md:"6"},{default:o(()=>[u(de,{ref:"name",rules:[i=>!!i||e.$gettext("Field is required")],readonly:a.readonly,modelValue:n.item.name,"onUpdate:modelValue":t[2]||(t[2]=i=>a.update("name",i)),"onUpdate:focused":t[3]||(t[3]=i=>a.setPath(i)),variant:"underlined",label:e.$gettext("Page name"),counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue","label"]),u(de,{ref:"title",readonly:a.readonly,modelValue:n.item.title,"onUpdate:modelValue":t[4]||(t[4]=i=>a.update("title",i)),variant:"underlined",label:e.$gettext("Page title"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),u(ge,{cols:"12",md:"6"},{default:o(()=>[u(de,{ref:"path",rules:[i=>!i||i&&i[0]!=="/"||e.$gettext("Path must not start with a slash (/)")],error:!!(e.messages.path||[]).length,"error-messages":e.messages.path,readonly:a.readonly,modelValue:n.item.path,"onUpdate:modelValue":t[5]||(t[5]=i=>{a.updatePath(i),e.messages.path=null}),onChange:t[6]||(t[6]=i=>a.checkPath()),variant:"underlined",label:e.$gettext("URL path"),counter:"255",maxlength:"255"},null,8,["rules","error","error-messages","readonly","modelValue","label"]),u(de,{ref:"domain",rules:[i=>!i||i&&/^([0-9a-z]+[.-])*[0-9a-z]+\.[a-z]{2,}$/.test(i)||e.$gettext("Domain name is invalid")],readonly:a.readonly,modelValue:n.item.domain,"onUpdate:modelValue":t[7]||(t[7]=i=>a.update("domain",i)),variant:"underlined",label:e.$gettext("Domain"),counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue","label"])]),_:1})]),_:1}),u(Xe,null,{default:o(()=>[u(ge,{cols:"12",md:"6"},{default:o(()=>[u(Le,{ref:"theme",readonly:a.readonly,items:Object.keys(s.config.get("themes",{cms:""})),modelValue:n.item.theme,"onUpdate:modelValue":t[8]||(t[8]=i=>{a.update("theme",i),n.item.type=""}),variant:"underlined",label:e.$gettext("Theme")},null,8,["readonly","items","modelValue","label"]),u(Le,{ref:"type",readonly:a.readonly,items:Object.keys(s.config.get(`themes.${n.item.theme||"cms"}.types`,{page:""})),modelValue:n.item.type,"onUpdate:modelValue":t[9]||(t[9]=i=>a.update("type",i)),variant:"underlined",label:e.$gettext("Page type")},null,8,["readonly","items","modelValue","label"])]),_:1}),u(ge,{cols:"12",md:"6"},{default:o(()=>[u(de,{ref:"tag",modelValue:n.item.tag,"onUpdate:modelValue":[t[10]||(t[10]=i=>n.item.tag=i),t[11]||(t[11]=i=>a.update())],readonly:a.readonly,label:e.$gettext("Page tag"),variant:"underlined",counter:"30",maxlength:"30"},null,8,["modelValue","readonly","label"]),u(Le,{ref:"cache",items:[{key:0,val:e.$gettext("No cache")},{key:1,val:e.$ngettext("%{num} minute","%{num} minutes",1,{num:1})},{key:5,val:e.$ngettext("%{num} minute","%{num} minutes",5,{num:5})},{key:15,val:e.$ngettext("%{num} minute","%{num} minutes",15,{num:15})},{key:30,val:e.$ngettext("%{num} minute","%{num} minutes",30,{num:30})},{key:60,val:e.$ngettext("%{num} hour","%{num} hours",1,{num:1})},{key:180,val:e.$ngettext("%{num} hour","%{num} hours",3,{num:3})},{key:360,val:e.$ngettext("%{num} hour","%{num} hours",6,{num:6})},{key:720,val:e.$ngettext("%{num} hour","%{num} hours",12,{num:12})},{key:1440,val:e.$ngettext("%{num} hour","%{num} hours",24,{num:24})}],readonly:a.readonly,modelValue:n.item.cache,"onUpdate:modelValue":t[12]||(t[12]=i=>a.update("cache",i)),variant:"underlined",label:e.$gettext("Cache time"),"item-title":"val","item-value":"key"},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),u(Xe,null,{default:o(()=>[u(ge,{cols:"12"},{default:o(()=>[u(de,{ref:"to",rules:[i=>!i||i.match("^((https?:)?//([^\\s/:@]+(:[^\\s/:@]+)?@)?([0-9a-z]+(\\.|-))*[0-9a-z]+\\.[a-z]{2,}(:[0-9]{1,5})?)?(/[^\\s]*)*$")!==null||e.$gettext("URL is not valid")],readonly:a.readonly,modelValue:n.item.to,"onUpdate:modelValue":t[13]||(t[13]=i=>a.update("to",i)),variant:"underlined",label:e.$gettext("Redirect URL"),counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1})}const En=G(Pn,[["render",Sn]]),On={components:{Fields:ot,SchemaItems:Et},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=Ve(),t=qe(),n=He();return{auth:he(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.config||(this.item.config={}),this.item.config[e.type]){this.messages.add(this.$gettext("The element has already been added"),"error");return}this.item.config[e.type]={id:Oe(),type:e.type,data:{}},this.panel.push(Object.keys(this.item.config).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.config||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.config[e])!=null&&t.fields?(n=this.schemas.config[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.config[e],this.$emit("change",!0),this.$nextTick(()=>{this.validate().then(t=>{this.$emit("error",!t)})})},reset(){Object.values(this.item.config||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),s=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||s&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const s of Object.values(this.item.config||{}))s.type&&(t[s.type]=(t[s.type]||0)+1),!s._changed&&!s._error&&(n.valid=(n.valid||0)+1),s._changed&&(n.changed=(n.changed||0)+1),s._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(s=>s&&typeof s!="object"&&typeof s!="boolean"?s:null).filter(s=>!!s).join(" - ")).substring(0,50)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(s=>s))}}},Vn={class:"element-title"},In={class:"element-type"},Tn={key:0,class:"btn-group"};function Ln(e,t,n,s,l,a){const i=T("Fields"),r=T("SchemaItems"),h=Ct("observe-visibility");return g(),S(j,null,[Ce((g(),v(Ie,null,{default:o(()=>[u(Te,null,{default:o(()=>[u(wt,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=d=>e.panel=d),elevation:"0",multiple:""},{default:o(()=>[(g(!0),S(j,null,ee(n.item.config||{},(d,c)=>Ce((g(),v($t,{key:c,class:q({changed:d._changed,error:d._error})},{default:o(()=>[u(Dt,{"expand-icon":"mdi-pencil"},{default:o(()=>[s.auth.can("page:save")?(g(),v(C,{key:0,icon:"mdi-delete",variant:"text",onClick:m=>a.remove(c)},null,8,["onClick"])):k("",!0),I("div",Vn,y(a.title(d)),1),I("div",In,y(d.type),1)]),_:2},1024),u(_t,null,{default:o(()=>[u(i,{ref_for:!0,ref:"field",data:d.data,"onUpdate:data":m=>d.data=m,files:d.files,"onUpdate:files":m=>d.files=m,readonly:!s.auth.can("page:save"),fields:a.fields(d.type),assets:n.assets,onError:m=>a.error(d,m),onChange:m=>a.update(d)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","onError","onChange"])]),_:2},1024)]),_:2},1032,["class"])),[[it,a.shown(d)]])),128))]),_:1},8,["modelValue"]),a.available&&s.auth.can("page:save")?(g(),S("div",Tn,[u(C,{icon:"mdi-view-grid-plus",color:"primary",onClick:t[1]||(t[1]=d=>e.vschemas=!0),variant:"flat"})])):k("",!0)]),_:1})]),_:1})),[[h,a.store]]),(g(),v(Pe,{to:"body"},[u(rt,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=d=>e.vschemas=d),scrollable:"",width:"auto"},{default:o(()=>[u(r,{type:"config",onAdd:t[2]||(t[2]=d=>a.add(d))})]),_:1},8,["modelValue"])]))],64)}const Nn=G(On,[["render",Ln],["__scopeId","data-v-c2a3047e"]]),Un={components:{PageDetailItemMeta:xn,PageDetailItemProps:En,PageDetailItemConfig:Nn},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["update:item","update:aside","error"],data:()=>({changed:{},errors:{},tab:"details"}),methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){var e,t,n;this.changed={},this.errors={},(e=this.$refs.props)==null||e.reset(),(t=this.$refs.meta)==null||t.reset(),(n=this.$refs.config)==null||n.reset()},update(e){this.changed[e]=!0,this.$emit("update:item",this.item)},validate(){const e=Object.values(this.$refs).map(t=>t.validate());return Promise.all(e).then(t=>t.every(n=>n))}}};function Fn(e,t,n,s,l,a){const i=T("PageDetailItemProps"),r=T("PageDetailItemMeta"),h=T("PageDetailItemConfig");return g(),v(Ie,null,{default:o(()=>[u(Te,{class:"box"},{default:o(()=>[u(lt,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=d=>e.tab=d),"align-tabs":"center"},{default:o(()=>[u(ce,{value:"details",class:q({changed:e.changed.details,error:e.errors.details}),onClick:t[0]||(t[0]=d=>e.$emit("update:aside","meta"))},{default:o(()=>[w(y(e.$gettext("Detail")),1)]),_:1},8,["class"]),u(ce,{value:"meta",class:q({changed:e.changed.meta,error:e.errors.meta}),onClick:t[1]||(t[1]=d=>e.$emit("update:aside","count"))},{default:o(()=>[w(y(e.$gettext("Meta")),1)]),_:1},8,["class"]),u(ce,{value:"config",class:q({changed:e.changed.config,error:e.errors.config}),onClick:t[2]||(t[2]=d=>e.$emit("update:aside","count"))},{default:o(()=>[w(y(e.$gettext("Config")),1)]),_:1},8,["class"])]),_:1},8,["modelValue"]),u(St,{modelValue:e.tab,"onUpdate:modelValue":t[10]||(t[10]=d=>e.tab=d)},{default:o(()=>[u(ye,{value:"details"},{default:o(()=>[u(i,{ref:"props",item:n.item,assets:n.assets,onChange:t[4]||(t[4]=d=>a.update("details")),onError:t[5]||(t[5]=d=>a.error("details",d))},null,8,["item","assets"])]),_:1}),u(ye,{value:"meta"},{default:o(()=>[u(r,{ref:"meta",item:n.item,assets:n.assets,onChange:t[6]||(t[6]=d=>a.update("meta")),onError:t[7]||(t[7]=d=>a.error("meta",d))},null,8,["item","assets"])]),_:1}),u(ye,{value:"config"},{default:o(()=>[u(h,{ref:"config",item:n.item,assets:n.assets,onChange:t[8]||(t[8]=d=>a.update("config")),onError:t[9]||(t[9]=d=>a.error("config",d))},null,8,["item","assets"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const An=G(Un,[["render",Fn],["__scopeId","data-v-c08997ac"]]),jn={components:{ElementListItems:mn,SchemaItems:Et},props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","add"]};function Bn(e,t,n,s,l,a){const i=T("SchemaItems"),r=T("ElementListItems");return g(),v(rt,{modelValue:n.modelValue,"max-width":"1200",scrollable:""},{default:o(()=>[u(Ht,null,{append:o(()=>[u(Se,{onClick:t[0]||(t[0]=h=>e.$emit("update:modelValue",!1))},{default:o(()=>t[3]||(t[3]=[w("mdi-close")])),_:1,__:[3]})]),title:o(()=>[w(y(e.$gettext("Content elements")),1)]),default:o(()=>[u(be),u(qt,null,{default:o(()=>[u(i,{type:"content",onAdd:t[1]||(t[1]=h=>e.$emit("add",h))}),u(lt,null,{default:o(()=>[u(ce,null,{default:o(()=>[w(y(e.$gettext("Shared elements")),1)]),_:1})]),_:1}),u(r,{onSelect:t[2]||(t[2]=h=>e.$emit("add",h)),embed:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const zt=G(jn,[["render",Bn],["__scopeId","data-v-43a7abdd"]]),Hn={components:{Fields:ot,SchemaDialog:zt,VueDraggable:gn},props:{item:{type:Object,required:!0},assets:{type:Object,required:!0},content:{type:Array,required:!0},elements:{type:Object,required:!0},section:{type:[String,null],default:null}},emits:["error","update:content"],data:()=>({panel:[],menu:{},index:null,checked:!1,vschemas:!1,currentPage:1,lastPage:1}),setup(){const e=ln(),t=Ve(),n=qe(),s=He();return{auth:he(),clipboard:e,side:s,messages:t,schemas:n}},computed:{changed(){return this.content.some(e=>e._changed)},isChecked(){return this.content.some(e=>e._checked)}},methods:{add(e,t){let n={id:Oe(),group:this.section||"main"};e.id?(this.elements[e.id]=e,n=Object.assign(n,{type:"reference",refid:e.id})):n=Object.assign(n,{type:e.type,data:{}}),t!==null?(this.content.splice(t,0,n),this.panel.push(this.panel.includes(t)?t+1:t)):(this.content.push(n),this.panel.push(this.content.length-1)),this.$emit("update:content",this.content),this.vschemas=!1,this.store()},copy(e){const t=[];if(e===void 0){for(let n=this.content.length-1;n>=0;n--)if(this.content[n]._checked){const s=JSON.parse(JSON.stringify(this.content[n]));s._checked=!1,s.id=null,t.push(s)}}else{const n=JSON.parse(JSON.stringify(this.content[e]));n._checked=!1,n.id=null,t.push(n)}this.clipboard.set("page-content",t.reverse())},cut(e){const t=[];if(e===void 0){for(let n=this.content.length-1;n>=0;n--)if(this.content[n]._checked){const s=JSON.parse(JSON.stringify(this.content[n]));this.content.splice(n,1),s.id=null,t.push(s)}}else{const n=JSON.parse(JSON.stringify(this.content[e]));this.content.splice(e,1),n.id=null,t.push(n)}this.clipboard.set("page-content",t.reverse()),this.$emit("update:content",this.content),this.store()},error(e,t){e._error=t,this.$emit("error",this.content.some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.content[e])!=null&&t.fields?(n=this.schemas.content[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" schemas`),[])},insert(e){this.index=e,this.vschemas=!0},paste(e=null){e===null&&(e=this.content.length);const t=(this.clipboard.get("page-content")||[]).map(n=>(n.group=this.section||"main",n));this.content.splice(e,0,...t),this.$emit("update:content",this.content),this.store()},purge(){for(let e=this.content.length-1;e>=0;e--)this.content[e]._checked&&this.content.splice(e,1);this.$emit("error",this.content.some(e=>e._error)),this.$emit("update:content",this.content),this.checked=!1,this.store()},remove(e){this.content.splice(e,1),this.$emit("error",this.content.some(t=>t._error)),this.$emit("update:content",this.content),this.store()},reset(){this.content.forEach(e=>{delete e._changed,delete e._error}),this.store()},search(e){e&&(e=e.toLocaleLowerCase().trim(),this.content.forEach(t=>{const n=t.type==="reference"?this.elements[t.refid]||{}:t;t._hide=!JSON.stringify(Object.values((n==null?void 0:n.data)||{})).toLocaleLowerCase().includes(e)}))},share(e){var n;if(!this.auth.can("element:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=this.content[e];if(!t){this.messages.add(this.$gettext("Element not found"),"error");return}if(t.type==="reference"){this.messages.add(this.$gettext("Element is already shared"),"error");return}this.$apollo.mutate({mutation:B`
            mutation($input: ElementInput!, $files: [ID!]) {
              addElement(input: $input, files: $files) {
                id
                type
                lang
                name
                data
                editor
                updated_at
                files {
                  id
                  lang
                  mime
                  name
                  path
                  previews
                  description
                  updated_at
                  editor
                }
              }
            }
          `,variables:{input:{type:t.type,lang:this.item.lang,name:this.title(t),data:JSON.stringify(t.data||{})},files:((n=t.files)==null?void 0:n.filter((s,l,a)=>a.indexOf(s)===l))||[]}}).then(s=>{if(s.errors)throw s.errors;const l=s.data.addElement;for(const a of l.files||[])a.previews=JSON.parse(a.previews||"{}"),this.assets[a.id]=a;l.data=JSON.parse(l.data),l.files=l.files.map(a=>a.id),this.elements[l.id]=l,this.content[e]={id:Oe(),group:this.section||"main",type:"reference",refid:l.id},this.$emit("update:content",this.content),this.store()}).catch(s=>{this.messages.add(this.$gettext("Unable to make element shared"),"error"),this.$log("PageDetailContentList::share(): Error making element shared",e,s)})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),s=this.side.shown("state","changed");return!e._hide&&this.side.shown("type",e.type)&&(n&&e._error||s&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};return this.content.forEach(s=>{s.type&&(t[s.type]=(t[s.type]||0)+1),!s._changed&&!s._error&&(n.valid=(n.valid||0)+1),s._changed&&(n.changed=(n.changed||0)+1),s._error&&(n.error=(n.error||0)+1)}),this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(s=>s&&typeof s!="object"&&typeof s!="boolean"?s:null).filter(s=>!!s).join(" - ")).substring(0,50)||e.type||""},toggle(){this.content.forEach(e=>{this.shown(e)&&(e._checked=!e._checked)})},unshare(e){if(!this.content[e]){this.messages.add(this.$gettext("Content element not found"),"error");return}const t=this.content[e];if(t.type!=="reference"||!this.elements[t.refid]){this.messages.add(this.$gettext("Element is not shared"),"error");return}for(const n of this.elements[t.refid].files||[])this.assets[n.id]=n;this.content[e].type=this.elements[t.refid].type||null,this.content[e].data=this.elements[t.refid].data||{},delete this.content[e].refid,this.$emit("update:content",this.content),this.store()},update(e){e._changed=!0,e.group=this.section||"main",this.$emit("error",this.content.some(t=>t._error)),this.$emit("update:content",this.content),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(s=>s))}}},qn={class:"header"},Kn={key:0,class:"bulk"},Mn={class:"element-title"},Rn={class:"element-type"},zn={key:0,class:"btn-group"};function Jn(e,t,n,s,l,a){const i=T("Fields"),r=T("VueDraggable"),h=T("SchemaDialog"),d=Ct("observe-visibility");return g(),S(j,null,[Ce((g(),S("div",null,[I("div",qn,[s.auth.can("page:save")?(g(),S("div",Kn,[u(Qe,{modelValue:e.checked,"onUpdate:modelValue":t[0]||(t[0]=c=>e.checked=c),onClick:t[1]||(t[1]=ue(c=>a.toggle(),["stop"]))},null,8,["modelValue"]),u(Ee,{location:"bottom right"},{activator:o(({props:c})=>[u(C,we({"append-icon":"mdi-menu-down",variant:"text"},c),{default:o(()=>[w(y(e.$gettext("Actions")),1)]),_:2},1040)]),default:o(()=>[u(xe,null,{default:o(()=>[a.isChecked?(g(),v(E,{key:0},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[2]||(t[2]=c=>a.purge())},{default:o(()=>[w(y(e.$gettext("Delete")),1)]),_:1})]),_:1})):k("",!0),a.isChecked?(g(),v(E,{key:1},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:t[3]||(t[3]=c=>a.copy())},{default:o(()=>[w(y(e.$gettext("Copy")),1)]),_:1})]),_:1})):k("",!0),a.isChecked?(g(),v(E,{key:2},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:t[4]||(t[4]=c=>a.cut())},{default:o(()=>[w(y(e.$gettext("Cut")),1)]),_:1})]),_:1})):k("",!0),s.clipboard.get("page-content")?(g(),v(E,{key:3},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[5]||(t[5]=c=>a.paste())},{default:o(()=>[w(y(e.$gettext("Paste")),1)]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})])):k("",!0),u(de,{"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:e.$gettext("Search for"),class:"search",clearable:"","hide-details":"",onInput:t[6]||(t[6]=c=>a.search(c.target.value)),"onClick:clear":t[7]||(t[7]=c=>a.search(""))},null,8,["label"])]),u(wt,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[10]||(t[10]=c=>e.panel=c),elevation:"0",multiple:""},{default:o(()=>[u(r,{"onUpdate:modelValue":t[9]||(t[9]=c=>e.$emit("update:content",c)),disabled:!s.auth.can("page:save"),modelValue:n.content,draggable:".content",group:"content"},{default:o(()=>[(g(!0),S(j,null,ee(n.content,(c,m)=>Ce((g(),v($t,{key:m,class:q(["content",{changed:c._changed,error:c._error}])},{default:o(()=>[u(Dt,{"expand-icon":"mdi-pencil"},{default:o(()=>{var f;return[s.auth.can("page:save")?(g(),v(Qe,{key:0,modelValue:c._checked,"onUpdate:modelValue":p=>c._checked=p,onClick:t[8]||(t[8]=ue(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])):k("",!0),s.auth.can("page:save")?(g(),v(Ee,{key:1},{activator:o(({props:p})=>[u(C,we({icon:"mdi-dots-vertical",variant:"text"},{ref_for:!0},p),null,16)]),default:o(()=>[u(xe,null,{default:o(()=>[!c._error&&s.auth.can("page:save")?(g(),v(E,{key:0},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:p=>a.copy(m)},{default:o(()=>[w(y(e.$gettext("Copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),!c._error&&s.auth.can("page:save")?(g(),v(E,{key:1},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:p=>a.cut(m)},{default:o(()=>[w(y(e.$gettext("Cut")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),s.auth.can("page:save")?(g(),v(E,{key:2},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete",variant:"text",onClick:p=>a.remove(m)},{default:o(()=>[w(y(e.$gettext("Delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),u(be),s.clipboard.get("page-content")&&s.auth.can("page:save")?(g(),v(E,{key:3},{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:p=>a.paste(m)},{default:o(()=>[w(y(e.$gettext("Paste before")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),s.clipboard.get("page-content")&&s.auth.can("page:save")?(g(),v(E,{key:4},{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:p=>a.paste(m+1)},{default:o(()=>[w(y(e.$gettext("Paste after")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),s.auth.can("page:save")?(g(),v(E,{key:5},{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:p=>a.insert(m)},{default:o(()=>[w(y(e.$gettext("Insert before")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),s.auth.can("page:save")?(g(),v(E,{key:6},{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:p=>a.insert(m+1)},{default:o(()=>[w(y(e.$gettext("Insert after")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),u(be),!c._error&&c.type!=="reference"&&s.auth.can("element:add")?(g(),v(E,{key:7},{default:o(()=>[u(C,{"prepend-icon":"mdi-link",variant:"text",onClick:p=>a.share(m)},{default:o(()=>[w(y(e.$gettext("Make shared")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),!c._error&&c.type==="reference"&&s.auth.can("page:save")?(g(),v(E,{key:8},{default:o(()=>[u(C,{"prepend-icon":"mdi-link-off",variant:"text",onClick:p=>a.unshare(m)},{default:o(()=>[w(y(e.$gettext("Merge copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024)):k("",!0),c.type==="reference"?(g(),v(Se,{key:2,class:"icon-shared",icon:"mdi-link",title:e.$gettext("Shared element")},null,8,["title"])):k("",!0),I("div",Mn,y(c.type==="reference"?(f=n.elements[c.refid])==null?void 0:f.name:a.title(c)),1),I("div",Rn,y(e.$gettext(c.type)),1)]}),_:2},1024),u(_t,null,{default:o(()=>{var f,p;return[c.type==="reference"?(g(),v(i,{key:0,data:((f=n.elements[c.refid])==null?void 0:f.data)||{},fields:a.fields((p=n.elements[c.refid])==null?void 0:p.type),assets:n.assets,readonly:!0},null,8,["data","fields","assets"])):(g(),v(i,{key:1,ref_for:!0,ref:"field",data:c.data,"onUpdate:data":b=>c.data=b,files:c.files,"onUpdate:files":b=>c.files=b,readonly:!s.auth.can("page:save"),fields:a.fields(c.type),assets:n.assets,onError:b=>a.error(c,b),onChange:b=>a.update(c)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","onError","onChange"]))]}),_:2},1024)]),_:2},1032,["class"])),[[it,a.shown(c)]])),128))]),_:1},8,["disabled","modelValue"])]),_:1},8,["modelValue"]),s.auth.can("page:save")?(g(),S("div",zn,[u(C,{onClick:t[11]||(t[11]=c=>e.vschemas=!0),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"})])):k("",!0)])),[[d,a.store]]),(g(),v(Pe,{to:"body"},[u(h,{modelValue:e.vschemas,"onUpdate:modelValue":t[12]||(t[12]=c=>e.vschemas=c),onAdd:t[13]||(t[13]=c=>a.add(c,e.index))},null,8,["modelValue"])]))],64)}const Wn=G(Hn,[["render",Jn],["__scopeId","data-v-fbdf7cab"]]),Xn={components:{PageDetailContentList:Wn},props:{item:{type:Object,required:!0},assets:{type:Object,required:!0},elements:{type:Object,required:!0}},emits:["change","error"],data:()=>({changed:{},errors:{},tab:"default"}),setup(){return{config:Bt()}},computed:{names(){const e=this.item.type||"page",t=this.item.theme||"cms";return this.config.get(`themes.${t}.types.${e}.sections`,["main"])},sections(){if(this.names.length<=1)return{};const e={};for(const t of this.names)e[t]=[];for(const t of this.item.content||[]){const n=t.group||"main";e[n]||(e[n]=[]),e[n].push(t)}return e}},methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){var e;this.changed={},this.errors={},Array.isArray(this.$refs.content)?this.$refs.content.forEach(t=>t.reset()):(e=this.$refs.content)==null||e.reset()},update(e,t){const n=this.sections;n[e]=t,this.item.content=Object.values(n).reduce((s,l)=>s.concat(l),[]),this.changed[e]=!0},validate(){const t=(Array.isArray(this.$refs.content)?this.$refs.content:[this.$refs.content]).map(n=>n==null?void 0:n.validate());return Promise.all(t).then(n=>n.every(s=>s))}}},Yn={key:0};function Gn(e,t,n,s,l,a){const i=T("PageDetailContentList");return g(),v(Ie,null,{default:o(()=>[u(Te,{class:"box"},{default:o(()=>[Object.keys(a.sections).length>1?(g(),S("div",Yn,[u(lt,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=r=>e.tab=r),"align-tabs":"center"},{default:o(()=>[(g(!0),S(j,null,ee(a.sections,(r,h)=>(g(),v(ce,{key:h,class:q({changed:e.changed[h],error:e.errors[h]}),value:h},{default:o(()=>[w(y(e.$gettext(h)),1)]),_:2},1032,["class","value"]))),128))]),_:1},8,["modelValue"]),u(St,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.tab=r)},{default:o(()=>[(g(!0),S(j,null,ee(a.sections,(r,h)=>(g(),v(ye,{key:h,value:h},{default:o(()=>[u(i,{ref_for:!0,ref:"content",section:h,item:n.item,assets:n.assets,content:r,elements:n.elements,onError:d=>a.error(h,d),"onUpdate:content":d=>{a.update(h,d),this.$emit("change","content")}},null,8,["section","item","assets","content","elements","onError","onUpdate:content"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])):(g(),v(i,{key:1,ref:"content",item:n.item,assets:n.assets,content:n.item.content||[],elements:n.elements,onError:t[2]||(t[2]=r=>e.$emit("error",r)),"onUpdate:content":t[3]||(t[3]=r=>{n.item.content=r,this.$emit("change","content")})},null,8,["item","assets","content","elements"]))]),_:1})]),_:1})}const Zn=G(Xn,[["render",Gn],["__scopeId","data-v-c7d0cda4"]]),Qn={components:{Fields:ot},props:{modelValue:{type:Boolean,required:!0},readonly:{type:Boolean,default:!1},element:{type:Object,required:!0},assets:{type:Object,default:()=>({})},type:{type:String,default:"content"}},emits:["update:modelValue","update:element"],setup(){return{schemas:qe()}},data(){return{error:!1}},methods:{fields(e){var t,n;return!this.schemas[this.type]||!((t=this.schemas[this.type][e])!=null&&t.fields)?(console.warn(`No definition of fields for "${e}" (${this.type}) schemas`),[]):(n=this.schemas.content[e])==null?void 0:n.fields}}};function ea(e,t,n,s,l,a){const i=T("Fields");return g(),v(rt,{modelValue:n.modelValue,"max-width":"1200",scrollable:""},{default:o(()=>[u(Ht,null,{append:o(()=>[!n.readonly&&!l.error?(g(),v(C,{key:0,variant:"outlined",onClick:t[0]||(t[0]=r=>e.$emit("update:element",n.element))},{default:o(()=>t[5]||(t[5]=[w("Save")])),_:1,__:[5]})):k("",!0),u(C,{variant:"flat",icon:"mdi-close",onClick:t[1]||(t[1]=r=>e.$emit("update:modelValue",!1))})]),title:o(()=>[w(y(e.$gettext("Content Element")),1)]),default:o(()=>[u(be),u(qt,null,{default:o(()=>[u(i,{data:n.element.data,"onUpdate:data":t[2]||(t[2]=r=>n.element.data=r),files:n.element.files,"onUpdate:files":t[3]||(t[3]=r=>n.element.files=r),readonly:n.readonly,fields:a.fields(n.element.type),assets:n.assets,onError:t[4]||(t[4]=r=>l.error=n.element._error=r)},null,8,["data","files","readonly","fields","assets"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ta=G(Qn,[["render",ea]]),na={components:{FieldsDialog:ta,SchemaDialog:zt},props:{save:{type:Object,required:!0},item:{type:Object,required:!0},elements:{type:Object,required:!0},assets:{type:Object,default:()=>({})}},emits:["change"],setup(){const e=Ve(),t=he();return{app:Pt(),auth:t,messages:e}},data(){return{pos:null,index:null,element:null,section:"main",expanded:!1,vschemas:!1,vpreview:!1,vedit:!1}},mounted(){var e;window.addEventListener("message",this.message),(e=this.$refs.iframe)==null||e.addEventListener("load",()=>{var t,n;(n=(t=this.$refs.iframe)==null?void 0:t.contentWindow)==null||n.postMessage("init","*")}),this.messages.add(this.$gettext("Double-click to edit"),"info")},beforeUnmount(){window.removeEventListener("message",this.message)},computed:{url(){return this.app.urlpage.replace(/:domain/,this.item.domain||"").replace(/:path/,this.item.path||"").replace(/\/+$/,"")}},methods:{add(e){const t=this.section||"main";this.vschemas=!1,e.id?(this.elements[e.id]=e,this.element={id:Oe(),group:t,type:"reference",refid:e.id},this.update()):(this.element={id:Oe(),group:t,type:e.type,data:{}},this.vedit=!0)},edit(){this.element=this.item.content[this.index]||null,this.vedit=!!this.element},fullscreen(){const e=this.$refs.preview;this.expanded?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e!=null&&e.requestFullscreen?e.requestFullscreen():e!=null&&e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this.expanded=!this.expanded},message(e){switch(e.data){case null:this.index=null;break;case!1:this.vpreview=!0,setTimeout(()=>{this.vpreview=!1},3e3);break;default:this.index=e.data.id?this.item.content.findIndex(t=>t.id===e.data.id):null,this.section=e.section||"main"}},remove(){this.index!==null&&(this.item.content.splice(this.index,1),this.$emit("change","content"),this.index=null,this.save.fcn(!0).then(()=>{this.$refs.iframe.contentWindow.postMessage("reload",this.url)}))},update(){this.pos!==null&&this.item.content.splice(this.index+this.pos,0,this.element),this.vedit=!1,this.index=null,this.pos=null,this.$emit("change","content"),this.save.fcn(!0).then(()=>{this.$refs.iframe.contentWindow.postMessage("reload",this.url)})}},watch:{"save.count":function(){this.save.count>0&&this.$refs.iframe.contentWindow.postMessage("reload",this.url)}}},aa={class:"page-preview",ref:"preview"},sa={key:0,class:"actions"},ia={key:1,class:"preview-mode"},ra=["src"];function la(e,t,n,s,l,a){const i=T("FieldsDialog"),r=T("SchemaDialog");return g(),S(j,null,[I("div",aa,[l.index!==null?(g(),S("div",sa,[l.index!==-1?(g(),v(C,{key:0,icon:"mdi-pencil",variant:"text",onClick:t[0]||(t[0]=h=>a.edit())})):k("",!0),l.index!==-1?(g(),v(C,{key:1,icon:"mdi-table-row-plus-before",variant:"text",onClick:t[1]||(t[1]=h=>{l.vschemas=!0,l.pos=0})})):k("",!0),u(C,{icon:"mdi-table-row-plus-after",variant:"text",onClick:t[2]||(t[2]=h=>{l.vschemas=!0,l.pos=1})}),l.index!==-1?(g(),v(C,{key:2,icon:"mdi-trash-can-outline",variant:"text",onClick:t[3]||(t[3]=h=>a.remove())})):k("",!0)])):k("",!0),l.vpreview?(g(),S("div",ia,y(e.$gettext("Preview mode")),1)):k("",!0),I("iframe",{ref:"iframe",src:a.url},null,8,ra),l.expanded?k("",!0):(g(),v(C,{key:2,class:"fullscreen",icon:"mdi-fullscreen",variant:"text",onClick:t[4]||(t[4]=h=>a.fullscreen())})),l.expanded?(g(),v(C,{key:3,class:"fullscreen",icon:"mdi-fullscreen-exit",variant:"text",onClick:t[5]||(t[5]=h=>a.fullscreen())})):k("",!0)],512),(g(),v(Pe,{to:"body"},[l.element?(g(),v(i,{key:0,modelValue:l.vedit,"onUpdate:modelValue":t[6]||(t[6]=h=>l.vedit=h),element:l.element.type==="reference"?n.elements[l.element.refid]:l.element,readonly:!s.auth.can("page:save")||!!l.element.refid,"onUpdate:element":t[7]||(t[7]=h=>a.update())},null,8,["modelValue","element","readonly"])):k("",!0)])),(g(),v(Pe,{to:"body"},[u(r,{modelValue:l.vschemas,"onUpdate:modelValue":t[8]||(t[8]=h=>l.vschemas=h),onAdd:t[9]||(t[9]=h=>a.add(h))},null,8,["modelValue"])]))],64)}const oa=G(na,[["render",la]]),da={components:{AsideMeta:fn,AsideCount:kn,HistoryDialog:hn,PageDetailItem:An,PageDetailContent:Zn,PageDetailPreview:oa},inject:["closeView","compose","translate","txlocales"],props:{item:{type:Object,required:!0}},provide(){return{compose:this.composeText,translate:this.translateText}},setup(){const e=xt(),t=Ve(),n=qe(),s=kt();return{auth:he(),drawer:s,languages:e,messages:t,schemas:n}},data:()=>({tab:"editor",aside:"",asidePage:"meta",changed:{},errors:{},assets:{},elements:{},latest:null,pubmenu:null,publishAt:null,translating:!1,vhistory:!1,savecnt:0}),computed:{hasChanged(){return Object.values(this.changed).some(e=>e)},hasError(){return Object.values(this.errors).some(e=>e)},langs(){const e=[],t=["ar","bg","cs","da","de","el","en","en-GB","en_US","es","et","fi","fr","he","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt","pt-BR","ro","ru","sk","sl","sv","th","tr","uk","vi","zh","zh-HANS","zh-HANT"];return Object.entries(this.languages.available).forEach(n=>{t.includes(n[0])&&n[0]!==this.item.lang&&e.push({code:n[0],name:n[1]})}),e}},created(){var e;this.$options._compose=this.compose,!(!((e=this.item)!=null&&e.id)||!this.auth.can("page:view"))&&this.$apollo.query({query:B`query($id: ID!) {
          page(id: $id) {
            id
            lang
            path
            domain
            name
            title
            to
            tag
            type
            theme
            status
            cache
            meta
            config
            content
            editor
            updated_at
            deleted_at
            files {
              id
              lang
              mime
              name
              path
              previews
              description
              updated_at
              editor
            }
            elements {
              id
              type
              data
              editor
              updated_at
              files {
                id
                lang
                mime
                name
                path
                previews
                description
                updated_at
                editor
              }
            }
            latest {
              id
              published
              data
              aux
              editor
              created_at
              files {
                id
                lang
                mime
                name
                path
                previews
                description
                updated_at
                editor
              }
              elements {
                id
                type
                data
                name
                editor
                updated_at
                files {
                  id
                  lang
                  mime
                  name
                  path
                  previews
                  description
                  updated_at
                  editor
                }
              }
            }
          }
        }`,variables:{id:this.item.id}}).then(t=>{var s,l,a;if(t.errors||!t.data.page)throw t;const n=t.data.page;if(this.reset(),this.assets={},this.elements={},this.latest=n.latest,(s=this.latest)!=null&&s.aux){const i=JSON.parse(this.latest.aux);this.item.content=i.content??[],this.item.config=i.config??{},this.item.meta=i.meta??{}}else this.item.content=JSON.parse(n.content??"{}"),this.item.config=JSON.parse(n.config??"{}"),this.item.meta=JSON.parse(n.meta??"{}");for(const i of((l=this.latest)==null?void 0:l.elements)||n.elements||[])this.elements[i.id]={...i,data:JSON.parse(i.data||"{}"),files:(i.files||[]).map(r=>({...r,previews:JSON.parse(r.previews||"{}"),description:JSON.parse(r.description||"{}")}))};for(const i of((a=this.latest)==null?void 0:a.files)||n.files||[])this.assets[i.id]={...i,previews:JSON.parse(i.previews||"{}"),description:JSON.parse(i.description||"{}")};for(const i of this.item.content)i.files&&Array.isArray(i.files)&&(i.files=i.files.filter(r=>typeof this.assets[r]<"u"))}).catch(t=>{this.messages.add(this.$gettext("Error fetching page"),"error"),this.$log("PageDetail::watch(item): Error fetching page",t)})},methods:{clean(e){if(e){e=JSON.parse(JSON.stringify(e));for(const t in e)for(const n in e[t])n.startsWith("_")&&delete e[t][n]}return e},composeText(e,t=[],n=[]){return this.$options._compose?(Array.isArray(t)||(t=[t]),t.push("page content as JSON: "+JSON.stringify(this.item.content)),t.push("required output language: "+(this.item.lang||"en")),this.$options._compose(e,t,n)):Promise.reject(new Error("Compose method is not available in PageDetail component"))},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"Page:"+this.item.id}),e.gc()},publish(e=null){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var n,s;t&&this.$apollo.mutate({mutation:B`mutation ($id: [ID!]!, $at: DateTime) {
              pubPage(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(s=(n=e==null?void 0:e.toISOString())==null?void 0:n.substring(0,19))==null?void 0:s.replace("T"," ")}}).then(l=>{if(l.errors)throw l.errors;e?(this.item.publish_at=e,this.messages.add(this.$gettext("Page scheduled for publishing at %{date}",{date:e.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("Page published successfully"),"success")),this.closeView()}).catch(l=>{this.messages.add(this.$gettext("Error publishing page"),"error"),this.$log("PageDetail::publish(): Error publishing page",e,l)})})},reset(){var e,t;(e=this.$refs.page)==null||e.reset(),(t=this.$refs.content)==null||t.reset(),this.changed={},this.errors={}},save(e=!1){return this.auth.can("page:save")?this.hasChanged?this.validate().then(t=>{if(!t)return this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),t;const n=[];for(const a of this.item.content||[])n.push(...a.files||[]);const s={};for(const a in this.item.meta||{})s[a]={type:this.item.meta[a].type||"",data:this.item.meta[a].data||{},files:this.item.meta[a].files||[]},n.push(...this.item.meta[a].files||[]);const l={};for(const a in this.item.config||{})l[a]={type:this.item.config[a].type||"",data:this.item.config[a].data||{},files:this.item.config[a].files||[]},n.push(...this.item.config[a].files||[]);return this.$apollo.mutate({mutation:B`mutation ($id: ID!, $input: PageInput!, $elements: [ID!], $files: [ID!]) {
              savePage(id: $id, input: $input, elements: $elements, files: $files) {
                id
              }
            }`,variables:{id:this.item.id,input:{cache:this.item.cache||0,domain:this.item.domain||"",lang:this.item.lang||"",name:this.item.name||"",path:this.item.path||"",status:this.item.status||0,title:this.item.title||"",tag:this.item.tag||"",to:this.item.to||"",type:this.item.type||"",theme:this.item.theme||"",meta:JSON.stringify(this.clean(s)),config:JSON.stringify(this.clean(l)),content:JSON.stringify(this.clean(this.item.content))},elements:Object.keys(this.elements),files:n.filter((a,i,r)=>r.indexOf(a)===i)}}).then(a=>{if(a.errors)throw a.errors;return this.item.published=!1,this.$refs.history.reset(),this.reset(),e||this.messages.add(this.$gettext("Page saved successfully"),"success"),this.invalidate(),this.savecnt++,!0}).catch(a=>{this.messages.add(this.$gettext("Error saving page"),"error"),this.$log("PageDetail::save(): Error saving page",a)})}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},translatePage(e){var s,l,a;if(!this.schemas.content){this.messages.add(this.$gettext('No page schema for "content" found'),"error");return}const t=["text","markdown","plaintext","string"],n=[{item:this.item,key:"title",text:this.item.title},{item:this.item,key:"name",text:this.item.name},{item:this.item,key:"path",text:this.item.path}];for(const i of Object.values(this.item.meta))for(const r in i.data){const h=(a=(l=(s=this.schemas.meta[i.type])==null?void 0:s.fields)==null?void 0:l[r])==null?void 0:a.type;i.data[r]&&t.includes(h)&&n.push({item:i.data,key:r,text:i.data[r]})}this.item.content.forEach(i=>{var r,h,d,c,m;for(const f in i.data){const p=(r=this.schemas.content[i.type])==null?void 0:r.fields,b=(h=p==null?void 0:p[f])==null?void 0:h.type;if(b==="items")for(const _ in i.data[f]){const V=i.data[f][_];for(const N in V)t.includes((m=(c=(d=p[f])==null?void 0:d.item)==null?void 0:c[N])==null?void 0:m.type)&&n.push({item:V,key:N,text:V[N]})}else i.type!=="code"&&i.data[f]&&t.includes(b)&&n.push({item:i.data,key:f,text:i.data[f]})}}),this.translating=!0,this.translate(n.map(i=>i.text),e,this.item.lang).then(i=>{i.forEach((r,h)=>{n[h]&&(n[h].item[n[h].key]=r)}),this.changed.content=!0,this.changed.page=!0,this.item.lang=e}).finally(()=>{this.translating=!1})},translateText(e,t,n=null){return this.translate(e,t,n||this.item.lang)},update(e,t){e==="page"?Object.assign(this.item,t):this[e]=t,this.changed[e]=!0},use(e){Object.assign(this.item,e.data),this.changed.content=!0,this.changed.page=!0,this.vhistory=!1},validate(){var e,t;return Promise.all([(e=this.$refs.page)==null?void 0:e.validate(),(t=this.$refs.content)==null?void 0:t.validate()].filter(n=>n)).then(n=>n.every(s=>s))},versions(e){return this.auth.can("page:view")?e?this.$apollo.query({query:B`query($id: ID!) {
            page(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                aux
                editor
                created_at
              }
            }
          }`,variables:{id:e}}).then(t=>{if(t.errors||!t.data.page)throw t;return(t.data.page.versions||[]).map(n=>{const s={...n,data:Object.assign(JSON.parse(n.data||"{}"),JSON.parse(n.aux||"{}"))};return delete s.aux,s}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching page versions"),"error"),this.$log("PageDetail::versions(): Error fetching page versions",e,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}},watch:{asidePage(e){this.aside=e}}},ua={class:"app-title"},ca={class:"menu-content"};function ha(e,t,n,s,l,a){const i=T("PageDetailPreview"),r=T("PageDetailContent"),h=T("PageDetailItem"),d=T("AsideMeta"),c=T("AsideCount"),m=T("HistoryDialog");return g(),S(j,null,[u(Kt,{elevation:0,density:"compact"},{prepend:o(()=>[u(C,{icon:"mdi-keyboard-backspace",onClick:t[0]||(t[0]=f=>a.closeView()),elevation:"0"})]),append:o(()=>[u(Ee,null,{activator:o(({props:f})=>[u(C,we({loading:e.translating,icon:"mdi-translate",elevation:"0"},f),null,16,["loading"])]),default:o(()=>[u(xe,null,{default:o(()=>[(g(!0),S(j,null,ee(a.txlocales(n.item.lang),f=>(g(),v(E,{key:f.code},{default:o(()=>[u(C,{variant:"text",onClick:p=>a.translatePage(f.code),"prepend-icon":"mdi-arrow-right-thin"},{default:o(()=>[w(y(f.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}),u(C,{icon:"mdi-history",class:q(["no-rtl",{hidden:n.item.published&&!a.hasChanged&&!e.latest}]),onClick:t[1]||(t[1]=f=>e.vhistory=!0),elevation:"0"},null,8,["class"]),u(C,{class:q([{error:a.hasError},"menu-save"]),disabled:!a.hasChanged||a.hasError||!s.auth.can("page:save"),onClick:t[2]||(t[2]=f=>a.save()),variant:"text"},{default:o(()=>[w(y(e.$gettext("Save")),1)]),_:1},8,["class","disabled"]),u(Ee,{modelValue:e.pubmenu,"onUpdate:modelValue":t[6]||(t[6]=f=>e.pubmenu=f),"close-on-content-click":!1},{activator:o(({props:f})=>[u(dn,{class:"menu-publish",variant:"text"},{default:o(()=>[u(C,{class:q([{error:a.hasError},"button"]),disabled:n.item.published&&!a.hasChanged||a.hasError||!s.auth.can("page:publish"),onClick:t[3]||(t[3]=p=>a.publish())},{default:o(()=>[w(y(e.$gettext("Publish")),1)]),_:1},8,["class","disabled"]),u(C,we({class:[{error:a.hasError},"icon"],icon:"mdi-menu-down",disabled:n.item.published&&!a.hasChanged||a.hasError||!s.auth.can("page:publish")},f),null,16,["class","disabled"])]),_:2},1024)]),default:o(()=>[I("div",ca,[u(on,{modelValue:e.publishAt,"onUpdate:modelValue":t[4]||(t[4]=f=>e.publishAt=f),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),u(C,{disabled:!e.publishAt||a.hasError,color:e.publishAt?"primary":"",onClick:t[5]||(t[5]=f=>{a.publish(e.publishAt),e.pubmenu=!1}),variant:"flat"},{default:o(()=>[w(y(e.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),u(C,{onClick:t[7]||(t[7]=ue(f=>s.drawer.toggle("aside"),["stop"]))},{default:o(()=>[u(Se,{size:"x-large"},{default:o(()=>[w(y(s.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"),1)]),_:1})]),_:1})]),default:o(()=>[u(Rt,null,{default:o(()=>[I("div",ua,y(e.$gettext("Page"))+": "+y(n.item.name),1)]),_:1})]),_:1}),u(Mt,{class:"page-details"},{default:o(()=>[u(un,{onSubmit:t[19]||(t[19]=ue(()=>{},["prevent"]))},{default:o(()=>[u(lt,{"fixed-tabs":"",modelValue:e.tab,"onUpdate:modelValue":t[11]||(t[11]=f=>e.tab=f)},{default:o(()=>[u(ce,{value:"editor",onClick:t[8]||(t[8]=f=>e.aside="")},{default:o(()=>[w(y(e.$gettext("Editor")),1)]),_:1}),u(ce,{value:"content",class:q({changed:e.changed.content,error:e.errors.content}),onClick:t[9]||(t[9]=f=>e.aside="count")},{default:o(()=>[w(y(e.$gettext("Content")),1)]),_:1},8,["class"]),u(ce,{value:"page",class:q({changed:e.changed.page,error:e.errors.page}),onClick:t[10]||(t[10]=f=>e.aside=e.asidePage)},{default:o(()=>[w(y(e.$gettext("Page")),1)]),_:1},8,["class"])]),_:1},8,["modelValue"]),u(St,{modelValue:e.tab,"onUpdate:modelValue":t[18]||(t[18]=f=>e.tab=f)},{default:o(()=>[u(ye,{value:"editor"},{default:o(()=>[u(i,{save:{fcn:a.save,count:e.savecnt},item:n.item,assets:e.assets,elements:e.elements,onChange:t[12]||(t[12]=f=>e.changed.content=!0)},null,8,["save","item","assets","elements"])]),_:1}),u(ye,{value:"content"},{default:o(()=>[u(r,{ref:"content",item:n.item,assets:e.assets,elements:e.elements,onError:t[13]||(t[13]=f=>e.errors.content=f),onChange:t[14]||(t[14]=f=>e.changed.content=!0)},null,8,["item","assets","elements"])]),_:1}),u(ye,{value:"page"},{default:o(()=>[u(h,{ref:"page",item:n.item,assets:e.assets,"onUpdate:item":t[15]||(t[15]=f=>{Object.assign(n.item,f),e.changed.page=!0}),"onUpdate:aside":t[16]||(t[16]=f=>e.asidePage=f),onError:t[17]||(t[17]=f=>e.errors.page=f)},null,8,["item","assets"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e.aside==="meta"?(g(),v(d,{key:0,item:n.item},null,8,["item"])):k("",!0),e.aside==="count"?(g(),v(c,{key:1})):k("",!0),(g(),v(Pe,{to:"body"},[u(m,{ref:"history",modelValue:e.vhistory,"onUpdate:modelValue":t[20]||(t[20]=f=>e.vhistory=f),current:{data:{cache:n.item.cache,domain:n.item.domain,lang:n.item.lang,name:n.item.name,path:n.item.path,status:n.item.status,title:n.item.title,tag:n.item.tag,to:n.item.to,type:n.item.type,theme:n.item.theme,meta:a.clean(n.item.meta),config:a.clean(n.item.config),content:a.clean(n.item.content)}},load:()=>a.versions(n.item.id),onUse:t[21]||(t[21]=f=>a.use(f)),onRevert:t[22]||(t[22]=f=>{a.use(f),a.reset()})},null,8,["modelValue","current","load"])]))],64)}const Ot=G(da,[["render",ha],["__scopeId","data-v-0e62e227"]]);var fa=!1,ma=!0;/*!
 * helper-js v3.1.6
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function et(e){return Object.prototype.toString.call(e)==="[object Array]"}function Vt(e){return Object.prototype.toString.call(e)==="[object Object]"}function ga(e){return typeof e=="function"}function pa(e,t){return e<t?e:t}function Jt(e,t){let n,s=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),s++;return s}function Wt(e){return e[e.length-1]}function va(e){return et(e)?e:[e]}function ya(e,t){let n=new Set(t);const s={};return n.forEach(l=>{s[l]=e[l]}),s}function ba(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const s={value:e[n],index:n};(!t.exclude||!t.exclude(s))&&(yield s)}else if(Vt(e)){const n=Object.keys(e);n.reverse();for(const s of n){const l={value:e[s],key:s};(!t.exclude||!t.exclude(l))&&(yield l)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const s={value:e[n],index:n};(!t.exclude||!t.exclude(s))&&(yield s)}else if(Vt(e))for(const n of Object.keys(e)){const s={value:e[n],key:n};(!t.exclude||!t.exclude(s))&&(yield s)}else throw"Unsupported type"}()}function ka(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function Xt(e,t){return Object.keys(t).forEach(n=>{ka(e,n,t[n])}),e}function Ca(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function ne(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=Xt({...n},{childrenKey:"children"});const{childrenKey:s}=n,l=et(e)?e:[e];class a{}const i=(r,h,d)=>{n.reverse&&(r=r.slice(),r.reverse());const c=r.length;for(let m=0;m<c;m++){const f=r[m],p=n.reverse?c-m-1:m,b=d?[...d,p]:[];n.childFirst&&f[s]!=null&&i(f[s],f,b);const _=t(f,p,h,b);if(_===!1)throw new a;if(_==="skip children")continue;if(_==="skip siblings")break;n.childFirst||f[s]!=null&&i(f[s],f,b)}};try{i(l,null,et(e)?[]:null)}catch(r){if(!(r instanceof a))throw r}}function wa(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s;return ne(e,function(){if(t(...arguments))return s={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),s}function $a(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=wa(e,t,n);return s==null?void 0:s.node}function Yt(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:s,nodeHandler:l}=n,a=new yt;return a.childrenKey=s,ne(e,(i,r,h,d)=>{let c=Object.assign({},i);c[s]&&(c[s]=[]),l&&(c=l(c,{oldNode:i,index:r,parent:h,path:d})),a.set(d,c)},{childrenKey:s}),a.data}class yt{constructor(){_e(this,"data");_e(this,"childrenKey","children");let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return et(n)?n:n[t]}iteratePath(t){var n=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{childrenKey:l,rootChildren:a}=n;if(s.reverse){const i=[...n.iteratePath(t,{...s,reverse:!1})];i.reverse();for(const{path:r,node:h}of i)yield{path:r,node:h}}else{let i=[],r=a;for(const h of t){const d=[...i,h],c=r[h];yield{path:d,node:c},i=d,r=c[l]}}}()}getFamily(t){const n=[];for(const{node:s}of this.iteratePath(t))n.push(s);return n}get(t){return Wt(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),s=n.pop();return{parent:this.get(n),index:s,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:s}=this;let{rootChildren:l}=this;const{parent:a,index:i}=this.getParentAndIndex(t);let r;t.length===1?(l||(this.data?this.data[s]=[]:this.data=[]),r=l):(a[s]||(a[s]=[]),r=a[s]),r[i]=n}}delete(t){const{childrenKey:n,rootChildren:s}=this,{parent:l,index:a}=this.getParentAndIndex(t),i=t.length===1?s:l[n],r=i[a];return i.splice(a,1),r}walk(t,n){const{childrenKey:s,data:l}=this;return ne(l,t,s,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Yt(this.data),Ca({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function It(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ga(e)?e(...t):e}function Da(e,t){return function(){let s,l;try{s=e(...arguments)}catch(a){l=a}finally{}if(l)throw l;return s}}function Ue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let s;const l={};let a=l;return{action:function(){for(var h=arguments.length,d=new Array(h),c=0;c<h;c++)d[c]=arguments[c];if(d.length===0)return a===l&&(a=e()),a;if(s||(s=new Sa),!s.has(d)&&(s.set(d,e(...d)),t.capacity!=null)){n.push(d);const m=n.splice(0,n.length-t.capacity);for(const f of m)s.delete(f)}return s.get(d)},clearCache:()=>{s=null,n.splice(0,n.length)}}}function _a(){let e,t;return{promise:new Promise((s,l)=>{e=s,t=l}),resolve:e,reject:t}}function xa(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function ct(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,s=t.bottom,l=t.left-document.documentElement.clientLeft,a=t.right,i=t.width||a-l,r=t.height||s-n,c={top:n,right:a,bottom:s,left:l,width:i,height:r,x:l,y:n};t={...c,toJSON:()=>c}}return t}function Tt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n&&n.withSelf?e:e.parentElement;for(;s;){const l=n.until&&s===n.until;if(l&&!n.withUntil)return;const a=t(s);if(a==="break")return;if(a)return s;if(l)return;s=s.parentElement}}function tt(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function Lt(e,t){for(const n of t)if(tt(e,n))return!0;return!1}function ae(e,t,n,s){e.addEventListener?e.addEventListener(t,n,s):e.attachEvent&&e.attachEvent(`on${t}`,n,s)}function se(e,t,n,s){e.removeEventListener?e.removeEventListener(t,n,s):e.detachEvent&&e.detachEvent(`on${t}`,n,s)}function Pa(e){let t=[];const n=()=>{if(!l.listening){for(const a of e){ae.apply(this,a);const i=()=>se.apply(this,a);t.push(i)}l.listening=!0}},l={listening:!1,stop:()=>{if(l.listening){for(const a of t)a();t=[],l.listening=!1}},resume:n,start:n};return l.start(),l}function nt(e,t){return getComputedStyle(e)[t]}function bt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:s,end:l}=n;const{returnNearestIfNoHit:a,maxTimes:i}=n;let r,h;s==null&&(s=0,l=e.length-1);let d=0,c;for(;s>=0&&s<=l;){if(d>=i)throw Error(`binarySearch: loop times is over ${i}, you can increase the limit.`);r=Math.floor((l-s)/2+s),h=e[r];const m=d+1;if(c=t(h,r,m),c>0)l=r-1;else if(c<0)s=r+1;else return{index:r,value:h,count:m,hit:!0};d++}return a?{index:r,value:h,count:d+1,hit:!1,greater:c>0}:null}class Sa{constructor(){_e(this,"_map",new Map);_e(this,"_values",{});_e(this,"_objCount",0)}_keysToString(t){const{_map:n}=this;let s=[];for(const l of t){if(!n.has(l))return null;s.push(n.get(l)[0])}return s.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,s=this._keysToString(t);if(s==null)throw"Value not found by specified keys";return n[s][1]}set(t,n){const{_map:s,_values:l}=this;let a=[];for(const i of t){let r,h=1;s.has(i)?([r,h]=s.get(i),h++):(this._objCount++,r=this._objCount.toString()),s.set(i,[r,h]),a.push(r)}l[a.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:s}=this,l=this._keysToString(t);if(l==null)throw"Value not found by specified keys";delete n[l];for(const a of t){let[i,r]=s.get(a);r--,r===0?s.delete(a):s.set(a,[i,r])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[s,l]=t[n];yield[s,l]}}count(){return[...this.entries()].length}}/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const Ea=Ke({props:{table:Boolean}}),Gt=(e,t)=>{const n=e.__vccOpts||e;for(const[s,l]of t)n[s]=l;return n},Oa={key:0},Va={key:1};function Ia(e,t,n,s,l,a){return e.table?(g(),S("table",Oa,[K(e.$slots,"prepend"),I("tbody",null,[K(e.$slots,"default")]),K(e.$slots,"append")])):(g(),S("div",Va,[K(e.$slots,"prepend"),K(e.$slots,"default"),K(e.$slots,"append")]))}const Ta=Gt(Ea,[["render",Ia]]),La=Ke({components:{VirtualListTable:Ta},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=Ne(0),n=Ne(e.firstRender-1),s=Y(()=>{var O;return pa(n.value,(((O=e.items)==null?void 0:O.length)||1)-1)}),l=Ne(0),a=Y(()=>f.value[t.value]?De(t.value):0),i=Y(()=>f.value.length>0?De(f.value.length-1)+Wt(m.value):0),r=Y(()=>f.value[s.value]?i.value-De(s.value)-m.value[s.value]:0),h=Y(()=>e.disabled?{}:{overflow:"auto"}),d=Y(()=>{const O={display:"flex"};return e.disabled||(e.horizontal?Object.assign(O,{"margin-left":a.value+"px","margin-right":r.value+"px",width:i.value-r.value-a.value+"px"}):Object.assign(O,{"margin-top":a.value+"px","margin-bottom":r.value+"px"})),O["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete O.display,delete O["flex-direction"]),O}),c=Y(()=>Be((e.items||[]).map(()=>null))),m=Y(()=>(e.items||[]).map((O,x)=>{var D;if(c[x]!=null)return c[x];let H=(D=e.itemSize)==null?void 0:D.call(e,O,x);return H==null&&(H=l.value),H})),f=Y(()=>{const O=[];return m.value.reduce((x,D)=>(O.push(x),x+D),0),O});vt(()=>e.items,A);const p=Y(()=>{if(!e.items||e.disabled)return;const O=[];for(let x=t.value;x<=s.value;x++){const D=e.items[x];if(!D)break;O.push({item:D,index:x})}return O}),b=Ne(),_=Ne();cn(async()=>{A();try{dt()}catch{await ut(),A()}});let V;function N(){const O=b.value;if(!O)return;const x=oe(O);V!=null&&e.buffer-Math.abs(x-V)>=10||(V=x,A())}let U=!1,Q=!1;async function A(){var O;if(U){Q=!0;return}if(!e.items||e.disabled)return;U=!0;const x=b.value,D=(O=_.value)==null?void 0:O.$el;if(!x||!D)return;l.value||(l.value=Je()),t.value=Re(),n.value=ze(),await ut();let H,Z=0;const z={},fe=e.table?D.querySelector("tbody").children:D.children;for(let L=0;L<fe.length;L++){const F=fe[L],M=nt(F,"position");if(M&&["absolute","fixed"].includes(M))continue;const ie=nt(F,"display")!=="none"?$e(F):0,me=F.getAttribute("vt-index"),We=me?parseInt(me):t.value+Z;z[We]=(z[We]||0)+ie,Z++}for(const L of Object.keys(z)){const F=parseInt(L);c.value[F]!==z[F]&&(c.value[F]=z[F],H=!0)}H&&await ut(),U=!1,Q&&(Q=!1,A());function Re(){const L=oe(x)-R(x)-e.buffer;return bt(f.value,F=>F-L,{returnNearestIfNoHit:!0}).index}function ze(){const L=oe(x)-R(x)+te(x)+e.buffer;return bt(f.value,F=>F-L,{returnNearestIfNoHit:!0}).index}function Je(){const L=[],F=e.table?D.querySelector("tbody").children:D.children;for(let M=0;M<F.length;M++){const ie=F[M],me=getComputedStyle(ie);if(["absolute","fixed"].includes(me.position))continue;const We=$e(ie);if(L.push(We),L.length>=10)break}return L.length===0?0:L.reduce((M,ie)=>M+ie,0)/L.length}}function te(O){const x=getComputedStyle(O);let D=parseFloat(e.horizontal?x.width:x.height);return x.boxSizing==="border-box"&&(e.horizontal?D=D-parseFloat(x.borderLeftWidth)-parseFloat(x.borderRightWidth):D=D-parseFloat(x.borderTopWidth)-parseFloat(x.borderBottomWidth)),D}function $e(O){let x=te(O);const D=getComputedStyle(O);return e.horizontal?x+=parseFloat(D.borderLeftWidth)+parseFloat(D.borderRightWidth)+parseFloat(D.marginLeft)+parseFloat(D.marginRight):x+=parseFloat(D.borderTopWidth)+parseFloat(D.borderBottomWidth)+parseFloat(D.marginTop)+parseFloat(D.marginBottom),x=Number.isNaN(x)?0:x,x}function oe(O){return e.horizontal?O.scrollLeft:O.scrollTop}function R(O){const x=getComputedStyle(O);return e.horizontal?parseFloat(x.paddingLeft):parseFloat(x.paddingTop)}function De(O){return f.value[O]}function dt(){const O=b.value;new ResizeObserver(x=>{for(let D of x)if(tt(D.target,"vtlist")){A();break}}).observe(O)}function Me(O,x){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return x;if(typeof e.itemKey=="function")return e.itemKey(O,x)}}return{listElRef:b,listInnerRef:_,onscroll:N,listStyle:h,listInnerStyle:d,visibleItemsInfo:p,getItemKey:Me,update:A,sizes:m,positions:f,runtimeSizes:c}}});function Na(e,t,n,s,l,a){const i=T("VirtualListTable");return g(),S("div",{class:"vtlist",ref:"listElRef",style:ke(e.listStyle),onScrollPassive:t[0]||(t[0]=(...r)=>e.onscroll&&e.onscroll(...r))},[u(i,{class:"vtlist-inner",ref:"listInnerRef",style:ke(e.listInnerStyle),table:e.table},{prepend:o(()=>[K(e.$slots,"prepend")]),append:o(()=>[K(e.$slots,"append")]),default:o(()=>[e.disabled?(g(!0),S(j,{key:0},ee(e.items,(r,h)=>K(e.$slots,"default",{key:e.getItemKey(r,h),item:r,index:h})),128)):(g(!0),S(j,{key:1},ee(e.visibleItemsInfo,({item:r,index:h})=>K(e.$slots,"default",{key:e.getItemKey(r,h),item:r,index:h})),128))]),_:3},8,["style","table"])],36)}const Ua=Gt(La,[["render",Na]]);/*!
 * @he-tree/tree-utils v0.1.0-alpha.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const ve="children";function Fa(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s={...Aa,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:a,childrenKey:i}=this,r=new yt([]);this._statsMap=new Map,ne(a,(d,c,m,f)=>{const p=this.statHandler({...Nt(),data:d,open:!!this.defaultOpen,parent:r.getParent(f),children:[],level:f.length});this._statsMap.set(d,p),r.set(f,p)},{childrenKey:i});const h=[];r.walk(d=>{h.push(d)}),this.stats=this.statsHandler(r.rootChildren),this.statsFlat=this.statsFlatHandler(h),this.initialized=!0},getStat(a){let i=this._statsMap.get(a);if(!i)throw new Ut("Stat not found");return i},has(a){if(a.isStat)return this.statsFlat.indexOf(a)>-1;try{return!!this.getStat(a)}catch(i){if(i instanceof Ut)return!1;throw i}},_getPathByStat(a){if(a==null)return[];const r=this.getSiblings(a).indexOf(a);return[...a.parent?this._getPathByStat(a.parent):[],r]},afterOneCheckChanged(a){const{checked:i}=a;if(a._ignoreCheckedOnce)return delete a._ignoreCheckedOnce,!1;const r=h=>{const{parent:d}=h;if(d){let c,m,f;for(const b of d.children)b.checked?c=!0:b.checked===0?f=!0:m=!0;const p=f?0:m?c?0:!1:!0;d.checked!==p&&(this._ignoreCheckedOnce(d),d.checked=p),r(d)}};return r(a),ne(a.children,h=>{h.checked!==i&&(this._ignoreCheckedOnce(h),h.checked=i)},{childrenKey:ve}),!0},_ignoreCheckedOnce(a){a._ignoreCheckedOnce=!0,setTimeout(()=>{a._ignoreCheckedOnce&&(a._ignoreCheckedOnce=!1)},100)},isVisible(a){const i=a.isStat?a:this.getStat(a),r=h=>!h||!h.hidden&&h.open&&r(h.parent);return!!(!i.hidden&&r(i.parent))},updateCheck(){ne(this.stats,a=>{if(a.children&&a.children.length>0){const i=a.children.every(r=>r.checked);a.checked!==i&&(this._ignoreCheckedOnce(a),a.checked=i)}},{childFirst:!0,childrenKey:ve})},getChecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(i=>i.checked||a&&i.checked===0)},getUnchecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(i=>a?!i.checked:i.checked===!1)},openAll(){for(const a of this.statsFlat)a.open=!0},closeAll(){for(const a of this.statsFlat)a.open=!1},openNodeAndParents(a){const i=a.isStat?a:this.getStat(a);for(const r of this.iterateParent(i,{withSelf:!0}))r.open=!0},_calcFlatIndex(a,i){let r=a?this.statsFlat.indexOf(a)+1:0;const h=a?a.children:this.stats;for(let d=0;d<i;d++)r+=this._count(h[d]);return r},add(a,i,r){if(this.has(a))throw"Can't add because data exists in tree";const h=i?i.children:this.stats;r==null&&(r=h.length);const d=this.statHandler({...Nt(),open:!!this.defaultOpen,data:a,parent:i||null,children:[],level:i?i.level+1:1});this._setPosition(d,i||null,r);const c=a[this.childrenKey];if(c){const m=c.slice();for(const f of m)this.add(f,d)}},remove(a){const i=this.getSiblings(a);if(i.includes(a)){Jt(i,a);const r=this._flat(a);this.statsFlat.splice(this.statsFlat.indexOf(a),r.length);for(const h of r)this._statsMap.delete(h.data);return this.afterRemoveStat(a),!0}return!1},getSiblings(a){const{parent:i}=a;return i?i.children:this.stats},_setPosition(a,i,r){(i?i.children:this.stats).splice(r,0,a),a.parent=i,a.level=i?i.level+1:1;const d=this._calcFlatIndex(i,r),c=this._flat(a);this.statsFlat.splice(d,0,...c);for(const m of c)this._statsMap.has(m.data)||this._statsMap.set(m.data,m);ne(a,(m,f,p)=>{p&&(m.level=p.level+1)},{childrenKey:ve}),this.afterSetStat(a,i,r)},*iterateParent(a,i){let r=i!=null&&i.withSelf?a:a.parent;for(;r;)yield r,r=r.parent},move(a,i,r){if(this.has(a)){if(a.parent===i&&this.getSiblings(a).indexOf(a)===r)return!1;if(a===i)throw new Error("Can't move node to it self");if(i&&a.level<i.level){let h;for(const d of this.iterateParent(i))if(d.level===a.level){h=d;break}if(a===h)throw new Error("Can't move node to its descendant")}this.remove(a)}return this._setPosition(a,i,r),!0},_flat(a){const i=[];return ne(a,r=>{i.push(r)},{childrenKey:ve}),i},_count(a){return this._flat(a).length},getData(a,i){const{childrenKey:r}=this,h=new yt([]);return h.childrenKey=r,ne(i||this.stats,(d,c,m,f)=>{let p={...d.data,[r]:[]};a&&(p=a(p)),h.set(f,p)},{childrenKey:ve}),h.data}},l=s;return s.noInitialization||l.init(),l}const Aa={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function Nt(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class Ut extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}/*!
 * drag-event-service v2.0.0
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Ye={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},ht={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,s){const{args:l,mouseArgs:a,touchArgs:i}=Ft(s),r=this._getStore(e),h=this,d=function(c){let m;if(h.isTouch(c))m={x:c.changedTouches[0].pageX,y:c.changedTouches[0].pageY,pageX:c.changedTouches[0].pageX,pageY:c.changedTouches[0].pageY,clientX:c.changedTouches[0].clientX,clientY:c.changedTouches[0].clientY,screenX:c.changedTouches[0].screenX,screenY:c.changedTouches[0].screenY};else if(m={x:c.pageX,y:c.pageY,pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,screenX:c.screenX,screenY:c.screenY},t==="start"&&c.which!==1)return;return n.call(this,c,m)};r.push({handler:n,wrapper:d}),ae.call(null,e,Ye[t][0],d,...l,...a),ae.call(null,e,Ye[t][1],d,...l,...i)},off(e,t,n,s){const{args:l,mouseArgs:a}=Ft(s),i=this._getStore(e);for(let r=i.length-1;r>=0;r--){const{handler:h,wrapper:d}=i[r];n===h&&(se.call(null,e,Ye[t][0],d,...l,...a),se.call(null,e,Ye[t][1],d,...l,...a),i.splice(r,1))}}};function Ft(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],s=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:s}}/*!
 * @he-tree/dnd-utils v0.1.0-alpha.4
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const ft=new Map,le={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},X=le;function Fe(e){e.dataTransfer&&(e.dataTransfer.dropEffect=X.dropEffect)}function ja(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ft.has(e))throw"Already registered on specified element";const n={...t},s=n;Xt(n,Ba),ht.on(e,"start",l,{touchArgs:[{passive:!0}]}),ht.on(e,"end",a);function l(m){var f;const p=m.target;p.nodeType===Node.ELEMENT_NODE&&(X.triggerElement=p);const b=p;if(n.ingoreHTMLTags&&b.tagName&&n.ingoreHTMLTags.find(V=>V.toUpperCase()===b.tagName))return;const _=(f=n.beforeDragStart)===null||f===void 0?void 0:f.call(n,m);_&&(_.setAttribute("draggable","true"),X.dragElement=_)}function a(m){X.dragElement&&X.dragElement.removeAttribute("draggable")}function i(m){var f;X.internal=!0,(f=n.onDragStart)===null||f===void 0||f.call(n,m),Fe(m)}function r(m){var f;(f=n.onDrag)===null||f===void 0||f.call(n,m),Fe(m)}function h(m){var f;(f=n.onDragEnd)===null||f===void 0||f.call(n,m),X.internal=!1,X.dragElement&&X.dragElement.removeAttribute("draggable"),X.triggerElement=null,X.dragElement=null,X.dropEffect="none"}const d=qa(e,{onDragLeave(m){var f;(f=n.onDragLeave)===null||f===void 0||f.call(n,m),Fe(m)},onDragEnter(m){var f;s.ifPreventDefault(m)&&m.preventDefault(),(f=n.onDragEnter)===null||f===void 0||f.call(n,m),Fe(m)},onDragOver(m){var f;s.ifPreventDefault(m)&&m.preventDefault(),(f=n.onDragOver)===null||f===void 0||f.call(n,m),Fe(m)},onDrop(m){var f;s.ifPreventDefault(m)&&m.preventDefault(),(f=n.onDrop)===null||f===void 0||f.call(n,m)},onEnter(m){var f;(f=n.onEnter)===null||f===void 0||f.call(n,m)},onLeave(m){var f;(f=n.onLeave)===null||f===void 0||f.call(n,m)}});return ae(e,"dragstart",i),ae(e,"drag",r),ae(e,"dragend",h),Object.assign(n,{root:e,destroy:()=>{ht.off(e,"start",l,{touchArgs:[{passive:!0}]}),se(e,"dragstart",i),se(e,"drag",r),se(e,"dragend",h),d(),ft.delete(e)}}),ft.set(e,s),s}const Ba={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return le.dragElement?!0:X.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let at=null;const Ha=e=>{at=e,setTimeout(()=>{at=null},20)};function qa(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let s=!1;const l=p=>{var b;s=!0,(b=t.onEnter)===null||b===void 0||b.call(t,p),c.resume()},a=p=>{var b;Ha(p.target),(b=t.onDragEnter)===null||b===void 0||b.call(t,p),s||l(p)},i=p=>{var b;s||l(p),(b=t.onDragOver)===null||b===void 0||b.call(t,p)},r=p=>{var b;(b=t.onDragLeave)===null||b===void 0||b.call(t,p);const _=function(){var N;let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p;s=!1,(N=t.onLeave)===null||N===void 0||N.call(t,U),c.stop()},V=at;at=null,V&&xa(V,n)||_()},h=p=>{var b;(b=t.onDrop)===null||b===void 0||b.call(t,p)},d=p=>{var b;p instanceof KeyboardEvent&&p.key!=="Escape"||(s=!1,c.stop(),(b=t.onEndBeforeLeave)===null||b===void 0||b.call(t,p))},c=Pa([[e,"drop",d],[window,"mouseup",d],[window,"touchend",d],[window,"keydown",d]]);c.stop();const m=()=>{ae(e,"dragenter",a),ae(e,"dragover",i),ae(e,"dragleave",r),ae(e,"drop",h)},f=()=>{se(e,"dragenter",a),se(e,"dragover",i),se(e,"dragleave",r),se(e,"drop",h),c.stop()};return m(),f}/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */let st=!1;const Ka=()=>{st=!0,setTimeout(()=>{st=!1},100)},Ma=Ke({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=Y(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));vt(()=>e.stat.checked,a=>{st||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),vt(()=>e.stat.open,a=>{st||(t(a?"open":"close",e.stat),Ka())});const s=Y(()=>{const a=[],i=c=>{var m;if(c.parent){let f=(m=c.parent)==null?void 0:m.children.indexOf(c);do{f++;let p=c.parent.children[f];if(p){if(!p.hidden)return!0}else break}while(!0)}return!1},r=e.rtl?"right":"left",h=e.btt?"top":"bottom";let d=e.stat;for(;d;){let c=(d.level-2)*e.indent+e.treeLineOffset;const m=i(d),f=()=>{a.push({style:{[r]:c+"px",[h]:m?0:"50%"}})};d===e.stat?d.level>1&&f():m&&f(),d=d.parent}return a}),l=Y(()=>{let a=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:a+"px"}});return{indentStyle:n,vLines:s,hLineStyle:l}}}),Zt=(e,t)=>{const n=e.__vccOpts||e;for(const[s,l]of t)n[s]=l;return n},Ra={class:"tree-node-inner"},za={key:1,class:"tree-node",ref:"el"};function Ja(e,t,n,s,l,a){return e.table?(g(),S("tr",za,[K(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(g(),S("div",{key:0,class:q(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:ke(e.indentStyle),ref:"el"},[e.treeLine?(g(),S(j,{key:0},[(g(!0),S(j,null,ee(e.vLines,i=>(g(),S("div",{class:"tree-line tree-vline",style:ke(i.style)},null,4))),256)),e.stat.level>1?(g(),S("div",{key:0,class:"tree-line tree-hline",style:ke(e.hLineStyle)},null,4)):k("",!0)],64)):k("",!0),I("div",Ra,[K(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const Wa=Zt(Ma,[["render",Ja]]);function Xa(e,t={}){const n={...t,statHandler(s){return this._statHandler2&&(s=this._statHandler2(s)),mt(t.statHandler,Be(s))},statsHandler(s){return mt(t.statsHandler,Be(s))},statsFlatHandler(s){return mt(t.statsFlatHandler,Be(s))}};return Fa(e,n)}function mt(e,t){return e?e(t):t}const Ya=Ke({components:{VirtualList:Ua,TreeNode:Wa},props:{value:{required:fa,type:Array},modelValue:{required:ma,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>Xa([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(s=>t(s))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:gt(J("getStat")),has:gt(J("has")),updateCheck:J("updateCheck"),getChecked:J("getChecked"),getUnchecked:J("getUnchecked"),openAll:J("openAll"),closeAll:J("closeAll"),openNodeAndParents:J("openNodeAndParents"),isVisible:J("isVisible"),move:At("move"),add:gt(At("add")),addMulti(e,t,n){this.batchUpdate(()=>{let s=n;for(const l of e)this.add(l,t,s),s!=null&&s++})},remove:J("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:J("iterateParent"),getSiblings:J("getSiblings"),getData:J("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:s}=this;return n[s]||(n[s]=[]),n[s]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,s,l)=>{const{childrenKey:a,updateBehavior:i}=this;let r=this.valueComputed;if(i==="new"){if(this.batchUpdateWaiting)return;r=this.getData()}else if(i==="modify"){const h=t(s==null?void 0:s.data);h.includes(n.data)||h.splice(l,0,n.data)}this.batchUpdateWaiting||this._updateValue(r)},e.afterRemoveStat=n=>{var s;const{childrenKey:l,updateBehavior:a}=this;let i=this.valueComputed;if(a==="new"){if(this.batchUpdateWaiting)return;i=this.getData()}else if(a==="modify"){const r=t((s=n.parent)==null?void 0:s.data);Jt(r,n.data)}this.batchUpdateWaiting||this._updateValue(i)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,ya(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function J(e){return function(...t){return this.processor[e](...t)}}function At(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function gt(e){return function(t,...n){return t&&(t=Be(t)),e.call(this,t,...n)}}const Ga={key:0,class:"drag-placeholder he-tree-drag-placeholder"},Za=["colspan"],Qa={class:"drag-placeholder he-tree-drag-placeholder"};function es(e,t,n,s,l,a){const i=T("TreeNode"),r=T("VirtualList");return g(),v(r,{class:q(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:o(()=>[K(e.$slots,"prepend",{tree:e.self})]),default:o(({item:h,index:d})=>[u(i,{"vt-index":d,class:q([h.class,{"drag-placeholder-wrapper":h.data===e.placeholderData,"dragging-node":h===e.dragNode}]),style:ke(h.style),stat:h,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:c=>e.$emit("click:node",h),onOpen:t[0]||(t[0]=c=>e.$emit("open:node",c)),onClose:t[1]||(t[1]=c=>e.$emit("close:node",c)),onCheck:t[2]||(t[2]=c=>e.$emit("check:node",c))},{default:o(({indentStyle:c})=>[h.data===e.placeholderData?(g(),S(j,{key:0},[e.table?(g(),S("td",{key:1,style:ke(c),colspan:e.placeholderColspan},[I("div",Qa,[K(e.$slots,"placeholder",{tree:e.self})])],12,Za)):(g(),S("div",Ga,[K(e.$slots,"placeholder",{tree:e.self})]))],64)):K(e.$slots,"default",{key:1,node:h.data,stat:h,indentStyle:c,tree:e.self},()=>[w(y(h.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:o(()=>[K(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const ts=Zt(Ya,[["render",es]]);let P=null,$=null,Ze,je,pe,Ge,pt,W,jt;const Ae={get startInfo(){return Ze},get targetInfo(){return je}},ns=Ke({extends:ts,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return It(this.rootDroppable,[this,P]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return It((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(d,c)=>{let m=!0;return P&&P!==this&&(m=m&&this._isMoved),this.table&&!this._isDragCopy&&(m=m&&this._isDragCopy),m&&(d.x!==c.x||d.y!==c.y)},t=(d,c)=>{$.ignoreUpdate(()=>{if(!$.has($.placeholderData)){if($.table){let f=0;const p=$.getRootEl().querySelector("tr");if(p)for(const{value:b}of ba(p.children))nt(b,"display")!=="none"&&(f+=b.colSpan||1);f<1&&(f=1),$.placeholderColspan=f}$.add($.placeholderData)}const m=$.getStat($.placeholderData);$.move(m,d,c)})},n=()=>{const d=this;if(d.has(d.placeholderData))return d.remove(d.getStat(d.placeholderData)),!0},s=d=>{d?le.dropEffect=P!=null&&P.dragCopy?"copy":"move":le.dropEffect="none"},l=d=>{const c=this;d?s(!0):c.keepPlaceholder?c.has(c.placeholderData)||s(!1):(n(),s(!1))};let a={x:0,y:0};const i=this.getRootEl();let r=null;const h=()=>{$!=null&&$.has($.placeholderData)&&$.ignoreUpdate(()=>{$.remove($.getStat($.placeholderData)),P&&(P.dragNode.hidden=!1,P.dragOvering=!1)})};this.treeDraggableInstance=ja(i,{beforeDragStart:d=>{if(!le.triggerElement)return;let c=this.triggerClass;(!c||c.length===0)&&(c="tree-node");let m=va(c),f=Tt(le.triggerElement,p=>{if(Lt(p,m))return!0;if(tt(p,"tree-node"))return"break"},{withSelf:!0,until:i});if(r=Tt(f,p=>{if(tt(p,"tree-node"))return!0},{withSelf:!0,until:i}),!!r){if(W=this.getNodeByElement(r),!W)throw"Can't find drag node";if(this.isDraggable(W))return this.$emit("before-drag-start",W),this.$emit("beforeDragStart",W),i}},onDragStart:d=>{var c,m,f;if(!r||!W)return;{const{x:_,y:V}=r.getBoundingClientRect(),{clientX:N,clientY:U}=d;(c=d.dataTransfer)==null||c.setDragImage(r,N-_,U-V)}pt={x:d.clientX,y:d.clientY},P=this,P.dragNode=W,Ge=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:d.clientX,y:d.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(r);{let _,V=0;if(this.table){let N=r.getBoundingClientRect();_={x:N.x,y:N.y},this.rtl&&(_.x=N.right),V=N.height}else if(!this.rtl)_=r.children[0].getBoundingClientRect().toJSON(),V=_.height;else{const N=r.children[0].getBoundingClientRect();_={x:N.right,y:N.y},V=N.height}return this.btt&&(_.y+=V),_}})(),this.dragOvering=!0;const p=P.getSiblings(P.dragNode),b=p.indexOf(W);Ze={tree:P,dragNode:W,parent:W.parent,siblings:p,indexBeforeDrop:b},$=this,(m=d.dataTransfer)==null||m.setData("text",`he-tree drag start at ${new Date().toISOString()}`),P._eachDroppable()||setTimeout(()=>{W.hidden=!0,t(W.parent,b+1)},0),(f=this.ondragstart)==null||f.call(this,d)},onEnter:d=>{this.$emit("enter",d)},onLeave:d=>{pe=null,this.dragOvering=!1,le.preventDefault=!1,n(),this.$emit("leave",d)},onDragOver:Da(d=>{if(!P){if(!this.onExternalDragOver||this.onExternalDragOver(d)===!1)return;le.preventDefault=!0}const c={x:d.clientX,y:d.clientY},m=e(c,a);if(a=c,!m)return;this.dragOvering=!0,$=this;const f=Ge?{x:Ge.x+(c.x-pt.x),y:Ge.y+(c.y-pt.y)}:{...c},{btt:p,rtl:b}=$;if($.disableDrop){le.dropEffect="none";return}let _,V;const N=$.getRootEl().querySelectorAll(".tree-node"),U=[];N.forEach(D=>{!Lt(D,["drag-placeholder-wrapper","dragging-node"])&&nt(D,"display")!=="none"&&U.push(D)});const Q=bt(U,D=>ct(D)[p?"bottom":"top"]-f.y,{returnNearestIfNoHit:!0});let A=null,te,$e;Q.hit||(Q.greater?p||(A=Q.index-1,U[A]||A++):p&&(A=Q.index+1,U[A]||A--)),A==null&&(A=Q.index),te=U[A],$e=p?U[A-1]:U[A+1],_=te&&$.getNodeByElement(te),V=$e&&$.getNodeByElement($e);const{indent:oe}=$,R=Ue(()=>{if($.table){let D=ct(te).toJSON();const H=oe*(_.level-1);return b?(D.width-=H,D.right-=H):D.x+=H,D}else return ct(te.firstElementChild)}).action,De=Ue(()=>p?f.y>R().y+R().height/2:f.y<R().y+R().height/2).action,dt=Ue(()=>p?!te||A===U.length-1&&De():!te||A===0&&De()).action,Me=Ue(()=>b?f.x-(R().x+R().width):R().x-f.x).action,O=Ue(()=>b?f.x<R().x+R().width-oe:f.x>R().x+oe).action;let x;if(dt())x=1,_=null;else if(_)Me()>0?x=_.level-Math.ceil(Me()/oe):O()?x=_.level+1:x=_.level;else return;V&&x<V.level&&(x=V.level),(async()=>{let D,H,Z=!1,z=null;const fe=async L=>{if(L.open)return!0;if($.dragOpen)if($.dragOpenDelay)if(z=L,pe===L)Z=!0;else{let F=_a();pe=L;const M=L;return setTimeout(async()=>{M!==pe?(Z=!0,F.resolve(!0)):($.beforeDragOpen&&await $.beforeDragOpen(L),M!==pe?(Z=!0,F.resolve(!0)):(L.open=!0,z=null,F.resolve(!0)))},$.dragOpenDelay),await F.promise}else return $.beforeDragOpen&&await $.beforeDragOpen(L),L.open=!0,!0;else return!1},Re=async()=>{if($.isDroppable(_)&&await fe(_)){if(Z)return;D=_,H=null}else return!1},ze=(L=x)=>{let F=_,M=[];for(;F&&F.level>=L;)F=F.parent||null,M.unshift(F);let ie=0;for(const me of M){if($.isDroppable(me))return D=me,H=M[ie+1]||_,!0;ie++}return!1};jt=_||null,_?x>_.level?await Re()===!1&&ze(_.level):ze()===!1&&await Re():$.isDroppable(null)&&(D=null),pe=z;const Je=!!(!Z&&(D||D===null));return{cancelled:Z,success:Je,parent:D,index:Je?H?(D?D.children:$.stats).filter(L=>L.data!==$.placeholderData).indexOf(H)+1:0:-1}})().then(D=>{if(!D.cancelled){if(!D.success){l(!1);return}if($.maxLevel!=null&&$.maxLevel>0){let H=1;if(P){const Z=P.dragNode;let z=0;ne(Z,fe=>{fe.level>z&&(z=fe.level)},{childrenKey:ve}),H=z-Z.level+1}if(H+(D.parent?D.parent.level:0)>$.maxLevel){l(!1);return}}l(!0),t(D.parent,D.index)}})}),onDrop:d=>{$=this;const c=!P;if(!$)return;const m=P==null?void 0:P.dragNode;let f,p=(()=>{var b;let _=!0;if(!$.has($.placeholderData))_=!1;else if(c)f=(b=this.externalDataHandler)==null?void 0:b.call(this,d),_=f!=null;else if(!P.dragCopy){const V=$.getStat($.placeholderData);P===$&&V.parent===m.parent&&$a(m,N=>N===V)}return _})();if(p){const b=$.getStat($.placeholderData),_=$.getSiblings(b);je={tree:$,dragNode:m,parent:b.parent,siblings:_,indexBeforeDrop:_.indexOf(b)}}(()=>{if(h(),p){let b=je.indexBeforeDrop;P&&!P.dragCopy&&P===$&&Ze.parent==je.parent&&Ze.indexBeforeDrop<b&&b--,P&&P!==$&&!P._eachDroppable()&&P.batchUpdate(()=>{P.remove(m),P.updateCheck()}),$.batchUpdate(()=>{let _=P==null?void 0:P.dragNode,V;f?V=f:P._eachDroppable()&&(V=Yt(P.dragNode.data,{childrenKey:P.childrenKey}),P.dragCopyDataHandler&&(V=P.dragCopyDataHandler(V))),V&&($.add(V),_=$.getStat(V)),$.move(_,je.parent,b),$.updateCheck()})}$.$emit("after-drop"),p&&(P&&(P.dragCopy||P.$emit("change")),$!==P&&$.$emit("change"))})()},onDragEnd:d=>{h(),P&&(P.dragNode&&(P.dragNode.hidden=!1),P.dragNode=null,P.dragOvering=!1,P=null),$=null,pe=null,W=null,jt=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),as={components:{Draggable:ns},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{clip:null,menu:{},items:[],loading:!0,checked:!1,term:""}},setup(){const e=xt(),t=Ve(),n=he();return{app:Pt(),auth:n,languages:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.fetch().then(e=>{this.items=e.data,this.loading=!1})},computed:{canTrash(){return this.$refs.tree.statsFlat.some(e=>e.check&&!e.data.deleted_at)},isChecked(){return this.$refs.tree.statsFlat.some(e=>e.check)},isTrashed(){return this.$refs.tree.statsFlat.some(e=>e.check&&e.data.deleted_at)}},methods:{add(){if(this.embed||!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=this.create();this.$apollo.mutate({mutation:B`mutation ($input: PageInput!) {
            addPage(input: $input) {
              id
            }
          }`,variables:{input:e}}).then(t=>{if(t.errors)throw t.errors;e.id=t.data.addPage.id,e.published=!0,this.$refs.tree.add(e),this.$emit("select",e)}).catch(t=>{this.messages.add(this.$gettext("Error adding root page"),"error"),this.$log("PageList::add(): Error adding root page",t)})},change(){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=Ae.targetInfo.parent,n=Ae.targetInfo.siblings[Ae.targetInfo.indexBeforeDrop+1]||null;this.$apollo.mutate({mutation:B`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:Ae.startInfo.dragNode.data.id,parent:e?e.data.id:null,ref:n?n.data.id:null}}).then(s=>{if(s.errors)throw s.errors;const l=Ae.startInfo.parent;l!=null&&l.data&&!(l!=null&&l.children.length)&&(l.data.has=!1),e&&(e.data.has=!0)}).catch(s=>{this.messages.add(this.$gettext("Error moving page"),"error"),this.$log("PageList::change(): Error moving page",s)})},copy(e,t){this.clip={type:"copy",node:t,stat:e}},create(e={}){return Object.assign({path:"_"+Math.floor(Math.random()*1e4),lang:this.languages.current||this.languages.default(),status:0,cache:5},e)},cut(e,t){this.$refs.tree.statsFlat.forEach(n=>{delete n.cut}),e.cut=!0,this.clip={type:"cut",node:t,stat:e}},drop(e){if(!this.auth.can("page:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>{var s;return n.check&&((s=n.data)==null?void 0:s.id)});t.length&&this.$apollo.mutate({mutation:B`mutation ($id: [ID!]!) {
            dropPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const s of t)this.update(s,l=>{l.data.deleted_at=new Date().toISOString().replace(/T/," ").substring(0,19),l.check=!1});this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error trashing page"),"error"),this.$log("PageList::drop(): Error trashing page",t,n)})},fetch(e=null,t=1,n=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const s=this.filter.publish||null,l=this.filter.trashed||"WITHOUT",a={...this.filter};return delete a.trashed,delete a.publish,delete a.view,a.parent_id=e,this.$apollo.query({query:B`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:a,page:t,limit:n,trashed:l,publish:s}}).then(i=>{if(i.errors)throw i.errors;return this.transform(i.data.pages)}).catch(i=>{this.messages.add(this.$gettext("Error fetching pages"),"error"),this.$log("PageList::fetch(): Error fetching page",e,t,n,i)})},fields(){return`id
          parent_id
          lang
          path
          domain
          name
          title
          to
          tag
          type
          theme
          status
          cache
          editor
          updated_at
          deleted_at
          has
          latest {
            id
            published
            publish_at
            data
            editor
            created_at
          }`},insert(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),s=t!==null?e.parent:e,l=n.indexOf(e),a=this.create();let i=null;switch(t===null&&!e.open&&this.load(e,e.data),t){case 0:i=e.data.id;break;case null:i=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:i=n[l+1]?n[l+1].data.id:null;break}this.$apollo.mutate({mutation:B`mutation ($input: PageInput!, $parent: ID, $ref: ID) {
            addPage(input: $input, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{input:a,parent:s?s.data.id:null,ref:i}}).then(r=>{if(r.errors)throw r.errors;a.id=r.data.addPage.id,(t!==null||e.open)&&this.$refs.tree.add(a,s,t!==null?l+t:0),s&&(s.data.has=!0),this.invalidate()}).catch(r=>{this.messages.add(this.$gettext("Error inserting page"),"error"),this.$log("PageList::insert(): Error inserting page",r)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"pages"}),e.gc()},keep(e){if(!this.auth.can("page:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(l=>l.check&&l.data.id&&l.data.deleted_at),n=t.filter(l=>t.indexOf(l.parent)===-1),s=e.data.deleted_at||null;n.length&&this.$apollo.mutate({mutation:B`mutation ($id: [ID!]!) {
            keepPage(id: $id) {
              id
            }
          }`,variables:{id:n.map(l=>l.data.id)}}).then(l=>{if(l.errors)throw l.errors;for(const a of n)this.update(a,i=>{s>=i.data.deleted_at&&(i.data.deleted_at=null,i.check=!1)});this.invalidate()}).catch(l=>{this.messages.add(this.$gettext("Error restoring page"),"error"),this.$log("PageList::keep(): Error restoring page",n,l)})},load(e,t){!e.open&&!t.children&&(e.loading=!0,this.fetch(t.id,e.page?e.page+1:1).then(n=>{this.$refs.tree.addMulti(n.data,e,0),e.page=n.currentPage||1}).finally(()=>{e.loading=!1})),e.open=!e.open},move(e,t=null){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),s=t!==null?e.parent:e,l=n.indexOf(e);let a=null;switch(t){case 0:a=e.data.id;break;case null:a=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:a=n[l+1]?n[l+1].data.id:null;break}this.$apollo.mutate({mutation:B`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:s?s.data.id:null,ref:a}}).then(i=>{var h;if(i.errors)throw i.errors;const r=t!==null?l<this.$refs.tree.getSiblings(e).indexOf(this.clip.stat)?l+t:l:0;this.$refs.tree.move(this.clip.stat,s,r),s&&((h=this.clip.stat.children)!=null&&h.length||(e.parent.data.has=!1),s.data.has=!0),this.invalidate()}).catch(i=>{this.messages.add(this.$gettext("Error moving page"),"error"),this.$log("PageList::move(): Error moving page",e,t,i)}),this.show()},paste(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),s=t!==null?e.parent:e,l=n.indexOf(e),a={...this.clip.node};let i=null;switch(t){case 0:i=e.data.id;break;case null:i=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:i=n[l+1]?n[l+1].data.id:null;break}return this.$apollo.query({query:B`query($id: ID!) {
            page(id: $id) {
              meta
              config
              content
              files {
                id
              }
              elements {
                id
              }
            }
          }`,variables:{id:a.id}}).then(r=>{var h,d,c,m,f,p,b,_,V,N;if(r.errors)throw r.errors;this.$apollo.mutate({mutation:B`mutation ($input: PageInput!, $parent: ID, $ref: ID, $elements: [ID!], $files: [ID!]) {
              addPage(input: $input, parent: $parent, ref: $ref, elements: $elements, files: $files) {
                ${this.fields()}
              }
            }`,variables:{input:{status:0,to:a.to,tag:a.tag,type:a.type,theme:a.theme,lang:a.lang,name:a.name,title:a.title,cache:a.cache,domain:a.domain,related_id:a.id,meta:((d=(h=r==null?void 0:r.data)==null?void 0:h.page)==null?void 0:d.meta)||"{}",config:((m=(c=r==null?void 0:r.data)==null?void 0:c.page)==null?void 0:m.config)||"{}",content:((p=(f=r==null?void 0:r.data)==null?void 0:f.page)==null?void 0:p.content)||"[]",path:a.path+"_"+Math.floor(Math.random()*1e4)},parent:s?s.data.id:null,ref:i,elements:((_=(b=r==null?void 0:r.data)==null?void 0:b.page)==null?void 0:_.elements.map(U=>U.id))||[],files:((N=(V=r==null?void 0:r.data)==null?void 0:V.page)==null?void 0:N.files.map(U=>U.id))||[]}}).then(U=>{if(U.errors)throw U.errors;if(!U.data.addPage)throw new Error("No page data returned");const Q=t!==null?this.$refs.tree.getSiblings(e).indexOf(e)+t:0,A=U.data.addPage;this.$refs.tree.add(A,s,Q),this.invalidate()}).catch(U=>{this.messages.add(this.$gettext("Error copying page"),"error"),this.$log("PageList::paste(): Error copying page",e,t,U)})}).catch(r=>{this.messages.add(this.$gettext("Error fetching page"),"error"),this.$log("PageList::paste(): Error fetching page",a.id,r)})},publish(e){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n.check&&n.data.id&&!n.data.published);t.length&&this.$apollo.mutate({mutation:B`mutation ($id: [ID!]!) {
            pubPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const s of t)s.data.published=!0,s.check=!1;this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error publishing page"),"error"),this.$log("PageList::publish(): Error publishing page",t,n)})},purge(e){if(!this.auth.can("page:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n.check&&n.data.id);t.length&&this.$apollo.mutate({mutation:B`mutation ($id: [ID!]!) {
            purgePage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id).reverse()}}).then(n=>{var s;if(n.errors)throw n.errors;for(const l of t)this.$refs.tree.remove(l),l.parent&&!((s=l.parent.children)!=null&&s.length)&&(l.parent.data.has=!1)}).catch(n=>{this.messages.add(this.$gettext("Error purging page"),"error"),this.$log("PageList::purge(): Error purging page",t,n)})},search(e=1,t=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const n=this.filter.publish||null,s=this.filter.trashed||"WITHOUT",l={...this.filter};return delete l.trashed,delete l.publish,delete l.view,this.term&&(l.any=this.term),this.$apollo.query({query:B`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:l,page:e,limit:t,trashed:s,publish:n}}).then(a=>{if(a.errors)throw a.errors;return this.transform(a.data.pages)}).catch(a=>{this.messages.add(this.$gettext("Error searching pages"),"error"),this.$log("PageList::search(): Error searching pages",e,t,a)})},show(e=null){e===null?this.menu={}:this.menu[e]?this.menu[e]=!1:(this.menu={},this.menu[e]=!0)},status(e,t){if(!this.auth.can("page:save")){this.messages.add(this.$gettext("Permission denied"),"error");return}(e?[e]:this.$refs.tree.statsFlat.filter(s=>s.check&&s.data.id)).forEach(s=>{this.$apollo.mutate({mutation:B`mutation ($id: ID!, $input: PageInput!) {
              savePage(id: $id, input: $input) {
                id
              }
            }`,variables:{id:s.data.id,input:{status:t}}}).then(l=>{if(l.errors)throw l.errors;s.data.status=t}).catch(l=>{this.messages.add(this.$gettext("Error saving page"),"error"),this.$log("PageList::status(): Error saving page",s,t,l)})})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),e.theme&&t.push("Theme: "+e.theme),e.type&&t.push("Page type: "+e.type),e.tag&&t.push("Tag: "+e.tag),e.cache&&t.push("Cache: "+e.cache+" min"),t.join(`
`)},toggle(){this.$refs.tree.statsFlat.forEach(e=>{e.check=!e.check})},transform(e){return{data:e.data.map(n=>{var l,a,i,r,h;const s=(l=n.latest)!=null&&l.data?JSON.parse(n.latest.data):{...n};return Object.assign(s,{id:n.id,has:n.has,parent_id:n.parent_id,deleted_at:n.deleted_at,created_at:n.created_at,updated_at:((a=n.latest)==null?void 0:a.created_at)||n.updated_at,editor:((i=n.latest)==null?void 0:i.editor)||n.editor,published:((r=n.latest)==null?void 0:r.published)??!0,publish_at:((h=n.latest)==null?void 0:h.publish_at)||null,latest:n.latest})}),currentPage:e.paginatorInfo.currentPage,lastPage:e.paginatorInfo.lastPage}},update(e,t){var n;if(typeof t!="function")throw new Error("Second paramter must be a function");t(e),(n=e.children)==null||n.forEach(s=>{t(s,t)})},url(e){return this.app.urlpage.replace(/:domain/,e.domain||"").replace(/:path/,e.path||"").replace(/\/+$/,"")}},watch:{filter:{deep:!0,handler(e){this.items=[],this.loading=!0,(e.view==="list"?this.search():this.fetch()).then(n=>{this.items=n.data,this.loading=!1})}},term:{handler(){this.items=[],this.loading=!0,(this.term?this.searchd():this.fetch()).then(t=>{this.items=t.data,this.loading=!1})}}}},ss={class:"header"},is={class:"bulk"},rs={class:"search"},ls={key:0,class:"spinner",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},os=["title"],ds=["onClick"],us={class:"item-head"},cs={key:1,class:"item-lang"},hs={class:"item-title"},fs={key:0,class:"item-subtitle"},ms=["href"],gs={class:"item-domain"},ps={class:"item-path item-subtitle"},vs={key:0,class:"item-to item-subtitle"},ys={key:0,class:"loading"},bs={key:1,class:"notfound"},ks={key:2,class:"btn-group"};function Cs(e,t,n,s,l,a){const i=T("Draggable");return g(),S(j,null,[I("div",ss,[I("div",is,[u(Qe,{modelValue:l.checked,"onUpdate:modelValue":t[0]||(t[0]=r=>l.checked=r),onClick:t[1]||(t[1]=ue(r=>a.toggle(),["stop"]))},null,8,["modelValue"]),u(Ee,null,{activator:o(({props:r})=>[u(C,we({"append-icon":"mdi-menu-down",variant:"text"},r),{default:o(()=>[w(y(e.$gettext("Actions")),1)]),_:2},1040)]),default:o(()=>[u(xe,null,{default:o(()=>[a.isChecked&&s.auth.can("page:publish")?(g(),v(E,{key:0},{default:o(()=>[u(C,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=r=>a.publish())},{default:o(()=>[w(y(e.$gettext("Publish")),1)]),_:1})]),_:1})):k("",!0),a.isChecked&&s.auth.can("page:save")?(g(),v(E,{key:1},{default:o(()=>[u(C,{"prepend-icon":"mdi-eye",variant:"text",onClick:t[3]||(t[3]=r=>a.status(null,1))},{default:o(()=>[w(y(e.$gettext("Enable")),1)]),_:1})]),_:1})):k("",!0),a.isChecked&&s.auth.can("page:save")?(g(),v(E,{key:2},{default:o(()=>[u(C,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:t[4]||(t[4]=r=>a.status(null,0))},{default:o(()=>[w(y(e.$gettext("Disable")),1)]),_:1})]),_:1})):k("",!0),u(be),a.canTrash&&s.auth.can("page:drop")?(g(),v(E,{key:3},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[5]||(t[5]=r=>a.drop())},{default:o(()=>[w(y(e.$gettext("Trash")),1)]),_:1})]),_:1})):k("",!0),a.isTrashed&&s.auth.can("page:keep")?(g(),v(E,{key:4},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[6]||(t[6]=r=>a.keep())},{default:o(()=>[w(y(e.$gettext("Restore")),1)]),_:1})]),_:1})):k("",!0),a.isChecked&&s.auth.can("page:purge")?(g(),v(E,{key:5},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[7]||(t[7]=r=>a.purge())},{default:o(()=>[w(y(e.$gettext("Purge")),1)]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})]),I("div",rs,[u(de,{modelValue:l.term,"onUpdate:modelValue":t[8]||(t[8]=r=>l.term=r),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])])]),u(i,{modelValue:l.items,"onUpdate:modelValue":t[12]||(t[12]=r=>l.items=r),ref:"tree",defaultOpen:!1,disableDrag:!s.auth.can("page:move"),rtl:e.$vuetify.locale.isRtl,watermark:!1,virtualization:"",onChange:t[13]||(t[13]=r=>a.change())},{default:o(({node:r,stat:h})=>[h.loading?(g(),S("svg",ls,t[15]||(t[15]=[I("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),I("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),I("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)]))):(g(),v(C,{key:1,class:q({hidden:!r.has}),onClick:d=>a.load(h,r),variant:"flat",icon:h.open?"mdi-menu-down":"mdi-menu-right"},null,8,["class","onClick","icon"])),u(Qe,{modelValue:h.check,"onUpdate:modelValue":d=>h.check=d,class:q({draft:!r.published})},null,8,["modelValue","onUpdate:modelValue","class"]),r.id?(g(),v(Ee,{key:2},{activator:o(({props:d})=>[u(C,we({icon:"mdi-dots-vertical",variant:"text"},d),null,16)]),default:o(()=>[u(xe,null,{default:o(()=>[!r.deleted_at&&!r.published&&s.auth.can("page:publish")?(g(),v(E,{key:0},{default:o(()=>[u(C,{"prepend-icon":"mdi-publish",variant:"text",onClick:d=>a.publish(h)},{default:o(()=>[w(y(e.$gettext("Publish")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),r.status!==0&&s.auth.can("page:save")?(g(),v(E,{key:1},{default:o(()=>[u(C,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:d=>a.status(h,0)},{default:o(()=>[w(y(e.$gettext("Disable")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),r.status!==1&&s.auth.can("page:save")?(g(),v(E,{key:2},{default:o(()=>[u(C,{"prepend-icon":"mdi-eye",variant:"text",onClick:d=>a.status(h,1)},{default:o(()=>[w(y(e.$gettext("Enable")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),r.status!==2&&s.auth.can("page:save")?(g(),v(E,{key:3},{default:o(()=>[u(C,{"prepend-icon":"mdi-eye-off-outline",variant:"text",onClick:d=>a.status(h,2)},{default:o(()=>[w(y(e.$gettext("Hide in menu")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),u(be),s.auth.can("page:move")?(g(),v(E,{key:4},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:d=>a.cut(h,r)},{default:o(()=>[w(y(e.$gettext("Cut")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),!this.embed&&s.auth.can("page:add")?(g(),v(E,{key:5},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:d=>a.copy(h,r)},{default:o(()=>[w(y(e.$gettext("Copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),l.clip&&l.clip.type=="copy"&&!this.embed&&s.auth.can("page:add")?(g(),v(E,{key:6},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[9]||(t[9]=ue(d=>a.show("paste"),["stop"]))},{default:o(()=>[w(y(e.$gettext("Paste")),1)]),_:1})]),_:1})):k("",!0),l.clip&&l.clip.type=="copy"&&l.menu.paste&&!this.embed&&s.auth.can("page:add")?(g(),v(re,{key:7},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>a.paste(h,0),class:"subitem"},{default:o(()=>[w(y(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),l.clip&&l.clip.type=="copy"&&l.menu.paste&&!this.embed&&s.auth.can("page:add")?(g(),v(re,{key:8},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:d=>a.paste(h),class:"subitem"},{default:o(()=>[w(y(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),l.clip&&l.clip.type=="copy"&&l.menu.paste&&!this.embed&&s.auth.can("page:add")?(g(),v(re,{key:9},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>a.paste(h,1),class:"subitem"},{default:o(()=>[w(y(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),l.clip&&l.clip.type=="cut"&&s.auth.can("page:move")?(g(),v(E,{key:10},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[10]||(t[10]=ue(d=>a.show("move"),["stop"]))},{default:o(()=>[w(y(e.$gettext("Paste")),1)]),_:1})]),_:1})):k("",!0),l.clip&&l.clip.type=="cut"&&l.menu.move&&s.auth.can("page:move")?(g(),v(re,{key:11},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>a.move(h,0),class:"subitem"},{default:o(()=>[w(y(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),l.clip&&l.clip.type=="cut"&&l.menu.move&&s.auth.can("page:move")?(g(),v(re,{key:12},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:d=>a.move(h),class:"subitem"},{default:o(()=>[w(y(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),l.clip&&l.clip.type=="cut"&&l.menu.move&&s.auth.can("page:move")?(g(),v(re,{key:13},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>a.move(h,1),class:"subitem"},{default:o(()=>[w(y(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),!this.embed&&s.auth.can("page:add")?(g(),v(E,{key:14},{default:o(()=>[u(C,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[11]||(t[11]=ue(d=>a.show("insert"),["stop"]))},{default:o(()=>[w(y(e.$gettext("Insert")),1)]),_:1})]),_:1})):k("",!0),l.menu.insert&&!this.embed&&s.auth.can("page:add")?(g(),v(re,{key:15},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>a.insert(h,0),class:"subitem"},{default:o(()=>[w(y(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),l.menu.insert&&!this.embed&&s.auth.can("page:add")?(g(),v(re,{key:16},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:d=>a.insert(h),class:"subitem"},{default:o(()=>[w(y(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),l.menu.insert&&!this.embed&&s.auth.can("page:add")?(g(),v(re,{key:17},{default:o(()=>[u(E,null,{default:o(()=>[u(C,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>a.insert(h,1),class:"subitem"},{default:o(()=>[w(y(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):k("",!0),u(be),!r.deleted_at&&s.auth.can("page:drop")?(g(),v(E,{key:18},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete",variant:"text",onClick:d=>a.drop(h)},{default:o(()=>[w(y(e.$gettext("Trash")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),r.deleted_at&&s.auth.can("page:keep")?(g(),v(E,{key:19},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:d=>a.keep(h)},{default:o(()=>[w(y(e.$gettext("Restore")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),s.auth.can("page:purge")?(g(),v(E,{key:20},{default:o(()=>[u(C,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:d=>a.purge(h)},{default:o(()=>[w(y(e.$gettext("Purge")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024)):k("",!0),I("div",{class:q(["item-content",{"status-hidden":r.status==2,"status-enabled":r.status==1,"status-disabled":!r.status,trashed:r.deleted_at,cut:h.cut}]),title:a.title(r)},[I("div",{class:"item-text",onClick:d=>e.$emit("select",r)},[I("div",us,[r.publish_at?(g(),v(Se,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):k("",!0),r.lang?(g(),S("span",cs,y(r.lang),1)):k("",!0),I("span",hs,y(r.name||e.$gettext("New")),1)]),r.title?(g(),S("div",fs,y(r.title),1)):k("",!0)],8,ds),I("a",{class:"item-aux",href:a.url(r),target:"_blank",draggable:"false"},[I("div",gs,y(r.domain),1),I("span",ps,y(a.url(r)),1),r.to?(g(),S("span",vs," ➔ "+y(r.to),1)):k("",!0)],8,ms)],10,os)]),_:1},8,["modelValue","disableDrag","rtl"]),l.loading?(g(),S("p",ys,[w(y(e.$gettext("Loading"))+" ",1),t[16]||(t[16]=I("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[I("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),I("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),I("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):k("",!0),!l.loading&&!l.items.length?(g(),S("p",bs,y(e.$gettext("No entries found")),1)):k("",!0),!l.loading&&!l.items.length&&!this.embed&&this.auth.can("page:add")?(g(),S("div",ks,[u(C,{onClick:t[14]||(t[14]=r=>a.add()),icon:"mdi-folder-plus",color:"primary",variant:"flat"})])):k("",!0)],64)}const ws=G(as,[["render",Cs]]),$s={components:{PageListItems:ws,PageDetail:Ot,Navigation:an,AsideList:nn,User:tn},inject:["locales","openView"],data:()=>({filter:{view:"tree",trashed:"WITHOUT",publish:null,editor:null,lang:null}}),setup(){const e=kt();return{auth:he(),drawer:e}},methods:{languages(){const e=[{title:this.$gettext("All"),icon:"mdi-playlist-check",value:{lang:null}}];for(const t of this.locales())e.push({title:t.title,icon:"mdi-translate",value:{lang:t.value}});return e},open(e){this.openView(Ot,{item:e})}}};function Ds(e,t,n,s,l,a){var c;const i=T("User"),r=T("Navigation"),h=T("PageListItems"),d=T("AsideList");return g(),S(j,null,[u(Kt,{elevation:0,density:"compact"},{prepend:o(()=>[u(C,{onClick:t[0]||(t[0]=m=>s.drawer.toggle("nav"))},{default:o(()=>[u(Se,{size:"x-large"},{default:o(()=>[w(y(s.drawer.nav?"mdi-close":"mdi-menu"),1)]),_:1})]),_:1})]),append:o(()=>[u(i),u(C,{onClick:t[1]||(t[1]=m=>s.drawer.toggle("aside"))},{default:o(()=>[u(Se,{size:"x-large"},{default:o(()=>[w(y(s.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"),1)]),_:1})]),_:1})]),default:o(()=>[u(Rt,null,{default:o(()=>[w(y(e.$gettext("Pages")),1)]),_:1})]),_:1}),u(r),u(Mt,{class:"page-list"},{default:o(()=>[u(Ie,null,{default:o(()=>[u(Te,{class:"box"},{default:o(()=>[u(h,{onSelect:t[2]||(t[2]=m=>a.open(m)),filter:e.filter},null,8,["filter"])]),_:1})]),_:1})]),_:1}),u(d,{filter:e.filter,"onUpdate:filter":t[3]||(t[3]=m=>e.filter=m),content:[{key:"view",title:e.$gettext("View"),items:[{title:e.$gettext("Tree"),icon:"mdi-file-tree",value:{view:"tree"}},{title:e.$gettext("List"),icon:"mdi-format-list-bulleted-square",value:{view:"list"}}]},{key:"publish",title:e.$gettext("Publish"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{publish:null}},{title:e.$gettext("Published"),icon:"mdi-publish",value:{publish:"PUBLISHED"}},{title:e.$gettext("Scheduled"),icon:"mdi-clock-outline",value:{publish:"SCHEDULED"}},{title:e.$gettext("Drafts"),icon:"mdi-pencil",value:{publish:"DRAFT"}}]},{key:"trashed",title:e.$gettext("Trashed"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{trashed:"WITH"}},{title:e.$gettext("Available only"),icon:"mdi-delete-off",value:{trashed:"WITHOUT"}},{title:e.$gettext("Only trashed"),icon:"mdi-delete",value:{trashed:"ONLY"}}]},{key:"editor",title:e.$gettext("Editor"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{editor:null}},{title:e.$gettext("Edited by me"),icon:"mdi-account",value:{editor:(c=this.auth.me)==null?void 0:c.email}}]},{key:"lang",title:e.$gettext("Languages"),items:a.languages()}]},null,8,["filter","content"])],64)}const Vs=G($s,[["render",Ds],["__scopeId","data-v-c1d79297"]]);export{Vs as default};
