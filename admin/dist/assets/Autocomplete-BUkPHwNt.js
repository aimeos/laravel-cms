import{_ as s,I as c,b as u,J as d,o as h}from"../index.js";const f={props:{modelValue:{type:[Object,String,Number,Boolean,null],default:null},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","error"],data(){return{list:this.config.options||[],loading:!1}},created(){this.graphql=this.debounce(this.graphql,500),this.rest=this.debounce(this.rest,500)},methods:{debounce(e,t){let i;return function(...l){return new Promise((o,n)=>{const r=this;clearTimeout(i),i=setTimeout(()=>{try{o(e.apply(r,l))}catch(a){n(a)}},t)})}},graphql(e){if(!this.config.endpoint.url||!this.config.endpoint.query)return;const t=this.config.endpoint.query.replace(/_term_/g,e?JSON.stringify(e):'""');this.loading=!0,this.$apollo.query({query:c`${t}`}).then(i=>{this.list=this.items(this.toList(i.data)),this.loading=!1}).catch(i=>{this.$log("Autocomplete::graphql(): Error fetching data",e,i)})},items(e){if(!e)return[];const t=this.config["item-title"],i=this.config["item-value"];return e.map(l=>typeof l=="object"&&l!==null?t?{label:l[t]??"",value:l[i]??""}:l[i]??"":l)},rest(e){this.config.endpoint.url&&(this.loading=!0,fetch(this.config.endpoint.url.replace(/_term_/g,e||""),{mode:"cors"}).then(t=>{if(!t.ok)throw t;return t.json()}).then(t=>{this.list=this.items(this.toList(t)),this.loading=!1}).catch(t=>{this.$log("Autocomplete::rest(): Error fetching data",e,t)}))},search(e){if(this.config.endpoint)switch(this.config.endpoint.type){case"GQL":this.graphql(e);break;case"REST":this.rest(e);break}},toList(e){return this.config["list-key"]?this.config["list-key"].split("/").reduce((t,i)=>typeof t=="object"&&t!==null?t[i]:t,e):e},update(e){this.$emit("update:modelValue",e),this.validate()},async validate(){await this.$nextTick();const e=await this.$refs.field.validate();return this.$emit("error",e.length>0),!e.length}},watch:{modelValue:{immediate:!0,handler(e){this.validate()}}}};function g(e,t,i,l,o,n){return h(),u(d,{ref:"field",rules:[r=>!i.config.required||!!r||"Value is required"],loading:o.loading,readonly:i.readonly,clearable:!i.readonly,items:o.list,"no-data-text":i.config["empty-text"]||"No data available",placeholder:i.config.placeholder||"","return-object":!!i.config["item-title"],multiple:i.config.multiple,chips:i.config.multiple,modelValue:i.modelValue,"onUpdate:modelValue":t[0]||(t[0]=r=>n.update(r)),"onUpdate:search":t[1]||(t[1]=r=>n.search(r)),density:"comfortable","hide-details":"auto",variant:"outlined","item-title":"label","item-value":"value"},null,8,["rules","loading","readonly","clearable","items","no-data-text","placeholder","return-object","multiple","chips","modelValue"])}const p=s(f,[["render",g]]);export{p as default};
