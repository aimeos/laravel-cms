import{_ as $,c as _,a1 as w,F as C,o as u,as as P,a as l,b as g,w as a,j as h,t as y,a7 as F,a8 as N,aN as U,aS as B,b5 as j,aT as M,b6 as q,ap as R,a3 as m,f as c,I as V,an as H,$ as J,d as k,h as W,aF as O,G as S,D as z,aG as T,b7 as G,ao as Q,T as Y,r as Z,aw as x,aH as f,ay as I,E as D,i as K}from"../index.js";const X={props:{data:{type:Object,default:()=>{}},files:{type:Array,default:()=>[]},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},fields:{type:Object,required:!0}},emits:["change","error","update:files"],data(){return{errors:{}}},methods:{addFile(s){const e=Array.isArray(s)?s:[s],t=[...this.files];t.push(...e),this.$emit("update:files",t)},error(s,e){this.errors[s]=e,this.$emit("error",Object.values(this.errors).includes(!0))},removeFile(s){const e=Array.isArray(s)?s:[s],t=[...this.files];for(const o of e){const i=t.findIndex(n=>n===o);i!==-1&&t.splice(i,1)}this.$emit("update:files",t)},update(s,e){this.data[s]=e,this.$emit("change",this.data[s])},validate(){var e;const s=[];return(e=this.$refs.field)==null||e.forEach(t=>{s.push(t.validate())}),Promise.all(s).then(t=>t.every(o=>o))}}};function ee(s,e,t,o,i,n){return u(!0),_(C,null,w(t.fields,(d,r)=>{var v,p,E;return u(),_("div",{key:r,class:P(["item",{error:i.errors[r]}])},[l(F,null,{default:a(()=>[h(y(d.label||r),1)]),_:2},1024),(u(),g(N(((p=(v=d.type)==null?void 0:v.charAt(0))==null?void 0:p.toUpperCase())+((E=d.type)==null?void 0:E.slice(1))),{ref_for:!0,ref:"field",assets:t.assets,config:d,readonly:t.readonly,modelValue:t.data[r],onAddFile:e[0]||(e[0]=b=>n.addFile(b)),onRemoveFile:e[1]||(e[1]=b=>n.removeFile(b)),"onUpdate:modelValue":b=>n.update(r,b),onError:b=>n.error(r,b)},null,40,["assets","config","readonly","modelValue","onUpdate:modelValue","onError"]))],2)}),128)}const Ce=$(X,[["render",ee],["__scopeId","data-v-98b151f1"]]),Ve=function(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",e=new Date("2025-01-01T00:00:00Z").getTime();let t=0;return function(){t=(t+1)%16;const o=Math.floor((Date.now()-e)/8)<<4|t;return Array.from({length:7},(i,n)=>{const d=o>>7*(7-n)&63;return s[n===0?d%52:d]}).join("")}}(),te={props:{type:{type:String,required:!0}},emits:["add"],data:()=>({tab:["basic"]}),setup(){return{schemas:U()}},computed:{groups(){const s={};for(const e in this.schemas[this.type]||{}){const t=this.schemas[this.type][e],o=t.group||"uncategorized";t.type=e,s[o]=s[o]||[],s[o].push(t)}return s}},methods:{add(s){this.$emit("add",{type:s.type})}}},se=["innerHTML"];function re(s,e,t,o,i,n){return u(),_(C,null,[l(B,{modelValue:s.tab,"onUpdate:modelValue":e[0]||(e[0]=d=>s.tab=d)},{default:a(()=>[(u(!0),_(C,null,w(n.groups,(d,r)=>(u(),g(M,{key:r,value:r},{default:a(()=>[h(y(r),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(j,{modelValue:s.tab,"onUpdate:modelValue":e[1]||(e[1]=d=>s.tab=d)},{default:a(()=>[(u(!0),_(C,null,w(Object.keys(n.groups),d=>(u(),g(q,{key:d,value:d},{default:a(()=>[l(R,null,{default:a(()=>[(u(!0),_(C,null,w(n.groups[d],r=>(u(),g(m,{key:r.type,onClick:v=>n.add(r),variant:"text",stacked:""},{prepend:a(()=>[c("span",{class:"icon",innerHTML:r.icon},null,8,se)]),default:a(()=>[h(" "+y(r.type),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],64)}const ae=$(te,[["render",re],["__scopeId","data-v-06e74854"]]),le={components:{SchemaItems:ae},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,vschemas:!1,checked:!1,loading:!0,trash:!1}},setup(){const s=H();return{auth:J(),messages:s}},created(){this.search(),this.searchd=this.debounce(this.search,500)},computed:{canTrash(){return this.items.some(s=>s._checked&&!s.deleted_at)},isChecked(){return this.items.some(s=>s._checked)},isTrashed(){return this.items.some(s=>s._checked&&s.deleted_at)}},methods:{add(s){if(this.embed||!this.auth.can("element:add")){this.messages.add("Permission denied","error");return}return this.$apollo.mutate({mutation:V`mutation($input: ElementInput!) {
            addElement(input: $input) {
              id
              lang
              name
              type
              data
              editor
              created_at
              updated_at
              deleted_at
            }
          }`,variables:{input:{type:s.type,name:"New shared element",data:"{}"}}}).then(e=>{var o;if(e.errors)throw e.errors;const t=((o=e.data)==null?void 0:o.addElement)||{};return t.data=JSON.parse(t.data)||{},t.published=!0,this.vschemas=!1,this.items.unshift(t),this.$emit("select",t),this.invalidate(),t}).catch(e=>{this.$log("ElementListItems::add(): Error adding shared element",e)})},debounce(s,e){let t;return function(...o){return new Promise((i,n)=>{const d=this;clearTimeout(t),t=setTimeout(()=>{try{i(s.apply(d,o))}catch(r){n(r)}},e)})}},drop(s){if(!this.auth.can("element:drop")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked);e.length&&this.$apollo.mutate({mutation:V`
            mutation($id: [ID!]!) {
              dropElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error trashing shared element","error"),this.$log("ElementListItems::drop(): Error trashing shared element",e,t)})},invalidate(){const s=this.$apollo.provider.defaultClient.cache;s.evict({id:"ROOT_QUERY",fieldName:"elements"}),s.gc()},keep(s){if(!this.auth.can("element:keep")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked);e.length&&this.$apollo.mutate({mutation:V`
            mutation($id: [ID!]!) {
              keepElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;e.forEach(o=>{o.deleted_at=null}),this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error restoring shared element","error"),this.$log("ElementListItems::keep(): Error restoring shared element",e,t)})},publish(s){if(!this.auth.can("element:publish")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked&&t.id&&!t.published);e.length&&this.$apollo.mutate({mutation:V`mutation ($id: [ID!]!) {
            pubElement(id: $id) {
              id
            }
          }`,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;e.forEach(o=>{o.published=!0,o._checked=!1}),this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error publishing shared element","error"),this.$log("ElementListItems::publish(): Error publishing shared element",e,t)})},purge(s){if(!this.auth.can("element:purge")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked);e.length&&this.$apollo.mutate({mutation:V`
            mutation($id: [ID!]!) {
              purgeElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error purging shared element","error"),this.$log("ElementListItems::purge(): Error purging shared element",e,t)})},search(){if(!this.auth.can("element:view"))return this.messages.add("Permission denied","error"),Promise.resolve([]);const s=this.filter.publish||null,e=this.filter.trashed||"WITHOUT",t={...this.filter};return delete t.publish,delete t.trashed,this.term&&this.term,this.loading=!0,this.$apollo.query({query:V`
            query($filter: ElementFilter, $sort: [QueryElementsSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              elements(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  type
                  data
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:t,page:this.page,limit:this.limit,sort:[this.sort],trashed:e,publish:s}}).then(o=>{var n;if(o.errors)throw o.errors;const i=o.data.elements||{};return this.last=((n=i.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...i.data||[]].map(d=>{var v,p,E,b,A,L;const r=(v=d.latest)!=null&&v.data?JSON.parse((p=d.latest)==null?void 0:p.data):{...d,data:JSON.parse(d.data||"{}")};return Object.assign(r,{id:d.id,deleted_at:d.deleted_at,created_at:d.created_at,updated_at:((E=d.latest)==null?void 0:E.created_at)||d.updated_at,editor:((b=d.latest)==null?void 0:b.editor)||d.editor,published:((A=d.latest)==null?void 0:A.published)??!0,publish_at:((L=d.latest)==null?void 0:L.publish_at)||null,latest:d.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(o=>{this.messages.add("Error fetching shared elements","error"),this.$log("ElementListItems::search(): Error fetching shared element",o)})},title(s){const e=[];return s.publish_at&&e.push("Publish at: "+new Date(s.publish_at).toLocaleDateString()),e.join(`
`)},toggle(){this.items.forEach(s=>{s._checked=!s._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},ie={class:"header"},ne={class:"bulk"},de={class:"search"},oe={class:"layout"},ue=["onClick","title"],he={class:"item-text"},me={key:1,class:"item-lang"},pe={class:"item-title"},ce={class:"item-type item-subtitle"},fe={class:"item-aux"},ge={class:"item-editor"},_e={class:"item-modified item-subtitle"},ve={key:0,class:"loading"},be={key:1,class:"notfound"},ke={key:3,class:"btn-group"};function ye(s,e,t,o,i,n){const d=Z("SchemaItems");return u(),_(C,null,[c("div",ie,[c("div",ne,[l(O,{modelValue:i.checked,"onUpdate:modelValue":e[0]||(e[0]=r=>i.checked=r),onClick:e[1]||(e[1]=W(r=>n.toggle(),["stop"]))},null,8,["modelValue"]),l(S,{location:"bottom left"},{activator:a(({props:r})=>[l(m,D({"append-icon":"mdi-menu-down",variant:"text"},r),{default:a(()=>e[17]||(e[17]=[h("Actions")])),_:2,__:[17]},1040)]),default:a(()=>[l(T,null,{default:a(()=>[x(l(f,null,{default:a(()=>[l(m,{"prepend-icon":"mdi-publish",variant:"text",onClick:e[2]||(e[2]=r=>n.publish())},{default:a(()=>e[18]||(e[18]=[h("Publish")])),_:1,__:[18]})]),_:1},512),[[I,n.isChecked&&o.auth.can("element:publish")]]),!this.embed&&o.auth.can("element:add")?(u(),g(f,{key:0},{default:a(()=>[l(m,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:e[3]||(e[3]=r=>i.vschemas=!0)},{default:a(()=>e[19]||(e[19]=[h("Add element")])),_:1,__:[19]})]),_:1})):k("",!0),x(l(f,null,{default:a(()=>[l(m,{"prepend-icon":"mdi-delete",variant:"text",onClick:e[4]||(e[4]=r=>n.drop())},{default:a(()=>e[20]||(e[20]=[h("Trash")])),_:1,__:[20]})]),_:1},512),[[I,n.canTrash&&o.auth.can("element:drop")]]),x(l(f,null,{default:a(()=>[l(m,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:e[5]||(e[5]=r=>n.keep())},{default:a(()=>e[21]||(e[21]=[h("Restore")])),_:1,__:[21]})]),_:1},512),[[I,n.isTrashed&&o.auth.can("element:keep")]]),x(l(f,null,{default:a(()=>[l(m,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:e[6]||(e[6]=r=>n.purge())},{default:a(()=>e[22]||(e[22]=[h("Purge")])),_:1,__:[22]})]),_:1},512),[[I,n.isChecked&&o.auth.can("element:purge")]])]),_:1})]),_:1})]),c("div",de,[l(z,{modelValue:i.term,"onUpdate:modelValue":e[7]||(e[7]=r=>i.term=r),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:"Search for","hide-details":"",clearable:""},null,8,["modelValue"])]),c("div",oe,[l(S,null,{activator:a(({props:r})=>[l(m,D({"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text",location:"bottom right"},r),{default:a(()=>{var v,p,E;return[h(y(((v=i.sort)==null?void 0:v.column)==="ID"?((p=i.sort)==null?void 0:p.order)==="DESC"?"Latest":"Oldest":((E=i.sort)==null?void 0:E.column)||""),1)]}),_:2},1040)]),default:a(()=>[l(T,null,{default:a(()=>[l(f,null,{default:a(()=>[l(m,{variant:"text",onClick:e[8]||(e[8]=r=>i.sort={column:"ID",order:"DESC"})},{default:a(()=>e[23]||(e[23]=[h("Latest")])),_:1,__:[23]})]),_:1}),l(f,null,{default:a(()=>[l(m,{variant:"text",onClick:e[9]||(e[9]=r=>i.sort={column:"ID",order:"ASC"})},{default:a(()=>e[24]||(e[24]=[h("Oldest")])),_:1,__:[24]})]),_:1}),l(f,null,{default:a(()=>[l(m,{variant:"text",onClick:e[10]||(e[10]=r=>i.sort={column:"NAME",order:"ASC"})},{default:a(()=>e[25]||(e[25]=[h("Name")])),_:1,__:[25]})]),_:1}),l(f,null,{default:a(()=>[l(m,{variant:"text",onClick:e[11]||(e[11]=r=>i.sort={column:"TYPE",order:"ASC"})},{default:a(()=>e[26]||(e[26]=[h("Type")])),_:1,__:[26]})]),_:1}),l(f,null,{default:a(()=>[l(m,{variant:"text",onClick:e[12]||(e[12]=r=>i.sort={column:"EDITOR",order:"ASC"})},{default:a(()=>e[27]||(e[27]=[h("Editor")])),_:1,__:[27]})]),_:1})]),_:1})]),_:1})])]),l(T,{class:"items"},{default:a(()=>[(u(!0),_(C,null,w(i.items,(r,v)=>(u(),g(f,{key:v},{default:a(()=>[l(O,{modelValue:r._checked,"onUpdate:modelValue":p=>r._checked=p,class:P([{draft:!r.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),l(S,null,{activator:a(({props:p})=>[l(m,D({class:"item-menu",icon:"mdi-dots-vertical",variant:"text",ref_for:!0},p),null,16)]),default:a(()=>[l(T,null,{default:a(()=>[x(l(f,null,{default:a(()=>[l(m,{"prepend-icon":"mdi-publish",variant:"text",onClick:p=>n.publish(r)},{default:a(()=>e[28]||(e[28]=[h("Publish")])),_:2,__:[28]},1032,["onClick"])]),_:2},1536),[[I,!r.deleted_at&&!r.published&&this.auth.can("element:publish")]]),!r.deleted_at&&this.auth.can("element:drop")?(u(),g(f,{key:0},{default:a(()=>[l(m,{"prepend-icon":"mdi-delete",variant:"text",onClick:p=>n.drop(r)},{default:a(()=>e[29]||(e[29]=[h("Trash")])),_:2,__:[29]},1032,["onClick"])]),_:2},1024)):k("",!0),r.deleted_at&&this.auth.can("element:keep")?(u(),g(f,{key:1},{default:a(()=>[l(m,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:p=>n.keep(r)},{default:a(()=>e[30]||(e[30]=[h("Restore")])),_:2,__:[30]},1032,["onClick"])]),_:2},1024)):k("",!0),this.auth.can("element:purge")?(u(),g(f,{key:2},{default:a(()=>[l(m,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:p=>n.purge(r)},{default:a(()=>e[31]||(e[31]=[h("Purge")])),_:2,__:[31]},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024),c("div",{class:P(["item-content",{trashed:r.deleted_at}]),onClick:p=>s.$emit("select",r),title:n.title(r)},[c("div",he,[r.publish_at?(u(),g(K,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):k("",!0),r.lang?(u(),_("span",me,y(r.lang),1)):k("",!0),c("span",pe,y(r.name),1),c("div",ce,y(r.type),1)]),c("div",fe,[c("div",ge,y(r.editor),1),c("div",_e,y(new Date(r.updated_at).toLocaleString()),1)])],10,ue)]),_:2},1024))),128))]),_:1}),i.loading?(u(),_("p",ve,e[32]||(e[32]=[h(" Loading "),c("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[c("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),c("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),c("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1)]))):k("",!0),!i.loading&&!i.items.length?(u(),_("p",be," No items found ")):k("",!0),i.last>1?(u(),g(G,{key:2,modelValue:i.page,"onUpdate:modelValue":e[13]||(e[13]=r=>i.page=r),length:i.last},null,8,["modelValue","length"])):k("",!0),!this.embed&&this.auth.can("element:add")?(u(),_("div",ke,[l(m,{onClick:e[14]||(e[14]=r=>i.vschemas=!0),icon:"mdi-view-grid-plus",color:"primary",elevation:"0"})])):k("",!0),(u(),g(Y,{to:"body"},[l(Q,{modelValue:i.vschemas,"onUpdate:modelValue":e[16]||(e[16]=r=>i.vschemas=r),scrollable:"",width:"auto"},{default:a(()=>[l(d,{type:"content",onAdd:e[15]||(e[15]=r=>n.add(r))})]),_:1},8,["modelValue"])]))],64)}const xe=$(le,[["render",ye],["__scopeId","data-v-cfbaa6b8"]]);export{xe as E,Ce as F,ae as S,Ve as u};
