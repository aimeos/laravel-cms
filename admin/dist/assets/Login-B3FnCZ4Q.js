import{_ as h,b as g,w as t,h as f,aI as n,aK as p,b5 as l,au as w,a0 as V,o as $,a as r,a4 as b,a5 as v,aN as y,E as u,i as C,l as o,t as i,b6 as c,aO as S,aX as A,j as k}from"../index.js";const F={data:()=>({creds:{email:"",password:""},form:null,error:null,loading:!1,login:!1,show:!1}),setup(){const e=w();return{auth:V(),messages:e}},created(){this.auth.isAuthenticated().then(e=>{if(!e)throw e;l.replace(this.next())}).catch(e=>{this.login=!0})},methods:{cmslogin(){if(!this.creds.email||!this.creds.password)return!1;this.error=null,this.loading=!0,this.auth.login(this.creds.email,this.creds.password).then(e=>{Object.values(e.permission||{}).some(s=>s===!0)?l.replace(this.next()):this.error=this.$gettext("Not a CMS editor")}).catch(e=>{this.error=e.message}).finally(()=>{this.loading=!1})},next(){var s;const e=this.auth.intended()||((s=l.getRoutes().find(d=>this.auth.can(d.name)))==null?void 0:s.path);return e||this.messages.add(this.$gettext("Access denied"),"error"),e||"/"}}};function M(e,s,d,N,B,m){return $(),g(p,{class:n(["login",{show:e.login}]),modelValue:e.form,"onUpdate:modelValue":s[4]||(s[4]=a=>e.form=a),onSubmit:s[5]||(s[5]=f(a=>m.cmslogin(),["prevent"]))},{default:t(()=>[r(b,{loading:e.loading,class:n(["elevation-2",{error:e.error}])},{title:t(()=>[o(i(e.$gettext("Login")),1)]),default:t(()=>[r(v,null,{default:t(()=>[r(u,{modelValue:e.creds.email,"onUpdate:modelValue":s[0]||(s[0]=a=>e.creds.email=a),label:e.$gettext("E-Mail"),variant:"underlined","validate-on":"blur",rules:[a=>!!a||e.$gettext("Field is required"),a=>!!a.match(/.+@.+/)||e.$gettext("Invalid e-mail address")],autocomplete:"username",autofocus:""},null,8,["modelValue","label","rules"]),r(u,{modelValue:e.creds.password,"onUpdate:modelValue":s[3]||(s[3]=a=>e.creds.password=a),type:e.show?"text":"password",label:e.$gettext("Password"),variant:"underlined",rules:[a=>!!a||e.$gettext("Field is required")],autocomplete:"current-password"},{"append-inner":t(()=>[r(C,{onClick:s[1]||(s[1]=a=>e.show=!e.show),onKeydown:s[2]||(s[2]=a=>[13,32].includes(a.keyCode)?e.show=!e.show:!1)},{default:t(()=>[o(i(e.show?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1},8,["modelValue","type","label","rules"]),y(r(c,{color:"error",icon:"mdi-alert-octagon",text:e.$gettext("Error")+": "+e.error},null,8,["text"]),[[S,e.error]])]),_:1}),r(A,null,{default:t(()=>[r(k,{type:"submit",variant:"outlined",disabled:e.form!=!0},{default:t(()=>[o(i(e.$gettext("Login")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["loading","class"])]),_:1},8,["class","modelValue"])}const I=h(F,[["render",M]]);export{I as default};
