import{_ as $,c as v,a1 as x,F as C,o as u,as as P,a as l,b as g,w as r,j as h,t as y,a7 as F,a8 as N,aN as U,aS as j,b5 as B,aT as M,b6 as q,ap as R,a3 as m,f as c,I as V,an as H,$ as J,d as k,h as W,aF as L,G as S,D as z,aG as T,b7 as G,ao as Q,T as Y,r as Z,aw as I,aH as f,ay as w,E as D,i as K}from"../index.js";const X={props:{data:{type:Object,default:()=>{}},files:{type:Array,default:()=>[]},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},fields:{type:Object,required:!0}},emits:["change","error","update:files"],data(){return{errors:{}}},methods:{addFile(s){const e=Array.isArray(s)?s:[s],t=[...this.files];t.push(...e),this.$emit("update:files",t)},error(s,e){this.errors[s]=e,this.$emit("error",Object.values(this.errors).includes(!0))},removeFile(s){const e=Array.isArray(s)?s:[s],t=[...this.files];for(const o of e){const i=t.findIndex(d=>d===o);i!==-1&&t.splice(i,1)}this.$emit("update:files",t)},update(s,e){this.data[s]=e,this.$emit("change",this.data[s])},validate(){var e;const s=[];return(e=this.$refs.field)==null||e.forEach(t=>{s.push(t.validate())}),Promise.all(s).then(t=>t.every(o=>o))}}};function ee(s,e,t,o,i,d){return u(!0),v(C,null,x(t.fields,(n,a)=>{var _,p,E;return u(),v("div",{key:a,class:P(["item",{error:i.errors[a]}])},[l(F,null,{default:r(()=>[h(y(n.label||a),1)]),_:2},1024),(u(),g(N(((p=(_=n.type)==null?void 0:_.charAt(0))==null?void 0:p.toUpperCase())+((E=n.type)==null?void 0:E.slice(1))),{ref_for:!0,ref:"field",assets:t.assets,config:n,readonly:t.readonly,modelValue:t.data[a],onAddFile:e[0]||(e[0]=b=>d.addFile(b)),onRemoveFile:e[1]||(e[1]=b=>d.removeFile(b)),"onUpdate:modelValue":b=>d.update(a,b),onError:b=>d.error(a,b)},null,40,["assets","config","readonly","modelValue","onUpdate:modelValue","onError"]))],2)}),128)}const Ve=$(X,[["render",ee],["__scopeId","data-v-98b151f1"]]),te=function(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",e=new Date("2025-01-01T00:00:00Z").getTime();let t=0;return function(){t=(t+1)%16;const i=Math.floor(Date.now()-e)>>8<<4|t;return Array.from({length:6},(d,n)=>s[i>>6*(5-n)&63]).join("")}}(),se={props:{type:{type:String,required:!0}},emits:["add"],data:()=>({tab:["basic"]}),setup(){return{schemas:U()}},computed:{groups(){const s={};for(const e of Object.values(this.schemas[this.type]||{})){const t=e.group||"uncategorized";s[t]=s[t]||[],s[t].push(e)}return s}},methods:{add(s){this.$emit("add",{cid:te(),type:s.type,data:{}})}}},ae=["innerHTML"];function re(s,e,t,o,i,d){return u(),v(C,null,[l(j,{modelValue:s.tab,"onUpdate:modelValue":e[0]||(e[0]=n=>s.tab=n)},{default:r(()=>[(u(!0),v(C,null,x(d.groups,(n,a)=>(u(),g(M,{key:a,value:a},{default:r(()=>[h(y(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(B,{modelValue:s.tab,"onUpdate:modelValue":e[1]||(e[1]=n=>s.tab=n)},{default:r(()=>[(u(!0),v(C,null,x(Object.keys(d.groups),n=>(u(),g(q,{key:n,value:n},{default:r(()=>[l(R,null,{default:r(()=>[(u(!0),v(C,null,x(d.groups[n],a=>(u(),g(m,{key:a.type,onClick:_=>d.add(a),variant:"text",stacked:""},{prepend:r(()=>[c("span",{class:"icon",innerHTML:a.icon},null,8,ae)]),default:r(()=>[h(" "+y(a.type),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],64)}const le=$(se,[["render",re],["__scopeId","data-v-bf1f155b"]]),ie={components:{SchemaItems:le},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,vschemas:!1,checked:!1,loading:!0,trash:!1}},setup(){const s=H();return{auth:J(),messages:s}},created(){this.search(),this.searchd=this.debounce(this.search,500)},computed:{canTrash(){return this.items.some(s=>s._checked&&!s.deleted_at)},isChecked(){return this.items.some(s=>s._checked)},isTrashed(){return this.items.some(s=>s._checked&&s.deleted_at)}},methods:{add(s){if(this.embed||!this.auth.can("element:add")){this.messages.add("Permission denied","error");return}return this.$apollo.mutate({mutation:V`mutation($input: ElementInput!) {
            addElement(input: $input) {
              id
              lang
              name
              type
              data
              editor
              created_at
              updated_at
              deleted_at
            }
          }`,variables:{input:{type:s.type,name:"New shared element",data:"{}"}}}).then(e=>{var o;if(e.errors)throw e.errors;const t=((o=e.data)==null?void 0:o.addElement)||{};return t.data=JSON.parse(t.data)||{},t.published=!0,this.vschemas=!1,this.items.unshift(t),this.$emit("select",t),this.invalidate(),t}).catch(e=>{this.$log("ElementListItems::add(): Error adding shared element",e)})},debounce(s,e){let t;return function(...o){return new Promise((i,d)=>{const n=this;clearTimeout(t),t=setTimeout(()=>{try{i(s.apply(n,o))}catch(a){d(a)}},e)})}},drop(s){if(!this.auth.can("element:drop")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked);e.length&&this.$apollo.mutate({mutation:V`
            mutation($id: [ID!]!) {
              dropElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error trashing shared element","error"),this.$log("ElementListItems::drop(): Error trashing shared element",e,t)})},invalidate(){const s=this.$apollo.provider.defaultClient.cache;s.evict({id:"ROOT_QUERY",fieldName:"elements"}),s.gc()},keep(s){if(!this.auth.can("element:keep")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked);e.length&&this.$apollo.mutate({mutation:V`
            mutation($id: [ID!]!) {
              keepElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;e.forEach(o=>{o.deleted_at=null}),this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error restoring shared element","error"),this.$log("ElementListItems::keep(): Error restoring shared element",e,t)})},publish(s){if(!this.auth.can("element:publish")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked&&t.id&&!t.published);e.length&&this.$apollo.mutate({mutation:V`mutation ($id: [ID!]!) {
            pubElement(id: $id) {
              id
            }
          }`,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;e.forEach(o=>{o.published=!0,o._checked=!1}),this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error publishing shared element","error"),this.$log("ElementListItems::publish(): Error publishing shared element",e,t)})},purge(s){if(!this.auth.can("element:purge")){this.messages.add("Permission denied","error");return}const e=s?[s]:this.items.filter(t=>t._checked);e.length&&this.$apollo.mutate({mutation:V`
            mutation($id: [ID!]!) {
              purgeElement(id: $id) {
                id
              }
            }
          `,variables:{id:e.map(t=>t.id)}}).then(t=>{if(t.errors)throw t.errors;this.invalidate(),this.search()}).catch(t=>{this.messages.add("Error purging shared element","error"),this.$log("ElementListItems::purge(): Error purging shared element",e,t)})},search(){if(!this.auth.can("element:view"))return this.messages.add("Permission denied","error"),Promise.resolve([]);const s=this.filter.publish||null,e=this.filter.trashed||"WITHOUT",t={...this.filter};return delete t.publish,delete t.trashed,this.term&&this.term,this.loading=!0,this.$apollo.query({query:V`
            query($filter: ElementFilter, $sort: [QueryElementsSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              elements(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  type
                  data
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:t,page:this.page,limit:this.limit,sort:[this.sort],trashed:e,publish:s}}).then(o=>{var d;if(o.errors)throw o.errors;const i=o.data.elements||{};return this.last=((d=i.paginatorInfo)==null?void 0:d.lastPage)||1,this.items=[...i.data||[]].map(n=>{var _,p,E,b,O,A;const a=(_=n.latest)!=null&&_.data?JSON.parse((p=n.latest)==null?void 0:p.data):{...n,data:JSON.parse(n.data||"{}")};return Object.assign(a,{id:n.id,deleted_at:n.deleted_at,created_at:n.created_at,updated_at:((E=n.latest)==null?void 0:E.created_at)||n.updated_at,editor:((b=n.latest)==null?void 0:b.editor)||n.editor,published:((O=n.latest)==null?void 0:O.published)??!0,publish_at:((A=n.latest)==null?void 0:A.publish_at)||null,latest:n.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(o=>{this.messages.add("Error fetching shared elements","error"),this.$log("ElementListItems::search(): Error fetching shared element",o)})},title(s){const e=[];return s.publish_at&&e.push("Publish at: "+new Date(s.publish_at).toLocaleDateString()),e.join(`
`)},toggle(){this.items.forEach(s=>{s._checked=!s._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},ne={class:"header"},de={class:"bulk"},oe={class:"search"},ue={class:"layout"},he=["onClick","title"],me={class:"item-text"},pe={key:1,class:"item-lang"},ce={class:"item-title"},fe={class:"item-type item-subtitle"},ge={class:"item-aux"},ve={class:"item-editor"},_e={class:"item-modified item-subtitle"},be={key:0,class:"loading"},ke={key:1,class:"notfound"},ye={key:3,class:"btn-group"};function Ee(s,e,t,o,i,d){const n=Z("SchemaItems");return u(),v(C,null,[c("div",ne,[c("div",de,[l(L,{modelValue:i.checked,"onUpdate:modelValue":e[0]||(e[0]=a=>i.checked=a),onClick:e[1]||(e[1]=W(a=>d.toggle(),["stop"]))},null,8,["modelValue"]),l(S,{location:"bottom left"},{activator:r(({props:a})=>[l(m,D({"append-icon":"mdi-menu-down",variant:"text"},a),{default:r(()=>e[17]||(e[17]=[h("Actions")])),_:2,__:[17]},1040)]),default:r(()=>[l(T,null,{default:r(()=>[I(l(f,null,{default:r(()=>[l(m,{"prepend-icon":"mdi-publish",variant:"text",onClick:e[2]||(e[2]=a=>d.publish())},{default:r(()=>e[18]||(e[18]=[h("Publish")])),_:1,__:[18]})]),_:1},512),[[w,d.isChecked&&o.auth.can("element:publish")]]),!this.embed&&o.auth.can("element:add")?(u(),g(f,{key:0},{default:r(()=>[l(m,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:e[3]||(e[3]=a=>i.vschemas=!0)},{default:r(()=>e[19]||(e[19]=[h("Add element")])),_:1,__:[19]})]),_:1})):k("",!0),I(l(f,null,{default:r(()=>[l(m,{"prepend-icon":"mdi-delete",variant:"text",onClick:e[4]||(e[4]=a=>d.drop())},{default:r(()=>e[20]||(e[20]=[h("Trash")])),_:1,__:[20]})]),_:1},512),[[w,d.canTrash&&o.auth.can("element:drop")]]),I(l(f,null,{default:r(()=>[l(m,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:e[5]||(e[5]=a=>d.keep())},{default:r(()=>e[21]||(e[21]=[h("Restore")])),_:1,__:[21]})]),_:1},512),[[w,d.isTrashed&&o.auth.can("element:keep")]]),I(l(f,null,{default:r(()=>[l(m,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:e[6]||(e[6]=a=>d.purge())},{default:r(()=>e[22]||(e[22]=[h("Purge")])),_:1,__:[22]})]),_:1},512),[[w,d.isChecked&&o.auth.can("element:purge")]])]),_:1})]),_:1})]),c("div",oe,[l(z,{modelValue:i.term,"onUpdate:modelValue":e[7]||(e[7]=a=>i.term=a),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:"Search for","hide-details":"",clearable:""},null,8,["modelValue"])]),c("div",ue,[l(S,null,{activator:r(({props:a})=>[l(m,D({"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text",location:"bottom right"},a),{default:r(()=>{var _,p,E;return[h(y(((_=i.sort)==null?void 0:_.column)==="ID"?((p=i.sort)==null?void 0:p.order)==="DESC"?"Latest":"Oldest":((E=i.sort)==null?void 0:E.column)||""),1)]}),_:2},1040)]),default:r(()=>[l(T,null,{default:r(()=>[l(f,null,{default:r(()=>[l(m,{variant:"text",onClick:e[8]||(e[8]=a=>i.sort={column:"ID",order:"DESC"})},{default:r(()=>e[23]||(e[23]=[h("Latest")])),_:1,__:[23]})]),_:1}),l(f,null,{default:r(()=>[l(m,{variant:"text",onClick:e[9]||(e[9]=a=>i.sort={column:"ID",order:"ASC"})},{default:r(()=>e[24]||(e[24]=[h("Oldest")])),_:1,__:[24]})]),_:1}),l(f,null,{default:r(()=>[l(m,{variant:"text",onClick:e[10]||(e[10]=a=>i.sort={column:"NAME",order:"ASC"})},{default:r(()=>e[25]||(e[25]=[h("Name")])),_:1,__:[25]})]),_:1}),l(f,null,{default:r(()=>[l(m,{variant:"text",onClick:e[11]||(e[11]=a=>i.sort={column:"TYPE",order:"ASC"})},{default:r(()=>e[26]||(e[26]=[h("Type")])),_:1,__:[26]})]),_:1}),l(f,null,{default:r(()=>[l(m,{variant:"text",onClick:e[12]||(e[12]=a=>i.sort={column:"EDITOR",order:"ASC"})},{default:r(()=>e[27]||(e[27]=[h("Editor")])),_:1,__:[27]})]),_:1})]),_:1})]),_:1})])]),l(T,{class:"items"},{default:r(()=>[(u(!0),v(C,null,x(i.items,(a,_)=>(u(),g(f,{key:_},{default:r(()=>[l(L,{modelValue:a._checked,"onUpdate:modelValue":p=>a._checked=p,class:P([{draft:!a.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),l(S,null,{activator:r(({props:p})=>[l(m,D({class:"item-menu",icon:"mdi-dots-vertical",variant:"text",ref_for:!0},p),null,16)]),default:r(()=>[l(T,null,{default:r(()=>[I(l(f,null,{default:r(()=>[l(m,{"prepend-icon":"mdi-publish",variant:"text",onClick:p=>d.publish(a)},{default:r(()=>e[28]||(e[28]=[h("Publish")])),_:2,__:[28]},1032,["onClick"])]),_:2},1536),[[w,!a.deleted_at&&!a.published&&this.auth.can("element:publish")]]),!a.deleted_at&&this.auth.can("element:drop")?(u(),g(f,{key:0},{default:r(()=>[l(m,{"prepend-icon":"mdi-delete",variant:"text",onClick:p=>d.drop(a)},{default:r(()=>e[29]||(e[29]=[h("Trash")])),_:2,__:[29]},1032,["onClick"])]),_:2},1024)):k("",!0),a.deleted_at&&this.auth.can("element:keep")?(u(),g(f,{key:1},{default:r(()=>[l(m,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:p=>d.keep(a)},{default:r(()=>e[30]||(e[30]=[h("Restore")])),_:2,__:[30]},1032,["onClick"])]),_:2},1024)):k("",!0),this.auth.can("element:purge")?(u(),g(f,{key:2},{default:r(()=>[l(m,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:p=>d.purge(a)},{default:r(()=>e[31]||(e[31]=[h("Purge")])),_:2,__:[31]},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024),c("div",{class:P(["item-content",{trashed:a.deleted_at}]),onClick:p=>s.$emit("select",a),title:d.title(a)},[c("div",me,[a.publish_at?(u(),g(K,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):k("",!0),a.lang?(u(),v("span",pe,y(a.lang),1)):k("",!0),c("span",ce,y(a.name),1),c("div",fe,y(a.type),1)]),c("div",ge,[c("div",ve,y(a.editor),1),c("div",_e,y(new Date(a.updated_at).toLocaleString()),1)])],10,he)]),_:2},1024))),128))]),_:1}),i.loading?(u(),v("p",be,e[32]||(e[32]=[h(" Loading "),c("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[c("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),c("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),c("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1)]))):k("",!0),!i.loading&&!i.items.length?(u(),v("p",ke," No items found ")):k("",!0),i.last>1?(u(),g(G,{key:2,modelValue:i.page,"onUpdate:modelValue":e[13]||(e[13]=a=>i.page=a),length:i.last},null,8,["modelValue","length"])):k("",!0),!this.embed&&this.auth.can("element:add")?(u(),v("div",ye,[l(m,{onClick:e[14]||(e[14]=a=>i.vschemas=!0),icon:"mdi-view-grid-plus",color:"primary",elevation:"0"})])):k("",!0),(u(),g(Y,{to:"body"},[l(Q,{modelValue:i.vschemas,"onUpdate:modelValue":e[16]||(e[16]=a=>i.vschemas=a),scrollable:"",width:"auto"},{default:r(()=>[l(n,{type:"content",onAdd:e[15]||(e[15]=a=>d.add(a))})]),_:1},8,["modelValue"])]))],64)}const Ie=$(ie,[["render",Ee],["__scopeId","data-v-cfbaa6b8"]]);export{Ie as E,Ve as F,le as S,te as u};
