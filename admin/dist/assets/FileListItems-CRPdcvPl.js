import{_ as It,J as F,a0 as Vt,b as O,w as f,ax as Ne,o as b,a as p,ay as Se,aa as ei,d as T,ab as Lt,ac as Pt,l as k,t as g,ad as Bt,az as zt,f as v,c as A,F as it,a2 as ft,aA as ii,aB as ai,a1 as Ae,V as Yt,e as Et,E as Ie,ak as ri,j as x,ae as si,a6 as Ve,a7 as Ht,aC as Re,aD as Wt,Z as ni,au as _e,aE as oi,aF as li,aG as hi,r as kt,T as di,aH as ui,aI as lt,H as Nt,X as ci,aJ as fi,G as St,h as jt,i as $e,aK as pi,aL as ce,a8 as Mt,aM as mi,a9 as P,aN as gi,aO as vi,$ as bi}from"../index.js";import{H as wi,A as yi}from"./HistoryDialog-BhGSg-LU.js";const xi={props:{item:{type:Object,required:!0}},emits:[],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:Vt()}},watch:{item:{immediate:!0,handler(i){!i.id||!this.auth.can("file:view")||this.$apollo.query({query:F`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:i.id}}).then(t=>{var e,a,n;if(t.errors)throw t.errors;this.file=((e=t.data)==null?void 0:e.file)||{},this.versions=(((n=(a=t.data)==null?void 0:a.file)==null?void 0:n.byversions)||[]).map(r=>({id:r.versionable_id,type:r.versionable_type.split("\\").at(-1),published:r.published?this.$gettext("yes"):r.publish_at?new Date(r.publish_at).toLocaleDateString():this.$gettext("no")})).filter(r=>this.auth.can(r.type.toLowerCase()+":view"))}).catch(t=>{this.$log("FileDetailRef::watch(item): Error fetching file",i,t)})}}}};function Di(i,t,e,a,n,r){return b(),O(Ne,null,{default:f(()=>[p(Se,null,{default:f(()=>[p(ei,{modelValue:i.panel,"onUpdate:modelValue":t[0]||(t[0]=s=>i.panel=s),elevation:"0",multiple:""},{default:f(()=>{var s,l,u;return[(s=i.file.bypages)!=null&&s.length&&a.auth.can("page:view")?(b(),O(Lt,{key:0},{default:f(()=>[p(Pt,null,{default:f(()=>[k(g(i.$gettext("Pages")),1)]),_:1}),p(Bt,null,{default:f(()=>[p(zt,{density:"comfortable",hover:""},{default:f(()=>[v("thead",null,[v("tr",null,[v("th",null,g(i.$gettext("ID")),1),v("th",null,g(i.$gettext("URL")),1),v("th",null,g(i.$gettext("Name")),1)])]),v("tbody",null,[(b(!0),A(it,null,ft(i.file.bypages,h=>(b(),A("tr",{key:h.id},[v("td",null,g(h.id),1),v("td",null,g(h.path),1),v("td",null,g(h.name),1)]))),128))])]),_:1})]),_:1})]),_:1})):T("",!0),(l=i.file.byelements)!=null&&l.length&&a.auth.can("element:view")?(b(),O(Lt,{key:1},{default:f(()=>[p(Pt,null,{default:f(()=>[k(g(i.$gettext("Elements")),1)]),_:1}),p(Bt,null,{default:f(()=>[p(zt,{density:"comfortable",hover:""},{default:f(()=>[v("thead",null,[v("tr",null,[v("th",null,g(i.$gettext("ID")),1),v("th",null,g(i.$gettext("Type")),1),v("th",null,g(i.$gettext("Name")),1)])]),v("tbody",null,[(b(!0),A(it,null,ft(i.file.byelements,h=>(b(),A("tr",{key:h.id},[v("td",null,g(h.id),1),v("td",null,g(h.type),1),v("td",null,g(h.name),1)]))),128))])]),_:1})]),_:1})]),_:1})):T("",!0),(u=i.versions)!=null&&u.length?(b(),O(Lt,{key:2},{default:f(()=>[p(Pt,null,{default:f(()=>[k(g(i.$gettext("Versions")),1)]),_:1}),p(Bt,null,{default:f(()=>[p(zt,{density:"comfortable",hover:""},{default:f(()=>[v("thead",null,[v("tr",null,[v("th",null,g(i.$gettext("ID")),1),v("th",null,g(i.$gettext("Type")),1),v("th",null,g(i.$gettext("Published")),1)])]),v("tbody",null,[(b(!0),A(it,null,ft(i.versions,h=>(b(),A("tr",{key:h.id},[v("td",null,g(h.id),1),v("td",null,g(h.type),1),v("td",null,g(h.published),1)]))),128))])]),_:1})]),_:1})]),_:1})):T("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ci=It(xi,[["render",Di],["__scopeId","data-v-2a9c7939"]]);/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function fe(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),e.push.apply(e,a)}return e}function Le(i){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fe(Object(e),!0).forEach(function(a){Ti(i,a,e[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):fe(Object(e)).forEach(function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(e,a))})}return i}function Ei(i,t){if(typeof i!="object"||!i)return i;var e=i[Symbol.toPrimitive];if(e!==void 0){var a=e.call(i,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function Pe(i){var t=Ei(i,"string");return typeof t=="symbol"?t:t+""}function Ft(i){"@babel/helpers - typeof";return Ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(i)}function ki(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(i,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,Pe(a.key),a)}}function Mi(i,t,e){return t&&pe(i.prototype,t),e&&pe(i,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function Ti(i,t,e){return t=Pe(t),t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function Be(i){return Oi(i)||Ni(i)||Si(i)||Ai()}function Oi(i){if(Array.isArray(i))return qt(i)}function Ni(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Si(i,t){if(i){if(typeof i=="string")return qt(i,t);var e=Object.prototype.toString.call(i).slice(8,-1);if(e==="Object"&&i.constructor&&(e=i.constructor.name),e==="Map"||e==="Set")return Array.from(i);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return qt(i,t)}}function qt(i,t){(t==null||t>i.length)&&(t=i.length);for(var e=0,a=new Array(t);e<t;e++)a[e]=i[e];return a}function Ai(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Rt=typeof window<"u"&&typeof window.document<"u",G=Rt?window:{},ae=Rt&&G.document.documentElement?"ontouchstart"in G.document.documentElement:!1,re=Rt?"PointerEvent"in G:!1,N="cropper",se="all",ze="crop",Ye="move",Ue="zoom",nt="e",ot="w",dt="s",Z="n",gt="ne",vt="nw",bt="se",wt="sw",Gt="".concat(N,"-crop"),me="".concat(N,"-disabled"),Y="".concat(N,"-hidden"),ge="".concat(N,"-hide"),Ii="".concat(N,"-invisible"),At="".concat(N,"-modal"),Jt="".concat(N,"-move"),xt="".concat(N,"Action"),Tt="".concat(N,"Preview"),ne="crop",Xe="move",He="none",Qt="crop",Kt="cropend",Zt="cropmove",te="cropstart",ve="dblclick",Vi=ae?"touchstart":"mousedown",Ri=ae?"touchmove":"mousemove",_i=ae?"touchend touchcancel":"mouseup",be=re?"pointerdown":Vi,we=re?"pointermove":Ri,ye=re?"pointerup pointercancel":_i,xe="ready",De="resize",Ce="wheel",ee="zoom",Ee="image/jpeg",$i=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Li=/^data:/,Pi=/^data:image\/jpeg;base64,/,Bi=/^img|canvas$/i,We=200,je=100,ke={viewMode:0,dragMode:ne,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:We,minContainerHeight:je,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},zi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',Yi=Number.isNaN||G.isNaN;function y(i){return typeof i=="number"&&!Yi(i)}var Me=function(t){return t>0&&t<1/0};function Ut(i){return typeof i>"u"}function ht(i){return Ft(i)==="object"&&i!==null}var Ui=Object.prototype.hasOwnProperty;function ut(i){if(!ht(i))return!1;try{var t=i.constructor,e=t.prototype;return t&&e&&Ui.call(e,"isPrototypeOf")}catch{return!1}}function z(i){return typeof i=="function"}var Xi=Array.prototype.slice;function Fe(i){return Array.from?Array.from(i):Xi.call(i)}function V(i,t){return i&&z(t)&&(Array.isArray(i)||y(i.length)?Fe(i).forEach(function(e,a){t.call(i,e,a,i)}):ht(i)&&Object.keys(i).forEach(function(e){t.call(i,i[e],e,i)})),i}var S=Object.assign||function(t){for(var e=arguments.length,a=new Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];return ht(t)&&a.length>0&&a.forEach(function(r){ht(r)&&Object.keys(r).forEach(function(s){t[s]=r[s]})}),t},Hi=/\.\d*(?:0|9){12}\d*$/;function pt(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Hi.test(i)?Math.round(i*t)/t:i}var Wi=/^width|height|left|top|marginLeft|marginTop$/;function tt(i,t){var e=i.style;V(t,function(a,n){Wi.test(n)&&y(a)&&(a="".concat(a,"px")),e[n]=a})}function ji(i,t){return i.classList?i.classList.contains(t):i.className.indexOf(t)>-1}function L(i,t){if(t){if(y(i.length)){V(i,function(a){L(a,t)});return}if(i.classList){i.classList.add(t);return}var e=i.className.trim();e?e.indexOf(t)<0&&(i.className="".concat(e," ").concat(t)):i.className=t}}function q(i,t){if(t){if(y(i.length)){V(i,function(e){q(e,t)});return}if(i.classList){i.classList.remove(t);return}i.className.indexOf(t)>=0&&(i.className=i.className.replace(t,""))}}function ct(i,t,e){if(t){if(y(i.length)){V(i,function(a){ct(a,t,e)});return}e?L(i,t):q(i,t)}}var Fi=/([a-z\d])([A-Z])/g;function oe(i){return i.replace(Fi,"$1-$2").toLowerCase()}function ie(i,t){return ht(i[t])?i[t]:i.dataset?i.dataset[t]:i.getAttribute("data-".concat(oe(t)))}function Dt(i,t,e){ht(e)?i[t]=e:i.dataset?i.dataset[t]=e:i.setAttribute("data-".concat(oe(t)),e)}function qi(i,t){if(ht(i[t]))try{delete i[t]}catch{i[t]=void 0}else if(i.dataset)try{delete i.dataset[t]}catch{i.dataset[t]=void 0}else i.removeAttribute("data-".concat(oe(t)))}var qe=/\s\s*/,Ge=function(){var i=!1;if(Rt){var t=!1,e=function(){},a=Object.defineProperty({},"once",{get:function(){return i=!0,t},set:function(r){t=r}});G.addEventListener("test",e,a),G.removeEventListener("test",e,a)}return i}();function W(i,t,e){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=e;t.trim().split(qe).forEach(function(r){if(!Ge){var s=i.listeners;s&&s[r]&&s[r][e]&&(n=s[r][e],delete s[r][e],Object.keys(s[r]).length===0&&delete s[r],Object.keys(s).length===0&&delete i.listeners)}i.removeEventListener(r,n,a)})}function H(i,t,e){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=e;t.trim().split(qe).forEach(function(r){if(a.once&&!Ge){var s=i.listeners,l=s===void 0?{}:s;n=function(){delete l[r][e],i.removeEventListener(r,n,a);for(var h=arguments.length,o=new Array(h),d=0;d<h;d++)o[d]=arguments[d];e.apply(i,o)},l[r]||(l[r]={}),l[r][e]&&i.removeEventListener(r,l[r][e],a),l[r][e]=n,i.listeners=l}i.addEventListener(r,n,a)})}function mt(i,t,e){var a;return z(Event)&&z(CustomEvent)?a=new CustomEvent(t,{detail:e,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(t,!0,!0,e)),i.dispatchEvent(a)}function Je(i){var t=i.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Xt=G.location,Gi=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Te(i){var t=i.match(Gi);return t!==null&&(t[1]!==Xt.protocol||t[2]!==Xt.hostname||t[3]!==Xt.port)}function Oe(i){var t="timestamp=".concat(new Date().getTime());return i+(i.indexOf("?")===-1?"?":"&")+t}function yt(i){var t=i.rotate,e=i.scaleX,a=i.scaleY,n=i.translateX,r=i.translateY,s=[];y(n)&&n!==0&&s.push("translateX(".concat(n,"px)")),y(r)&&r!==0&&s.push("translateY(".concat(r,"px)")),y(t)&&t!==0&&s.push("rotate(".concat(t,"deg)")),y(e)&&e!==1&&s.push("scaleX(".concat(e,")")),y(a)&&a!==1&&s.push("scaleY(".concat(a,")"));var l=s.length?s.join(" "):"none";return{WebkitTransform:l,msTransform:l,transform:l}}function Ji(i){var t=Le({},i),e=0;return V(i,function(a,n){delete t[n],V(t,function(r){var s=Math.abs(a.startX-r.startX),l=Math.abs(a.startY-r.startY),u=Math.abs(a.endX-r.endX),h=Math.abs(a.endY-r.endY),o=Math.sqrt(s*s+l*l),d=Math.sqrt(u*u+h*h),c=(d-o)/o;Math.abs(c)>Math.abs(e)&&(e=c)})}),e}function Ot(i,t){var e=i.pageX,a=i.pageY,n={endX:e,endY:a};return t?n:Le({startX:e,startY:a},n)}function Qi(i){var t=0,e=0,a=0;return V(i,function(n){var r=n.startX,s=n.startY;t+=r,e+=s,a+=1}),t/=a,e/=a,{pageX:t,pageY:e}}function et(i){var t=i.aspectRatio,e=i.height,a=i.width,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=Me(a),s=Me(e);if(r&&s){var l=e*t;n==="contain"&&l>a||n==="cover"&&l<a?e=a/t:a=e*t}else r?e=a/t:s&&(a=e*t);return{width:a,height:e}}function Ki(i){var t=i.width,e=i.height,a=i.degree;if(a=Math.abs(a)%180,a===90)return{width:e,height:t};var n=a%90*Math.PI/180,r=Math.sin(n),s=Math.cos(n),l=t*s+e*r,u=t*r+e*s;return a>90?{width:u,height:l}:{width:l,height:u}}function Zi(i,t,e,a){var n=t.aspectRatio,r=t.naturalWidth,s=t.naturalHeight,l=t.rotate,u=l===void 0?0:l,h=t.scaleX,o=h===void 0?1:h,d=t.scaleY,c=d===void 0?1:d,w=e.aspectRatio,D=e.naturalWidth,M=e.naturalHeight,C=a.fillColor,R=C===void 0?"transparent":C,$=a.imageSmoothingEnabled,I=$===void 0?!0:$,J=a.imageSmoothingQuality,U=J===void 0?"low":J,m=a.maxWidth,E=m===void 0?1/0:m,_=a.maxHeight,X=_===void 0?1/0:_,Q=a.minWidth,at=Q===void 0?0:Q,rt=a.minHeight,K=rt===void 0?0:rt,j=document.createElement("canvas"),B=j.getContext("2d"),st=et({aspectRatio:w,width:E,height:X}),Ct=et({aspectRatio:w,width:at,height:K},"cover"),_t=Math.min(st.width,Math.max(Ct.width,D)),$t=Math.min(st.height,Math.max(Ct.height,M)),le=et({aspectRatio:n,width:E,height:X}),he=et({aspectRatio:n,width:at,height:K},"cover"),de=Math.min(le.width,Math.max(he.width,r)),ue=Math.min(le.height,Math.max(he.height,s)),Ze=[-de/2,-ue/2,de,ue];return j.width=pt(_t),j.height=pt($t),B.fillStyle=R,B.fillRect(0,0,_t,$t),B.save(),B.translate(_t/2,$t/2),B.rotate(u*Math.PI/180),B.scale(o,c),B.imageSmoothingEnabled=I,B.imageSmoothingQuality=U,B.drawImage.apply(B,[i].concat(Be(Ze.map(function(ti){return Math.floor(pt(ti))})))),B.restore(),j}var Qe=String.fromCharCode;function ta(i,t,e){var a="";e+=t;for(var n=t;n<e;n+=1)a+=Qe(i.getUint8(n));return a}var ea=/^data:.*,/;function ia(i){var t=i.replace(ea,""),e=atob(t),a=new ArrayBuffer(e.length),n=new Uint8Array(a);return V(n,function(r,s){n[s]=e.charCodeAt(s)}),a}function aa(i,t){for(var e=[],a=8192,n=new Uint8Array(i);n.length>0;)e.push(Qe.apply(null,Fe(n.subarray(0,a)))),n=n.subarray(a);return"data:".concat(t,";base64,").concat(btoa(e.join("")))}function ra(i){var t=new DataView(i),e;try{var a,n,r;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var s=t.byteLength,l=2;l+1<s;){if(t.getUint8(l)===255&&t.getUint8(l+1)===225){n=l;break}l+=1}if(n){var u=n+4,h=n+10;if(ta(t,u,4)==="Exif"){var o=t.getUint16(h);if(a=o===18761,(a||o===19789)&&t.getUint16(h+2,a)===42){var d=t.getUint32(h+4,a);d>=8&&(r=h+d)}}}if(r){var c=t.getUint16(r,a),w,D;for(D=0;D<c;D+=1)if(w=r+D*12+2,t.getUint16(w,a)===274){w+=8,e=t.getUint16(w,a),t.setUint16(w,1,a);break}}}catch{e=1}return e}function sa(i){var t=0,e=1,a=1;switch(i){case 2:e=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,e=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:e,scaleY:a}}var na={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,e=this.options,a=this.container,n=this.cropper,r=Number(e.minContainerWidth),s=Number(e.minContainerHeight);L(n,Y),q(t,Y);var l={width:Math.max(a.offsetWidth,r>=0?r:We),height:Math.max(a.offsetHeight,s>=0?s:je)};this.containerData=l,tt(n,{width:l.width,height:l.height}),L(t,Y),q(n,Y)},initCanvas:function(){var t=this.containerData,e=this.imageData,a=this.options.viewMode,n=Math.abs(e.rotate)%180===90,r=n?e.naturalHeight:e.naturalWidth,s=n?e.naturalWidth:e.naturalHeight,l=r/s,u=t.width,h=t.height;t.height*l>t.width?a===3?u=t.height*l:h=t.width/l:a===3?h=t.width/l:u=t.height*l;var o={aspectRatio:l,naturalWidth:r,naturalHeight:s,width:u,height:h};this.canvasData=o,this.limited=a===1||a===2,this.limitCanvas(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.left=(t.width-o.width)/2,o.top=(t.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCanvasData=S({},o)},limitCanvas:function(t,e){var a=this.options,n=this.containerData,r=this.canvasData,s=this.cropBoxData,l=a.viewMode,u=r.aspectRatio,h=this.cropped&&s;if(t){var o=Number(a.minCanvasWidth)||0,d=Number(a.minCanvasHeight)||0;l>1?(o=Math.max(o,n.width),d=Math.max(d,n.height),l===3&&(d*u>o?o=d*u:d=o/u)):l>0&&(o?o=Math.max(o,h?s.width:0):d?d=Math.max(d,h?s.height:0):h&&(o=s.width,d=s.height,d*u>o?o=d*u:d=o/u));var c=et({aspectRatio:u,width:o,height:d});o=c.width,d=c.height,r.minWidth=o,r.minHeight=d,r.maxWidth=1/0,r.maxHeight=1/0}if(e)if(l>(h?0:1)){var w=n.width-r.width,D=n.height-r.height;r.minLeft=Math.min(0,w),r.minTop=Math.min(0,D),r.maxLeft=Math.max(0,w),r.maxTop=Math.max(0,D),h&&this.limited&&(r.minLeft=Math.min(s.left,s.left+(s.width-r.width)),r.minTop=Math.min(s.top,s.top+(s.height-r.height)),r.maxLeft=s.left,r.maxTop=s.top,l===2&&(r.width>=n.width&&(r.minLeft=Math.min(0,w),r.maxLeft=Math.max(0,w)),r.height>=n.height&&(r.minTop=Math.min(0,D),r.maxTop=Math.max(0,D))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=n.width,r.maxTop=n.height},renderCanvas:function(t,e){var a=this.canvasData,n=this.imageData;if(e){var r=Ki({width:n.naturalWidth*Math.abs(n.scaleX||1),height:n.naturalHeight*Math.abs(n.scaleY||1),degree:n.rotate||0}),s=r.width,l=r.height,u=a.width*(s/a.naturalWidth),h=a.height*(l/a.naturalHeight);a.left-=(u-a.width)/2,a.top-=(h-a.height)/2,a.width=u,a.height=h,a.aspectRatio=s/l,a.naturalWidth=s,a.naturalHeight=l,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,tt(this.canvas,S({width:a.width,height:a.height},yt({translateX:a.left,translateY:a.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var e=this.canvasData,a=this.imageData,n=a.naturalWidth*(e.width/e.naturalWidth),r=a.naturalHeight*(e.height/e.naturalHeight);S(a,{width:n,height:r,left:(e.width-n)/2,top:(e.height-r)/2}),tt(this.image,S({width:a.width,height:a.height},yt(S({translateX:a.left,translateY:a.top},a)))),t&&this.output()},initCropBox:function(){var t=this.options,e=this.canvasData,a=t.aspectRatio||t.initialAspectRatio,n=Number(t.autoCropArea)||.8,r={width:e.width,height:e.height};a&&(e.height*a>e.width?r.height=r.width/a:r.width=r.height*a),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*n),r.height=Math.max(r.minHeight,r.height*n),r.left=e.left+(e.width-r.width)/2,r.top=e.top+(e.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=S({},r)},limitCropBox:function(t,e){var a=this.options,n=this.containerData,r=this.canvasData,s=this.cropBoxData,l=this.limited,u=a.aspectRatio;if(t){var h=Number(a.minCropBoxWidth)||0,o=Number(a.minCropBoxHeight)||0,d=l?Math.min(n.width,r.width,r.width+r.left,n.width-r.left):n.width,c=l?Math.min(n.height,r.height,r.height+r.top,n.height-r.top):n.height;h=Math.min(h,n.width),o=Math.min(o,n.height),u&&(h&&o?o*u>h?o=h/u:h=o*u:h?o=h/u:o&&(h=o*u),c*u>d?c=d/u:d=c*u),s.minWidth=Math.min(h,d),s.minHeight=Math.min(o,c),s.maxWidth=d,s.maxHeight=c}e&&(l?(s.minLeft=Math.max(0,r.left),s.minTop=Math.max(0,r.top),s.maxLeft=Math.min(n.width,r.left+r.width)-s.width,s.maxTop=Math.min(n.height,r.top+r.height)-s.height):(s.minLeft=0,s.minTop=0,s.maxLeft=n.width-s.width,s.maxTop=n.height-s.height))},renderCropBox:function(){var t=this.options,e=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,t.movable&&t.cropBoxMovable&&Dt(this.face,xt,a.width>=e.width&&a.height>=e.height?Ye:se),tt(this.cropBox,S({width:a.width,height:a.height},yt({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),mt(this.element,Qt,this.getData())}},oa={initPreview:function(){var t=this.element,e=this.crossOrigin,a=this.options.preview,n=e?this.crossOriginUrl:this.url,r=t.alt||"The image to preview",s=document.createElement("img");if(e&&(s.crossOrigin=e),s.src=n,s.alt=r,this.viewBox.appendChild(s),this.viewBoxImage=s,!!a){var l=a;typeof a=="string"?l=t.ownerDocument.querySelectorAll(a):a.querySelector&&(l=[a]),this.previews=l,V(l,function(u){var h=document.createElement("img");Dt(u,Tt,{width:u.offsetWidth,height:u.offsetHeight,html:u.innerHTML}),e&&(h.crossOrigin=e),h.src=n,h.alt=r,h.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',u.innerHTML="",u.appendChild(h)})}},resetPreview:function(){V(this.previews,function(t){var e=ie(t,Tt);tt(t,{width:e.width,height:e.height}),t.innerHTML=e.html,qi(t,Tt)})},preview:function(){var t=this.imageData,e=this.canvasData,a=this.cropBoxData,n=a.width,r=a.height,s=t.width,l=t.height,u=a.left-e.left-t.left,h=a.top-e.top-t.top;!this.cropped||this.disabled||(tt(this.viewBoxImage,S({width:s,height:l},yt(S({translateX:-u,translateY:-h},t)))),V(this.previews,function(o){var d=ie(o,Tt),c=d.width,w=d.height,D=c,M=w,C=1;n&&(C=c/n,M=r*C),r&&M>w&&(C=w/r,D=n*C,M=w),tt(o,{width:D,height:M}),tt(o.getElementsByTagName("img")[0],S({width:s*C,height:l*C},yt(S({translateX:-u*C,translateY:-h*C},t))))}))}},la={bind:function(){var t=this.element,e=this.options,a=this.cropper;z(e.cropstart)&&H(t,te,e.cropstart),z(e.cropmove)&&H(t,Zt,e.cropmove),z(e.cropend)&&H(t,Kt,e.cropend),z(e.crop)&&H(t,Qt,e.crop),z(e.zoom)&&H(t,ee,e.zoom),H(a,be,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&H(a,Ce,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&H(a,ve,this.onDblclick=this.dblclick.bind(this)),H(t.ownerDocument,we,this.onCropMove=this.cropMove.bind(this)),H(t.ownerDocument,ye,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&H(window,De,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.options,a=this.cropper;z(e.cropstart)&&W(t,te,e.cropstart),z(e.cropmove)&&W(t,Zt,e.cropmove),z(e.cropend)&&W(t,Kt,e.cropend),z(e.crop)&&W(t,Qt,e.crop),z(e.zoom)&&W(t,ee,e.zoom),W(a,be,this.onCropStart),e.zoomable&&e.zoomOnWheel&&W(a,Ce,this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&W(a,ve,this.onDblclick),W(t.ownerDocument,we,this.onCropMove),W(t.ownerDocument,ye,this.onCropEnd),e.responsive&&W(window,De,this.onResize)}},ha={resize:function(){if(!this.disabled){var t=this.options,e=this.container,a=this.containerData,n=e.offsetWidth/a.width,r=e.offsetHeight/a.height,s=Math.abs(n-1)>Math.abs(r-1)?n:r;if(s!==1){var l,u;t.restore&&(l=this.getCanvasData(),u=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(V(l,function(h,o){l[o]=h*s})),this.setCropBoxData(V(u,function(h,o){u[o]=h*s})))}}},dblclick:function(){this.disabled||this.options.dragMode===He||this.setDragMode(ji(this.dragBox,Gt)?Xe:ne)},wheel:function(t){var e=this,a=Number(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),t.deltaY?n=t.deltaY>0?1:-1:t.wheelDelta?n=-t.wheelDelta/120:t.detail&&(n=t.detail>0?1:-1),this.zoom(-n*a,t)))},cropStart:function(t){var e=t.buttons,a=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(y(e)&&e!==1||y(a)&&a!==0||t.ctrlKey))){var n=this.options,r=this.pointers,s;t.changedTouches?V(t.changedTouches,function(l){r[l.identifier]=Ot(l)}):r[t.pointerId||0]=Ot(t),Object.keys(r).length>1&&n.zoomable&&n.zoomOnTouch?s=Ue:s=ie(t.target,xt),$i.test(s)&&mt(this.element,te,{originalEvent:t,action:s})!==!1&&(t.preventDefault(),this.action=s,this.cropping=!1,s===ze&&(this.cropping=!0,L(this.dragBox,At)))}},cropMove:function(t){var e=this.action;if(!(this.disabled||!e)){var a=this.pointers;t.preventDefault(),mt(this.element,Zt,{originalEvent:t,action:e})!==!1&&(t.changedTouches?V(t.changedTouches,function(n){S(a[n.identifier]||{},Ot(n,!0))}):S(a[t.pointerId||0]||{},Ot(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var e=this.action,a=this.pointers;t.changedTouches?V(t.changedTouches,function(n){delete a[n.identifier]}):delete a[t.pointerId||0],e&&(t.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,ct(this.dragBox,At,this.cropped&&this.options.modal)),mt(this.element,Kt,{originalEvent:t,action:e}))}}},da={change:function(t){var e=this.options,a=this.canvasData,n=this.containerData,r=this.cropBoxData,s=this.pointers,l=this.action,u=e.aspectRatio,h=r.left,o=r.top,d=r.width,c=r.height,w=h+d,D=o+c,M=0,C=0,R=n.width,$=n.height,I=!0,J;!u&&t.shiftKey&&(u=d&&c?d/c:1),this.limited&&(M=r.minLeft,C=r.minTop,R=M+Math.min(n.width,a.width,a.left+a.width),$=C+Math.min(n.height,a.height,a.top+a.height));var U=s[Object.keys(s)[0]],m={x:U.endX-U.startX,y:U.endY-U.startY},E=function(X){switch(X){case nt:w+m.x>R&&(m.x=R-w);break;case ot:h+m.x<M&&(m.x=M-h);break;case Z:o+m.y<C&&(m.y=C-o);break;case dt:D+m.y>$&&(m.y=$-D);break}};switch(l){case se:h+=m.x,o+=m.y;break;case nt:if(m.x>=0&&(w>=R||u&&(o<=C||D>=$))){I=!1;break}E(nt),d+=m.x,d<0&&(l=ot,d=-d,h-=d),u&&(c=d/u,o+=(r.height-c)/2);break;case Z:if(m.y<=0&&(o<=C||u&&(h<=M||w>=R))){I=!1;break}E(Z),c-=m.y,o+=m.y,c<0&&(l=dt,c=-c,o-=c),u&&(d=c*u,h+=(r.width-d)/2);break;case ot:if(m.x<=0&&(h<=M||u&&(o<=C||D>=$))){I=!1;break}E(ot),d-=m.x,h+=m.x,d<0&&(l=nt,d=-d,h-=d),u&&(c=d/u,o+=(r.height-c)/2);break;case dt:if(m.y>=0&&(D>=$||u&&(h<=M||w>=R))){I=!1;break}E(dt),c+=m.y,c<0&&(l=Z,c=-c,o-=c),u&&(d=c*u,h+=(r.width-d)/2);break;case gt:if(u){if(m.y<=0&&(o<=C||w>=R)){I=!1;break}E(Z),c-=m.y,o+=m.y,d=c*u}else E(Z),E(nt),m.x>=0?w<R?d+=m.x:m.y<=0&&o<=C&&(I=!1):d+=m.x,m.y<=0?o>C&&(c-=m.y,o+=m.y):(c-=m.y,o+=m.y);d<0&&c<0?(l=wt,c=-c,d=-d,o-=c,h-=d):d<0?(l=vt,d=-d,h-=d):c<0&&(l=bt,c=-c,o-=c);break;case vt:if(u){if(m.y<=0&&(o<=C||h<=M)){I=!1;break}E(Z),c-=m.y,o+=m.y,d=c*u,h+=r.width-d}else E(Z),E(ot),m.x<=0?h>M?(d-=m.x,h+=m.x):m.y<=0&&o<=C&&(I=!1):(d-=m.x,h+=m.x),m.y<=0?o>C&&(c-=m.y,o+=m.y):(c-=m.y,o+=m.y);d<0&&c<0?(l=bt,c=-c,d=-d,o-=c,h-=d):d<0?(l=gt,d=-d,h-=d):c<0&&(l=wt,c=-c,o-=c);break;case wt:if(u){if(m.x<=0&&(h<=M||D>=$)){I=!1;break}E(ot),d-=m.x,h+=m.x,c=d/u}else E(dt),E(ot),m.x<=0?h>M?(d-=m.x,h+=m.x):m.y>=0&&D>=$&&(I=!1):(d-=m.x,h+=m.x),m.y>=0?D<$&&(c+=m.y):c+=m.y;d<0&&c<0?(l=gt,c=-c,d=-d,o-=c,h-=d):d<0?(l=bt,d=-d,h-=d):c<0&&(l=vt,c=-c,o-=c);break;case bt:if(u){if(m.x>=0&&(w>=R||D>=$)){I=!1;break}E(nt),d+=m.x,c=d/u}else E(dt),E(nt),m.x>=0?w<R?d+=m.x:m.y>=0&&D>=$&&(I=!1):d+=m.x,m.y>=0?D<$&&(c+=m.y):c+=m.y;d<0&&c<0?(l=vt,c=-c,d=-d,o-=c,h-=d):d<0?(l=wt,d=-d,h-=d):c<0&&(l=gt,c=-c,o-=c);break;case Ye:this.move(m.x,m.y),I=!1;break;case Ue:this.zoom(Ji(s),t),I=!1;break;case ze:if(!m.x||!m.y){I=!1;break}J=Je(this.cropper),h=U.startX-J.left,o=U.startY-J.top,d=r.minWidth,c=r.minHeight,m.x>0?l=m.y>0?bt:gt:m.x<0&&(h-=d,l=m.y>0?wt:vt),m.y<0&&(o-=c),this.cropped||(q(this.cropBox,Y),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}I&&(r.width=d,r.height=c,r.left=h,r.top=o,this.action=l,this.renderCropBox()),V(s,function(_){_.startX=_.endX,_.startY=_.endY})}},ua={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&L(this.dragBox,At),q(this.cropBox,Y),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=S({},this.initialImageData),this.canvasData=S({},this.initialCanvasData),this.cropBoxData=S({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(S(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),q(this.dragBox,At),L(this.cropBox,Y)),this},replace:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),e?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,V(this.previews,function(a){a.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,q(this.cropper,me)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,L(this.cropper,me)),this},destroy:function(){var t=this.element;return t[N]?(t[N]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,n=a.left,r=a.top;return this.moveTo(Ut(t)?t:n+Number(t),Ut(e)?e:r+Number(e))},moveTo:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,n=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.movable&&(y(t)&&(a.left=t,n=!0),y(e)&&(a.top=e,n=!0),n&&this.renderCanvas(!0)),this},zoom:function(t,e){var a=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(a.width*t/a.naturalWidth,null,e)},zoomTo:function(t,e,a){var n=this.options,r=this.canvasData,s=r.width,l=r.height,u=r.naturalWidth,h=r.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&n.zoomable){var o=u*t,d=h*t;if(mt(this.element,ee,{ratio:t,oldRatio:s/u,originalEvent:a})===!1)return this;if(a){var c=this.pointers,w=Je(this.cropper),D=c&&Object.keys(c).length?Qi(c):{pageX:a.pageX,pageY:a.pageY};r.left-=(o-s)*((D.pageX-w.left-r.left)/s),r.top-=(d-l)*((D.pageY-w.top-r.top)/l)}else ut(e)&&y(e.x)&&y(e.y)?(r.left-=(o-s)*((e.x-r.left)/s),r.top-=(d-l)*((e.y-r.top)/l)):(r.left-=(o-s)/2,r.top-=(d-l)/2);r.width=o,r.height=d,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),y(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var e=this.imageData.scaleY;return this.scale(t,y(e)?e:1)},scaleY:function(t){var e=this.imageData.scaleX;return this.scale(y(e)?e:1,t)},scale:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.imageData,n=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(y(t)&&(a.scaleX=t,n=!0),y(e)&&(a.scaleY=e,n=!0),n&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.options,a=this.imageData,n=this.canvasData,r=this.cropBoxData,s;if(this.ready&&this.cropped){s={x:r.left-n.left,y:r.top-n.top,width:r.width,height:r.height};var l=a.width/a.naturalWidth;if(V(s,function(o,d){s[d]=o/l}),t){var u=Math.round(s.y+s.height),h=Math.round(s.x+s.width);s.x=Math.round(s.x),s.y=Math.round(s.y),s.width=h-s.x,s.height=u-s.y}}else s={x:0,y:0,width:0,height:0};return e.rotatable&&(s.rotate=a.rotate||0),e.scalable&&(s.scaleX=a.scaleX||1,s.scaleY=a.scaleY||1),s},setData:function(t){var e=this.options,a=this.imageData,n=this.canvasData,r={};if(this.ready&&!this.disabled&&ut(t)){var s=!1;e.rotatable&&y(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,s=!0),e.scalable&&(y(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,s=!0),y(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,s=!0)),s&&this.renderCanvas(!0,!0);var l=a.width/a.naturalWidth;y(t.x)&&(r.left=t.x*l+n.left),y(t.y)&&(r.top=t.y*l+n.top),y(t.width)&&(r.width=t.width*l),y(t.height)&&(r.height=t.height*l),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?S({},this.containerData):{}},getImageData:function(){return this.sized?S({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,e={};return this.ready&&V(["left","top","width","height","naturalWidth","naturalHeight"],function(a){e[a]=t[a]}),e},setCanvasData:function(t){var e=this.canvasData,a=e.aspectRatio;return this.ready&&!this.disabled&&ut(t)&&(y(t.left)&&(e.left=t.left),y(t.top)&&(e.top=t.top),y(t.width)?(e.width=t.width,e.height=t.width/a):y(t.height)&&(e.height=t.height,e.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,e;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(t){var e=this.cropBoxData,a=this.options.aspectRatio,n,r;return this.ready&&this.cropped&&!this.disabled&&ut(t)&&(y(t.left)&&(e.left=t.left),y(t.top)&&(e.top=t.top),y(t.width)&&t.width!==e.width&&(n=!0,e.width=t.width),y(t.height)&&t.height!==e.height&&(r=!0,e.height=t.height),a&&(n?e.height=e.width/a:r&&(e.width=e.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e=this.canvasData,a=Zi(this.image,this.imageData,e,t);if(!this.cropped)return a;var n=this.getData(t.rounded),r=n.x,s=n.y,l=n.width,u=n.height,h=a.width/Math.floor(e.naturalWidth);h!==1&&(r*=h,s*=h,l*=h,u*=h);var o=l/u,d=et({aspectRatio:o,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),c=et({aspectRatio:o,width:t.minWidth||0,height:t.minHeight||0},"cover"),w=et({aspectRatio:o,width:t.width||(h!==1?a.width:l),height:t.height||(h!==1?a.height:u)}),D=w.width,M=w.height;D=Math.min(d.width,Math.max(c.width,D)),M=Math.min(d.height,Math.max(c.height,M));var C=document.createElement("canvas"),R=C.getContext("2d");C.width=pt(D),C.height=pt(M),R.fillStyle=t.fillColor||"transparent",R.fillRect(0,0,D,M);var $=t.imageSmoothingEnabled,I=$===void 0?!0:$,J=t.imageSmoothingQuality;R.imageSmoothingEnabled=I,J&&(R.imageSmoothingQuality=J);var U=a.width,m=a.height,E=r,_=s,X,Q,at,rt,K,j;E<=-l||E>U?(E=0,X=0,at=0,K=0):E<=0?(at=-E,E=0,X=Math.min(U,l+E),K=X):E<=U&&(at=0,X=Math.min(l,U-E),K=X),X<=0||_<=-u||_>m?(_=0,Q=0,rt=0,j=0):_<=0?(rt=-_,_=0,Q=Math.min(m,u+_),j=Q):_<=m&&(rt=0,Q=Math.min(u,m-_),j=Q);var B=[E,_,X,Q];if(K>0&&j>0){var st=D/l;B.push(at*st,rt*st,K*st,j*st)}return R.drawImage.apply(R,[a].concat(Be(B.map(function(Ct){return Math.floor(pt(Ct))})))),C},setAspectRatio:function(t){var e=this.options;return!this.disabled&&!Ut(t)&&(e.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var e=this.options,a=this.dragBox,n=this.face;if(this.ready&&!this.disabled){var r=t===ne,s=e.movable&&t===Xe;t=r||s?t:He,e.dragMode=t,Dt(a,xt,t),ct(a,Gt,r),ct(a,Jt,s),e.cropBoxMovable||(Dt(n,xt,t),ct(n,Gt,r),ct(n,Jt,s))}return this}},ca=G.Cropper,Ke=function(){function i(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ki(this,i),!t||!Bi.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=S({},ke,ut(e)&&e),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Mi(i,[{key:"init",value:function(){var e=this.element,a=e.tagName.toLowerCase(),n;if(!e[N]){if(e[N]=this,a==="img"){if(this.isImg=!0,n=e.getAttribute("src")||"",this.originalUrl=n,!n)return;n=e.src}else a==="canvas"&&window.HTMLCanvasElement&&(n=e.toDataURL());this.load(n)}}},{key:"load",value:function(e){var a=this;if(e){this.url=e,this.imageData={};var n=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Li.test(e)){Pi.test(e)?this.read(ia(e)):this.clone();return}var s=new XMLHttpRequest,l=this.clone.bind(this);this.reloading=!0,this.xhr=s,s.onabort=l,s.onerror=l,s.ontimeout=l,s.onprogress=function(){s.getResponseHeader("content-type")!==Ee&&s.abort()},s.onload=function(){a.read(s.response)},s.onloadend=function(){a.reloading=!1,a.xhr=null},r.checkCrossOrigin&&Te(e)&&n.crossOrigin&&(e=Oe(e)),s.open("GET",e,!0),s.responseType="arraybuffer",s.withCredentials=n.crossOrigin==="use-credentials",s.send()}}},{key:"read",value:function(e){var a=this.options,n=this.imageData,r=ra(e),s=0,l=1,u=1;if(r>1){this.url=aa(e,Ee);var h=sa(r);s=h.rotate,l=h.scaleX,u=h.scaleY}a.rotatable&&(n.rotate=s),a.scalable&&(n.scaleX=l,n.scaleY=u),this.clone()}},{key:"clone",value:function(){var e=this.element,a=this.url,n=e.crossOrigin,r=a;this.options.checkCrossOrigin&&Te(a)&&(n||(n="anonymous"),r=Oe(a)),this.crossOrigin=n,this.crossOriginUrl=r;var s=document.createElement("img");n&&(s.crossOrigin=n),s.src=r||a,s.alt=e.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),L(s,ge),e.parentNode.insertBefore(s,e.nextSibling)}},{key:"start",value:function(){var e=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var n=G.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(G.navigator.userAgent),r=function(h,o){S(e.imageData,{naturalWidth:h,naturalHeight:o,aspectRatio:h/o}),e.initialImageData=S({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(a.naturalWidth&&!n){r(a.naturalWidth,a.naturalHeight);return}var s=document.createElement("img"),l=document.body||document.documentElement;this.sizingImage=s,s.onload=function(){r(s.width,s.height),n||l.removeChild(s)},s.src=a.src,n||(s.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",l.appendChild(s))}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var e=this.element,a=this.options,n=this.image,r=e.parentNode,s=document.createElement("div");s.innerHTML=zi;var l=s.querySelector(".".concat(N,"-container")),u=l.querySelector(".".concat(N,"-canvas")),h=l.querySelector(".".concat(N,"-drag-box")),o=l.querySelector(".".concat(N,"-crop-box")),d=o.querySelector(".".concat(N,"-face"));this.container=r,this.cropper=l,this.canvas=u,this.dragBox=h,this.cropBox=o,this.viewBox=l.querySelector(".".concat(N,"-view-box")),this.face=d,u.appendChild(n),L(e,Y),r.insertBefore(l,e.nextSibling),q(n,ge),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,L(o,Y),a.guides||L(o.getElementsByClassName("".concat(N,"-dashed")),Y),a.center||L(o.getElementsByClassName("".concat(N,"-center")),Y),a.background&&L(l,"".concat(N,"-bg")),a.highlight||L(d,Ii),a.cropBoxMovable&&(L(d,Jt),Dt(d,xt,se)),a.cropBoxResizable||(L(o.getElementsByClassName("".concat(N,"-line")),Y),L(o.getElementsByClassName("".concat(N,"-point")),Y)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),z(a.ready)&&H(e,xe,a.ready,{once:!0}),mt(e,xe)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var e=this.cropper.parentNode;e&&e.removeChild(this.cropper),q(this.element,Y)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=ca,i}},{key:"setDefaults",value:function(e){S(ke,ut(e)&&e)}}])}();S(Ke.prototype,na,oa,la,ha,da,ua);const fa={props:{item:{type:Object,required:!0}},emits:["update:item","update:file","error"],inject:["compose","translate","txlanguages"],data(){return{translating:!1,composing:!1,cropper:null,tabdesc:null,scaleX:1,scaleY:1}},setup(){const i=ii(),t=ai(),e=Vt();return{app:Ae(),auth:e,languages:i,side:t}},mounted(){var i;!this.readonly&&((i=this.item.mime)!=null&&i.startsWith("image/"))&&(this.cropper=new Ke(this.$refs.image,{aspectRatio:NaN,background:!0,responsive:!0,dragMode:"move",movable:!1,autoCrop:!1,zoomable:!0,zoomOnWheel:!1,zoomOnTouch:!1,checkCrossOrigin:!1,checkOrientation:!1,viewMode:1}))},beforeUnmount(){this.cropper&&this.cropper.destroy()},computed:{desclangs(){return Object.keys(this.languages.available||{}).concat(Object.keys(this.item.description||{})).filter((i,t,e)=>e.indexOf(i)===t)},langs(){const i=[{code:null,name:"None"}];return Object.entries(this.languages.available||{}).forEach(t=>{i.push({code:t[0],name:t[1]})}),i},readonly(){return!this.auth.can("file:save")}},methods:{composeText(){const i=this.item.lang||"en",t='Summarize the content of the file in a few words for a title tag in the language with the ISO code "'+i+'":';this.composing=!0,this.compose(t,null,[this.item.id]).then(e=>{this.item.description[i]=e}).finally(()=>{this.composing=!1})},download(){this.cropper.getCroppedCanvas().toBlob(i=>{const t=URL.createObjectURL(i),e=document.createElement("a");e.href=t,e.download=this.item.name||"download",e.click(),URL.revokeObjectURL(t)})},flipX(){this.scaleX=-this.scaleX,this.cropper.scaleX(this.scaleX),this.save()},flipY(){this.scaleY=-this.scaleY,this.cropper.scaleY(this.scaleY),this.save()},reset(){this.$emit("update:file",null),this.cropper.reset(),this.cropper.clear(),this.scaleX=1,this.scaleY=1},rotate(i){this.cropper.rotate(i),this.save(),this.$nextTick(()=>{const t=this.cropper.getContainerData(),e=this.cropper.getImageData();let a,n;Math.abs(Math.abs(e.rotate)-180)===90?(a=t.width/e.naturalHeight,n=t.height/e.naturalWidth):(a=t.width/e.naturalWidth,n=t.height/e.naturalHeight),this.cropper.zoomTo(Math.min(a,n))})},save(){this.cropper.getCroppedCanvas().toBlob(i=>{this.$emit("update:file",i)})},update(i,t){this.item[i]=t,this.$emit("update:item",this.item)},translateText(){const i=[],[t,e]=Object.entries(this.item.description||{}).find(([a,n])=>!!n);this.translating=!0,this.txlanguages(t).map(a=>a.code).forEach(a=>{i.push(this.translate(e,a).then(n=>{n[0]&&(this.item.description[a]=n[0])}).catch(n=>{this.$log("FileDetailItem::translateText(): Error translating text",n)}))}),Promise.all(i).then(()=>{this.translating=!1})},url(i,t=!1){return t&&i.startsWith("http")?this.app.urlproxy.replace(/:url/,encodeURIComponent(i)):i.startsWith("blob:")||i.startsWith("http")?i:this.app.urlfile.replace(/\/+$/g,"")+"/"+i}}},pa={key:0,ref:"editorContainer",class:"editor-container"},ma=["src"],ga={key:0,class:"floating-toolbar"},va={class:"toolbar-group"},ba={class:"toolbar-group"},wa={class:"toolbar-group"},ya=["src"],xa=["src"],Da={key:3,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-file-earmark-binary",viewBox:"0 0 16 16"},Ca={key:0,class:"actions"};function Ea(i,t,e,a,n,r){return b(),O(Ne,null,{default:f(()=>[p(Se,null,{default:f(()=>[p(Yt,null,{default:f(()=>[p(Et,{cols:"12",md:"6"},{default:f(()=>[p(Ie,{ref:"name",readonly:r.readonly,modelValue:e.item.name,"onUpdate:modelValue":t[0]||(t[0]=s=>r.update("name",s)),variant:"underlined",label:i.$gettext("Name"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),p(Et,{cols:"12",md:"6"},{default:f(()=>[p(ri,{ref:"lang",items:r.langs,readonly:r.readonly,modelValue:e.item.lang,"onUpdate:modelValue":t[1]||(t[1]=s=>r.update("lang",s)),variant:"underlined","item-title":"name","item-value":"code",label:i.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),p(Yt,null,{default:f(()=>[e.item?(b(),O(Et,{key:0,cols:"12",class:"preview"},{default:f(()=>{var s,l,u;return[(s=e.item.mime)!=null&&s.startsWith("image/")?(b(),A("div",pa,[v("img",{ref:"image",src:r.url(e.item.path,!0),class:"element",crossorigin:"anonymous"},null,8,ma),r.readonly?T("",!0):(b(),A("div",ga,[v("div",va,[p(x,{icon:"mdi-rotate-left",onClick:t[2]||(t[2]=h=>r.rotate(-90)),title:i.$gettext("Rotate counter-clockwise")},null,8,["title"]),p(x,{icon:"mdi-rotate-right",onClick:t[3]||(t[3]=h=>r.rotate(90)),title:i.$gettext("Rotate clockwise")},null,8,["title"])]),v("div",ba,[p(x,{icon:"mdi-flip-horizontal",onClick:r.flipX,title:i.$gettext("Flip horizontally")},null,8,["onClick","title"]),p(x,{icon:"mdi-flip-vertical",onClick:r.flipY,title:i.$gettext("Flip vertically")},null,8,["onClick","title"])]),v("div",wa,[p(x,{icon:"mdi-history",onClick:t[4]||(t[4]=h=>r.reset()),title:i.$gettext("Reset")},null,8,["title"]),p(x,{icon:"mdi-download",onClick:t[5]||(t[5]=h=>r.download()),title:i.$gettext("Download")},null,8,["title"])])]))],512)):(l=e.item.mime)!=null&&l.startsWith("video/")?(b(),A("video",{key:1,src:r.url(e.item.path),crossorigin:"anonymous",preload:"metadata",class:"element",controls:""},null,8,ya)):(u=e.item.mime)!=null&&u.startsWith("audio/")?(b(),A("audio",{key:2,src:r.url(e.item.path),crossorigin:"anonymous",preload:"metadata",class:"element",controls:""},null,8,xa)):(b(),A("svg",Da,t[10]||(t[10]=[v("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),v("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])))]}),_:1})):T("",!0)]),_:1}),p(Yt,null,{default:f(()=>[p(Et,{cols:"12",class:"desc"},{default:f(()=>[p(si,null,{default:f(()=>[k(g(i.$gettext("Descriptions"))+" ",1),r.readonly?T("",!0):(b(),A("div",Ca,[Object.values(e.item.description||{}).find(s=>!!s)?(b(),O(x,{key:0,loading:n.translating,icon:"mdi-translate",variant:"flat",onClick:t[6]||(t[6]=s=>r.translateText())},null,8,["loading"])):T("",!0),p(x,{loading:n.composing,icon:"mdi-creation",variant:"flat",onClick:t[7]||(t[7]=s=>r.composeText())},null,8,["loading"])]))]),_:1}),p(Ve,{modelValue:n.tabdesc,"onUpdate:modelValue":t[8]||(t[8]=s=>n.tabdesc=s)},{default:f(()=>[(b(!0),A(it,null,ft(r.desclangs,s=>(b(),O(Ht,{value:s},{default:f(()=>[k(g(s),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),p(Re,{modelValue:n.tabdesc,"onUpdate:modelValue":t[9]||(t[9]=s=>n.tabdesc=s)},{default:f(()=>[(b(!0),A(it,null,ft(r.desclangs,s=>(b(),O(Wt,{value:s},{default:f(()=>{var l;return[p(ni,{ref_for:!0,ref:"description",readonly:r.readonly,modelValue:((l=e.item.description)==null?void 0:l[s])||"","onUpdate:modelValue":u=>{e.item.description[s]=u,i.$emit("update:item",e.item)},label:i.$gettext("Description (%{lang})",{lang:s}),variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["readonly","modelValue","onUpdate:modelValue","label"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}const ka=It(fa,[["render",Ea],["__scopeId","data-v-cbd41692"]]),Ma={components:{AsideMeta:yi,HistoryDialog:wi,FileDetailItem:ka,FileDetailRefs:Ci},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,pubmenu:!1,vhistory:!1,tab:"file"}),setup(){const i=_e(),t=oi();return{auth:Vt(),drawer:t,messages:i}},methods:{publish(i=null){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var e,a;t&&this.$apollo.mutate({mutation:F`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(a=(e=i==null?void 0:i.toISOString())==null?void 0:e.substring(0,19))==null?void 0:a.replace("T"," ")}}).then(n=>{if(n.errors)throw n.errors;i?(this.item.publish_at=i,this.messages.add(this.$gettext("File scheduled for publishing at %{date}",{date:i.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("File published successfully"),"success")),this.closeView()}).catch(n=>{this.messages.add(this.$gettext("Error publishing file"),"error"),this.$log("FileDetail::publish(): Error publishing file",i,n)})})},reset(){this.changed=!1,this.error=!1},save(i=!1){return this.auth.can("file:save")?this.changed?this.$apollo.mutate({mutation:F`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
            }
          }`,variables:{id:this.item.id,input:{description:JSON.stringify(this.item.description||{}),name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(t=>{if(t.errors)throw t.errors;return this.item.published=!1,this.reset(),i||this.messages.add(this.$gettext("File saved successfully"),"success"),!0}).catch(t=>{this.messages.add(this.$gettext("Error saving file"),"error"),this.$log("FileDetail::save(): Error saving file",t)}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},use(i){Object.assign(this.item,i.data),this.vhistory=!1,this.changed=!0},versions(i){return this.auth.can("file:view")?i?this.$apollo.query({query:F`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:i}}).then(t=>{if(t.errors||!t.data.file)throw t;return(t.data.file.versions||[]).map(e=>({...e,data:JSON.parse(e.data||"{}")})).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching file versions"),"error"),this.$log("FileDetail::versions(): Error fetching file versions",i,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}}},Ta={class:"app-title"},Oa={class:"menu-content"};function Na(i,t,e,a,n,r){const s=kt("FileDetailItem"),l=kt("FileDetailRefs"),u=kt("AsideMeta"),h=kt("HistoryDialog");return b(),A(it,null,[p(li,{elevation:0,density:"compact"},{prepend:f(()=>[p(x,{icon:"mdi-keyboard-backspace",onClick:t[0]||(t[0]=o=>r.closeView()),elevation:"0"})]),append:f(()=>[p(x,{icon:"mdi-history",class:lt({hidden:e.item.published&&!i.changed&&!e.item.latest}),onClick:t[1]||(t[1]=o=>i.vhistory=!0),elevation:"0"},null,8,["class"]),p(x,{class:lt([{error:i.error},"menu-save"]),disabled:!i.changed||i.error||!a.auth.can("file:save"),onClick:t[2]||(t[2]=o=>r.save()),variant:"text"},{default:f(()=>[k(g(i.$gettext("Save")),1)]),_:1},8,["class","disabled"]),p(Nt,{modelValue:i.pubmenu,"onUpdate:modelValue":t[6]||(t[6]=o=>i.pubmenu=o),"close-on-content-click":!1},{activator:f(({props:o})=>[p(fi,{class:"menu-publish",variant:"text"},{default:f(()=>[p(x,{class:lt([{error:i.error},"button"]),disabled:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish"),onClick:t[3]||(t[3]=d=>r.publish())},{default:f(()=>[k(g(i.$gettext("Publish")),1)]),_:1},8,["class","disabled"]),p(x,St({class:[{error:i.error},"icon"],icon:"mdi-menu-down",disabled:e.item.published&&!i.changed||i.error||!a.auth.can("file:publish")},o),null,16,["class","disabled"])]),_:2},1024)]),default:f(()=>[v("div",Oa,[p(ci,{modelValue:i.publishAt,"onUpdate:modelValue":t[4]||(t[4]=o=>i.publishAt=o),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),p(x,{disabled:!i.publishAt||i.error,color:i.publishAt?"primary":"",onClick:t[5]||(t[5]=o=>{r.publish(i.publishAt),i.pubmenu=!1}),variant:"flat"},{default:f(()=>[k(g(i.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),p(x,{onClick:t[7]||(t[7]=jt(o=>a.drawer.toggle("aside"),["stop"]))},{default:f(()=>[p($e,{size:"x-large"},{default:f(()=>[k(g(a.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"),1)]),_:1})]),_:1})]),default:f(()=>[p(ui,null,{default:f(()=>[v("div",Ta,g(i.$gettext("File"))+": "+g(e.item.name),1)]),_:1})]),_:1}),p(hi,{class:"file-details"},{default:f(()=>[p(pi,{onSubmit:t[13]||(t[13]=jt(()=>{},["prevent"]))},{default:f(()=>[p(Ve,{"fixed-tabs":"",modelValue:i.tab,"onUpdate:modelValue":t[8]||(t[8]=o=>i.tab=o)},{default:f(()=>[p(Ht,{value:"file",class:lt({changed:i.changed,error:i.error})},{default:f(()=>[k(g(i.$gettext("File")),1)]),_:1},8,["class"]),p(Ht,{value:"refs"},{default:f(()=>[k(g(i.$gettext("Used by")),1)]),_:1})]),_:1},8,["modelValue"]),p(Re,{modelValue:i.tab,"onUpdate:modelValue":t[12]||(t[12]=o=>i.tab=o)},{default:f(()=>[p(Wt,{value:"file"},{default:f(()=>[p(s,{item:e.item,"onUpdate:item":t[9]||(t[9]=o=>{this.$emit("update:item",e.item),i.changed=!0}),"onUpdate:file":t[10]||(t[10]=o=>{this.file=o,i.changed=!0}),onError:t[11]||(t[11]=o=>i.error=o)},null,8,["item"])]),_:1}),p(Wt,{value:"refs"},{default:f(()=>[p(l,{item:e.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),p(u,{item:e.item},null,8,["item"]),(b(),O(di,{to:"body"},[p(h,{modelValue:i.vhistory,"onUpdate:modelValue":t[14]||(t[14]=o=>i.vhistory=o),current:{data:{lang:e.item.lang,name:e.item.name,mime:e.item.mime,path:e.item.path,previews:e.item.previews,description:e.item.description}},load:()=>r.versions(e.item.id),onUse:t[15]||(t[15]=o=>r.use(o)),onRevert:t[16]||(t[16]=o=>{r.use(o),r.reset()})},null,8,["modelValue","current","load"])]))],64)}const Qa=It(Ma,[["render",Na],["__scopeId","data-v-bc743d88"]]),Sa={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,checked:!1,loading:!0,vgrid:!1}},setup(){const i=_e(),t=Vt();return{app:Ae(),auth:t,messages:i}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(i=>i._checked&&!i.deleted_at)},isChecked(){return this.items.some(i=>i._checked)},isTrashed(){return this.items.some(i=>i._checked&&i.deleted_at)}},methods:{add(i){if(this.embed||!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=[],e=i.target.files||i.dataTransfer.files||[];if(e.length)return Array.from(e).forEach(a=>{t.push(this.$apollo.mutate({mutation:F`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:a},context:{hasUpload:!0}}).then(n=>{var s;if(n.errors)throw n.errors;const r=((s=n.data)==null?void 0:s.addFile)||{};return r.previews=JSON.parse(r.previews)||{},r.description=JSON.parse(r.description)||{},r.published=!0,this.items.unshift(r),this.$emit("select",r),r}).catch(n=>{this.$log("FileListItems::add(): Error adding file",i,n)}))}),Promise.all(t).then(()=>{this.invalidate()})},drop(i){if(!this.auth.can("file:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:F`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error trashing file"),"error"),this.$log("FileListItems::drop(): Error trashing file",i,e)})},invalidate(){const i=this.$apollo.provider.defaultClient.cache;i.evict({id:"ROOT_QUERY",fieldName:"files"}),i.gc()},keep(i){if(!this.auth.can("file:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:F`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(a=>{a.deleted_at=null}),this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error restoring file"),"error"),this.$log("FileListItems::keep(): Error restoring file",i,e)})},publish(i){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked&&e.id&&!e.published);t.length&&this.$apollo.mutate({mutation:F`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;t.forEach(a=>{a.published=!0,a._checked=!1}),this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error publishing file"),"error"),this.$log("FileListItems::publish(): Error publishing file",i,e)})},purge(i){if(!this.auth.can("file:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=i?[i]:this.items.filter(e=>e._checked);t.length&&this.$apollo.mutate({mutation:F`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(e=>e.id)}}).then(e=>{if(e.errors)throw e.errors;this.invalidate(),this.search()}).catch(e=>{this.messages.add(this.$gettext("Error purging file"),"error"),this.$log("FileListItems::purge(): Error purging file",i,e)})},search(){if(!this.auth.can("file:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const i=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",e={...this.filter};return delete e.trashed,delete e.publish,this.term&&(e.any=this.term),this.loading=!0,this.$apollo.query({query:F`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:e,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:i}}).then(a=>{var r;if(a.errors)throw a.errors;const n=a.data.files||{};return this.last=((r=n.paginatorInfo)==null?void 0:r.lastPage)||1,this.items=[...n.data||[]].map(s=>{var u,h,o,d,c,w;const l=(u=s.latest)!=null&&u.data?JSON.parse((h=s.latest)==null?void 0:h.data):{...s,previews:JSON.parse(s.previews||"{}"),description:JSON.parse(s.description||"{}")};return Object.assign(l,{id:s.id,deleted_at:s.deleted_at,created_at:s.created_at,updated_at:((o=s.latest)==null?void 0:o.created_at)||s.updated_at,editor:((d=s.latest)==null?void 0:d.editor)||s.editor,published:((c=s.latest)==null?void 0:c.published)??!0,publish_at:((w=s.latest)==null?void 0:w.publish_at)||null,latest:s.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(a=>{this.messages.add(this.$gettext("Error fetching files"),"error"),this.$log("FileListItems::search(): Error fetching files",a)})},srcset(i){let t=[];for(const e in i)t.push(`${this.url(i[e])} ${e}w`);return t.join(", ")},title(i){const t=[];return i.publish_at&&t.push("Publish at: "+new Date(i.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(i=>{i._checked=!i._checked})},url(i){return i.startsWith("http")||i.startsWith("blob:")?i:this.app.urlfile.replace(/\/+$/g,"")+"/"+i}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},Aa={class:"header"},Ia={class:"bulk"},Va={class:"search"},Ra={class:"layout"},_a=["onClick","title"],$a=["onClick","title"],La={class:"item-text"},Pa={class:"item-head"},Ba={key:1,class:"item-lang"},za={class:"item-title"},Ya={class:"item-mime item-subtitle"},Ua={class:"item-aux"},Xa={class:"item-editor"},Ha={class:"item-modified item-subtitle"},Wa={key:0,class:"loading"},ja={key:1,class:"notfound"},Fa={key:3,class:"btn-group"};function qa(i,t,e,a,n,r){return b(),A(it,null,[v("div",Aa,[v("div",Ia,[p(ce,{modelValue:n.checked,"onUpdate:modelValue":t[0]||(t[0]=s=>n.checked=s),onClick:t[1]||(t[1]=jt(s=>r.toggle(),["stop"]))},null,8,["modelValue"]),p(Nt,{location:"bottom left"},{activator:f(({props:s})=>[p(x,St({"append-icon":"mdi-menu-down",variant:"text"},s),{default:f(()=>[k(g(i.$gettext("Actions")),1)]),_:2},1040)]),default:f(()=>[p(Mt,null,{default:f(()=>[r.isChecked&&a.auth.can("file:publish")?(b(),O(P,{key:0},{default:f(()=>[p(x,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=s=>r.publish())},{default:f(()=>[k(g(i.$gettext("Publish")),1)]),_:1})]),_:1})):T("",!0),!this.embed&&a.auth.can("file:add")?(b(),O(P,{key:1},{default:f(()=>[p(x,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[3]||(t[3]=s=>i.$refs.upload.click())},{default:f(()=>[k(g(i.$gettext("Add files")),1)]),_:1})]),_:1})):T("",!0),r.canTrash&&a.auth.can("file:drop")?(b(),O(P,{key:2},{default:f(()=>[p(x,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=s=>r.drop())},{default:f(()=>[k(g(i.$gettext("Trash")),1)]),_:1})]),_:1})):T("",!0),r.isTrashed&&a.auth.can("file:keep")?(b(),O(P,{key:3},{default:f(()=>[p(x,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=s=>r.keep())},{default:f(()=>[k(g(i.$gettext("Restore")),1)]),_:1})]),_:1})):T("",!0),r.isChecked&&a.auth.can("file:purge")?(b(),O(P,{key:4},{default:f(()=>[p(x,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=s=>r.purge())},{default:f(()=>[k(g(i.$gettext("Purge")),1)]),_:1})]),_:1})):T("",!0)]),_:1})]),_:1})]),v("div",Va,[p(Ie,{modelValue:n.term,"onUpdate:modelValue":t[7]||(t[7]=s=>n.term=s),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:i.$gettext("Search for"),"hide-details":"",clearable:""},null,8,["modelValue","label"])]),v("div",Ra,[n.vgrid?T("",!0):(b(),O(x,{key:0,onClick:t[8]||(t[8]=s=>n.vgrid=!0),icon:"mdi-view-grid-outline",variant:"flat",title:i.$gettext("Grid view")},null,8,["title"])),n.vgrid?(b(),O(x,{key:1,onClick:t[9]||(t[9]=s=>n.vgrid=!1),icon:"mdi-format-list-bulleted-square",variant:"flat",title:i.$gettext("List view")},null,8,["title"])):T("",!0),p(Nt,null,{activator:f(({props:s})=>[p(x,St({"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text",location:"bottom right"},s),{default:f(()=>{var l,u,h;return[k(g(((l=n.sort)==null?void 0:l.column)==="ID"?((u=n.sort)==null?void 0:u.order)==="DESC"?i.$gettext("Latest"):i.$gettext("Oldest"):((h=n.sort)==null?void 0:h.column)||""),1)]}),_:2},1040)]),default:f(()=>[p(Mt,null,{default:f(()=>[p(P,null,{default:f(()=>[p(x,{variant:"text",onClick:t[10]||(t[10]=s=>n.sort={column:"ID",order:"DESC"})},{default:f(()=>[k(g(i.$gettext("Latest")),1)]),_:1})]),_:1}),p(P,null,{default:f(()=>[p(x,{variant:"text",onClick:t[11]||(t[11]=s=>n.sort={column:"ID",order:"ASC"})},{default:f(()=>[k(g(i.$gettext("Oldest")),1)]),_:1})]),_:1}),p(P,null,{default:f(()=>[p(x,{variant:"text",onClick:t[12]||(t[12]=s=>n.sort={column:"NAME",order:"ASC"})},{default:f(()=>[k(g(i.$gettext("Name")),1)]),_:1})]),_:1}),p(P,null,{default:f(()=>[p(x,{variant:"text",onClick:t[13]||(t[13]=s=>n.sort={column:"MIME",order:"ASC"})},{default:f(()=>[k(g(i.$gettext("Mime")),1)]),_:1})]),_:1}),p(P,null,{default:f(()=>[p(x,{variant:"text",onClick:t[14]||(t[14]=s=>n.sort={column:"LANG",order:"ASC"})},{default:f(()=>[k(g(i.$gettext("Language")),1)]),_:1})]),_:1}),p(P,null,{default:f(()=>[p(x,{variant:"text",onClick:t[15]||(t[15]=s=>n.sort={column:"EDITOR",order:"ASC"})},{default:f(()=>[k(g(i.$gettext("Editor")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),p(Mt,{class:lt(["items",{grid:n.vgrid,list:!n.vgrid}])},{default:f(()=>[(b(!0),A(it,null,ft(n.items,(s,l)=>(b(),O(P,{key:l},{default:f(()=>[p(ce,{modelValue:s._checked,"onUpdate:modelValue":u=>s._checked=u,class:lt([{draft:!s.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),p(Nt,null,{activator:f(({props:u})=>[p(x,St({class:"item-menu",icon:"mdi-dots-vertical",variant:"text"},{ref_for:!0},u),null,16)]),default:f(()=>[p(Mt,null,{default:f(()=>[gi(p(P,null,{default:f(()=>[p(x,{"prepend-icon":"mdi-publish",variant:"text",onClick:u=>r.publish(s)},{default:f(()=>[k(g(i.$gettext("Publish")),1)]),_:2},1032,["onClick"])]),_:2},1536),[[vi,!s.deleted_at&&!s.published&&a.auth.can("file:publish")]]),!s.deleted_at&&a.auth.can("file:drop")?(b(),O(P,{key:0},{default:f(()=>[p(x,{"prepend-icon":"mdi-delete",variant:"text",onClick:u=>r.drop(s)},{default:f(()=>[k(g(i.$gettext("Trash")),1)]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),s.deleted_at&&a.auth.can("file:keep")?(b(),O(P,{key:1},{default:f(()=>[p(x,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:u=>r.keep(s)},{default:f(()=>[k(g(i.$gettext("Restore")),1)]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0),a.auth.can("file:purge")?(b(),O(P,{key:2},{default:f(()=>[p(x,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:u=>r.purge(s)},{default:f(()=>[k(g(i.$gettext("Purge")),1)]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0)]),_:2},1024)]),_:2},1024),v("div",{class:"item-preview",onClick:u=>i.$emit("select",s),title:r.title(s)},[s.previews?(b(),O(bi,{key:0,src:r.url(s.path),srcset:r.srcset(s.previews),alt:s.name},null,8,["src","srcset","alt"])):T("",!0)],8,_a),v("div",{class:lt(["item-content",{trashed:s.deleted_at}]),onClick:u=>i.$emit("select",s),title:r.title(s)},[v("div",La,[v("div",Pa,[s.publish_at?(b(),O($e,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):T("",!0),s.lang?(b(),A("span",Ba,g(s.lang),1)):T("",!0),v("span",za,g(s.name),1)]),v("div",Ya,g(s.mime),1)]),v("div",Ua,[v("div",Xa,g(s.editor),1),v("div",Ha,g(new Date(s.updated_at).toLocaleString()),1)])],10,$a)]),_:2},1024))),128))]),_:1},8,["class"]),n.loading?(b(),A("p",Wa,[k(g(i.$gettext("Loading"))+" ",1),t[19]||(t[19]=v("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[v("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),v("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),v("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):T("",!0),!n.loading&&!n.items.length?(b(),A("p",ja,g(i.$gettext("No entries found")),1)):T("",!0),n.last>1?(b(),O(mi,{key:2,modelValue:n.page,"onUpdate:modelValue":t[16]||(t[16]=s=>n.page=s),length:n.last},null,8,["modelValue","length"])):T("",!0),!this.embed&&a.auth.can("file:add")?(b(),A("div",Fa,[v("input",{onChange:t[17]||(t[17]=s=>r.add(s)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),p(x,{color:"primary",icon:"mdi-folder-plus",onClick:t[18]||(t[18]=s=>i.$refs.upload.click())})])):T("",!0)],64)}const Ka=It(Sa,[["render",qa],["__scopeId","data-v-0fb94d01"]]);export{Ka as F,Qa as a};
