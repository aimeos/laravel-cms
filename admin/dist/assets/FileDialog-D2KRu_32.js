import{_ as $,J as w,a1 as x,b as f,w as a,a3 as F,o,a as d,a4 as _,a5 as b,Z as B,av as C,E as I,a8 as E,c as g,F as L,a2 as T,a9 as U,f as u,j as v,t as p,l as V,d as j,r as z,aw as A,i as D}from"../index.js";import{F as O}from"./FileListItems-BgArmzs5.js";const S={props:{modelValue:{type:Boolean,required:!0},multiple:{type:Boolean,required:!1},mime:{type:String,default:""}},emits:["update:modelValue","add"],setup(){return{app:x()}},data(){return{errors:[],input:"",items:{},loading:!1}},methods:{add(){const t=[],e=Object.values(this.items);e.length&&(this.loading=!0,e.forEach(s=>{t.push(this.$apollo.mutate({mutation:w`mutation($input: FileInput) {
              addFile(input: $input) {
                id
                mime
                name
                path
                previews
                updated_at
                editor
              }
            }`,variables:{input:{path:s.path,name:s.name}}}).then(n=>{if(n.errors)throw n.errors;Object.assign(s,n.data.addFile,{previews:JSON.parse(n.data.addFile.previews||"{}")})}).catch(n=>{this.$log("Error adding file:",s,n)}).finally(()=>{this.loading=!1}))}),Promise.all(t).then(()=>{this.$emit("update:modelValue",!1),this.$emit("add",e),this.input="",this.items={}}))},remove(t){delete this.items[t]},size(t){return t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(2)} KB`:t<1024*1024*1024?`${(t/(1024*1024)).toFixed(2)} MB`:`${(t/(1024*1024*1024)).toFixed(2)} GB`:""},update(){const t=this.input.split(`
`).map(e=>e.trim()).filter(e=>e&&e.startsWith("http"));for(const e of Object.keys(this.items))t.includes(e)||delete this.items[e];t.forEach(e=>{this.items[e]||fetch(this.app.urlproxy.replace(":url",encodeURIComponent(e)),{credentials:"include",method:"HEAD"}).then(s=>{var n,l,r,i,m,c,h;if(!s.ok)throw new Error(`Failed to fetch ${e}`,s);(l=(n=s.headers)==null?void 0:n.get("Content-Type"))!=null&&l.startsWith(this.mime)?this.items[e]={path:e,mime:(r=s.headers)==null?void 0:r.get("Content-Type"),size:parseInt((i=s.headers)==null?void 0:i.get("Content-Length")),name:(((h=(c=(m=e.split("?"))==null?void 0:m.shift())==null?void 0:c.split("/"))==null?void 0:h.pop())||e).splice(0,100)}:this.errors=this.multiple?[this.$gettext('At least one file is not of type "%{mime}*"',{mime:this.mime})]:[this.$gettext('The file is not of type "%{mime}*"',{mime:this.mime})]}).catch(s=>{this.$log(`Error fetching ${e}`,s)})})}}},N=["onClick"],R=["src"],W=["src"],q=["src"],K=["href"],J=["onClick"],G={class:"item-text"},H={class:"item-title"},M={class:"item-mime item-subtitle"},P={class:"item-aux"},Z={class:"item-size"};function Q(t,e,s,n,l,r){return o(),f(F,{modelValue:s.modelValue,"max-width":"1200",scrollable:""},{default:a(()=>[d(_,{loading:l.loading?"primary":!1},{append:a(()=>[Object.keys(l.items).length?(o(),f(v,{key:0,variant:"outlined",onClick:e[0]||(e[0]=i=>r.add())},{default:a(()=>[V(p(t.$gettext("Add file","Add files",+s.multiple)),1)]),_:1})):j("",!0),d(v,{icon:"mdi-close",variant:"flat",onClick:e[1]||(e[1]=i=>t.$emit("update:modelValue",!1))})]),title:a(()=>[V(p(t.$gettext("Add files by URL")),1)]),default:a(()=>[d(b,null,{default:a(()=>[s.multiple?(o(),f(B,{key:0,ref:"input",modelValue:l.input,"onUpdate:modelValue":e[2]||(e[2]=i=>l.input=i),onKeyup:e[3]||(e[3]=C(i=>r.update(),["enter"])),"onClick:appendInner":e[4]||(e[4]=i=>r.update()),"onClick:clear":e[5]||(e[5]=i=>l.errors=[]),"error-messages":l.errors,"append-inner-icon":l.input?"mdi-check":"",placeholder:t.$gettext("Enter one URL per line"),variant:"underlined",autofocus:"",clearable:"","auto-grow":"",rows:"3"},null,8,["modelValue","error-messages","append-inner-icon","placeholder"])):(o(),f(I,{key:1,ref:"input",modelValue:l.input,"onUpdate:modelValue":e[6]||(e[6]=i=>l.input=i),onKeyup:e[7]||(e[7]=C(i=>r.update(),["enter"])),"onClick:appendInner":e[8]||(e[8]=i=>r.update()),"onClick:clear":e[9]||(e[9]=i=>l.errors=[]),"error-messages":l.errors,"append-inner-icon":l.input?"mdi-check":"",placeholder:t.$gettext("Enter URL"),variant:"underlined",autofocus:"",clearable:""},null,8,["modelValue","error-messages","append-inner-icon","placeholder"])),d(E,{class:"items grid"},{default:a(()=>[(o(!0),g(L,null,T(l.items,(i,m)=>(o(),f(U,{key:m},{default:a(()=>{var c,h,k;return[d(v,{icon:"mdi-delete",onClick:y=>r.remove(m),class:"btn-overlay",title:t.$gettext("Remove file")},null,8,["onClick","title"]),u("div",{class:"item-preview",onClick:y=>t.$emit("select",i)},[(c=i.mime)!=null&&c.startsWith("image/")?(o(),g("img",{key:0,src:i.path},null,8,R)):(h=i.mime)!=null&&h.startsWith("video/")?(o(),g("video",{key:1,preload:"metadata",controls:"",src:i.path},null,8,W)):(k=i.mime)!=null&&k.startsWith("audio/")?(o(),g("audio",{key:2,preload:"metadata",controls:"",src:i.path},null,8,q)):(o(),g("a",{key:3,href:i.path,target:"_blank"},p(i.path),9,K))],8,N),u("div",{class:"item-content",onClick:y=>t.$emit("select",i)},[u("div",G,[u("span",H,p(i.name),1),u("div",M,p(i.mime),1)]),u("div",P,[u("div",Z,"Size: "+p(r.size(i.size)),1)])],8,J)]}),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue"])}const ie=$(S,[["render",Q],["__scopeId","data-v-76735330"]]),X={components:{FileListItems:O},props:{modelValue:{type:Boolean,required:!0},filter:{type:Object,default:()=>({})},grid:{type:Boolean,default:!1}},emits:["update:modelValue","add"]};function Y(t,e,s,n,l,r){const i=z("FileListItems");return o(),f(F,{modelValue:s.modelValue,"max-width":"1200",scrollable:""},{default:a(()=>[d(_,null,{append:a(()=>[d(D,{onClick:e[0]||(e[0]=m=>t.$emit("update:modelValue",!1))},{default:a(()=>e[2]||(e[2]=[V("mdi-close")])),_:1,__:[2]})]),title:a(()=>[V(p(t.$gettext("Files")),1)]),default:a(()=>[d(A),d(b,null,{default:a(()=>[d(i,{filter:s.filter,grid:s.grid,onSelect:e[1]||(e[1]=m=>t.$emit("add",m)),embed:""},null,8,["filter","grid"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const se=$(X,[["render",Y]]);export{ie as F,se as a};
