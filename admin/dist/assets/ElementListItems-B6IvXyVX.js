import{_ as P,au as N,c as b,a2 as E,F as $,o as h,aI as O,b as _,d as k,w as i,l as c,t as u,a as l,H as T,a8 as w,a9 as v,j as m,G as S,ae as U,af as j,b7 as F,a6 as B,bh as q,a7 as M,bi as J,a4 as R,f as g,J as C,a0 as H,h as W,aL as A,E as z,aM as Q,a3 as Y,T as G,r as Z,aN as V,aO as I,i as K}from"../index.js";const X={props:{data:{type:Object,default:()=>{}},files:{type:Array,default:()=>[]},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},fields:{type:Object,required:!0}},emits:["change","error","update:files"],inject:["compose","translate","txlanguages"],data(){return{translating:{},composing:{},errors:{}}},setup(){return{messages:N()}},methods:{addFile(e){const t=Array.isArray(e)?e:[e],s=[...this.files];s.push(...t),this.$emit("update:files",s)},composeText(e){const t=["generate for: "+(this.fields[e].label||e),"required output format: "+this.fields[e].type,this.fields[e].min?"minimum characters: "+this.fields[e].min:null,this.fields[e].max?"maximum characters: "+this.fields[e].max:null,this.fields[e].placeholder?"hint text: "+this.fields[e].placeholder:null,"context information as JSON: "+JSON.stringify(this.data)];this.composing[e]=!0,this.compose(this.data[e]??"",t).then(s=>{this.update(e,s)}).finally(()=>{this.composing[e]=!1})},error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},removeFile(e){const t=Array.isArray(e)?e:[e],s=[...this.files];for(const o of t){const r=s.findIndex(n=>n===o);r!==-1&&s.splice(r,1)}this.$emit("update:files",s)},translateText(e,t){this.translating[e]=!0,this.translate([this.data[e]],t).then(s=>{this.update(e,s[0]||"")}).finally(()=>{this.translating[e]=!1})},update(e,t){this.data[e]=t,this.$emit("change",this.data[e])},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(s=>{e.push(s.validate())}),Promise.all(e).then(s=>s.every(o=>o))}}},ee={key:0,class:"actions"};function te(e,t,s,o,r,n){return h(!0),b($,null,E(s.fields,(d,a)=>{var y,f,x;return h(),b("div",{key:a,class:O(["item",{error:r.errors[a]}])},[d.type!=="hidden"?(h(),_(U,{key:0},{default:i(()=>[c(u(e.$gettext(d.label||a).replace(/-/g," "))+" ",1),!s.readonly&&["markdown","plaintext","string","text"].includes(d.type)?(h(),b("div",ee,[l(T,null,{activator:i(({props:p})=>[l(m,S({loading:r.translating[a]||!1,icon:"mdi-translate",variant:"flat"},{ref_for:!0},p),null,16,["loading"])]),default:i(()=>[l(w,null,{default:i(()=>[(h(!0),b($,null,E(n.txlanguages(),p=>(h(),_(v,{key:p.code},{default:i(()=>[l(m,{variant:"text",onClick:D=>n.translateText(a,p.code)},{default:i(()=>[c("ðŸ – "+u(p.name)+" ("+u(p.code)+")",1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),l(m,{loading:r.composing[a]||!1,icon:"mdi-creation",variant:"flat",onClick:p=>n.composeText(a)},null,8,["loading","onClick"])])):k("",!0)]),_:2},1024)):k("",!0),(h(),_(j(((f=(y=d.type)==null?void 0:y.charAt(0))==null?void 0:f.toUpperCase())+((x=d.type)==null?void 0:x.slice(1))),{ref_for:!0,ref:"field",assets:s.assets,config:d,readonly:s.readonly,modelValue:s.data[a],onAddFile:t[0]||(t[0]=p=>n.addFile(p)),onRemoveFile:t[1]||(t[1]=p=>n.removeFile(p)),"onUpdate:modelValue":p=>n.update(a,p),onError:p=>n.error(a,p)},null,40,["assets","config","readonly","modelValue","onUpdate:modelValue","onError"]))],2)}),128)}const Ee=P(X,[["render",te],["__scopeId","data-v-bcb217ac"]]),Ve=function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",t=new Date("2025-01-01T00:00:00Z").getTime();let s=0;return function(){s=(s+1)%8;const o=(Date.now()-t)/256<<3|s;return Array.from({length:6},(r,n)=>{const d=o>>6*(5-n)&63;return e[n===0?d%52:d]}).join("")}}(),se={props:{type:{type:String,required:!0}},emits:["add"],data:()=>({tab:["basic"]}),setup(){return{schemas:F()}},computed:{groups(){const e={};for(const t in this.schemas[this.type]||{}){const s=this.schemas[this.type][t],o=s.group||this.$gettext("uncategorized");s.type=t,e[o]=e[o]||[],e[o].push(s)}return e}},methods:{add(e){this.$emit("add",{type:e.type})}}},ae=["innerHTML"];function ie(e,t,s,o,r,n){return h(),b($,null,[l(B,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=d=>e.tab=d)},{default:i(()=>[(h(!0),b($,null,E(n.groups,(d,a)=>(h(),_(M,{key:a,value:a},{default:i(()=>[c(u(e.$gettext(a)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(q,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=d=>e.tab=d)},{default:i(()=>[(h(!0),b($,null,E(Object.keys(n.groups),d=>(h(),_(J,{key:d,value:d},{default:i(()=>[l(R,null,{default:i(()=>[(h(!0),b($,null,E(n.groups[d],a=>(h(),_(m,{key:a.type,onClick:y=>n.add(a),variant:"text",stacked:""},{prepend:i(()=>[g("span",{class:"icon",innerHTML:a.icon},null,8,ae)]),default:i(()=>[c(" "+u(a.type),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],64)}const le=P(se,[["render",ie],["__scopeId","data-v-37391eac"]]),re={components:{SchemaItems:le},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,vschemas:!1,checked:!1,loading:!0,trash:!1}},setup(){const e=N();return{auth:H(),messages:e}},created(){this.search(),this.searchd=this.debounce(this.search,500)},computed:{canTrash(){return this.items.some(e=>e._checked&&!e.deleted_at)},isChecked(){return this.items.some(e=>e._checked)},isTrashed(){return this.items.some(e=>e._checked&&e.deleted_at)}},methods:{add(e){if(this.embed||!this.auth.can("element:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}return this.$apollo.mutate({mutation:C`mutation($input: ElementInput!) {
            addElement(input: $input) {
              id
              lang
              name
              type
              data
              editor
              created_at
              updated_at
              deleted_at
            }
          }`,variables:{input:{type:e.type,name:this.$gettext("New shared element"),data:"{}"}}}).then(t=>{var o;if(t.errors)throw t.errors;const s=((o=t.data)==null?void 0:o.addElement)||{};return s.data=JSON.parse(s.data)||{},s.published=!0,this.vschemas=!1,this.items.unshift(s),this.$emit("select",s),this.invalidate(),s}).catch(t=>{this.$log("ElementListItems::add(): Error adding shared element",t)})},drop(e){if(!this.auth.can("element:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:C`
            mutation($id: [ID!]!) {
              dropElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error trashing shared element"),"error"),this.$log("ElementListItems::drop(): Error trashing shared element",t,s)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"elements"}),e.gc()},keep(e){if(!this.auth.can("element:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:C`
            mutation($id: [ID!]!) {
              keepElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(o=>{o.deleted_at=null}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error restoring shared element"),"error"),this.$log("ElementListItems::keep(): Error restoring shared element",t,s)})},publish(e){if(!this.auth.can("element:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked&&s.id&&!s.published);t.length&&this.$apollo.mutate({mutation:C`mutation ($id: [ID!]!) {
            pubElement(id: $id) {
              id
            }
          }`,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(o=>{o.published=!0,o._checked=!1}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error publishing shared element"),"error"),this.$log("ElementListItems::publish(): Error publishing shared element",t,s)})},purge(e){if(!this.auth.can("element:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:C`
            mutation($id: [ID!]!) {
              purgeElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error purging shared element"),"error"),this.$log("ElementListItems::purge(): Error purging shared element",t,s)})},search(){if(!this.auth.can("element:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const e=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.publish,delete s.trashed,this.term&&(s.any=this.term),this.loading=!0,this.$apollo.query({query:C`
            query($filter: ElementFilter, $sort: [QueryElementsSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              elements(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  type
                  data
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:s,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:e}}).then(o=>{var n;if(o.errors)throw o.errors;const r=o.data.elements||{};return this.last=((n=r.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...r.data||[]].map(d=>{var y,f,x,p,D,L;const a=(y=d.latest)!=null&&y.data?JSON.parse((f=d.latest)==null?void 0:f.data):{...d,data:JSON.parse(d.data||"{}")};return Object.assign(a,{id:d.id,deleted_at:d.deleted_at,created_at:d.created_at,updated_at:((x=d.latest)==null?void 0:x.created_at)||d.updated_at,editor:((p=d.latest)==null?void 0:p.editor)||d.editor,published:((D=d.latest)==null?void 0:D.published)??!0,publish_at:((L=d.latest)==null?void 0:L.publish_at)||null,latest:d.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(o=>{this.messages.add(this.$gettext("Error fetching shared elements"),"error"),this.$log("ElementListItems::search(): Error fetching shared element",o)})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(e=>{e._checked=!e._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},ne={class:"header"},de={class:"bulk"},oe={class:"search"},ue={class:"layout"},he=["onClick","title"],me={class:"item-text"},ce={class:"item-head"},pe={key:1,class:"item-lang"},fe={class:"item-title"},ge={class:"item-type item-subtitle"},ve={class:"item-aux"},_e={class:"item-editor"},be={class:"item-modified item-subtitle"},ke={key:0,class:"loading"},ye={key:1,class:"notfound"},xe={key:3,class:"btn-group"};function $e(e,t,s,o,r,n){const d=Z("SchemaItems");return h(),b($,null,[g("div",ne,[g("div",de,[l(A,{modelValue:r.checked,"onUpdate:modelValue":t[0]||(t[0]=a=>r.checked=a),onClick:t[1]||(t[1]=W(a=>n.toggle(),["stop"]))},null,8,["modelValue"]),l(T,{location:"bottom left"},{activator:i(({props:a})=>[l(m,S({"append-icon":"mdi-menu-down",variant:"text"},a),{default:i(()=>[c(u(e.$gettext("Actions")),1)]),_:2},1040)]),default:i(()=>[l(w,null,{default:i(()=>[V(l(v,null,{default:i(()=>[l(m,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=a=>n.publish())},{default:i(()=>[c(u(e.$gettext("Publish")),1)]),_:1})]),_:1},512),[[I,n.isChecked&&o.auth.can("element:publish")]]),!this.embed&&o.auth.can("element:add")?(h(),_(v,{key:0},{default:i(()=>[l(m,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[3]||(t[3]=a=>r.vschemas=!0)},{default:i(()=>[c(u(e.$gettext("Add element")),1)]),_:1})]),_:1})):k("",!0),V(l(v,null,{default:i(()=>[l(m,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=a=>n.drop())},{default:i(()=>[c(u(e.$gettext("Trash")),1)]),_:1})]),_:1},512),[[I,n.canTrash&&o.auth.can("element:drop")]]),V(l(v,null,{default:i(()=>[l(m,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=a=>n.keep())},{default:i(()=>[c(u(e.$gettext("Restore")),1)]),_:1})]),_:1},512),[[I,n.isTrashed&&o.auth.can("element:keep")]]),V(l(v,null,{default:i(()=>[l(m,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=a=>n.purge())},{default:i(()=>[c(u(e.$gettext("Purge")),1)]),_:1})]),_:1},512),[[I,n.isChecked&&o.auth.can("element:purge")]])]),_:1})]),_:1})]),g("div",oe,[l(z,{modelValue:r.term,"onUpdate:modelValue":t[7]||(t[7]=a=>r.term=a),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:e.$gettext("Search for"),"hide-details":"",clearable:""},null,8,["modelValue","label"])]),g("div",ue,[l(T,null,{activator:i(({props:a})=>[l(m,S({"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text",location:"bottom right"},a),{default:i(()=>{var y,f,x;return[c(u(((y=r.sort)==null?void 0:y.column)==="ID"?((f=r.sort)==null?void 0:f.order)==="DESC"?e.$gettext("Latest"):e.$gettext("Oldest"):((x=r.sort)==null?void 0:x.column)||""),1)]}),_:2},1040)]),default:i(()=>[l(w,null,{default:i(()=>[l(v,null,{default:i(()=>[l(m,{variant:"text",onClick:t[8]||(t[8]=a=>r.sort={column:"ID",order:"DESC"})},{default:i(()=>[c(u(e.$gettext("Latest")),1)]),_:1})]),_:1}),l(v,null,{default:i(()=>[l(m,{variant:"text",onClick:t[9]||(t[9]=a=>r.sort={column:"ID",order:"ASC"})},{default:i(()=>[c(u(e.$gettext("Oldest")),1)]),_:1})]),_:1}),l(v,null,{default:i(()=>[l(m,{variant:"text",onClick:t[10]||(t[10]=a=>r.sort={column:"NAME",order:"ASC"})},{default:i(()=>[c(u(e.$gettext("Name")),1)]),_:1})]),_:1}),l(v,null,{default:i(()=>[l(m,{variant:"text",onClick:t[11]||(t[11]=a=>r.sort={column:"TYPE",order:"ASC"})},{default:i(()=>[c(u(e.$gettext("Type")),1)]),_:1})]),_:1}),l(v,null,{default:i(()=>[l(m,{variant:"text",onClick:t[12]||(t[12]=a=>r.sort={column:"EDITOR",order:"ASC"})},{default:i(()=>[c(u(e.$gettext("Editor")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),l(w,{class:"items"},{default:i(()=>[(h(!0),b($,null,E(r.items,(a,y)=>(h(),_(v,{key:y},{default:i(()=>[l(A,{modelValue:a._checked,"onUpdate:modelValue":f=>a._checked=f,class:O([{draft:!a.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),l(T,null,{activator:i(({props:f})=>[l(m,S({class:"item-menu",icon:"mdi-dots-vertical",variant:"text"},{ref_for:!0},f),null,16)]),default:i(()=>[l(w,null,{default:i(()=>[V(l(v,null,{default:i(()=>[l(m,{"prepend-icon":"mdi-publish",variant:"text",onClick:f=>n.publish(a)},{default:i(()=>[c(u(e.$gettext("Publish")),1)]),_:2},1032,["onClick"])]),_:2},1536),[[I,!a.deleted_at&&!a.published&&this.auth.can("element:publish")]]),!a.deleted_at&&this.auth.can("element:drop")?(h(),_(v,{key:0},{default:i(()=>[l(m,{"prepend-icon":"mdi-delete",variant:"text",onClick:f=>n.drop(a)},{default:i(()=>[c(u(e.$gettext("Trash")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),a.deleted_at&&this.auth.can("element:keep")?(h(),_(v,{key:1},{default:i(()=>[l(m,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:f=>n.keep(a)},{default:i(()=>[c(u(e.$gettext("Restore")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0),this.auth.can("element:purge")?(h(),_(v,{key:2},{default:i(()=>[l(m,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:f=>n.purge(a)},{default:i(()=>[c(u(e.$gettext("Purge")),1)]),_:2},1032,["onClick"])]),_:2},1024)):k("",!0)]),_:2},1024)]),_:2},1024),g("div",{class:O(["item-content",{trashed:a.deleted_at}]),onClick:f=>e.$emit("select",a),title:n.title(a)},[g("div",me,[g("div",ce,[a.publish_at?(h(),_(K,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):k("",!0),a.lang?(h(),b("span",pe,u(a.lang),1)):k("",!0),g("span",fe,u(a.name),1)]),g("div",ge,u(a.type),1)]),g("div",ve,[g("div",_e,u(a.editor),1),g("div",be,u(new Date(a.updated_at).toLocaleString()),1)])],10,he)]),_:2},1024))),128))]),_:1}),r.loading?(h(),b("p",ke,[c(u(e.$gettext("Loading"))+" ",1),t[17]||(t[17]=g("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),g("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),g("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):k("",!0),!r.loading&&!r.items.length?(h(),b("p",ye,u(e.$gettext("No entries found")),1)):k("",!0),r.last>1?(h(),_(Q,{key:2,modelValue:r.page,"onUpdate:modelValue":t[13]||(t[13]=a=>r.page=a),length:r.last},null,8,["modelValue","length"])):k("",!0),!this.embed&&this.auth.can("element:add")?(h(),b("div",xe,[l(m,{onClick:t[14]||(t[14]=a=>r.vschemas=!0),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"})])):k("",!0),(h(),_(G,{to:"body"},[l(Y,{modelValue:r.vschemas,"onUpdate:modelValue":t[16]||(t[16]=a=>r.vschemas=a),scrollable:"",width:"auto"},{default:i(()=>[l(d,{type:"content",onAdd:t[15]||(t[15]=a=>n.add(a))})]),_:1},8,["modelValue"])]))],64)}const Ie=P(re,[["render",$e],["__scopeId","data-v-e81e5d1f"]]);export{Ie as E,Ee as F,le as S,Ve as u};
