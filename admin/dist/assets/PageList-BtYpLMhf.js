var Yt=Object.defineProperty;var Xt=(e,t,n)=>t in e?Yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var we=(e,t,n)=>Xt(e,typeof t!="symbol"?t+"":t,n);import{U as Gt,A as Zt,N as Qt}from"./Navigation-BddgMFLq.js";import{ag as Ae,r as U,c as O,o as m,a as u,w as d,F as B,a1 as ae,aA as K,aB as ye,O as Oe,n as X,aC as Ue,Q as pt,aj as en,aD as lt,f as x,b as v,as as j,j as k,t as N,d as C,_ as Z,I as H,aE as vt,an as Fe,$ as _e,a0 as yt,h as ue,aF as Ye,G as $e,D as de,a3 as D,aG as Ne,aH as V,E as Se,i as ke,aI as ie,aJ as bt,aK as je,aL as tn,aw as he,aM as nn,ay as nt,aN as kt,aO as at,aP as Ee,ao as _t,T as rt,aQ as Pe,a2 as Ct,a4 as Dt,a5 as wt,a6 as St,aR as jt,V as qe,e as me,ad as Ve,aS as st,aT as ce,aU as Et,aV as be,ap as an,aq as rn,ar as sn,aW as Bt,aX as Ht,aY as Kt,W as ln,aZ as on,at as dn}from"../index.js";import{H as un,A as cn}from"./HistoryDialog-CI7a4V_R.js";import{S as Pt,F as Ot,u as Xe,E as hn}from"./ElementListItems-BcCRb1Ts.js";import{l as fn}from"./vue-draggable-plus-BDMZhDjn.js";var pn=!1,mn=!0;/*!
 * helper-js v3.1.6
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function Ge(e){return Object.prototype.toString.call(e)==="[object Array]"}function Vt(e){return Object.prototype.toString.call(e)==="[object Object]"}function gn(e){return typeof e=="function"}function vn(e,t){return e<t?e:t}function Mt(e,t){let n,r=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),r++;return r}function Rt(e){return e[e.length-1]}function yn(e){return Ge(e)?e:[e]}function bn(e,t){let n=new Set(t);const r={};return n.forEach(i=>{r[i]=e[i]}),r}function kn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(Vt(e)){const n=Object.keys(e);n.reverse();for(const r of n){const i={value:e[r],key:r};(!t.exclude||!t.exclude(i))&&(yield i)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(Vt(e))for(const n of Object.keys(e)){const r={value:e[n],key:n};(!t.exclude||!t.exclude(r))&&(yield r)}else throw"Unsupported type"}()}function _n(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function qt(e,t){return Object.keys(t).forEach(n=>{_n(e,n,t[n])}),e}function Cn(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function ee(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=qt({...n},{childrenKey:"children"});const{childrenKey:r}=n,i=Ge(e)?e:[e];class a{}const o=(s,h,l)=>{n.reverse&&(s=s.slice(),s.reverse());const c=s.length;for(let p=0;p<c;p++){const f=s[p],g=n.reverse?c-p-1:p,y=l?[...l,g]:[];n.childFirst&&f[r]!=null&&o(f[r],f,y);const S=t(f,g,h,y);if(S===!1)throw new a;if(S==="skip children")continue;if(S==="skip siblings")break;n.childFirst||f[r]!=null&&o(f[r],f,y)}};try{o(i,null,Ge(e)?[]:null)}catch(s){if(!(s instanceof a))throw s}}function Dn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r;return ee(e,function(){if(t(...arguments))return r={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),r}function wn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Dn(e,t,n);return r==null?void 0:r.node}function zt(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:r,nodeHandler:i}=n,a=new mt;return a.childrenKey=r,ee(e,(o,s,h,l)=>{let c=Object.assign({},o);c[r]&&(c[r]=[]),i&&(c=i(c,{oldNode:o,index:s,parent:h,path:l})),a.set(l,c)},{childrenKey:r}),a.data}class mt{constructor(){we(this,"data");we(this,"childrenKey","children");let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return Ge(n)?n:n[t]}iteratePath(t){var n=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{childrenKey:i,rootChildren:a}=n;if(r.reverse){const o=[...n.iteratePath(t,{...r,reverse:!1})];o.reverse();for(const{path:s,node:h}of o)yield{path:s,node:h}}else{let o=[],s=a;for(const h of t){const l=[...o,h],c=s[h];yield{path:l,node:c},o=l,s=c[i]}}}()}getFamily(t){const n=[];for(const{node:r}of this.iteratePath(t))n.push(r);return n}get(t){return Rt(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),r=n.pop();return{parent:this.get(n),index:r,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:r}=this;let{rootChildren:i}=this;const{parent:a,index:o}=this.getParentAndIndex(t);let s;t.length===1?(i||(this.data?this.data[r]=[]:this.data=[]),s=i):(a[r]||(a[r]=[]),s=a[r]),s[o]=n}}delete(t){const{childrenKey:n,rootChildren:r}=this,{parent:i,index:a}=this.getParentAndIndex(t),o=t.length===1?r:i[n],s=o[a];return o.splice(a,1),s}walk(t,n){const{childrenKey:r,data:i}=this;return ee(i,t,r,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return zt(this.data),Cn({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function It(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return gn(e)?e(...t):e}function Sn(e,t){return function(){let r,i;try{r=e(...arguments)}catch(a){i=a}finally{}if(i)throw i;return r}}function Ie(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let r;const i={};let a=i;return{action:function(){for(var h=arguments.length,l=new Array(h),c=0;c<h;c++)l[c]=arguments[c];if(l.length===0)return a===i&&(a=e()),a;if(r||(r=new Vn),!r.has(l)&&(r.set(l,e(...l)),t.capacity!=null)){n.push(l);const p=n.splice(0,n.length-t.capacity);for(const f of p)r.delete(f)}return r.get(l)},clearCache:()=>{r=null,n.splice(0,n.length)}}}function En(){let e,t;return{promise:new Promise((r,i)=>{e=r,t=i}),resolve:e,reject:t}}function Pn(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function ot(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,r=t.bottom,i=t.left-document.documentElement.clientLeft,a=t.right,o=t.width||a-i,s=t.height||r-n,c={top:n,right:a,bottom:r,left:i,width:o,height:s,x:i,y:n};t={...c,toJSON:()=>c}}return t}function xt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n&&n.withSelf?e:e.parentElement;for(;r;){const i=n.until&&r===n.until;if(i&&!n.withUntil)return;const a=t(r);if(a==="break")return;if(a)return r;if(i)return;r=r.parentElement}}function Ze(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function Tt(e,t){for(const n of t)if(Ze(e,n))return!0;return!1}function te(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent(`on${t}`,n,r)}function ne(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent(`on${t}`,n,r)}function On(e){let t=[];const n=()=>{if(!i.listening){for(const a of e){te.apply(this,a);const o=()=>ne.apply(this,a);t.push(o)}i.listening=!0}},i={listening:!1,stop:()=>{if(i.listening){for(const a of t)a();t=[],i.listening=!1}},resume:n,start:n};return i.start(),i}function Qe(e,t){return getComputedStyle(e)[t]}function gt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:r,end:i}=n;const{returnNearestIfNoHit:a,maxTimes:o}=n;let s,h;r==null&&(r=0,i=e.length-1);let l=0,c;for(;r>=0&&r<=i;){if(l>=o)throw Error(`binarySearch: loop times is over ${o}, you can increase the limit.`);s=Math.floor((i-r)/2+r),h=e[s];const p=l+1;if(c=t(h,s,p),c>0)i=s-1;else if(c<0)r=s+1;else return{index:s,value:h,count:p,hit:!0};l++}return a?{index:s,value:h,count:l+1,hit:!1,greater:c>0}:null}class Vn{constructor(){we(this,"_map",new Map);we(this,"_values",{});we(this,"_objCount",0)}_keysToString(t){const{_map:n}=this;let r=[];for(const i of t){if(!n.has(i))return null;r.push(n.get(i)[0])}return r.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,r=this._keysToString(t);if(r==null)throw"Value not found by specified keys";return n[r][1]}set(t,n){const{_map:r,_values:i}=this;let a=[];for(const o of t){let s,h=1;r.has(o)?([s,h]=r.get(o),h++):(this._objCount++,s=this._objCount.toString()),r.set(o,[s,h]),a.push(s)}i[a.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:r}=this,i=this._keysToString(t);if(i==null)throw"Value not found by specified keys";delete n[i];for(const a of t){let[o,s]=r.get(a);s--,s===0?r.delete(a):r.set(a,[o,s])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[r,i]=t[n];yield[r,i]}}count(){return[...this.entries()].length}}/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const In=Ae({props:{table:Boolean}}),Wt=(e,t)=>{const n=e.__vccOpts||e;for(const[r,i]of t)n[r]=i;return n},xn={key:0},Tn={key:1};function Ln(e,t,n,r,i,a){return e.table?(m(),O("table",xn,[K(e.$slots,"prepend"),x("tbody",null,[K(e.$slots,"default")]),K(e.$slots,"append")])):(m(),O("div",Tn,[K(e.$slots,"prepend"),K(e.$slots,"default"),K(e.$slots,"append")]))}const Un=Wt(In,[["render",Ln]]),$n=Ae({components:{VirtualListTable:Un},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=Oe(0),n=Oe(e.firstRender-1),r=X(()=>{var P;return vn(n.value,(((P=e.items)==null?void 0:P.length)||1)-1)}),i=Oe(0),a=X(()=>f.value[t.value]?De(t.value):0),o=X(()=>f.value.length>0?De(f.value.length-1)+Rt(p.value):0),s=X(()=>f.value[r.value]?o.value-De(r.value)-p.value[r.value]:0),h=X(()=>e.disabled?{}:{overflow:"auto"}),l=X(()=>{const P={display:"flex"};return e.disabled||(e.horizontal?Object.assign(P,{"margin-left":a.value+"px","margin-right":s.value+"px",width:o.value-s.value-a.value+"px"}):Object.assign(P,{"margin-top":a.value+"px","margin-bottom":s.value+"px"})),P["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete P.display,delete P["flex-direction"]),P}),c=X(()=>Ue((e.items||[]).map(()=>null))),p=X(()=>(e.items||[]).map((P,w)=>{var _;if(c[w]!=null)return c[w];let F=(_=e.itemSize)==null?void 0:_.call(e,P,w);return F==null&&(F=i.value),F})),f=X(()=>{const P=[];return p.value.reduce((w,_)=>(P.push(w),w+_),0),P});pt(()=>e.items,$);const g=X(()=>{if(!e.items||e.disabled)return;const P=[];for(let w=t.value;w<=r.value;w++){const _=e.items[w];if(!_)break;P.push({item:_,index:w})}return P}),y=Oe(),S=Oe();en(async()=>{$();try{it()}catch{await lt(),$()}});let I;function A(){const P=y.value;if(!P)return;const w=oe(P);I!=null&&e.buffer-Math.abs(w-I)>=10||(I=w,$())}let M=!1,re=!1;async function $(){var P;if(M){re=!0;return}if(!e.items||e.disabled)return;M=!0;const w=y.value,_=(P=S.value)==null?void 0:P.$el;if(!w||!_)return;i.value||(i.value=Me()),t.value=He(),n.value=Ke(),await lt();let F,G=0;const z={},fe=e.table?_.querySelector("tbody").children:_.children;for(let T=0;T<fe.length;T++){const L=fe[T],R=Qe(L,"position");if(R&&["absolute","fixed"].includes(R))continue;const se=Qe(L,"display")!=="none"?Ce(L):0,pe=L.getAttribute("vt-index"),Re=pe?parseInt(pe):t.value+G;z[Re]=(z[Re]||0)+se,G++}for(const T of Object.keys(z)){const L=parseInt(T);c.value[L]!==z[L]&&(c.value[L]=z[L],F=!0)}F&&await lt(),M=!1,re&&(re=!1,$());function He(){const T=oe(w)-q(w)-e.buffer;return gt(f.value,L=>L-T,{returnNearestIfNoHit:!0}).index}function Ke(){const T=oe(w)-q(w)+Q(w)+e.buffer;return gt(f.value,L=>L-T,{returnNearestIfNoHit:!0}).index}function Me(){const T=[],L=e.table?_.querySelector("tbody").children:_.children;for(let R=0;R<L.length;R++){const se=L[R],pe=getComputedStyle(se);if(["absolute","fixed"].includes(pe.position))continue;const Re=Ce(se);if(T.push(Re),T.length>=10)break}return T.length===0?0:T.reduce((R,se)=>R+se,0)/T.length}}function Q(P){const w=getComputedStyle(P);let _=parseFloat(e.horizontal?w.width:w.height);return w.boxSizing==="border-box"&&(e.horizontal?_=_-parseFloat(w.borderLeftWidth)-parseFloat(w.borderRightWidth):_=_-parseFloat(w.borderTopWidth)-parseFloat(w.borderBottomWidth)),_}function Ce(P){let w=Q(P);const _=getComputedStyle(P);return e.horizontal?w+=parseFloat(_.borderLeftWidth)+parseFloat(_.borderRightWidth)+parseFloat(_.marginLeft)+parseFloat(_.marginRight):w+=parseFloat(_.borderTopWidth)+parseFloat(_.borderBottomWidth)+parseFloat(_.marginTop)+parseFloat(_.marginBottom),w=Number.isNaN(w)?0:w,w}function oe(P){return e.horizontal?P.scrollLeft:P.scrollTop}function q(P){const w=getComputedStyle(P);return e.horizontal?parseFloat(w.paddingLeft):parseFloat(w.paddingTop)}function De(P){return f.value[P]}function it(){const P=y.value;new ResizeObserver(w=>{for(let _ of w)if(Ze(_.target,"vtlist")){$();break}}).observe(P)}function Be(P,w){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return w;if(typeof e.itemKey=="function")return e.itemKey(P,w)}}return{listElRef:y,listInnerRef:S,onscroll:A,listStyle:h,listInnerStyle:l,visibleItemsInfo:g,getItemKey:Be,update:$,sizes:p,positions:f,runtimeSizes:c}}});function Nn(e,t,n,r,i,a){const o=U("VirtualListTable");return m(),O("div",{class:"vtlist",ref:"listElRef",style:ye(e.listStyle),onScrollPassive:t[0]||(t[0]=(...s)=>e.onscroll&&e.onscroll(...s))},[u(o,{class:"vtlist-inner",ref:"listInnerRef",style:ye(e.listInnerStyle),table:e.table},{prepend:d(()=>[K(e.$slots,"prepend")]),append:d(()=>[K(e.$slots,"append")]),default:d(()=>[e.disabled?(m(!0),O(B,{key:0},ae(e.items,(s,h)=>K(e.$slots,"default",{key:e.getItemKey(s,h),item:s,index:h})),128)):(m(!0),O(B,{key:1},ae(e.visibleItemsInfo,({item:s,index:h})=>K(e.$slots,"default",{key:e.getItemKey(s,h),item:s,index:h})),128))]),_:3},8,["style","table"])],36)}const An=Wt($n,[["render",Nn]]);/*!
 * @he-tree/tree-utils v0.1.0-alpha.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const ve="children";function Fn(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={...jn,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:a,childrenKey:o}=this,s=new mt([]);this._statsMap=new Map,ee(a,(l,c,p,f)=>{const g=this.statHandler({...Lt(),data:l,open:!!this.defaultOpen,parent:s.getParent(f),children:[],level:f.length});this._statsMap.set(l,g),s.set(f,g)},{childrenKey:o});const h=[];s.walk(l=>{h.push(l)}),this.stats=this.statsHandler(s.rootChildren),this.statsFlat=this.statsFlatHandler(h),this.initialized=!0},getStat(a){let o=this._statsMap.get(a);if(!o)throw new Ut("Stat not found");return o},has(a){if(a.isStat)return this.statsFlat.indexOf(a)>-1;try{return!!this.getStat(a)}catch(o){if(o instanceof Ut)return!1;throw o}},_getPathByStat(a){if(a==null)return[];const s=this.getSiblings(a).indexOf(a);return[...a.parent?this._getPathByStat(a.parent):[],s]},afterOneCheckChanged(a){const{checked:o}=a;if(a._ignoreCheckedOnce)return delete a._ignoreCheckedOnce,!1;const s=h=>{const{parent:l}=h;if(l){let c,p,f;for(const y of l.children)y.checked?c=!0:y.checked===0?f=!0:p=!0;const g=f?0:p?c?0:!1:!0;l.checked!==g&&(this._ignoreCheckedOnce(l),l.checked=g),s(l)}};return s(a),ee(a.children,h=>{h.checked!==o&&(this._ignoreCheckedOnce(h),h.checked=o)},{childrenKey:ve}),!0},_ignoreCheckedOnce(a){a._ignoreCheckedOnce=!0,setTimeout(()=>{a._ignoreCheckedOnce&&(a._ignoreCheckedOnce=!1)},100)},isVisible(a){const o=a.isStat?a:this.getStat(a),s=h=>!h||!h.hidden&&h.open&&s(h.parent);return!!(!o.hidden&&s(o.parent))},updateCheck(){ee(this.stats,a=>{if(a.children&&a.children.length>0){const o=a.children.every(s=>s.checked);a.checked!==o&&(this._ignoreCheckedOnce(a),a.checked=o)}},{childFirst:!0,childrenKey:ve})},getChecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(o=>o.checked||a&&o.checked===0)},getUnchecked(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(o=>a?!o.checked:o.checked===!1)},openAll(){for(const a of this.statsFlat)a.open=!0},closeAll(){for(const a of this.statsFlat)a.open=!1},openNodeAndParents(a){const o=a.isStat?a:this.getStat(a);for(const s of this.iterateParent(o,{withSelf:!0}))s.open=!0},_calcFlatIndex(a,o){let s=a?this.statsFlat.indexOf(a)+1:0;const h=a?a.children:this.stats;for(let l=0;l<o;l++)s+=this._count(h[l]);return s},add(a,o,s){if(this.has(a))throw"Can't add because data exists in tree";const h=o?o.children:this.stats;s==null&&(s=h.length);const l=this.statHandler({...Lt(),open:!!this.defaultOpen,data:a,parent:o||null,children:[],level:o?o.level+1:1});this._setPosition(l,o||null,s);const c=a[this.childrenKey];if(c){const p=c.slice();for(const f of p)this.add(f,l)}},remove(a){const o=this.getSiblings(a);if(o.includes(a)){Mt(o,a);const s=this._flat(a);this.statsFlat.splice(this.statsFlat.indexOf(a),s.length);for(const h of s)this._statsMap.delete(h.data);return this.afterRemoveStat(a),!0}return!1},getSiblings(a){const{parent:o}=a;return o?o.children:this.stats},_setPosition(a,o,s){(o?o.children:this.stats).splice(s,0,a),a.parent=o,a.level=o?o.level+1:1;const l=this._calcFlatIndex(o,s),c=this._flat(a);this.statsFlat.splice(l,0,...c);for(const p of c)this._statsMap.has(p.data)||this._statsMap.set(p.data,p);ee(a,(p,f,g)=>{g&&(p.level=g.level+1)},{childrenKey:ve}),this.afterSetStat(a,o,s)},*iterateParent(a,o){let s=o!=null&&o.withSelf?a:a.parent;for(;s;)yield s,s=s.parent},move(a,o,s){if(this.has(a)){if(a.parent===o&&this.getSiblings(a).indexOf(a)===s)return!1;if(a===o)throw new Error("Can't move node to it self");if(o&&a.level<o.level){let h;for(const l of this.iterateParent(o))if(l.level===a.level){h=l;break}if(a===h)throw new Error("Can't move node to its descendant")}this.remove(a)}return this._setPosition(a,o,s),!0},_flat(a){const o=[];return ee(a,s=>{o.push(s)},{childrenKey:ve}),o},_count(a){return this._flat(a).length},getData(a,o){const{childrenKey:s}=this,h=new mt([]);return h.childrenKey=s,ee(o||this.stats,(l,c,p,f)=>{let g={...l.data,[s]:[]};a&&(g=a(g)),h.set(f,g)},{childrenKey:ve}),h.data}},i=r;return r.noInitialization||i.init(),i}const jn={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function Lt(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class Ut extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}/*!
 * drag-event-service v2.0.0
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const ze={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},dt={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,r){const{args:i,mouseArgs:a,touchArgs:o}=$t(r),s=this._getStore(e),h=this,l=function(c){let p;if(h.isTouch(c))p={x:c.changedTouches[0].pageX,y:c.changedTouches[0].pageY,pageX:c.changedTouches[0].pageX,pageY:c.changedTouches[0].pageY,clientX:c.changedTouches[0].clientX,clientY:c.changedTouches[0].clientY,screenX:c.changedTouches[0].screenX,screenY:c.changedTouches[0].screenY};else if(p={x:c.pageX,y:c.pageY,pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,screenX:c.screenX,screenY:c.screenY},t==="start"&&c.which!==1)return;return n.call(this,c,p)};s.push({handler:n,wrapper:l}),te.call(null,e,ze[t][0],l,...i,...a),te.call(null,e,ze[t][1],l,...i,...o)},off(e,t,n,r){const{args:i,mouseArgs:a}=$t(r),o=this._getStore(e);for(let s=o.length-1;s>=0;s--){const{handler:h,wrapper:l}=o[s];n===h&&(ne.call(null,e,ze[t][0],l,...i,...a),ne.call(null,e,ze[t][1],l,...i,...a),o.splice(s,1))}}};function $t(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],r=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:r}}/*!
 * @he-tree/dnd-utils v0.1.0-alpha.4
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const ut=new Map,le={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},Y=le;function xe(e){e.dataTransfer&&(e.dataTransfer.dropEffect=Y.dropEffect)}function Bn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ut.has(e))throw"Already registered on specified element";const n={...t},r=n;qt(n,Hn),dt.on(e,"start",i,{touchArgs:[{passive:!0}]}),dt.on(e,"end",a);function i(p){var f;const g=p.target;g.nodeType===Node.ELEMENT_NODE&&(Y.triggerElement=g);const y=g;if(n.ingoreHTMLTags&&y.tagName&&n.ingoreHTMLTags.find(I=>I.toUpperCase()===y.tagName))return;const S=(f=n.beforeDragStart)===null||f===void 0?void 0:f.call(n,p);S&&(S.setAttribute("draggable","true"),Y.dragElement=S)}function a(p){Y.dragElement&&Y.dragElement.removeAttribute("draggable")}function o(p){var f;Y.internal=!0,(f=n.onDragStart)===null||f===void 0||f.call(n,p),xe(p)}function s(p){var f;(f=n.onDrag)===null||f===void 0||f.call(n,p),xe(p)}function h(p){var f;(f=n.onDragEnd)===null||f===void 0||f.call(n,p),Y.internal=!1,Y.dragElement&&Y.dragElement.removeAttribute("draggable"),Y.triggerElement=null,Y.dragElement=null,Y.dropEffect="none"}const l=Mn(e,{onDragLeave(p){var f;(f=n.onDragLeave)===null||f===void 0||f.call(n,p),xe(p)},onDragEnter(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=n.onDragEnter)===null||f===void 0||f.call(n,p),xe(p)},onDragOver(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=n.onDragOver)===null||f===void 0||f.call(n,p),xe(p)},onDrop(p){var f;r.ifPreventDefault(p)&&p.preventDefault(),(f=n.onDrop)===null||f===void 0||f.call(n,p)},onEnter(p){var f;(f=n.onEnter)===null||f===void 0||f.call(n,p)},onLeave(p){var f;(f=n.onLeave)===null||f===void 0||f.call(n,p)}});return te(e,"dragstart",o),te(e,"drag",s),te(e,"dragend",h),Object.assign(n,{root:e,destroy:()=>{dt.off(e,"start",i,{touchArgs:[{passive:!0}]}),ne(e,"dragstart",o),ne(e,"drag",s),ne(e,"dragend",h),l(),ut.delete(e)}}),ut.set(e,r),r}const Hn={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return le.dragElement?!0:Y.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let et=null;const Kn=e=>{et=e,setTimeout(()=>{et=null},20)};function Mn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let r=!1;const i=g=>{var y;r=!0,(y=t.onEnter)===null||y===void 0||y.call(t,g),c.resume()},a=g=>{var y;Kn(g.target),(y=t.onDragEnter)===null||y===void 0||y.call(t,g),r||i(g)},o=g=>{var y;r||i(g),(y=t.onDragOver)===null||y===void 0||y.call(t,g)},s=g=>{var y;(y=t.onDragLeave)===null||y===void 0||y.call(t,g);const S=function(){var A;let M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:g;r=!1,(A=t.onLeave)===null||A===void 0||A.call(t,M),c.stop()},I=et;et=null,I&&Pn(I,n)||S()},h=g=>{var y;(y=t.onDrop)===null||y===void 0||y.call(t,g)},l=g=>{var y;g instanceof KeyboardEvent&&g.key!=="Escape"||(r=!1,c.stop(),(y=t.onEndBeforeLeave)===null||y===void 0||y.call(t,g))},c=On([[e,"drop",l],[window,"mouseup",l],[window,"touchend",l],[window,"keydown",l]]);c.stop();const p=()=>{te(e,"dragenter",a),te(e,"dragover",o),te(e,"dragleave",s),te(e,"drop",h)},f=()=>{ne(e,"dragenter",a),ne(e,"dragover",o),ne(e,"dragleave",s),ne(e,"drop",h),c.stop()};return p(),f}/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */let tt=!1;const Rn=()=>{tt=!0,setTimeout(()=>{tt=!1},100)},qn=Ae({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=X(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));pt(()=>e.stat.checked,a=>{tt||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),pt(()=>e.stat.open,a=>{tt||(t(a?"open":"close",e.stat),Rn())});const r=X(()=>{const a=[],o=c=>{var p;if(c.parent){let f=(p=c.parent)==null?void 0:p.children.indexOf(c);do{f++;let g=c.parent.children[f];if(g){if(!g.hidden)return!0}else break}while(!0)}return!1},s=e.rtl?"right":"left",h=e.btt?"top":"bottom";let l=e.stat;for(;l;){let c=(l.level-2)*e.indent+e.treeLineOffset;const p=o(l),f=()=>{a.push({style:{[s]:c+"px",[h]:p?0:"50%"}})};l===e.stat?l.level>1&&f():p&&f(),l=l.parent}return a}),i=X(()=>{let a=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:a+"px"}});return{indentStyle:n,vLines:r,hLineStyle:i}}}),Jt=(e,t)=>{const n=e.__vccOpts||e;for(const[r,i]of t)n[r]=i;return n},zn={class:"tree-node-inner"},Wn={key:1,class:"tree-node",ref:"el"};function Jn(e,t,n,r,i,a){return e.table?(m(),O("tr",Wn,[K(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(m(),O("div",{key:0,class:j(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:ye(e.indentStyle),ref:"el"},[e.treeLine?(m(),O(B,{key:0},[(m(!0),O(B,null,ae(e.vLines,o=>(m(),O("div",{class:"tree-line tree-vline",style:ye(o.style)},null,4))),256)),e.stat.level>1?(m(),O("div",{key:0,class:"tree-line tree-hline",style:ye(e.hLineStyle)},null,4)):C("",!0)],64)):C("",!0),x("div",zn,[K(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const Yn=Jt(qn,[["render",Jn]]);function Xn(e,t={}){const n={...t,statHandler(r){return this._statHandler2&&(r=this._statHandler2(r)),ct(t.statHandler,Ue(r))},statsHandler(r){return ct(t.statsHandler,Ue(r))},statsFlatHandler(r){return ct(t.statsFlatHandler,Ue(r))}};return Fn(e,n)}function ct(e,t){return e?e(t):t}const Gn=Ae({components:{VirtualList:An,TreeNode:Yn},props:{value:{required:pn,type:Array},modelValue:{required:mn,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>Xn([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(r=>t(r))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:ht(W("getStat")),has:ht(W("has")),updateCheck:W("updateCheck"),getChecked:W("getChecked"),getUnchecked:W("getUnchecked"),openAll:W("openAll"),closeAll:W("closeAll"),openNodeAndParents:W("openNodeAndParents"),isVisible:W("isVisible"),move:Nt("move"),add:ht(Nt("add")),addMulti(e,t,n){this.batchUpdate(()=>{let r=n;for(const i of e)this.add(i,t,r),r!=null&&r++})},remove:W("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:W("iterateParent"),getSiblings:W("getSiblings"),getData:W("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:r}=this;return n[r]||(n[r]=[]),n[r]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,r,i)=>{const{childrenKey:a,updateBehavior:o}=this;let s=this.valueComputed;if(o==="new"){if(this.batchUpdateWaiting)return;s=this.getData()}else if(o==="modify"){const h=t(r==null?void 0:r.data);h.includes(n.data)||h.splice(i,0,n.data)}this.batchUpdateWaiting||this._updateValue(s)},e.afterRemoveStat=n=>{var r;const{childrenKey:i,updateBehavior:a}=this;let o=this.valueComputed;if(a==="new"){if(this.batchUpdateWaiting)return;o=this.getData()}else if(a==="modify"){const s=t((r=n.parent)==null?void 0:r.data);Mt(s,n.data)}this.batchUpdateWaiting||this._updateValue(o)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,bn(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function W(e){return function(...t){return this.processor[e](...t)}}function Nt(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function ht(e){return function(t,...n){return t&&(t=Ue(t)),e.call(this,t,...n)}}const Zn={key:0,class:"drag-placeholder he-tree-drag-placeholder"},Qn=["colspan"],ea={class:"drag-placeholder he-tree-drag-placeholder"};function ta(e,t,n,r,i,a){const o=U("TreeNode"),s=U("VirtualList");return m(),v(s,{class:j(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:d(()=>[K(e.$slots,"prepend",{tree:e.self})]),default:d(({item:h,index:l})=>[u(o,{"vt-index":l,class:j([h.class,{"drag-placeholder-wrapper":h.data===e.placeholderData,"dragging-node":h===e.dragNode}]),style:ye(h.style),stat:h,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:c=>e.$emit("click:node",h),onOpen:t[0]||(t[0]=c=>e.$emit("open:node",c)),onClose:t[1]||(t[1]=c=>e.$emit("close:node",c)),onCheck:t[2]||(t[2]=c=>e.$emit("check:node",c))},{default:d(({indentStyle:c})=>[h.data===e.placeholderData?(m(),O(B,{key:0},[e.table?(m(),O("td",{key:1,style:ye(c),colspan:e.placeholderColspan},[x("div",ea,[K(e.$slots,"placeholder",{tree:e.self})])],12,Qn)):(m(),O("div",Zn,[K(e.$slots,"placeholder",{tree:e.self})]))],64)):K(e.$slots,"default",{key:1,node:h.data,stat:h,indentStyle:c,tree:e.self},()=>[k(N(h.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:d(()=>[K(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const na=Jt(Gn,[["render",ta]]);let E=null,b=null,Je,Le,ge,We,ft,J,At;const Te={get startInfo(){return Je},get targetInfo(){return Le}},aa=Ae({extends:na,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return It(this.rootDroppable,[this,E]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return It((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(l,c)=>{let p=!0;return E&&E!==this&&(p=p&&this._isMoved),this.table&&!this._isDragCopy&&(p=p&&this._isDragCopy),p&&(l.x!==c.x||l.y!==c.y)},t=(l,c)=>{b.ignoreUpdate(()=>{if(!b.has(b.placeholderData)){if(b.table){let f=0;const g=b.getRootEl().querySelector("tr");if(g)for(const{value:y}of kn(g.children))Qe(y,"display")!=="none"&&(f+=y.colSpan||1);f<1&&(f=1),b.placeholderColspan=f}b.add(b.placeholderData)}const p=b.getStat(b.placeholderData);b.move(p,l,c)})},n=()=>{const l=this;if(l.has(l.placeholderData))return l.remove(l.getStat(l.placeholderData)),!0},r=l=>{l?le.dropEffect=E!=null&&E.dragCopy?"copy":"move":le.dropEffect="none"},i=l=>{const c=this;l?r(!0):c.keepPlaceholder?c.has(c.placeholderData)||r(!1):(n(),r(!1))};let a={x:0,y:0};const o=this.getRootEl();let s=null;const h=()=>{b!=null&&b.has(b.placeholderData)&&b.ignoreUpdate(()=>{b.remove(b.getStat(b.placeholderData)),E&&(E.dragNode.hidden=!1,E.dragOvering=!1)})};this.treeDraggableInstance=Bn(o,{beforeDragStart:l=>{if(!le.triggerElement)return;let c=this.triggerClass;(!c||c.length===0)&&(c="tree-node");let p=yn(c),f=xt(le.triggerElement,g=>{if(Tt(g,p))return!0;if(Ze(g,"tree-node"))return"break"},{withSelf:!0,until:o});if(s=xt(f,g=>{if(Ze(g,"tree-node"))return!0},{withSelf:!0,until:o}),!!s){if(J=this.getNodeByElement(s),!J)throw"Can't find drag node";if(this.isDraggable(J))return this.$emit("before-drag-start",J),this.$emit("beforeDragStart",J),o}},onDragStart:l=>{var c,p,f;if(!s||!J)return;{const{x:S,y:I}=s.getBoundingClientRect(),{clientX:A,clientY:M}=l;(c=l.dataTransfer)==null||c.setDragImage(s,A-S,M-I)}ft={x:l.clientX,y:l.clientY},E=this,E.dragNode=J,We=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:l.clientX,y:l.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(s);{let S,I=0;if(this.table){let A=s.getBoundingClientRect();S={x:A.x,y:A.y},this.rtl&&(S.x=A.right),I=A.height}else if(!this.rtl)S=s.children[0].getBoundingClientRect().toJSON(),I=S.height;else{const A=s.children[0].getBoundingClientRect();S={x:A.right,y:A.y},I=A.height}return this.btt&&(S.y+=I),S}})(),this.dragOvering=!0;const g=E.getSiblings(E.dragNode),y=g.indexOf(J);Je={tree:E,dragNode:J,parent:J.parent,siblings:g,indexBeforeDrop:y},b=this,(p=l.dataTransfer)==null||p.setData("text",`he-tree drag start at ${new Date().toISOString()}`),E._eachDroppable()||setTimeout(()=>{J.hidden=!0,t(J.parent,y+1)},0),(f=this.ondragstart)==null||f.call(this,l)},onEnter:l=>{this.$emit("enter",l)},onLeave:l=>{ge=null,this.dragOvering=!1,le.preventDefault=!1,n(),this.$emit("leave",l)},onDragOver:Sn(l=>{if(!E){if(!this.onExternalDragOver||this.onExternalDragOver(l)===!1)return;le.preventDefault=!0}const c={x:l.clientX,y:l.clientY},p=e(c,a);if(a=c,!p)return;this.dragOvering=!0,b=this;const f=We?{x:We.x+(c.x-ft.x),y:We.y+(c.y-ft.y)}:{...c},{btt:g,rtl:y}=b;if(b.disableDrop){le.dropEffect="none";return}let S,I;const A=b.getRootEl().querySelectorAll(".tree-node"),M=[];A.forEach(_=>{!Tt(_,["drag-placeholder-wrapper","dragging-node"])&&Qe(_,"display")!=="none"&&M.push(_)});const re=gt(M,_=>ot(_)[g?"bottom":"top"]-f.y,{returnNearestIfNoHit:!0});let $=null,Q,Ce;re.hit||(re.greater?g||($=re.index-1,M[$]||$++):g&&($=re.index+1,M[$]||$--)),$==null&&($=re.index),Q=M[$],Ce=g?M[$-1]:M[$+1],S=Q&&b.getNodeByElement(Q),I=Ce&&b.getNodeByElement(Ce);const{indent:oe}=b,q=Ie(()=>{if(b.table){let _=ot(Q).toJSON();const F=oe*(S.level-1);return y?(_.width-=F,_.right-=F):_.x+=F,_}else return ot(Q.firstElementChild)}).action,De=Ie(()=>g?f.y>q().y+q().height/2:f.y<q().y+q().height/2).action,it=Ie(()=>g?!Q||$===M.length-1&&De():!Q||$===0&&De()).action,Be=Ie(()=>y?f.x-(q().x+q().width):q().x-f.x).action,P=Ie(()=>y?f.x<q().x+q().width-oe:f.x>q().x+oe).action;let w;if(it())w=1,S=null;else if(S)Be()>0?w=S.level-Math.ceil(Be()/oe):P()?w=S.level+1:w=S.level;else return;I&&w<I.level&&(w=I.level),(async()=>{let _,F,G=!1,z=null;const fe=async T=>{if(T.open)return!0;if(b.dragOpen)if(b.dragOpenDelay)if(z=T,ge===T)G=!0;else{let L=En();ge=T;const R=T;return setTimeout(async()=>{R!==ge?(G=!0,L.resolve(!0)):(b.beforeDragOpen&&await b.beforeDragOpen(T),R!==ge?(G=!0,L.resolve(!0)):(T.open=!0,z=null,L.resolve(!0)))},b.dragOpenDelay),await L.promise}else return b.beforeDragOpen&&await b.beforeDragOpen(T),T.open=!0,!0;else return!1},He=async()=>{if(b.isDroppable(S)&&await fe(S)){if(G)return;_=S,F=null}else return!1},Ke=(T=w)=>{let L=S,R=[];for(;L&&L.level>=T;)L=L.parent||null,R.unshift(L);let se=0;for(const pe of R){if(b.isDroppable(pe))return _=pe,F=R[se+1]||S,!0;se++}return!1};At=S||null,S?w>S.level?await He()===!1&&Ke(S.level):Ke()===!1&&await He():b.isDroppable(null)&&(_=null),ge=z;const Me=!!(!G&&(_||_===null));return{cancelled:G,success:Me,parent:_,index:Me?F?(_?_.children:b.stats).filter(T=>T.data!==b.placeholderData).indexOf(F)+1:0:-1}})().then(_=>{if(!_.cancelled){if(!_.success){i(!1);return}if(b.maxLevel!=null&&b.maxLevel>0){let F=1;if(E){const G=E.dragNode;let z=0;ee(G,fe=>{fe.level>z&&(z=fe.level)},{childrenKey:ve}),F=z-G.level+1}if(F+(_.parent?_.parent.level:0)>b.maxLevel){i(!1);return}}i(!0),t(_.parent,_.index)}})}),onDrop:l=>{b=this;const c=!E;if(!b)return;const p=E==null?void 0:E.dragNode;let f,g=(()=>{var y;let S=!0;if(!b.has(b.placeholderData))S=!1;else if(c)f=(y=this.externalDataHandler)==null?void 0:y.call(this,l),S=f!=null;else if(!E.dragCopy){const I=b.getStat(b.placeholderData);E===b&&I.parent===p.parent&&wn(p,A=>A===I)}return S})();if(g){const y=b.getStat(b.placeholderData),S=b.getSiblings(y);Le={tree:b,dragNode:p,parent:y.parent,siblings:S,indexBeforeDrop:S.indexOf(y)}}(()=>{if(h(),g){let y=Le.indexBeforeDrop;E&&!E.dragCopy&&E===b&&Je.parent==Le.parent&&Je.indexBeforeDrop<y&&y--,E&&E!==b&&!E._eachDroppable()&&E.batchUpdate(()=>{E.remove(p),E.updateCheck()}),b.batchUpdate(()=>{let S=E==null?void 0:E.dragNode,I;f?I=f:E._eachDroppable()&&(I=zt(E.dragNode.data,{childrenKey:E.childrenKey}),E.dragCopyDataHandler&&(I=E.dragCopyDataHandler(I))),I&&(b.add(I),S=b.getStat(I)),b.move(S,Le.parent,y),b.updateCheck()})}b.$emit("after-drop"),g&&(E&&(E.dragCopy||E.$emit("change")),b!==E&&b.$emit("change"))})()},onDragEnd:l=>{h(),E&&(E.dragNode&&(E.dragNode.hidden=!1),E.dragNode=null,E.dragOvering=!1,E=null),b=null,ge=null,J=null,At=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),ra={components:{Draggable:aa},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],data(){return{clip:null,menu:{},items:[],loading:!0,checked:!1,term:""}},setup(){const e=vt(),t=Fe(),n=_e();return{app:yt(),auth:n,languages:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.fetch().then(e=>{this.items=e.data,this.loading=!1})},computed:{canTrash(){return this.$refs.tree.statsFlat.some(e=>e.check&&!e.data.deleted_at)},isChecked(){return this.$refs.tree.statsFlat.some(e=>e.check)},isTrashed(){return this.$refs.tree.statsFlat.some(e=>e.check&&e.data.deleted_at)}},methods:{add(){if(this.embed||!this.auth.can("page:add")){this.messages.add("Permission denied","error");return}const e=this.create();this.$apollo.mutate({mutation:H`mutation ($input: PageInput!) {
            addPage(input: $input) {
              id
            }
          }`,variables:{input:e}}).then(t=>{if(t.errors)throw t.errors;e.id=t.data.addPage.id,e.published=!0,this.$refs.tree.add(e),this.$emit("select",e)}).catch(t=>{this.messages.add("Error adding root page","error"),this.$log("PageList::add(): Error adding root page",t)})},change(){if(!this.auth.can("page:move")){this.messages.add("Permission denied","error");return}const e=Te.targetInfo.parent,n=Te.targetInfo.siblings[Te.targetInfo.indexBeforeDrop+1]||null;this.$apollo.mutate({mutation:H`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:Te.startInfo.dragNode.data.id,parent:e?e.data.id:null,ref:n?n.data.id:null}}).then(r=>{if(r.errors)throw r.errors;const i=Te.startInfo.parent;i!=null&&i.data&&!(i!=null&&i.children.length)&&(i.data.has=!1),e&&(e.data.has=!0)}).catch(r=>{this.messages.add("Error moving page","error"),this.$log("PageList::change(): Error moving page",r)})},copy(e,t){this.clip={type:"copy",node:t,stat:e}},create(e={}){return Object.assign({path:"_"+Math.floor(Math.random()*1e4),lang:this.languages.current||this.languages.default(),status:0,cache:5},e)},cut(e,t){this.clip={type:"cut",node:t,stat:e}},debounce(e,t){let n;return function(...r){return new Promise((i,a)=>{const o=this;clearTimeout(n),n=setTimeout(()=>{try{i(e.apply(o,r))}catch(s){a(s)}},t)})}},drop(e){if(!this.auth.can("page:drop")){this.messages.add("Permission denied","error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>{var r;return n.check&&((r=n.data)==null?void 0:r.id)});t.length&&this.$apollo.mutate({mutation:H`mutation ($id: [ID!]!) {
            dropPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)this.update(r,i=>{i.data.deleted_at=new Date().toISOString().replace(/T/," ").substring(0,19),i.check=!1});this.invalidate()}).catch(n=>{this.messages.add("Error trashing page","error"),this.$log("PageList::drop(): Error trashing page",t,n)})},fetch(e=null,t=1,n=100){return this.auth.can("page:view")?this.$apollo.query({query:H`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:{parent_id:e},page:t,limit:n,trashed:this.filter.trashed||"WITHOUT"}}).then(r=>{if(r.errors)throw r.errors;return this.transform(r.data.pages)}).catch(r=>{this.messages.add("Error fetching pages","error"),this.$log("PageList::fetch(): Error fetching page",e,t,n,r)}):(this.messages.add("Permission denied","error"),Promise.resolve([]))},fields(){return`id
          parent_id
          lang
          path
          domain
          name
          title
          to
          tag
          type
          theme
          meta
          config
          status
          cache
          editor
          updated_at
          deleted_at
          has
          latest {
            id
            published
            publish_at
            data
            editor
            created_at
          }`},insert(e,t=null){if(!this.auth.can("page:add")){this.messages.add("Permission denied","error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,i=n.indexOf(e),a=this.create();let o=null;switch(t===null&&!e.open&&this.load(e,e.data),t){case 0:o=e.data.id;break;case null:o=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:o=n[i+1]?n[i+1].data.id:null;break}this.$apollo.mutate({mutation:H`mutation ($input: PageInput!, $parent: ID, $ref: ID) {
            addPage(input: $input, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{input:a,parent:r?r.data.id:null,ref:o}}).then(s=>{if(s.errors)throw s.errors;a.id=s.data.addPage.id,(t!==null||e.open)&&this.$refs.tree.add(a,r,t!==null?i+t:0),r&&(r.data.has=!0),this.invalidate()}).catch(s=>{this.messages.add("Error inserting page","error"),this.$log("PageList::insert(): Error inserting page",s)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"pages"}),e.gc()},keep(e){if(!this.auth.can("page:keep")){this.messages.add("Permission denied","error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(i=>i.check&&i.data.id&&i.data.deleted_at),n=t.filter(i=>t.indexOf(i.parent)===-1),r=e.data.deleted_at||null;n.length&&this.$apollo.mutate({mutation:H`mutation ($id: [ID!]!) {
            keepPage(id: $id) {
              id
            }
          }`,variables:{id:n.map(i=>i.data.id)}}).then(i=>{if(i.errors)throw i.errors;for(const a of n)this.update(a,o=>{r>=o.data.deleted_at&&(o.data.deleted_at=null,o.check=!1)});this.invalidate()}).catch(i=>{this.messages.add("Error restoring page","error"),this.$log("PageList::keep(): Error restoring page",n,i)})},load(e,t){!e.open&&!t.children&&(e.loading=!0,this.fetch(t.id,e.page?e.page+1:1).then(n=>{this.$refs.tree.addMulti(n.data,e,0),e.page=n.currentPage||1}).finally(()=>{e.loading=!1})),e.open=!e.open},move(e,t=null){if(!this.auth.can("page:move")){this.messages.add("Permission denied","error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,i=n.indexOf(e);let a=null;switch(t){case 0:a=e.data.id;break;case null:a=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:a=n[i+1]?n[i+1].data.id:null;break}this.$apollo.mutate({mutation:H`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:r?r.data.id:null,ref:a}}).then(o=>{var h;if(o.errors)throw o.errors;const s=t!==null?i<this.$refs.tree.getSiblings(e).indexOf(this.clip.stat)?i+t:i:0;this.$refs.tree.move(this.clip.stat,r,s),r&&((h=this.clip.stat.children)!=null&&h.length||(e.parent.data.has=!1),r.data.has=!0),this.invalidate()}).catch(o=>{this.messages.add("Error moving page","error"),this.$log("PageList::move(): Error moving page",e,t,o)}),this.show()},paste(e,t=null){if(!this.auth.can("page:add")){this.messages.add("Permission denied","error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,i=n.indexOf(e),a={...this.clip.node};let o=null;switch(a.path=a.path+"_"+Math.floor(Math.random()*1e4),a.status=0,a.children=null,a.has=!1,a.id=null,t){case 0:o=e.data.id;break;case null:o=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:o=n[i+1]?n[i+1].data.id:null;break}this.$apollo.mutate({mutation:H`mutation ($id: ID!, $parent: ID, $ref: ID) {
            addPage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:r?r.data.id:null,ref:o}}).then(s=>{if(s.errors)throw s.errors;const h=t!==null?this.$refs.tree.getSiblings(e).indexOf(e)+t:0;this.$refs.tree.add(a,r,h),r&&(r.data.has=!0),this.invalidate()}).catch(s=>{this.messages.add("Error copying page","error"),this.$log("PageList::paste(): Error copying page",e,t,s)}),this.show()},publish(e){if(!this.auth.can("page:publish")){this.messages.add("Permission denied","error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n.check&&n.data.id&&!n.data.published);t.length&&this.$apollo.mutate({mutation:H`mutation ($id: [ID!]!) {
            pubPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)r.data.published=!0,r.check=!1;this.invalidate()}).catch(n=>{this.messages.add("Error publishing page","error"),this.$log("PageList::publish(): Error publishing page",t,n)})},purge(e){if(!this.auth.can("page:purge")){this.messages.add("Permission denied","error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n.check&&n.data.id);t.length&&this.$apollo.mutate({mutation:H`mutation ($id: [ID!]!) {
            purgePage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id).reverse()}}).then(n=>{var r;if(n.errors)throw n.errors;for(const i of t)this.$refs.tree.remove(i),i.parent&&!((r=i.parent.children)!=null&&r.length)&&(i.parent.data.has=!1)}).catch(n=>{this.messages.add("Error purging page","error"),this.$log("PageList::purge(): Error purging page",t,n)})},search(e=1,t=100){if(!this.auth.can("page:view"))return this.messages.add("Permission denied","error"),Promise.resolve([]);const n=this.filter.publish||null,r=this.filter.trashed||"WITHOUT",i={...this.filter};return delete i.trashed,delete i.publish,this.term&&(i.any=this.term),this.$apollo.query({query:H`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:i,page:e,limit:t,trashed:r,publish:n}}).then(a=>{if(a.errors)throw a.errors;return this.transform(a.data.pages)}).catch(a=>{this.messages.add("Error searching pages","error"),this.$log("PageList::search(): Error searching pages",e,t,a)})},show(e=null){e===null?this.menu={}:this.menu[e]?this.menu[e]=!1:(this.menu={},this.menu[e]=!0)},status(e,t){if(!this.auth.can("page:save")){this.messages.add("Permission denied","error");return}(e?[e]:this.$refs.tree.statsFlat.filter(r=>r.check&&r.data.id)).forEach(r=>{this.$apollo.mutate({mutation:H`mutation ($id: ID!, $input: PageInput!) {
              savePage(id: $id, input: $input) {
                id
              }
            }`,variables:{id:r.data.id,input:{status:t}}}).then(i=>{if(i.errors)throw i.errors;r.data.status=t}).catch(i=>{this.messages.add("Error saving page","error"),this.$log("PageList::status(): Error saving page",r,t,i)})})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),e.theme&&t.push("Theme: "+e.theme),e.type&&t.push("Page type: "+e.type),e.tag&&t.push("Tag: "+e.tag),e.cache&&t.push("Cache: "+e.cache+" min"),t.join(`
`)},toggle(){this.$refs.tree.statsFlat.forEach(e=>{e.check=!e.check})},transform(e){return{data:e.data.map(n=>{var i,a,o,s,h,l;const r=(i=n.latest)!=null&&i.data?JSON.parse(((a=n.latest)==null?void 0:a.data)||"{}"):{...n,meta:JSON.parse(n.meta||"{}"),config:JSON.parse(n.config||"{}")};return Object.assign(r,{id:n.id,has:n.has,parent_id:n.parent_id,deleted_at:n.deleted_at,created_at:n.created_at,updated_at:((o=n.latest)==null?void 0:o.created_at)||n.updated_at,editor:((s=n.latest)==null?void 0:s.editor)||n.editor,published:((h=n.latest)==null?void 0:h.published)??!0,publish_at:((l=n.latest)==null?void 0:l.publish_at)||null,latest:n.latest})}),currentPage:e.paginatorInfo.currentPage,lastPage:e.paginatorInfo.lastPage}},update(e,t){var n;if(typeof t!="function")throw new Error("Second paramter must be a function");t(e),(n=e.children)==null||n.forEach(r=>{t(r,t)})},url(e){return this.app.urlpage.replace(/:domain/,e.domain||"").replace(/:path/,e.path||"").replace(/\/+$/,"/")}},watch:{filter:{deep:!0,handler(e){this.items=[],this.loading=!0,(e.publish?this.search():this.fetch()).then(n=>{this.items=n.data,this.loading=!1})}},term:{handler(){this.items=[],this.loading=!0,(this.term?this.searchd():this.fetch()).then(t=>{this.items=t.data,this.loading=!1})}}}},sa={class:"header"},ia={class:"bulk"},la={class:"search"},oa={key:0,class:"spinner",width:"24",height:"24",viewBox:"0 0 28 28",xmlns:"http://www.w3.org/2000/svg"},da=["title"],ua=["onClick"],ca={key:1,class:"item-lang"},ha={class:"item-title"},fa={key:2,class:"item-subtitle"},pa=["href"],ma={class:"item-domain"},ga={class:"item-path item-subtitle"},va={key:0,class:"item-to item-subtitle"},ya={key:0,class:"loading"},ba={key:1,class:"notfound"},ka={key:2,class:"btn-group"};function _a(e,t,n,r,i,a){const o=U("Draggable");return m(),O(B,null,[x("div",sa,[x("div",ia,[u(Ye,{modelValue:i.checked,"onUpdate:modelValue":t[0]||(t[0]=s=>i.checked=s),onClick:t[1]||(t[1]=ue(s=>a.toggle(),["stop"]))},null,8,["modelValue"]),u($e,null,{activator:d(({props:s})=>[u(D,Se({"append-icon":"mdi-menu-down",variant:"text"},s),{default:d(()=>t[15]||(t[15]=[k("Actions")])),_:2,__:[15]},1040)]),default:d(()=>[u(Ne,null,{default:d(()=>[a.isChecked&&r.auth.can("page:publish")?(m(),v(V,{key:0},{default:d(()=>[u(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=s=>a.publish())},{default:d(()=>t[16]||(t[16]=[k("Publish")])),_:1,__:[16]})]),_:1})):C("",!0),a.isChecked&&r.auth.can("page:save")?(m(),v(V,{key:1},{default:d(()=>[u(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:t[3]||(t[3]=s=>a.status(null,1))},{default:d(()=>t[17]||(t[17]=[k("Enable")])),_:1,__:[17]})]),_:1})):C("",!0),a.isChecked&&r.auth.can("page:save")?(m(),v(V,{key:2},{default:d(()=>[u(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:t[4]||(t[4]=s=>a.status(null,0))},{default:d(()=>t[18]||(t[18]=[k("Disable")])),_:1,__:[18]})]),_:1})):C("",!0),a.canTrash&&r.auth.can("page:drop")?(m(),v(V,{key:3},{default:d(()=>[u(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[5]||(t[5]=s=>a.drop())},{default:d(()=>t[19]||(t[19]=[k("Trash")])),_:1,__:[19]})]),_:1})):C("",!0),a.isTrashed&&r.auth.can("page:keep")?(m(),v(V,{key:4},{default:d(()=>[u(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[6]||(t[6]=s=>a.keep())},{default:d(()=>t[20]||(t[20]=[k("Restore")])),_:1,__:[20]})]),_:1})):C("",!0),a.isChecked&&r.auth.can("page:purge")?(m(),v(V,{key:5},{default:d(()=>[u(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[7]||(t[7]=s=>a.purge())},{default:d(()=>t[21]||(t[21]=[k("Purge")])),_:1,__:[21]})]),_:1})):C("",!0)]),_:1})]),_:1})]),x("div",la,[u(de,{modelValue:i.term,"onUpdate:modelValue":t[8]||(t[8]=s=>i.term=s),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:"Search for","hide-details":"",clearable:""},null,8,["modelValue"])])]),u(o,{modelValue:i.items,"onUpdate:modelValue":t[12]||(t[12]=s=>i.items=s),ref:"tree",defaultOpen:!1,disableDrag:!r.auth.can("page:move"),watermark:!1,virtualization:"",onChange:t[13]||(t[13]=s=>a.change())},{default:d(({node:s,stat:h})=>[h.loading?(m(),O("svg",oa,t[22]||(t[22]=[x("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),x("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),x("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)]))):(m(),v(ke,{key:1,class:j({hidden:!s.has}),size:"large",onClick:l=>a.load(h,s),icon:h.open?"mdi-menu-down":"mdi-menu-right"},null,8,["class","onClick","icon"])),u(Ye,{modelValue:h.check,"onUpdate:modelValue":l=>h.check=l,class:j({draft:!s.published})},null,8,["modelValue","onUpdate:modelValue","class"]),s.id?(m(),v($e,{key:2},{activator:d(({props:l})=>[u(D,Se({icon:"mdi-dots-vertical",variant:"text"},l),null,16)]),default:d(()=>[u(Ne,null,{default:d(()=>[!s.deleted_at&&!s.published&&r.auth.can("page:publish")?(m(),v(V,{key:0},{default:d(()=>[u(D,{"prepend-icon":"mdi-publish",variant:"text",onClick:l=>a.publish(h)},{default:d(()=>t[23]||(t[23]=[k("Publish")])),_:2,__:[23]},1032,["onClick"])]),_:2},1024)):C("",!0),s.status!==0&&r.auth.can("page:save")?(m(),v(V,{key:1},{default:d(()=>[u(D,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:l=>a.status(h,0)},{default:d(()=>t[24]||(t[24]=[k("Disable")])),_:2,__:[24]},1032,["onClick"])]),_:2},1024)):C("",!0),s.status!==1&&r.auth.can("page:save")?(m(),v(V,{key:2},{default:d(()=>[u(D,{"prepend-icon":"mdi-eye",variant:"text",onClick:l=>a.status(h,1)},{default:d(()=>t[25]||(t[25]=[k("Enable")])),_:2,__:[25]},1032,["onClick"])]),_:2},1024)):C("",!0),s.status!==2&&r.auth.can("page:save")?(m(),v(V,{key:3},{default:d(()=>[u(D,{"prepend-icon":"mdi-eye-off-outline",variant:"text",onClick:l=>a.status(h,2)},{default:d(()=>t[26]||(t[26]=[k("Hide in menu")])),_:2,__:[26]},1032,["onClick"])]),_:2},1024)):C("",!0),r.auth.can("page:move")?(m(),v(V,{key:4},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:l=>a.cut(h,s)},{default:d(()=>t[27]||(t[27]=[k("Cut")])),_:2,__:[27]},1032,["onClick"])]),_:2},1024)):C("",!0),!this.embed&&r.auth.can("page:add")?(m(),v(V,{key:5},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:l=>a.copy(h,s)},{default:d(()=>t[28]||(t[28]=[k("Copy")])),_:2,__:[28]},1032,["onClick"])]),_:2},1024)):C("",!0),!this.embed&&r.auth.can("page:add")?(m(),v(V,{key:6},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[9]||(t[9]=ue(l=>a.show("insert"),["stop"]))},{default:d(()=>t[29]||(t[29]=[k("Insert")])),_:1,__:[29]})]),_:1})):C("",!0),i.menu.insert&&!this.embed&&r.auth.can("page:add")?(m(),v(ie,{key:7},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.insert(h,0)},{default:d(()=>t[30]||(t[30]=[k(" Before")])),_:2,__:[30]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.menu.insert&&!this.embed&&r.auth.can("page:add")?(m(),v(ie,{key:8},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.insert(h)},{default:d(()=>t[31]||(t[31]=[k(" Into")])),_:2,__:[31]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.menu.insert&&!this.embed&&r.auth.can("page:add")?(m(),v(ie,{key:9},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.insert(h,1)},{default:d(()=>t[32]||(t[32]=[k(" After")])),_:2,__:[32]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.clip&&i.clip.type=="copy"&&!this.embed&&r.auth.can("page:add")?(m(),v(V,{key:10},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[10]||(t[10]=ue(l=>a.show("paste"),["stop"]))},{default:d(()=>t[33]||(t[33]=[k("Paste")])),_:1,__:[33]})]),_:1})):C("",!0),i.clip&&i.clip.type=="copy"&&i.menu.paste&&!this.embed&&r.auth.can("page:add")?(m(),v(ie,{key:11},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.paste(h,0)},{default:d(()=>t[34]||(t[34]=[k(" Before")])),_:2,__:[34]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.clip&&i.clip.type=="copy"&&i.menu.paste&&!this.embed&&r.auth.can("page:add")?(m(),v(ie,{key:12},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.paste(h)},{default:d(()=>t[35]||(t[35]=[k(" Into")])),_:2,__:[35]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.clip&&i.clip.type=="copy"&&i.menu.paste&&!this.embed&&r.auth.can("page:add")?(m(),v(ie,{key:13},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.paste(h,1)},{default:d(()=>t[36]||(t[36]=[k(" After")])),_:2,__:[36]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.clip&&i.clip.type=="cut"&&r.auth.can("page:move")?(m(),v(V,{key:14},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[11]||(t[11]=ue(l=>a.show("move"),["stop"]))},{default:d(()=>t[37]||(t[37]=[k("Paste")])),_:1,__:[37]})]),_:1})):C("",!0),i.clip&&i.clip.type=="cut"&&i.menu.move&&r.auth.can("page:move")?(m(),v(ie,{key:15},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.move(h,0)},{default:d(()=>t[38]||(t[38]=[k(" Before")])),_:2,__:[38]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.clip&&i.clip.type=="cut"&&i.menu.move&&r.auth.can("page:move")?(m(),v(ie,{key:16},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.move(h)},{default:d(()=>t[39]||(t[39]=[k(" Into")])),_:2,__:[39]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),i.clip&&i.clip.type=="cut"&&i.menu.move&&r.auth.can("page:move")?(m(),v(ie,{key:17},{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:l=>a.move(h,1)},{default:d(()=>t[40]||(t[40]=[k(" After")])),_:2,__:[40]},1032,["onClick"])]),_:2},1024)]),_:2},1024)):C("",!0),!s.deleted_at&&r.auth.can("page:drop")?(m(),v(V,{key:18},{default:d(()=>[u(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:l=>a.drop(h)},{default:d(()=>t[41]||(t[41]=[k("Trash")])),_:2,__:[41]},1032,["onClick"])]),_:2},1024)):C("",!0),s.deleted_at&&r.auth.can("page:keep")?(m(),v(V,{key:19},{default:d(()=>[u(D,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:l=>a.keep(h)},{default:d(()=>t[42]||(t[42]=[k("Restore")])),_:2,__:[42]},1032,["onClick"])]),_:2},1024)):C("",!0),r.auth.can("page:purge")?(m(),v(V,{key:20},{default:d(()=>[u(D,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:l=>a.purge(h)},{default:d(()=>t[43]||(t[43]=[k("Purge")])),_:2,__:[43]},1032,["onClick"])]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1024)):C("",!0),x("div",{class:j(["item-content",{"status-hidden":s.status==2,"status-enabled":s.status==1,"status-disabled":!s.status,trashed:s.deleted_at}]),title:a.title(s)},[x("div",{class:"item-text",onClick:l=>e.$emit("select",s)},[s.publish_at?(m(),v(ke,{key:0,class:"publish-at",icon:"mdi-clock-outline"})):C("",!0),s.lang?(m(),O("span",ca,N(s.lang),1)):C("",!0),x("span",ha,N(s.name||"New"),1),s.title?(m(),O("div",fa,N(s.title),1)):C("",!0)],8,ua),x("a",{class:"item-aux",href:a.url(s),target:"_blank",draggable:"false"},[x("div",ma,N(s.domain),1),x("span",ga,N(a.url(s)),1),s.to?(m(),O("span",va,"  "+N(s.to),1)):C("",!0)],8,pa)],10,da)]),_:1},8,["modelValue","disableDrag"]),i.loading?(m(),O("p",ya,t[44]||(t[44]=[k(" Loading "),x("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[x("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),x("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),x("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1)]))):C("",!0),!i.loading&&!i.items.length?(m(),O("p",ba," No items found ")):C("",!0),!i.loading&&!i.items.length&&!this.embed&&this.auth.can("page:add")?(m(),O("div",ka,[u(D,{onClick:t[14]||(t[14]=s=>a.add()),icon:"mdi-folder-plus",color:"primary",elevation:"0"})])):C("",!0)],64)}const Ca=Z(ra,[["render",_a]]),Da={data:()=>({active:{},open:[0,1,2]}),setup(){const e=bt(),t=je();return{drawer:e,side:t}},computed:{stores(){const e=Object.keys(this.side.store).sort(),t={};for(const n of e)t[n]=this.side.store[n];return t}},methods:{isActive(e,t){return typeof this.active[e]>"u"&&(this.active[e]={}),typeof this.active[e][t]>"u"&&(this.active[e][t]=!1),this.active[e][t]},sort(e){const t=Object.keys(e).sort(),n={};for(const r of t)n[r]=e[r];return n},toggle(e,t){this.side.toggle(e,t),this.active[e][t]=!this.active[e][t]}}},wa={class:"name"},Sa={class:"value"};function Ea(e,t,n,r,i,a){return m(),v(tn,{modelValue:r.drawer.aside,"onUpdate:modelValue":t[1]||(t[1]=o=>r.drawer.aside=o),"mobile-breakpoint":"md",location:"end"},{default:d(()=>[u(Ne,{opened:e.open,"onUpdate:opened":t[0]||(t[0]=o=>e.open=o)},{default:d(()=>[(m(!0),O(B,null,ae(a.stores,(o,s)=>he((m(),v(nn,{key:s,value:Object.keys(a.stores).indexOf(s)},{activator:d(({props:h})=>[u(V,Se({ref_for:!0},h),{default:d(()=>[k(N(s),1)]),_:2},1040)]),default:d(()=>[(m(!0),O(B,null,ae(o,(h,l)=>(m(),v(V,{key:l,active:a.isActive(s,l),onClick:c=>a.toggle(s,l),rounded:"lg"},{default:d(()=>[x("span",wa,N(l),1),x("span",Sa,N(h),1)]),_:2},1032,["active","onClick"]))),128))]),_:2},1032,["value"])),[[nt,Object.keys(o).length]])),128))]),_:1},8,["opened"])]),_:1},8,["modelValue"])}const Pa=Z(Da,[["render",Ea],["__scopeId","data-v-b089c62f"]]),Oa={components:{Fields:Ot,SchemaItems:Pt},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=Fe(),t=kt(),n=je();return{auth:_e(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.meta||(this.item.meta={}),this.item.meta[el.type]){this.messages.add("Element is already available","error");return}this.item.meta[item.type]={id:Xe(),type:item.type,data:{}},this.panel.push(Object.keys(this.item.meta).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.meta||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.meta[e])!=null&&t.fields?(n=this.schemas.meta[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.meta[e]},reset(){Object.values(this.item.meta||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const r of Object.values(this.item.meta||{}))r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){return Object.values(e.data||{}).map(t=>t&&typeof t!="object"&&typeof t!="boolean"?t:null).filter(t=>!!t).join(" - ").substring(0,50)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}}},Va={class:"element-title"},Ia={class:"element-type"},xa={key:0,class:"btn-group"};function Ta(e,t,n,r,i,a){const o=U("Fields"),s=U("SchemaItems"),h=at("observe-visibility");return m(),O(B,null,[he((m(),v(Ee,null,{default:d(()=>[u(Pe,null,{default:d(()=>[u(Ct,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=l=>e.panel=l),elevation:"0",multiple:""},{default:d(()=>[(m(!0),O(B,null,ae(n.item.meta||{},(l,c)=>he((m(),v(Dt,{key:c,class:j({changed:l._changed,error:l._error})},{default:d(()=>[u(wt,{"expand-icon":"mdi-pencil"},{default:d(()=>[r.auth.can("page:save")?(m(),v(D,{key:0,icon:"mdi-delete",variant:"text",onClick:p=>a.remove(c)},null,8,["onClick"])):C("",!0),x("div",Va,N(a.title(l)),1),x("div",Ia,N(l.type),1)]),_:2},1024),u(St,null,{default:d(()=>[u(o,{ref_for:!0,ref:"field",data:l.data,"onUpdate:data":p=>l.data=p,files:l.files,"onUpdate:files":p=>l.files=p,readonly:!r.auth.can("page:save"),fields:a.fields(l.type),assets:n.assets,onError:p=>a.error(l,p),onChange:p=>a.update(l)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","onError","onChange"])]),_:2},1024)]),_:2},1032,["class"])),[[nt,a.shown(l)]])),128))]),_:1},8,["modelValue"]),a.available&&r.auth.can("page:save")?(m(),O("div",xa,[u(D,{icon:"mdi-view-grid-plus",color:"primary",onClick:t[1]||(t[1]=l=>e.vschemas=!0),elevation:"0"})])):C("",!0)]),_:1})]),_:1})),[[h,a.store]]),(m(),v(rt,{to:"body"},[u(_t,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=l=>e.vschemas=l),scrollable:"",width:"auto"},{default:d(()=>[u(s,{type:"meta",onAdd:t[2]||(t[2]=l=>a.add(l))})]),_:1},8,["modelValue"])]))],64)}const La=Z(Oa,[["render",Ta],["__scopeId","data-v-07f1a1c8"]]),Ua={props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({errors:{}}),setup(){const e=vt(),t=jt(),n=je(),r=_e();return{app:yt(),auth:r,side:n,config:t,languages:e}},computed:{langs(){const e=[{code:null,name:"None"}];return Object.entries(this.languages.available).forEach(t=>{e.push({code:t[0],name:t[1]})}),e},readonly(){return!this.auth.can("page:save")}},methods:{reset(){this.errors={}},store(e=!0){e&&this.validate().then(t=>{let n={};t!==!0&&(n={error:t}),this.side.store={state:n}})},update(e,t){this.item[e]=t,this.$emit("change",!0),this.validate(),this.store()},updatePath(e){var t,n,r;!e&&((t=this.item.path)==null?void 0:t.at(0))==="_"&&(this.item.path=(r=(n=this.item.name)==null?void 0:n.replace(/[ ]+/g,"-"))==null?void 0:r.toLowerCase())},async validate(){await this.$nextTick();const e=[];return Object.values(this.$refs).forEach(t=>{e.push(t.validate())}),Promise.all(e).then(t=>{const n=t.reduce((r,i)=>r+i.length,0);return this.$emit("error",!!n),n||!0})}},watch:{item:{deep:!0,immediate:!0,handler(e){this.validate()}}}};function $a(e,t,n,r,i,a){const o=at("observe-visibility");return he((m(),v(Ee,null,{default:d(()=>[u(Pe,null,{default:d(()=>[u(qe,null,{default:d(()=>[u(me,{cols:"12",md:"6"},{default:d(()=>[u(Ve,{ref:"status",items:[{key:0,val:"Disabled"},{key:1,val:"Enabled"},{key:2,val:"Hidden in navigation"}],readonly:a.readonly,modelValue:n.item.status,"onUpdate:modelValue":t[0]||(t[0]=s=>a.update("status",s)),variant:"underlined","item-title":"val","item-value":"key",label:"Status"},null,8,["readonly","modelValue"])]),_:1}),u(me,{cols:"12",md:"6"},{default:d(()=>[u(Ve,{ref:"lang",items:a.langs,readonly:a.readonly,modelValue:n.item.lang,"onUpdate:modelValue":t[1]||(t[1]=s=>a.update("lang",s)),variant:"underlined","item-title":"name","item-value":"code",label:"Language"},null,8,["items","readonly","modelValue"])]),_:1})]),_:1}),u(qe,null,{default:d(()=>[u(me,{cols:"12",md:"6"},{default:d(()=>[u(de,{ref:"name",rules:[s=>!!s||"The field is required"],readonly:a.readonly,modelValue:n.item.name,"onUpdate:modelValue":t[2]||(t[2]=s=>a.update("name",s)),"onUpdate:focused":t[3]||(t[3]=s=>a.updatePath(s)),variant:"underlined",label:"Page name",counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue"]),u(de,{ref:"title",readonly:a.readonly,modelValue:n.item.title,"onUpdate:modelValue":t[4]||(t[4]=s=>a.update("title",s)),variant:"underlined",label:"Page title",counter:"255",maxlength:"255"},null,8,["readonly","modelValue"])]),_:1}),u(me,{cols:"12",md:"6"},{default:d(()=>[u(de,{ref:"path",rules:[s=>!!s||"The field is required"],readonly:a.readonly,modelValue:n.item.path,"onUpdate:modelValue":t[5]||(t[5]=s=>a.update("path",s)),variant:"underlined",label:"URL path",counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue"]),u(de,{ref:"domain",readonly:a.readonly,modelValue:n.item.domain,"onUpdate:modelValue":t[6]||(t[6]=s=>a.update("domain",s)),variant:"underlined",label:"Domain",counter:"255",maxlength:"255"},null,8,["readonly","modelValue"])]),_:1})]),_:1}),u(qe,null,{default:d(()=>[u(me,{cols:"12",md:"6"},{default:d(()=>[u(Ve,{ref:"theme",readonly:a.readonly,items:Object.keys(r.config.get("themes",{default:""})),modelValue:n.item.theme,"onUpdate:modelValue":t[7]||(t[7]=s=>{a.update("theme",s),n.item.type=""}),variant:"underlined",label:"Theme"},null,8,["readonly","items","modelValue"]),u(Ve,{ref:"type",readonly:a.readonly,items:Object.keys(r.config.get(`themes.${n.item.theme||""}.types`,{default:""})),modelValue:n.item.type,"onUpdate:modelValue":t[8]||(t[8]=s=>a.update("type",s)),variant:"underlined",label:"Page type"},null,8,["readonly","items","modelValue"])]),_:1}),u(me,{cols:"12",md:"6"},{default:d(()=>[u(de,{ref:"tag",modelValue:n.item.tag,"onUpdate:modelValue":[t[9]||(t[9]=s=>n.item.tag=s),t[10]||(t[10]=s=>a.update())],readonly:a.readonly,label:"Page tag",variant:"underlined",counter:"30",maxlength:"30"},null,8,["modelValue","readonly"]),u(Ve,{ref:"cache",items:[{key:0,val:"No cache"},{key:1,val:"1 minute"},{key:5,val:"5 minutes"},{key:15,val:"15 minutes"},{key:30,val:"30 minutes"},{key:60,val:"1 hour"},{key:180,val:"3 hours"},{key:360,val:"6 hours"},{key:720,val:"12 hours"},{key:1440,val:"24 hours"}],readonly:a.readonly,modelValue:n.item.cache,"onUpdate:modelValue":t[11]||(t[11]=s=>a.update("cache",s)),variant:"underlined",label:"Cache time","item-title":"val","item-value":"key"},null,8,["readonly","modelValue"])]),_:1})]),_:1}),u(qe,null,{default:d(()=>[u(me,{cols:"12"},{default:d(()=>[u(de,{ref:"to",rules:[s=>!s||s.match("^((https?:)?//([^\\s/:@]+(:[^\\s/:@]+)?@)?([0-9a-z]+(\\.|-))*[0-9a-z]+\\.[a-z]{2,}(:[0-9]{1,5})?)?(/[^\\s]*)*$")!==null||"URL is not valid"],readonly:a.readonly,modelValue:n.item.to,"onUpdate:modelValue":t[12]||(t[12]=s=>a.update("to",s)),variant:"underlined",label:"Redirect URL",counter:"255",maxlength:"255"},null,8,["rules","readonly","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})),[[o,a.store]])}const Na=Z(Ua,[["render",$a]]),Aa={components:{Fields:Ot,SchemaItems:Pt},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=Fe(),t=kt(),n=je();return{auth:_e(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.config||(this.item.config={}),this.item.config[e.type]){this.messages.add("Element is already available","error");return}this.item.config[e.type]={id:Xe(),type:e.type,data:{}},this.panel.push(Object.keys(this.item.config).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.config||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.config[e])!=null&&t.fields?(n=this.schemas.config[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.config[e]},reset(){Object.values(this.item.config||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const r of Object.values(this.item.config||{}))r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){return Object.values(e.data||{}).map(t=>t&&typeof t!="object"&&typeof t!="boolean"?t:null).filter(t=>!!t).join(" - ").substring(0,50)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}}},Fa={class:"element-title"},ja={class:"element-type"},Ba={key:0,class:"btn-group"};function Ha(e,t,n,r,i,a){const o=U("Fields"),s=U("SchemaItems"),h=at("observe-visibility");return m(),O(B,null,[he((m(),v(Ee,null,{default:d(()=>[u(Pe,null,{default:d(()=>[u(Ct,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=l=>e.panel=l),elevation:"0",multiple:""},{default:d(()=>[(m(!0),O(B,null,ae(n.item.config||{},(l,c)=>he((m(),v(Dt,{key:c,class:j({changed:l._changed,error:l._error})},{default:d(()=>[u(wt,{"expand-icon":"mdi-pencil"},{default:d(()=>[r.auth.can("page:save")?(m(),v(D,{key:0,icon:"mdi-delete",variant:"text",onClick:p=>a.remove(c)},null,8,["onClick"])):C("",!0),x("div",Fa,N(a.title(l)),1),x("div",ja,N(l.type),1)]),_:2},1024),u(St,null,{default:d(()=>[u(o,{ref_for:!0,ref:"field",data:l.data,"onUpdate:data":p=>l.data=p,files:l.files,"onUpdate:files":p=>l.files=p,readonly:!r.auth.can("page:save"),fields:a.fields(l.type),assets:n.assets,onError:p=>a.error(l,p),onChange:p=>a.update(l)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","onError","onChange"])]),_:2},1024)]),_:2},1032,["class"])),[[nt,a.shown(l)]])),128))]),_:1},8,["modelValue"]),a.available&&r.auth.can("page:save")?(m(),O("div",Ba,[u(D,{icon:"mdi-view-grid-plus",color:"primary",onClick:t[1]||(t[1]=l=>e.vschemas=!0),elevation:"0"})])):C("",!0)]),_:1})]),_:1})),[[h,a.store]]),(m(),v(rt,{to:"body"},[u(_t,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=l=>e.vschemas=l),scrollable:"",width:"auto"},{default:d(()=>[u(s,{type:"config",onAdd:t[2]||(t[2]=l=>a.add(l))})]),_:1},8,["modelValue"])]))],64)}const Ka=Z(Aa,[["render",Ha],["__scopeId","data-v-a64cc9b8"]]),Ma={components:{PageDetailItemMeta:La,PageDetailItemProps:Na,PageDetailItemConfig:Ka},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["update:item","update:aside","error"],data:()=>({changed:{},errors:{},tab:"details"}),methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){var e,t,n;this.changed={},this.errors={},(e=this.$refs.props)==null||e.reset(),(t=this.$refs.meta)==null||t.reset(),(n=this.$refs.config)==null||n.reset()},update(e){this.changed[e]=!0,this.$emit("update:item",this.item)},validate(){const e=Object.values(this.$refs).map(t=>t.validate());return Promise.all(e).then(t=>t.every(n=>n))}}};function Ra(e,t,n,r,i,a){const o=U("PageDetailItemProps"),s=U("PageDetailItemMeta"),h=U("PageDetailItemConfig");return m(),v(Ee,null,{default:d(()=>[u(Pe,{class:"box"},{default:d(()=>[u(st,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=l=>e.tab=l),"align-tabs":"center"},{default:d(()=>[u(ce,{value:"details",class:j({changed:e.changed.details,error:e.errors.details}),onClick:t[0]||(t[0]=l=>e.$emit("update:aside","meta"))},{default:d(()=>t[11]||(t[11]=[k("Detail")])),_:1,__:[11]},8,["class"]),u(ce,{value:"meta",class:j({changed:e.changed.meta,error:e.errors.meta}),onClick:t[1]||(t[1]=l=>e.$emit("update:aside","count"))},{default:d(()=>t[12]||(t[12]=[k("Meta")])),_:1,__:[12]},8,["class"]),u(ce,{value:"config",class:j({changed:e.changed.config,error:e.errors.config}),onClick:t[2]||(t[2]=l=>e.$emit("update:aside","count"))},{default:d(()=>t[13]||(t[13]=[k("Config")])),_:1,__:[13]},8,["class"])]),_:1},8,["modelValue"]),u(Et,{modelValue:e.tab,"onUpdate:modelValue":t[10]||(t[10]=l=>e.tab=l)},{default:d(()=>[u(be,{value:"details"},{default:d(()=>[u(o,{ref:"props",item:n.item,assets:n.assets,onChange:t[4]||(t[4]=l=>a.update("details")),onError:t[5]||(t[5]=l=>a.error("details",l))},null,8,["item","assets"])]),_:1}),u(be,{value:"meta"},{default:d(()=>[u(s,{ref:"meta",item:n.item,assets:n.assets,onChange:t[6]||(t[6]=l=>a.update("meta")),onError:t[7]||(t[7]=l=>a.error("meta",l))},null,8,["item","assets"])]),_:1}),u(be,{value:"config"},{default:d(()=>[u(h,{ref:"config",item:n.item,assets:n.assets,onChange:t[8]||(t[8]=l=>a.update("config")),onError:t[9]||(t[9]=l=>a.error("config",l))},null,8,["item","assets"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const qa=Z(Ma,[["render",Ra],["__scopeId","data-v-2dc7cec1"]]),za={components:{ElementListItems:hn,SchemaItems:Pt},props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","add"]};function Wa(e,t,n,r,i,a){const o=U("SchemaItems"),s=U("ElementListItems");return m(),v(_t,{modelValue:n.modelValue,"max-width":"1200",scrollable:""},{default:d(()=>[u(an,null,{append:d(()=>[u(ke,{onClick:t[0]||(t[0]=h=>e.$emit("update:modelValue",!1))},{default:d(()=>t[3]||(t[3]=[k("mdi-close")])),_:1,__:[3]})]),title:d(()=>t[4]||(t[4]=[k(" Content Elements ")])),default:d(()=>[u(rn),u(sn,null,{default:d(()=>[u(o,{type:"content",onAdd:t[1]||(t[1]=h=>e.$emit("add",h))}),u(st,null,{default:d(()=>[u(ce,null,{default:d(()=>t[5]||(t[5]=[k("Shared elements")])),_:1,__:[5]})]),_:1}),u(s,{onSelect:t[2]||(t[2]=h=>e.$emit("add",h)),embed:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Ja=Z(za,[["render",Wa],["__scopeId","data-v-c6a0c11d"]]),Ya={components:{Fields:Ot,SchemaDialog:Ja,VueDraggable:fn},props:{section:{type:[String,null],default:null},item:{type:Object,required:!0},contents:{type:Array,required:!0},elements:{type:Object,required:!0},assets:{type:Object,default:()=>({})}},emits:["error","update:contents","update:elements"],data:()=>({list:[],panel:[],menu:{},clip:null,index:null,checked:!1,vschemas:!1,currentPage:1,lastPage:1}),setup(){const e=Fe(),t=kt(),n=je();return{auth:_e(),side:n,messages:e,schemas:t}},computed:{changed(){return this.list.some(e=>e._changed)}},methods:{add(e,t){let n={id:Xe(),group:this.section||"main"};e.id?(n=Object.assign(n,{type:"reference",refid:e.id}),this.$emit("update:elements",Object.assign(this.elements,{[e.id]:e}))):n=Object.assign(n,{type:e.type,data:{}}),t!==null?(this.list.splice(t,0,n),this.panel.push(this.panel.includes(t)?t+1:t)):(this.list.push(n),this.panel.push(this.list.length-1)),this.vschemas=!1,this.store()},clean(e){for(const t in e)t.startsWith("_")&&delete e[t];return e},copy(e){const t=JSON.parse(JSON.stringify(this.list[e]));t.id=null,this.clip={type:"copy",index:e,content:t}},cut(e){this.clip={type:"cut",index:e,content:this.list[e]},this.list.splice(e,1),this.store()},error(e,t){e._error=t,this.$emit("error",this.list.some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.content[e])!=null&&t.fields?(n=this.schemas.content[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" schemas`),[])},insert(e){this.index=e,this.vschemas=!0},paste(e){this.list.splice(e,0,this.clip.content),this.clip=null,this.store()},purge(){for(let e=this.list.length-1;e>=0;e--)this.list[e]._checked&&this.remove(e);this.checked=!1},remove(e){this.list.splice(e,1),this.$emit("update:contents",this.list),this.$emit("error",this.list.some(t=>t._error)),this.store()},reset(){for(const e of this.list)delete e._changed,delete e._error},search(e){this.list.forEach(t=>{t._hide=e!==""&&!JSON.stringify(t).toLocaleLowerCase().includes(e)})},share(e){if(!this.auth.can("element:add")){this.messages.add("Permission denied","error");return}const t=this.list[e];if(!t){this.messages.add("Element not found","error");return}if(t.type==="reference"){this.messages.add("Element is already shared","error");return}this.$apollo.mutate({mutation:H`
            mutation($input: ElementInput!, $files: [ID!]) {
              addElement(input: $input, files: $files) {
                id
                type
                lang
                name
                data
                editor
                updated_at
                files {
                  id
                }
              }
            }
          `,variables:{input:{type:t.type,lang:this.item.lang,name:this.title(t),data:JSON.stringify(this.clean(t))},files:t.files.filter((n,r,i)=>i.indexOf(n)===r)}}).then(n=>{if(n.errors)throw n.errors;const r=n.data.addElement;r.data=JSON.parse(r.data),r.files=r.files.map(i=>i.id),this.$emit("update:elements",Object.assign(this.elements,{[r.id]:r})),this.list[e]={id:Xe(),group:this.section||"main",type:"reference",refid:r.id},this.store()}).catch(n=>{this.messages.add("Unable to make element shared","error"),this.$log("PageDetailContentList::share(): Error making element shared",e,n)})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return!e._hide&&this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};this.list.forEach(r=>{r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1)}),this.side.store={type:t,state:n}},title(e){return Object.values(e.data||{}).map(t=>t&&typeof t!="object"&&typeof t!="boolean"?t:null).filter(t=>!!t).join(" - ").substring(0,50)||e.type||""},toggle(){this.list.forEach(e=>{this.shown(e)&&(e._checked=!e._checked)})},unshare(e){if(!this.list[e]){this.messages.add("Content element not found","error");return}const t=this.list[e];if(t.type!=="reference"||!this.elements[t.refid]){this.messages.add("Element is not shared","error");return}for(const n of this.elements[t.refid].files||[])this.assets[n.id]=n;this.list[e]=this.elements[t.refid].data||{},this.store()},update(e){e._changed=!0,e.group=this.section||"main",this.$emit("update:contents",this.list),this.$emit("error",this.list.some(t=>t._error)),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}},watch:{contents:{immediate:!0,handler(e,t){const n=t||[],r=e||[];n.length===r.length&&n.every((i,a)=>i===r[a])||(this.list=this.contents,this.store())}},list:{handler(e){this.$emit("update:contents",e)}}}},Xa={class:"header"},Ga={key:0,class:"bulk"},Za={class:"element-title"},Qa={class:"element-type"},er={key:0,class:"btn-group"};function tr(e,t,n,r,i,a){const o=U("Fields"),s=U("VueDraggable"),h=U("SchemaDialog"),l=at("observe-visibility");return m(),O(B,null,[he((m(),O("div",null,[x("div",Xa,[r.auth.can("page:save")?(m(),O("div",Ga,[u(Ye,{modelValue:e.checked,"onUpdate:modelValue":t[0]||(t[0]=c=>e.checked=c),onClick:t[1]||(t[1]=ue(c=>a.toggle(),["stop"]))},null,8,["modelValue"]),u($e,{location:"bottom right"},{activator:d(({props:c})=>[u(D,Se({"append-icon":"mdi-menu-down",variant:"text"},c),{default:d(()=>t[11]||(t[11]=[k("Actions")])),_:2,__:[11]},1040)]),default:d(()=>[u(Ne,null,{default:d(()=>[u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[2]||(t[2]=c=>a.purge())},{default:d(()=>t[12]||(t[12]=[k("Delete")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})])):C("",!0),u(de,{"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:"Search for",class:"search",clearable:"","hide-details":"",onInput:t[3]||(t[3]=c=>a.search(c.target.value)),"onClick:clear":t[4]||(t[4]=c=>a.search(""))})]),u(Ct,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[7]||(t[7]=c=>e.panel=c),elevation:"0",multiple:""},{default:d(()=>[u(s,{modelValue:e.list,"onUpdate:modelValue":t[6]||(t[6]=c=>e.list=c),disabled:!r.auth.can("page:save"),draggable:".content",group:"contents"},{default:d(()=>[(m(!0),O(B,null,ae(e.list,(c,p)=>he((m(),v(Dt,{key:p,class:j(["content",{changed:c._changed,error:c._error}])},{default:d(()=>[u(wt,{"expand-icon":"mdi-pencil"},{default:d(()=>{var f;return[r.auth.can("page:save")?(m(),v(Ye,{key:0,modelValue:c._checked,"onUpdate:modelValue":g=>c._checked=g,onClick:t[5]||(t[5]=ue(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])):C("",!0),r.auth.can("page:save")?(m(),v($e,{key:1},{activator:d(({props:g})=>[u(D,Se({icon:"mdi-dots-vertical",variant:"text",ref_for:!0},g),null,16)]),default:d(()=>[u(Ne,null,{default:d(()=>[c._error?C("",!0):(m(),v(V,{key:0},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:g=>a.copy(p)},{default:d(()=>t[13]||(t[13]=[k("Copy")])),_:2,__:[13]},1032,["onClick"])]),_:2},1024)),c._error?C("",!0):(m(),v(V,{key:1},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:g=>a.cut(p)},{default:d(()=>t[14]||(t[14]=[k("Cut")])),_:2,__:[14]},1032,["onClick"])]),_:2},1024)),c._error?C("",!0):(m(),v(V,{key:2},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:g=>a.insert(p)},{default:d(()=>t[15]||(t[15]=[k("Insert before")])),_:2,__:[15]},1032,["onClick"])]),_:2},1024)),c._error?C("",!0):(m(),v(V,{key:3},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:g=>a.insert(p+1)},{default:d(()=>t[16]||(t[16]=[k("Insert after")])),_:2,__:[16]},1032,["onClick"])]),_:2},1024)),!c._error&&e.clip?(m(),v(V,{key:4},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:g=>a.paste(p)},{default:d(()=>t[17]||(t[17]=[k("Paste before")])),_:2,__:[17]},1032,["onClick"])]),_:2},1024)):C("",!0),!c._error&&e.clip?(m(),v(V,{key:5},{default:d(()=>[u(D,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:g=>a.paste(p+1)},{default:d(()=>t[18]||(t[18]=[k("Paste after")])),_:2,__:[18]},1032,["onClick"])]),_:2},1024)):C("",!0),u(V,null,{default:d(()=>[u(D,{"prepend-icon":"mdi-delete",variant:"text",onClick:g=>a.remove(p)},{default:d(()=>t[19]||(t[19]=[k("Delete")])),_:2,__:[19]},1032,["onClick"])]),_:2},1024),!c._error&&c.type!=="reference"&&r.auth.can("element:add")?(m(),v(V,{key:6},{default:d(()=>[u(D,{"prepend-icon":"mdi-link",variant:"text",onClick:g=>a.share(p)},{default:d(()=>t[20]||(t[20]=[k("Make shared")])),_:2,__:[20]},1032,["onClick"])]),_:2},1024)):C("",!0),c.type==="reference"?(m(),v(V,{key:7},{default:d(()=>[u(D,{"prepend-icon":"mdi-link-off",variant:"text",onClick:g=>a.unshare(p)},{default:d(()=>t[21]||(t[21]=[k("Merge copy")])),_:2,__:[21]},1032,["onClick"])]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1024)):C("",!0),c.type==="reference"?(m(),v(ke,{key:2,class:"icon-shared",icon:"mdi-link",title:"Shared element"})):C("",!0),x("div",Za,N(c.type==="reference"?(f=n.elements[c.refid])==null?void 0:f.name:a.title(c)),1),x("div",Qa,N(c.type),1)]}),_:2},1024),u(St,null,{default:d(()=>{var f,g;return[c.type==="reference"?(m(),v(o,{key:0,data:((f=n.elements[c.refid])==null?void 0:f.data)||{},fields:a.fields((g=n.elements[c.refid])==null?void 0:g.type),assets:n.assets,readonly:!0},null,8,["data","fields","assets"])):(m(),v(o,{key:1,ref_for:!0,ref:"field",data:c.data,"onUpdate:data":y=>c.data=y,files:c.files,"onUpdate:files":y=>c.files=y,readonly:!r.auth.can("page:save"),fields:a.fields(c.type),assets:n.assets,onError:y=>a.error(c,y),onChange:y=>a.update(c)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","onError","onChange"]))]}),_:2},1024)]),_:2},1032,["class"])),[[nt,a.shown(c)]])),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue"]),r.auth.can("page:save")?(m(),O("div",er,[u(D,{onClick:t[8]||(t[8]=c=>e.vschemas=!0),icon:"mdi-view-grid-plus",color:"primary",elevation:"0"})])):C("",!0)])),[[l,a.store]]),(m(),v(rt,{to:"body"},[u(h,{modelValue:e.vschemas,"onUpdate:modelValue":t[9]||(t[9]=c=>e.vschemas=c),onAdd:t[10]||(t[10]=c=>a.add(c,e.index))},null,8,["modelValue"])]))],64)}const nr=Z(Ya,[["render",tr],["__scopeId","data-v-643e0581"]]),ar={components:{PageDetailContentList:nr},props:{item:{type:Object,required:!0},contents:{type:Array,required:!0},elements:{type:Object,required:!0},assets:{type:Object,default:()=>({})}},emits:["error","update:contents","update:elements"],data:()=>({changed:{},errors:{},tab:"default"}),setup(){return{config:jt()}},computed:{names(){const e=this.item.type||"default",t=this.item.theme||"default";return this.config.get(`themes.${t}.types.${e}.sections`,["main"])},sections(){if(this.names.length<=1)return{};const e={};for(const t of this.names)e[t]=[];for(const t of this.contents){const n=t.group||"main";e[n]||(e[n]=[]),e[n].push(t)}return e}},methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){this.changed={},this.errors={},Object.values(this.$refs).map(e=>e.reset())},update(e,t){const n=this.sections;n[e]=t;const r=Object.values(n).reduce((i,a)=>i.concat(a),[]);this.$emit("update:contents",r),this.changed[e]=!0},validate(){const e=Object.values(this.$refs).map(t=>t.validate());return Promise.all(e).then(t=>t.every(n=>n))}}},rr={key:0};function sr(e,t,n,r,i,a){const o=U("PageDetailContentList");return m(),v(Ee,null,{default:d(()=>[u(Pe,{class:"box"},{default:d(()=>[Object.keys(a.sections).length>1?(m(),O("div",rr,[u(st,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=s=>e.tab=s),"align-tabs":"center"},{default:d(()=>[(m(!0),O(B,null,ae(a.sections,(s,h)=>(m(),v(ce,{key:h,class:j({changed:e.changed[h],error:e.errors[h]}),value:h},{default:d(()=>[k(N(h),1)]),_:2},1032,["class","value"]))),128))]),_:1},8,["modelValue"]),u(Et,{modelValue:e.tab,"onUpdate:modelValue":t[2]||(t[2]=s=>e.tab=s)},{default:d(()=>[(m(!0),O(B,null,ae(a.sections,(s,h)=>(m(),v(be,{key:h,value:h},{default:d(()=>[u(o,{section:h,item:n.item,contents:s,elements:n.elements,assets:n.assets,"onUpdate:contents":l=>a.update(h,l),"onUpdate:elements":t[1]||(t[1]=l=>e.$emit("update:elements",l)),onError:l=>a.error(h,l)},null,8,["section","item","contents","elements","assets","onUpdate:contents","onError"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])):(m(),v(o,{key:1,item:n.item,contents:n.contents,elements:n.elements,assets:n.assets,"onUpdate:contents":t[3]||(t[3]=s=>e.$emit("update:contents",s)),"onUpdate:elements":t[4]||(t[4]=s=>e.$emit("update:elements",s)),onError:t[5]||(t[5]=s=>e.$emit("error",s))},null,8,["item","contents","elements","assets"]))]),_:1})]),_:1})}const ir=Z(ar,[["render",sr],["__scopeId","data-v-d723b545"]]),lr={props:{item:{type:Object,required:!0}},emits:["update:item"],setup(){return{app:yt()}},computed:{url(){return this.app.urlpage.replace(/:domain/,this.item.domain||"").replace(/:path/,this.item.path||"").replace(/\/+$/,"/")}}},or=["src"];function dr(e,t,n,r,i,a){return m(),O("iframe",{ref:"preview",src:a.url},null,8,or)}const ur=Z(lr,[["render",dr]]),cr={components:{AsideMeta:cn,AsideCount:Pa,HistoryDialog:un,PageDetailItem:qa,PageDetailContent:ir,PageDetailPreview:ur},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({tab:"page",aside:"meta",asidePage:"meta",changed:{},errors:{},assets:{},elements:{},contents:[],latest:null,pubmenu:null,publishAt:null,vhistory:!1}),setup(){const e=Fe(),t=bt();return{auth:_e(),drawer:t,messages:e}},computed:{hasChanged(){return Object.values(this.changed).some(e=>e)},hasError(){return Object.values(this.errors).some(e=>e)}},created(){var e;!((e=this.item)!=null&&e.id)||!this.auth.can("page:view")||this.$apollo.query({query:H`query($id: ID!) {
          page(id: $id) {
            id
            contents
            files {
              id
              lang
              mime
              name
              path
              previews
              description
              updated_at
              editor
            }
            elements {
              id
              type
              data
              editor
              updated_at
              files {
                id
                lang
                mime
                name
                path
                previews
                description
                updated_at
                editor
              }
            }
            latest {
              id
              published
              data
              contents
              editor
              created_at
              files {
                id
                lang
                mime
                name
                path
                previews
                description
                updated_at
                editor
              }
              elements {
                id
                type
                data
                name
                editor
                updated_at
                files {
                  id
                  lang
                  mime
                  name
                  path
                  previews
                  description
                  updated_at
                  editor
                }
              }
            }
          }
        }`,variables:{id:this.item.id}}).then(t=>{var r,i,a;if(t.errors||!t.data.page)throw t;const n=t.data.page;this.reset(),this.assets={},this.elements={},this.latest=n.latest,this.contents=JSON.parse(((r=this.latest)==null?void 0:r.contents)||n.contents||"[]");for(const o of((i=this.latest)==null?void 0:i.elements)||n.elements||[])this.elements[o.id]={...o,data:JSON.parse(o.data||"{}"),files:(o.files||[]).map(s=>({...s,previews:JSON.parse(s.previews||"{}"),description:JSON.parse(s.description||"{}")}))};for(const o of((a=this.latest)==null?void 0:a.files)||n.files||[])this.assets[o.id]={...o,previews:JSON.parse(o.previews||"{}"),description:JSON.parse(o.description||"{}")};for(const o of this.contents)o.files&&Array.isArray(o.files)&&(o.files=o.files.filter(s=>typeof this.assets[s]<"u"))}).catch(t=>{this.messages.add("Error fetching page","error"),this.$log("PageDetail::watch(item): Error fetching page",t)})},methods:{clean(e){for(const t in e)for(const n in e[t])n.startsWith("_")&&delete e[t][n];return e},publish(e=null){if(!this.auth.can("page:publish")){this.messages.add("Permission denied","error");return}this.save(!0).then(t=>{var n,r;t&&this.$apollo.mutate({mutation:H`mutation ($id: [ID!]!, $at: DateTime) {
              pubPage(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(r=(n=e==null?void 0:e.toISOString())==null?void 0:n.substring(0,19))==null?void 0:r.replace("T"," ")}}).then(i=>{if(i.errors)throw i.errors;e?(this.item.publish_at=e,this.messages.add(`Page scheduled for publishing at ${e.toLocaleDateString()}`,"info")):(this.item.published=!0,this.messages.add("Page published successfully","success")),this.closeView()}).catch(i=>{this.messages.add("Error publishing page","error"),this.$log("PageDetail::publish(): Error publishing page",e,i)})})},reset(){var e,t;(e=this.$refs.page)==null||e.reset(),(t=this.$refs.contents)==null||t.reset(),this.changed={},this.errors={}},save(e=!1){return this.auth.can("page:save")?this.hasChanged?this.validate().then(t=>{if(!t)return this.messages.add("There are invalid fields, please resolve the errors first","error"),t;const n=[];for(const a of this.contents||[])n.push(...a.files||[]);const r={};for(const a in this.item.meta||{})r[a]={type:this.item.meta[a].type||"",data:this.item.meta[a].data||{},files:this.item.meta[a].files||[]},n.push(...this.item.meta[a].files||[]);const i={};for(const a in this.item.config||{})i[a]={type:this.item.config[a].type||"",data:this.item.config[a].data||{},files:this.item.config[a].files||[]},n.push(...this.item.config[a].files||[]);return this.$apollo.mutate({mutation:H`mutation ($id: ID!, $input: PageInput!, $elements: [ID!], $files: [ID!]) {
              savePage(id: $id, input: $input, elements: $elements, files: $files) {
                id
              }
            }`,variables:{id:this.item.id,input:{cache:this.item.cache||0,domain:this.item.domain||"",lang:this.item.lang||"",name:this.item.name||"",path:this.item.path||"",status:this.item.status||0,title:this.item.title||"",tag:this.item.tag||"",to:this.item.to||"",type:this.item.type||"",theme:this.item.theme||"",meta:JSON.stringify(this.clean(r)),config:JSON.stringify(this.clean(i)),contents:JSON.stringify(this.clean(this.contents))},elements:Object.keys(this.elements),files:n.filter((a,o,s)=>s.indexOf(a)===o)}}).then(a=>{if(a.errors)throw a.errors;return this.item.published=!1,this.reset(),e||this.messages.add("Page saved successfully","success"),!0}).catch(a=>{this.messages.add("Error saving page","error"),this.$log("PageDetail::save(): Error saving page",a)})}):Promise.resolve(!0):(this.messages.add("Permission denied","error"),Promise.resolve(!1))},update(e,t){e==="page"?Object.assign(this.item,t):this[e]=t,this.changed[e]=!0},use(e){Object.assign(this.item,e.data),this.contents=e.contents,this.changed.contents=!0,this.changed.page=!0,this.vhistory=!1},validate(){var e,t;return Promise.all([(e=this.$refs.page)==null?void 0:e.validate(),(t=this.$refs.contents)==null?void 0:t.validate()].filter(n=>n)).then(n=>n.every(r=>r))},versions(e){return this.auth.can("page:view")?e?this.$apollo.query({query:H`query($id: ID!) {
            page(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                contents
                editor
                created_at
              }
            }
          }`,variables:{id:e}}).then(t=>{if(t.errors||!t.data.page)throw t;return(t.data.page.versions||[]).map(n=>({...n,data:JSON.parse(n.data||"{}"),contents:n.contents?JSON.parse(n.contents):null})).reverse()}).catch(t=>{this.messages.add("Error fetching page versions","error"),this.$log("PageDetail::versions(): Error fetching page versions",e,t)}):Promise.resolve([]):(this.messages.add("Permission denied","error"),Promise.resolve([]))}},watch:{asidePage(e){this.aside=e}}},hr={class:"app-title"},fr={class:"menu-content"};function pr(e,t,n,r,i,a){const o=U("PageDetailItem"),s=U("PageDetailContent"),h=U("PageDetailPreview"),l=U("AsideMeta"),c=U("AsideCount"),p=U("HistoryDialog");return m(),O(B,null,[u(Bt,{elevation:0,density:"compact"},{prepend:d(()=>[u(D,{icon:"mdi-keyboard-backspace",onClick:t[0]||(t[0]=f=>a.closeView()),elevation:"0"})]),append:d(()=>[u(D,{icon:"mdi-history",class:j({hidden:n.item.published&&!a.hasChanged&&!e.latest}),onClick:t[1]||(t[1]=f=>e.vhistory=!0),elevation:"0"},null,8,["class"]),u(D,{class:j([{error:a.hasError},"menu-save"]),disabled:!a.hasChanged||a.hasError||!r.auth.can("page:save"),onClick:t[2]||(t[2]=f=>a.save()),variant:"text"},{default:d(()=>t[23]||(t[23]=[k("Save")])),_:1,__:[23]},8,["class","disabled"]),u($e,{modelValue:e.pubmenu,"onUpdate:modelValue":t[6]||(t[6]=f=>e.pubmenu=f),"close-on-content-click":!1},{activator:d(({props:f})=>[u(on,{class:"menu-publish",variant:"text"},{default:d(()=>[u(D,{class:j([{error:a.hasError},"button"]),disabled:n.item.published&&!a.hasChanged||a.hasError||!r.auth.can("page:publish"),onClick:t[3]||(t[3]=g=>a.publish())},{default:d(()=>t[24]||(t[24]=[k("Publish")])),_:1,__:[24]},8,["class","disabled"]),u(D,Se({class:[{error:a.hasError},"icon"],icon:"mdi-menu-down",disabled:n.item.published&&!a.hasChanged||a.hasError||!r.auth.can("page:publish")},f),null,16,["class","disabled"])]),_:2},1024)]),default:d(()=>[x("div",fr,[u(ln,{modelValue:e.publishAt,"onUpdate:modelValue":t[4]||(t[4]=f=>e.publishAt=f),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),u(D,{disabled:!e.publishAt||a.hasError,color:e.publishAt?"primary":"",onClick:t[5]||(t[5]=f=>{a.publish(e.publishAt),e.pubmenu=!1}),variant:"flat"},{default:d(()=>t[25]||(t[25]=[k("Publish")])),_:1,__:[25]},8,["disabled","color"])])]),_:1},8,["modelValue"]),u(D,{onClick:t[7]||(t[7]=ue(f=>r.drawer.toggle("aside"),["stop"]))},{default:d(()=>[u(ke,{size:"x-large"},{default:d(()=>[k(N(r.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"),1)]),_:1})]),_:1})]),default:d(()=>[u(Kt,null,{default:d(()=>[x("div",hr," Page: "+N(n.item.name),1)]),_:1})]),_:1}),u(Ht,{class:"page-details"},{default:d(()=>[u(dn,{onSubmit:t[19]||(t[19]=ue(()=>{},["prevent"]))},{default:d(()=>[u(st,{"fixed-tabs":"",modelValue:e.tab,"onUpdate:modelValue":t[11]||(t[11]=f=>e.tab=f)},{default:d(()=>[u(ce,{value:"page",class:j({changed:e.changed.page,error:e.errors.page}),onClick:t[8]||(t[8]=f=>e.aside=e.asidePage)},{default:d(()=>t[26]||(t[26]=[k("Page")])),_:1,__:[26]},8,["class"]),u(ce,{value:"contents",class:j({changed:e.changed.contents,error:e.errors.contents}),onClick:t[9]||(t[9]=f=>e.aside="count")},{default:d(()=>t[27]||(t[27]=[k("Content")])),_:1,__:[27]},8,["class"]),u(ce,{value:"preview",onClick:t[10]||(t[10]=f=>e.aside="")},{default:d(()=>t[28]||(t[28]=[k("Preview")])),_:1,__:[28]})]),_:1},8,["modelValue"]),u(Et,{modelValue:e.tab,"onUpdate:modelValue":t[18]||(t[18]=f=>e.tab=f)},{default:d(()=>[u(be,{value:"page"},{default:d(()=>[u(o,{ref:"page",item:n.item,assets:e.assets,"onUpdate:item":t[12]||(t[12]=f=>a.update("page",f)),"onUpdate:aside":t[13]||(t[13]=f=>e.asidePage=f),onError:t[14]||(t[14]=f=>e.errors.page=f)},null,8,["item","assets"])]),_:1}),u(be,{value:"contents"},{default:d(()=>[u(s,{ref:"contents",item:n.item,assets:e.assets,elements:e.elements,contents:e.contents,"onUpdate:contents":t[15]||(t[15]=f=>a.update("contents",f)),"onUpdate:elements":t[16]||(t[16]=f=>a.update("elements",f)),onError:t[17]||(t[17]=f=>e.errors.contents=f)},null,8,["item","assets","elements","contents"])]),_:1}),u(be,{value:"preview"},{default:d(()=>[u(h,{item:n.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e.aside==="meta"?(m(),v(l,{key:0,item:n.item},null,8,["item"])):C("",!0),e.aside==="count"?(m(),v(c,{key:1})):C("",!0),(m(),v(rt,{to:"body"},[u(p,{modelValue:e.vhistory,"onUpdate:modelValue":t[20]||(t[20]=f=>e.vhistory=f),current:{data:{cache:n.item.cache,domain:n.item.domain,lang:n.item.lang,name:n.item.name,path:n.item.path,status:n.item.status,title:n.item.title,tag:n.item.tag,to:n.item.to,type:n.item.type,theme:n.item.theme,meta:a.clean(n.item.meta),config:a.clean(n.item.config)},contents:a.clean(e.contents)},load:()=>a.versions(n.item.id),onUse:t[21]||(t[21]=f=>a.use(f)),onRevert:t[22]||(t[22]=f=>{a.use(f),a.reset()})},null,8,["modelValue","current","load"])]))],64)}const Ft=Z(cr,[["render",pr],["__scopeId","data-v-6cae20e5"]]),mr={components:{PageListItems:Ca,PageDetail:Ft,Navigation:Qt,AsideList:Zt,User:Gt},inject:["openView"],data:()=>({filter:{trashed:"WITHOUT",publish:null,editor:null,lang:null}}),setup(){const e=vt(),t=bt();return{auth:_e(),drawer:t,languages:e}},methods:{languages(){const e=[{title:"All",icon:"mdi-playlist-check",value:{lang:null}}];for(const t in this.languages.available)e.push({title:this.languages.available[t],icon:"mdi-translate",value:{lang:t}});return e},open(e){this.openView(Ft,{item:e})}}};function gr(e,t,n,r,i,a){var c;const o=U("User"),s=U("Navigation"),h=U("PageListItems"),l=U("AsideList");return m(),O(B,null,[u(Bt,{elevation:0,density:"compact"},{prepend:d(()=>[u(D,{onClick:t[0]||(t[0]=p=>r.drawer.toggle("nav"))},{default:d(()=>[u(ke,{size:"x-large"},{default:d(()=>[k(N(r.drawer.nav?"mdi-close":"mdi-menu"),1)]),_:1})]),_:1})]),append:d(()=>[u(o),u(D,{onClick:t[1]||(t[1]=p=>r.drawer.toggle("aside"))},{default:d(()=>[u(ke,{size:"x-large"},{default:d(()=>[k(N(r.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"),1)]),_:1})]),_:1})]),default:d(()=>[u(Kt,null,{default:d(()=>t[4]||(t[4]=[k("Pages")])),_:1,__:[4]})]),_:1}),u(s),u(Ht,{class:"page-list"},{default:d(()=>[u(Ee,null,{default:d(()=>[u(Pe,{class:"box"},{default:d(()=>[u(h,{onSelect:t[2]||(t[2]=p=>a.open(p)),filter:e.filter},null,8,["filter"])]),_:1})]),_:1})]),_:1}),u(l,{filter:e.filter,"onUpdate:filter":t[3]||(t[3]=p=>e.filter=p),content:[{key:"publish",items:[{title:"All",icon:"mdi-playlist-check",value:{publish:null}},{title:"Published",icon:"mdi-publish",value:{publish:"PUBLISHED"}},{title:"Scheduled",icon:"mdi-clock-outline",value:{publish:"SCHEDULED"}},{title:"Drafts",icon:"mdi-pencil",value:{publish:"DRAFT"}}]},{key:"trashed",items:[{title:"All",icon:"mdi-playlist-check",value:{trashed:"WITH"}},{title:"Available only",icon:"mdi-delete-off",value:{trashed:"WITHOUT"}},{title:"Only trashed",icon:"mdi-delete",value:{trashed:"ONLY"}}]},{key:"editor",items:[{title:"All",icon:"mdi-playlist-check",value:{editor:null}},{title:"Edited by me",icon:"mdi-account",value:{editor:(c=this.auth.me)==null?void 0:c.email}}]},{key:"lang",items:a.languages()}]},null,8,["filter","content"])],64)}const Dr=Z(mr,[["render",gr],["__scopeId","data-v-a952b4ca"]]);export{Dr as default};
